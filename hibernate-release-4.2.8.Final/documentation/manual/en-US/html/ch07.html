<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 7. Collection mapping</title><link rel="stylesheet" type="text/css" href="css/hibernate.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"/><link rel="home" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java"/><link rel="up" href="index.html" title="HIBERNATE - Relational Persistence for Idiomatic Java"/><link rel="prev" href="ch06.html" title="Chapter 6. Types"/><link rel="next" href="ch08.html" title="Chapter 8. Association Mappings"/><link rel="copyright" href="ln-d5e19.html" title="Legal Notice"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch06.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="ch08.html"><strong>Next</strong></a></li></ul><div class="chapter" title="Chapter 7. Collection mapping"><div class="titlepage"><div><div><h2 class="title"><a id="collections"/>Chapter 7. Collection mapping</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="section"><a href="ch07.html#collections-persistent">7.1. Persistent collections</a></span></dt><dt><span class="section"><a href="ch07.html#collections-mapping">7.2. How to map collections</a></span></dt><dd><dl><dt><span class="section"><a href="ch07.html#collections-foreignkeys">7.2.1. Collection foreign keys</a></span></dt><dt><span class="section"><a href="ch07.html#collections-indexed">7.2.2. Indexed collections</a></span></dt><dt><span class="section"><a href="ch07.html#collections-ofvalues">7.2.3. Collections of basic types and embeddable objects</a></span></dt></dl></dd><dt><span class="section"><a href="ch07.html#collections-advancedmappings">7.3. Advanced collection mappings</a></span></dt><dd><dl><dt><span class="section"><a href="ch07.html#collections-sorted">7.3.1. Sorted collections</a></span></dt><dt><span class="section"><a href="ch07.html#collections-bidirectional">7.3.2. Bidirectional associations</a></span></dt><dt><span class="section"><a href="ch07.html#collections-indexedbidirectional">7.3.3. Bidirectional associations with indexed collections</a></span></dt><dt><span class="section"><a href="ch07.html#collections-ternary">7.3.4. Ternary associations</a></span></dt><dt><span class="section"><a href="ch07.html#collections-idbag">7.3.5. <code class="literal">Using an &lt;idbag&gt;</code></a></span></dt></dl></dd><dt><span class="section"><a href="ch07.html#collections-example">7.4. Collection examples</a></span></dt></dl></div>
  

  <div class="section" title="7.1. Persistent collections"><div class="titlepage"><div><div><h2 class="title"><a id="collections-persistent"/>7.1. Persistent collections</h2></div></div></div>
    

    <p>Naturally Hibernate also allows to persist collections. These
    persistent collections can contain almost any other Hibernate type,
    including: basic types, custom types, components and references to other
    entities. The distinction between value and reference semantics is in this
    context very important. An object in a collection might be handled with
    "value" semantics (its life cycle fully depends on the collection owner),
    or it might be a reference to another entity with its own life cycle. In
    the latter case, only the "link" between the two objects is considered to
    be a state held by the collection.</p>

    <p>As a requirement persistent collection-valued fields must be
    declared as an interface type (see <a class="xref" href="ch07.html#example.collection.mapping.annotations" title="Example 7.2. Collection mapping using @OneToMany and @JoinColumn">Example 7.2, “Collection mapping using @OneToMany and @JoinColumn”</a>). The actual interface
    might be <code class="literal">java.util.Set</code>,
    <code class="literal">java.util.Collection</code>,
    <code class="literal">java.util.List</code>, <code class="literal">java.util.Map</code>,
    <code class="literal">java.util.SortedSet</code>,
    <code class="literal">java.util.SortedMap</code> or anything you like ("anything you
    like" means you will have to write an implementation of
    <code class="literal">org.hibernate.usertype.UserCollectionType</code>).</p>

    <p>Notice how in <a class="xref" href="ch07.html#example.collection.mapping.annotations" title="Example 7.2. Collection mapping using @OneToMany and @JoinColumn">Example 7.2, “Collection mapping using @OneToMany and @JoinColumn”</a> the instance variable
    <code class="literal">parts</code> was initialized with an instance of
    <code class="literal">HashSet</code>. This is the best way to initialize collection
    valued properties of newly instantiated (non-persistent) instances. When
    you make the instance persistent, by calling <code class="literal">persist()</code>,
    Hibernate will actually replace the <code class="literal">HashSet</code> with an
    instance of Hibernate's own implementation of <code class="literal">Set</code>. Be
    aware of the following error:</p>

    <div class="example"><a id="d5e5071"/><p class="title"><strong>Example 7.1. Hibernate uses its own collection implementations</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">Cat cat = new DomesticCat();
Cat kitten = new DomesticCat();
....
Set kittens = new HashSet();
kittens.add(kitten);
cat.setKittens(kittens);
session.persist(cat);

kittens = cat.getKittens(); // Okay, kittens collection is a Set
(HashSet) cat.getKittens(); // Error!</pre>
    </div></div><br class="example-break"/>

    <p>The persistent collections injected by Hibernate behave like
    <code class="literal">HashMap</code>, <code class="literal">HashSet</code>,
    <code class="literal">TreeMap</code>, <code class="literal">TreeSet</code> or
    <code class="literal">ArrayList</code>, depending on the interface type.</p>

    <p>Collections instances have the usual behavior of value types. They
    are automatically persisted when referenced by a persistent object and are
    automatically deleted when unreferenced. If a collection is passed from
    one persistent object to another, its elements might be moved from one
    table to another. Two entities cannot share a reference to the same
    collection instance. Due to the underlying relational model,
    collection-valued properties do not support null value semantics.
    Hibernate does not distinguish between a null collection reference and an
    empty collection.</p>

    <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>
      <p>Use persistent collections the same way you use ordinary Java
      collections. However, ensure you understand the semantics of
      bidirectional associations (see <a class="xref" href="ch07.html#collections-bidirectional" title="7.3.2. Bidirectional associations">Section 7.3.2, “Bidirectional associations”</a>).</p>
    </div>
  </div>

  <div class="section" title="7.2. How to map collections"><div class="titlepage"><div><div><h2 class="title"><a id="collections-mapping"/>7.2. How to map collections</h2></div></div></div>
    

    <p>Using annotations you can map <code class="classname">Collection</code>s,
    <code class="classname">List</code>s, <code class="classname">Map</code>s and
    <code class="classname">Set</code>s of associated entities using @OneToMany and
    @ManyToMany. For collections of a basic or embeddable type use
    @ElementCollection. In the simplest case a collection mapping looks like
    this:</p>

    <div class="example"><a id="example.collection.mapping.annotations"/><p class="title"><strong>Example 7.2. Collection mapping using @OneToMany and @JoinColumn</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Entity
public class Product {

    private String serialNumber;
    private Set&lt;Part&gt; parts = new HashSet&lt;Part&gt;();

    @Id
    public String getSerialNumber() { return serialNumber; }
    void setSerialNumber(String sn) { serialNumber = sn; }
   
    @OneToMany
    @JoinColumn(name="PART_ID")
    public Set&lt;Part&gt; getParts() { return parts; }
    void setParts(Set parts) { this.parts = parts; }
}


@Entity
public class Part {
   ...
}</pre>
    </div></div><br class="example-break"/>

    <p>Product describes a unidirectional relationship with Part using the
    join column PART_ID. In this unidirectional one to many scenario you can
    also use a join table as seen in <a class="xref" href="ch07.html#example-one-to-many-with-join-table" title="Example 7.3. Collection mapping using @OneToMany and @JoinTable">Example 7.3, “Collection mapping using @OneToMany and @JoinTable”</a>.</p>

    <div class="example"><a id="example-one-to-many-with-join-table"/><p class="title"><strong>Example 7.3. Collection mapping using @OneToMany and @JoinTable</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Entity
public class Product {

    private String serialNumber;
    private Set&lt;Part&gt; parts = new HashSet&lt;Part&gt;();

    @Id
    public String getSerialNumber() { return serialNumber; }
    void setSerialNumber(String sn) { serialNumber = sn; }
   
    @OneToMany
    @JoinTable(
            name="PRODUCT_PARTS",
            joinColumns = @JoinColumn( name="PRODUCT_ID"),
            inverseJoinColumns = @JoinColumn( name="PART_ID")
    )
    public Set&lt;Part&gt; getParts() { return parts; }
    void setParts(Set parts) { this.parts = parts; }
}


@Entity
public class Part {
   ...
}</pre>
    </div></div><br class="example-break"/>

    <p>Without describing any physical mapping (no
    <code class="classname">@JoinColumn</code> or <code class="classname">@JoinTable</code>),
    a unidirectional one to many with join table is used. The table name is
    the concatenation of the owner table name, _, and the other side table
    name. The foreign key name(s) referencing the owner table is the
    concatenation of the owner table, _, and the owner primary key column(s)
    name. The foreign key name(s) referencing the other side is the
    concatenation of the owner property name, _, and the other side primary
    key column(s) name. A unique constraint is added to the foreign key
    referencing the other side table to reflect the one to many.</p>

    <p>Lets have a look now how collections are mapped using Hibernate
    mapping files. In this case the first step is to chose the right mapping
    element. It depends on the type of interface. For example, a
    <code class="literal">&lt;set&gt;</code> element is used for mapping properties of
    type <code class="literal">Set</code>.</p>

    <div class="example"><a id="example.collections.set"/><p class="title"><strong>Example 7.4. Mapping a Set using &lt;set&gt;</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;class name="Product"&gt;
    &lt;id name="serialNumber" column="productSerialNumber"/&gt;
    &lt;set name="parts"&gt;
        &lt;key column="productSerialNumber" not-null="true"/&gt;
        &lt;one-to-many class="Part"/&gt;
    &lt;/set&gt;
&lt;/class&gt;</pre>
    </div></div><br class="example-break"/>

    <p>In <a class="xref" href="ch07.html#example.collections.set" title="Example 7.4. Mapping a Set using &lt;set&gt;">Example 7.4, “Mapping a Set using &lt;set&gt;”</a> a
    <span class="emphasis"><em>one-to-many association</em></span> links the
    <code class="literal">Product</code> and <code class="literal">Part</code> entities. This
    association requires the existence of a foreign key column and possibly an
    index column to the <code class="literal">Part</code> table. This mapping loses
    certain semantics of normal Java collections:</p>

    <div class="itemizedlist"><ul class="itemizedlist" compact="compact"><li class="listitem">
        <p>An instance of the contained entity class cannot belong to more
        than one instance of the collection.</p>
      </li><li class="listitem">
        <p>An instance of the contained entity class cannot appear at more
        than one value of the collection index.</p>
      </li></ul></div>

    <p>Looking closer at the used <code class="literal">&lt;one-to-many&gt;</code>
    tag we see that it has the following options.</p>

    <div class="example"><a id="d5e5121"/><p class="title"><strong>Example 7.5. options of &lt;one-to-many&gt; element</strong></p><div class="example-contents">
      

      <div class="programlistingco"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;one-to-many
        class="ClassName"                                  <span class="co" id="onetomany1"><img src="images/callouts/1.png" alt="(1)"/></span>
        not-found="ignore|exception"                       <span class="co" id="onetomany2"><img src="images/callouts/2.png" alt="(2)"/></span>
        entity-name="EntityName"                           <span class="co" id="onetomany3"><img src="images/callouts/3.png" alt="(3)"/></span>
        node="element-name"
        embed-xml="true|false"
    /&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/1.png" alt="1" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">class</code> (required): the name of the
            associated class.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/2.png" alt="2" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">not-found</code> (optional - defaults to
            <code class="literal">exception</code>): specifies how cached identifiers
            that reference missing rows will be handled.
            <code class="literal">ignore</code> will treat a missing row as a null
            association.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/3.png" alt="3" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">entity-name</code> (optional): the entity name
            of the associated class, as an alternative to
            <code class="literal">class</code>.</p>
          </td></tr></table></div></div>
    </div></div><br class="example-break"/>

    <p>The <code class="literal">&lt;one-to-many&gt;</code> element does not need to
    declare any columns. Nor is it necessary to specify the
    <code class="literal">table</code> name anywhere.</p>

    <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Warning</h2>
      <p>If the foreign key column of a
      <code class="literal">&lt;one-to-many&gt;</code> association is declared
      <code class="literal">NOT NULL</code>, you must declare the
      <code class="literal">&lt;key&gt;</code> mapping
      <code class="literal">not-null="true"</code> or <span class="emphasis"><em>use a bidirectional
      association</em></span> with the collection mapping marked
      <code class="literal">inverse="true"</code>. See <a class="xref" href="ch07.html#collections-bidirectional" title="7.3.2. Bidirectional associations">Section 7.3.2, “Bidirectional associations”</a>.</p>
    </div>

    <p>Apart from the <code class="literal">&lt;set&gt; </code>tag as shown in <a class="xref" href="ch07.html#example.collections.set" title="Example 7.4. Mapping a Set using &lt;set&gt;">Example 7.4, “Mapping a Set using &lt;set&gt;”</a>, there is also
    <code class="literal">&lt;list&gt;</code>, <code class="literal">&lt;map&gt;</code>,
    <code class="literal">&lt;bag&gt;</code>, <code class="literal">&lt;array&gt;</code> and
    <code class="literal">&lt;primitive-array&gt;</code> mapping elements. The
    <code class="literal">&lt;map&gt;</code> element is representative:</p>

    <div class="example"><a id="d5e5163"/><p class="title"><strong>Example 7.6. Elements of the &lt;map&gt; mapping</strong></p><div class="example-contents">
      

      <div class="programlistingco"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;map
    name="propertyName"                                    <span class="co" id="mappingcollection1"><img src="images/callouts/1.png" alt="(1)"/></span>
    table="table_name"                                     <span class="co" id="mappingcollection2"><img src="images/callouts/2.png" alt="(2)"/></span>
    schema="schema_name"                                   <span class="co" id="mappingcollection3"><img src="images/callouts/3.png" alt="(3)"/></span>
    lazy="true|extra|false"                                <span class="co" id="mappingcollection4"><img src="images/callouts/4.png" alt="(4)"/></span>
    inverse="true|false"                                   <span class="co" id="mappingcollection5"><img src="images/callouts/5.png" alt="(5)"/></span>
    cascade="all|none|save-update|delete|all-delete-orphan|<span class="co" id="mappingcollection6"><img src="images/callouts/6.png" alt="(6)"/></span>delete-orphan"
    sort="unsorted|natural|comparatorClass"                <span class="co" id="mappingcollection7"><img src="images/callouts/7.png" alt="(7)"/></span>
    order-by="column_name asc|desc"                        <span class="co" id="mappingcollection8"><img src="images/callouts/8.png" alt="(8)"/></span>
    where="arbitrary sql where condition"                  <span class="co" id="mappingcollection9"><img src="images/callouts/9.png" alt="(9)"/></span>
    fetch="join|select|subselect"                          <span class="co" id="mappingcollection10"><img src="images/callouts/10.png" alt="(10)"/></span>
    batch-size="N"                                         <span class="co" id="mappingcollection11"><img src="images/callouts/11.png" alt="(11)"/></span>
    access="field|property|ClassName"                      <span class="co" id="mappingcollection12"><img src="images/callouts/12.png" alt="(12)"/></span>
    optimistic-lock="true|false"                           <span class="co" id="mappingcollection13"><img src="images/callouts/13.png" alt="(13)"/></span>
    mutable="true|false"                                   <span class="co" id="mappingcollection14"><img src="images/callouts/14.png" alt="(14)"/></span>
    node="element-name|."
    embed-xml="true|false"
&gt;

    &lt;key .... /&gt;
    &lt;map-key .... /&gt;
    &lt;element .... /&gt;
&lt;/map&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/1.png" alt="1" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">name</code>: the collection property name</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/2.png" alt="2" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">table</code> (optional - defaults to property
            name): the name of the collection table. It is not used for
            one-to-many associations.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/3.png" alt="3" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">schema</code> (optional): the name of a table
            schema to override the schema declared on the root element</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/4.png" alt="4" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">lazy</code> (optional - defaults to
            <code class="literal">true</code>): disables lazy fetching and specifies
            that the association is always eagerly fetched. It can also be
            used to enable "extra-lazy" fetching where most operations do not
            initialize the collection. This is suitable for large
            collections.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/5.png" alt="5" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">inverse</code> (optional - defaults to
            <code class="literal">false</code>): marks this collection as the "inverse"
            end of a bidirectional association.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/6.png" alt="6" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">cascade</code> (optional - defaults to
            <code class="literal">none</code>): enables operations to cascade to child
            entities.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/7.png" alt="7" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">sort</code> (optional): specifies a sorted
            collection with <code class="literal">natural</code> sort order or a given
            comparator class.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/8.png" alt="8" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">order-by</code> (optional): specifies a table
            column or columns that define the iteration order of the
            <code class="literal">Map</code>, <code class="literal">Set</code> or bag, together
            with an optional <code class="literal">asc</code> or
            <code class="literal">desc</code>.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/9.png" alt="9" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">where</code> (optional): specifies an arbitrary
            SQL <code class="literal">WHERE</code> condition that is used when
            retrieving or removing the collection. This is useful if the
            collection needs to contain only a subset of the available
            data.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/10.png" alt="10" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">fetch</code> (optional, defaults to
            <code class="literal">select</code>): chooses between outer-join fetching,
            fetching by sequential select, and fetching by sequential
            subselect.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/11.png" alt="11" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">batch-size</code> (optional, defaults to
            <code class="literal">1</code>): specifies a "batch size" for lazily
            fetching instances of this collection.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/12.png" alt="12" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">access</code> (optional - defaults to
            <code class="literal">property</code>): the strategy Hibernate uses for
            accessing the collection property value.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/13.png" alt="13" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">optimistic-lock</code> (optional - defaults to
            <code class="literal">true</code>): specifies that changes to the state of
            the collection results in increments of the owning entity's
            version. For one-to-many associations you may want to disable this
            setting.</p>
          </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/14.png" alt="14" border="0"/></p></td><td valign="top" align="left">
            <p><code class="literal">mutable</code> (optional - defaults to
            <code class="literal">true</code>): a value of <code class="literal">false</code>
            specifies that the elements of the collection never change. This
            allows for minor performance optimization in some cases.</p>
          </td></tr></table></div></div>
    </div></div><br class="example-break"/>

    <p>After exploring the basic mapping of collections in the preceding
    paragraphs we will now focus details like physical mapping considerations,
    indexed collections and collections of value types.</p>

    <div class="section" title="7.2.1. Collection foreign keys"><div class="titlepage"><div><div><h3 class="title"><a id="collections-foreignkeys"/>7.2.1. Collection foreign keys</h3></div></div></div>
      

      <p>On the database level collection instances are distinguished by
      the foreign key of the entity that owns the collection. This foreign key
      is referred to as the <span class="emphasis"><em>collection key column</em></span>, or
      columns, of the collection table. The collection key column is mapped by
      the <code class="literal">@JoinColumn</code> annotation respectively the
      <code class="literal">&lt;key&gt;</code> XML element.</p>

      <p>There can be a nullability constraint on the foreign key column.
      For most collections, this is implied. For unidirectional one-to-many
      associations, the foreign key column is nullable by default, so you may
      need to specify</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@JoinColumn(nullable=false)</pre>

      <p>or</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;key column="productSerialNumber" not-null="true"/&gt;</pre>

      <p>The foreign key constraint can use <code class="literal">ON DELETE
      CASCADE</code>. In XML this can be expressed via:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;key column="productSerialNumber" on-delete="cascade"/&gt;</pre>

      <p>In annotations the Hibernate specific annotation @OnDelete has to
      be used.</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@OnDelete(action=OnDeleteAction.CASCADE)</pre>

      <p>See <a class="xref" href="ch05.html#section.key">Section 5.1.11.3, “Key”</a> for more information
      about the <code class="literal">&lt;key&gt;</code> element.</p>
    </div>

    <div class="section" title="7.2.2. Indexed collections"><div class="titlepage"><div><div><h3 class="title"><a id="collections-indexed"/>7.2.2. Indexed collections</h3></div></div></div>
      

      <p>In the following paragraphs we have a closer look at the indexed
      collections <code class="classname">List</code> and <code class="classname">Map</code>
      how the their index can be mapped in Hibernate.</p>

      <div class="section" title="7.2.2.1. Lists"><div class="titlepage"><div><div><h4 class="title"><a id="d5e5264"/>7.2.2.1. Lists</h4></div></div></div>
        

        <p>Lists can be mapped in two different ways:</p>

        <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
            <p>as ordered lists, where the order is not materialized in the
            database</p>
          </li><li class="listitem">
            <p>as indexed lists, where the order is materialized in the
            database</p>
          </li></ul></div>

        <p>To order lists in memory, add
        <code class="literal">@javax.persistence.OrderBy</code> to your property. This
        annotation takes as parameter a list of comma separated properties (of
        the target entity) and orders the collection accordingly (eg
        <code class="code">firstname asc, age desc, weight asc nulls last</code>), if the string
        is empty, the collection will be ordered by the primary key of the target
        entity.</p>

        <div class="example"><a id="d5e5275"/><p class="title"><strong>Example 7.7. Ordered lists using <code class="classname">@OrderBy</code></strong></p><div class="example-contents">
          

          <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;customer&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderBy</span><span class="java_separator">(</span><span class="java_literal">&quot;number&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getOrders</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setOrders</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">orders&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getNumber</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setNumber</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">number&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;getCustomer</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setCustomer</span><span class="java_separator">(</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">--</span><span class="java_plain">&nbsp;</span><span class="java_type">Table</span><span class="java_plain">&nbsp;schema</span>
<!--  --><br/><span class="java_operator">|-------------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|-------------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;customer_id&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|-------------|</span></pre>
        </div></div><br class="example-break"/>

        <p>To store the index value in a dedicated column, use the
        <code class="classname">@javax.persistence.OrderColumn</code> annotation on
        your property. This annotations describes the column name and
        attributes of the column keeping the index value. This column is
        hosted on the table containing the association foreign key. If the
        column name is not specified, the default is the name of the
        referencing property, followed by underscore, followed by
        <code class="literal">ORDER</code> (in the following example, it would be
        <code class="literal">orders_ORDER</code>).</p>

        <div class="example"><a id="d5e5283"/><p class="title"><strong>Example 7.8. Explicit index column using
          <code class="classname">@OrderColumn</code></strong></p><div class="example-contents">
          

          <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;customer&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OrderColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;orders_index&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getOrders</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setOrders</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">orders&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getNumber</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setNumber</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">number&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;getCustomer</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setCustomer</span><span class="java_separator">(</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">--</span><span class="java_plain">&nbsp;</span><span class="java_type">Table</span><span class="java_plain">&nbsp;schema</span>
<!--  --><br/><span class="java_operator">|--------------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|--------------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;customer_id&nbsp;&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;orders_order&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|--------------|</span></pre>
        </div></div><br class="example-break"/>

        <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>
          <p>We recommend you to convert <code class="classname">the legacy
          @org.hibernate.annotations.IndexColumn</code> usages to
          <code class="classname">@OrderColumn</code> unless you are making use of the
          base property. The <code class="literal">base</code> property lets you define
          the index value of the first element (aka as base index). The usual
          value is <code class="literal">0</code> or <code class="literal">1</code>. The default
          is 0 like in Java.</p>
        </div>

        <p>Looking again at the Hibernate mapping file equivalent, the
        index of an array or list is always of type <code class="literal">integer</code>
        and is mapped using the <code class="literal">&lt;list-index&gt;</code> element.
        The mapped column contains sequential integers that are numbered from
        zero by default.</p>

        <div class="example"><a id="d5e5297"/><p class="title"><strong>Example 7.9. index-list element for indexed collections in xml
          mapping</strong></p><div class="example-contents">
          

          <div class="programlistingco"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;list-index
        column="column_name"                               <span class="co" id="index1"><img src="images/callouts/1.png" alt="(1)"/></span>
        base="0|1|..."/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/1.png" alt="1" border="0"/></p></td><td valign="top" align="left">
                <p><code class="literal">column_name</code> (required): the name of
                the column holding the collection index values.</p>
              </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/1.png" alt="1" border="0"/></p></td><td valign="top" align="left">
                <p><code class="literal">base</code> (optional - defaults to
                <code class="literal">0</code>): the value of the index column that
                corresponds to the first element of the list or array.</p>
              </td></tr></table></div></div>
        </div></div><br class="example-break"/>

        <p>If your table does not have an index column, and you still wish
        to use <code class="literal">List</code> as the property type, you can map the
        property as a Hibernate <span class="emphasis"><em>&lt;bag&gt;</em></span>. A bag does
        not retain its order when it is retrieved from the database, but it
        can be optionally sorted or ordered.</p>
      </div>

      <div class="section" title="7.2.2.2. Maps"><div class="titlepage"><div><div><h4 class="title"><a id="d5e5315"/>7.2.2.2. Maps</h4></div></div></div>
        

        <p>The question with <code class="classname">Map</code>s is where the key
        value is stored. There are everal options. Maps can borrow their keys
        from one of the associated entity properties or have dedicated columns
        to store an explicit key.</p>

        <p>To use one of the target entity property as a key of the map,
        use <code class="literal">@MapKey(name="myProperty")</code>, where
        <code class="literal">myProperty</code> is a property name in the target entity.
        When using <code class="literal">@MapKey</code> without the name attribuate, the
        target entity primary key is used. The map key uses the same column as
        the property pointed out. There is no additional column defined to
        hold the map key, because the map key represent a target property. Be
        aware that once loaded, the key is no longer kept in sync with the
        property. In other words, if you change the property value, the key
        will not change automatically in your Java model.</p>

        <div class="example"><a id="d5e5323"/><p class="title"><strong>Example 7.10. Use of target entity property as map key via
          <code class="classname">@MapKey</code></strong></p><div class="example-contents">
          

          <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;customer&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapKey</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;number&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getOrders</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setOrders</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;order</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">orders&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getNumber</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setNumber</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">number&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;getCustomer</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setCustomer</span><span class="java_separator">(</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">--</span><span class="java_plain">&nbsp;</span><span class="java_type">Table</span><span class="java_plain">&nbsp;schema</span>
<!--  --><br/><span class="java_operator">|-------------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|-------------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;customer_id&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|-------------|</span></pre>
        </div></div><br class="example-break"/>

        <p>Alternatively the map key is mapped to a dedicated column or
        columns. In order to customize the mapping use one of the following
        annotations:</p>

        <div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
            <p>@<code class="classname">MapKeyColumn</code> if the map key is a
            basic type. If you don't specify the column name, the name of the
            property followed by underscore followed by <code class="literal">KEY</code>
            is used (for example <code class="literal">orders_KEY</code>).</p>
          </li><li class="listitem">
            <p><code class="classname">@MapKeyEnumerated</code> /
            <code class="classname">@MapKeyTemporal</code> if the map key type is
            respectively an enum or a <code class="classname">Date</code>.</p>
          </li><li class="listitem">
            <p><code class="classname">@MapKeyJoinColumn</code>/<code class="classname">@MapKeyJoinColumns</code>
            if the map key type is another entity.</p>
          </li><li class="listitem">
            <p><code class="classname">@AttributeOverride</code>/<code class="classname">@AttributeOverrides</code>
            when the map key is a embeddable object. Use
            <code class="literal">key.</code> as a prefix for your embeddable object
            property names.</p>
          </li></ul></div>

        <p>You can also use <code class="classname">@MapKeyClass</code> to define
        the type of the key if you don't use generics.</p>

        <div class="example"><a id="d5e5350"/><p class="title"><strong>Example 7.11. Map key as basic type using
          <code class="classname">@MapKeyColumn</code></strong></p><div class="example-contents">
          

          <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_plain">&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;Cust_Order&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">MapKeyColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;orders_number&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getOrders</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setOrders</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">orders&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">Order</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;orders</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getNumber</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setNumber</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">number&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;getCustomer</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setCustomer</span><span class="java_separator">(</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;customer</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;number</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">--</span><span class="java_plain">&nbsp;</span><span class="java_type">Table</span><span class="java_plain">&nbsp;schema</span>
<!--  --><br/><span class="java_operator">|-------------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|---------------|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Order</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_type">Cust_Order</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|-------------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|---------------|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;customer_id&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|----------|</span><span class="java_plain">&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;order_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|</span><span class="java_plain">&nbsp;customer_id&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|</span><span class="java_plain">&nbsp;orders_number&nbsp;</span><span class="java_operator">|</span>
<!--  --><br/><span class="java_operator">|-------------|</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">|---------------|</span></pre>
        </div></div><br class="example-break"/>

        <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>
          <p>We recommend you to migrate from
          <code class="classname">@org.hibernate.annotations.MapKey</code> /
          <code class="classname">@org.hibernate.annotation.MapKeyManyToMany</code> to
          the new standard approach described above</p>
        </div>

        <p>Using Hibernate mapping files there exists equivalent concepts
        to the descibed annotations. You have to use
        <code class="literal">&lt;map-key&gt;</code>,
        <code class="literal">&lt;map-key-many-to-many&gt;</code> and
        <code class="literal">&lt;composite-map-key&gt;</code>.
        <code class="literal">&lt;map-key&gt;</code> is used for any basic type,
        <code class="literal">&lt;map-key-many-to-many&gt;</code> for an entity
        reference and <code class="literal">&lt;composite-map-key&gt;</code> for a
        composite type.</p>

        <div class="example"><a id="d5e5365"/><p class="title"><strong>Example 7.12. map-key xml mapping element</strong></p><div class="example-contents">
          

          <div class="programlistingco"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;map-key
        column="column_name"                               <span class="co" id="mapkey1"><img src="images/callouts/1.png" alt="(1)"/></span>
        formula="any SQL expression"                       <span class="co" id="mapkey2"><img src="images/callouts/2.png" alt="(2)"/></span>
        type="type_name"                                   <span class="co" id="mapkey3"><img src="images/callouts/3.png" alt="(3)"/></span>
        node="@attribute-name"
        length="N"/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/1.png" alt="1" border="0"/></p></td><td valign="top" align="left">
                <p><code class="literal">column</code> (optional): the name of the
                column holding the collection index values.</p>
              </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/2.png" alt="2" border="0"/></p></td><td valign="top" align="left">
                <p><code class="literal">formula</code> (optional): a SQL formula
                used to evaluate the key of the map.</p>
              </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/3.png" alt="3" border="0"/></p></td><td valign="top" align="left">
                <p><code class="literal">type</code> (required): the type of the map
                keys.</p>
              </td></tr></table></div></div>
        </div></div><br class="example-break"/>

        <div class="example"><a id="d5e5383"/><p class="title"><strong>Example 7.13. map-key-many-to-many</strong></p><div class="example-contents">
          

          <div class="programlistingco"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;map-key-many-to-many
        column="column_name"                               <span class="co" id="indexmanytomany1"><img src="images/callouts/1.png" alt="(1)"/></span>
        formula="any SQL expression"                       <span class="co" id="indexmanytomany2"><img src="images/callouts/2.png" alt="(2)"/></span><span class="co" id="indexmanytomany3"><img src="images/callouts/3.png" alt="(3)"/></span>
        class="ClassName"
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/1.png" alt="1" border="0"/></p></td><td valign="top" align="left">
                <p><code class="literal">column</code> (optional): the name of the
                foreign key column for the collection index values.</p>
              </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/2.png" alt="2" border="0"/></p></td><td valign="top" align="left">
                <p><code class="literal">formula</code> (optional): a SQ formula used
                to evaluate the foreign key of the map key.</p>
              </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/3.png" alt="3" border="0"/></p></td><td valign="top" align="left">
                <p><code class="literal">class</code> (required): the entity class
                used as the map key.</p>
              </td></tr></table></div></div>
        </div></div><br class="example-break"/>
      </div>
    </div>

    <div class="section" title="7.2.3. Collections of basic types and embeddable objects"><div class="titlepage"><div><div><h3 class="title"><a id="collections-ofvalues"/>7.2.3. Collections of basic types and embeddable objects</h3></div></div></div>
      

      <p>In some situations you don't need to associate two entities but
      simply create a collection of basic types or embeddable objects. Use the
      <code class="classname">@ElementCollection</code> for this case.</p>

      <div class="example"><a id="d5e5405"/><p class="title"><strong>Example 7.14. Collection of basic types mapped via
        <code class="classname">@ElementCollection</code></strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getLastname</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">CollectionTable</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;Nicknames&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;joinColumns</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;user_id&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;nickname&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getNicknames</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre>
      </div></div><br class="example-break"/>

      <p>The collection table holding the collection data is set using the
      <code class="classname">@CollectionTable</code> annotation. If omitted the
      collection table name defaults to the concatenation of the name of the
      containing entity and the name of the collection attribute, separated by
      an underscore. In our example, it would be
      <code class="literal">User_nicknames</code>.</p>

      <p>The column holding the basic type is set using the
      <code class="classname">@Column</code> annotation. If omitted, the column name
      defaults to the property name: in our example, it would be
      <code class="literal">nicknames</code>.</p>

      <p>But you are not limited to basic types, the collection type can be
      any embeddable object. To override the columns of the embeddable object
      in the collection table, use the
      <code class="classname">@AttributeOverride</code> annotation.</p>

      <div class="example"><a id="d5e5417"/><p class="title"><strong>Example 7.15. @ElementCollection for embeddable objects</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getLastname</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">CollectionTable</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;Addresses&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;joinColumns</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;user_id&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AttributeOverrides</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AttributeOverride</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;column</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;fld_street&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Address</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getAddresses</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getStreet1</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
<!--  --><br/><span class="java_separator">}</span></pre>
      </div></div><br class="example-break"/>

      <p>Such an embeddable object cannot contains a collection
      itself.</p>

      <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>
        <p>in <code class="classname">@AttributeOverride</code>, you must use the
        <code class="literal">value.</code> prefix to override properties of the
        embeddable object used in the map value and the
        <code class="literal">key.</code> prefix to override properties of the
        embeddable object used in the map key.</p>

        <pre xmlns="" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ElementCollection</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AttributeOverrides</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AttributeOverride</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;key.street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;column</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;fld_street&quot;</span><span class="java_separator">)),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AttributeOverride</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;value.stars&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;column</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Column</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;fld_note&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">Address</span><span class="java_separator">,</span><span class="java_type">Rating</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getFavHomes</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre>
      </div>

      <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>
        <p>We recommend you to migrate from
        <code class="classname">@org.hibernate.annotations.CollectionOfElements</code>
        to the new <code class="classname">@ElementCollection</code>
        annotation.</p>
      </div>

      <p>Using the mapping file approach a collection of values is mapped
      using the <code class="literal">&lt;element&gt;</code> tag. For example:</p>

      <div class="example"><a id="d5e5433"/><p class="title"><strong>Example 7.16. &lt;element&gt; tag for collection values using mapping
        files</strong></p><div class="example-contents">
        

        <div class="programlistingco"><pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;element
        column="column_name"                               <span class="co" id="element1b"><img src="images/callouts/1.png" alt="(1)"/></span>
        formula="any SQL expression"                       <span class="co" id="element2b"><img src="images/callouts/2.png" alt="(2)"/></span>
        type="typename"                                    <span class="co" id="element3b"><img src="images/callouts/3.png" alt="(3)"/></span>
        length="L"
        precision="P"
        scale="S"
        not-null="true|false"
        unique="true|false"
        node="element-name"
/&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/1.png" alt="1" border="0"/></p></td><td valign="top" align="left">
              <p><code class="literal">column</code> (optional): the name of the
              column holding the collection element values.</p>
            </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/2.png" alt="2" border="0"/></p></td><td valign="top" align="left">
              <p><code class="literal">formula</code> (optional): an SQL formula used
              to evaluate the element.</p>
            </td></tr><tr><td width="5%" valign="top" align="left"><p><img src="images/callouts/3.png" alt="3" border="0"/></p></td><td valign="top" align="left">
              <p><code class="literal">type</code> (required): the type of the
              collection element.</p>
            </td></tr></table></div></div>
      </div></div><br class="example-break"/>
    </div>
  </div>

  <div class="section" title="7.3. Advanced collection mappings"><div class="titlepage"><div><div><h2 class="title"><a id="collections-advancedmappings"/>7.3. Advanced collection mappings</h2></div></div></div>
    

    <div class="section" title="7.3.1. Sorted collections"><div class="titlepage"><div><div><h3 class="title"><a id="collections-sorted"/>7.3.1. Sorted collections</h3></div></div></div>
      

      <p>Hibernate supports collections implementing
      <code class="literal">java.util.SortedMap</code> and
      <code class="literal">java.util.SortedSet</code>. With annotations you declare a
      sort comparator using <code class="literal">@Sort</code>. You chose between the
      comparator types unsorted, natural or custom. If you want to use your
      own comparator implementation, you'll also have to specify the
      implementation class using the <code class="literal">comparator</code> attribute.
      Note that you need to use either a <code class="classname">SortedSet</code> or a
      <code class="classname">SortedMap</code> interface.</p>

      <div class="example"><a id="d5e5462"/><p class="title"><strong>Example 7.17. Sorted collection with @Sort</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">OneToMany</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">cascade</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_type">CascadeType</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">ALL</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;fetch</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_type">FetchType</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">EAGER</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;CUST_ID&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Sort</span><span class="java_separator">(</span><span class="java_plain">type&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">SortType</span><span class="java_separator">.</span><span class="java_plain">COMPARATOR</span><span class="java_separator">,</span><span class="java_plain">&nbsp;comparator&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">TicketComparator</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">SortedSet</span><span class="java_operator">&lt;</span><span class="java_type">Ticket</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getTickets</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;tickets</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre>
      </div></div><br class="example-break"/>

      <p>Using Hibernate mapping files you specify a comparator in the
      mapping file with <code class="literal">&lt;sort&gt;</code>:</p>

      <div class="example"><a id="d5e5467"/><p class="title"><strong>Example 7.18. Sorted collection using xml mapping</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;set name="aliases"
            table="person_aliases" 
            sort="natural"&gt;
    &lt;key column="person"/&gt;
    &lt;element column="name" type="string"/&gt;
&lt;/set&gt;

&lt;map name="holidays" sort="my.custom.HolidayComparator"&gt;
    &lt;key column="year_id"/&gt;
    &lt;map-key column="hol_name" type="string"/&gt;
    &lt;element column="hol_date" type="date"/&gt;
&lt;/map&gt;</pre>
      </div></div><br class="example-break"/>

      <p>Allowed values of the <code class="literal">sort</code> attribute are
      <code class="literal">unsorted</code>, <code class="literal">natural</code> and the name of
      a class implementing <code class="literal">java.util.Comparator</code>.</p>

      <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Tip</h2>
        <p>Sorted collections actually behave like
        <code class="literal">java.util.TreeSet</code> or
        <code class="literal">java.util.TreeMap</code>.</p>
      </div>

      <p>If you want the database itself to order the collection elements,
      use the <code class="literal">order-by</code> attribute of <code class="literal">set</code>,
      <code class="literal">bag</code> or <code class="literal">map</code> mappings. This solution
      is implemented using <code class="literal">LinkedHashSet</code> or
      <code class="literal">LinkedHashMap</code> and performs the ordering in the SQL
      query and not in the memory.</p>

      <div class="example"><a id="d5e5486"/><p class="title"><strong>Example 7.19. Sorting in database using order-by</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;set name="aliases" table="person_aliases" order-by="lower(name) asc"&gt;
    &lt;key column="person"/&gt;
    &lt;element column="name" type="string"/&gt;
&lt;/set&gt;

&lt;map name="holidays" order-by="hol_date, hol_name"&gt;
    &lt;key column="year_id"/&gt;
    &lt;map-key column="hol_name" type="string"/&gt;
    &lt;element column="hol_date type="date"/&gt;
&lt;/map&gt;</pre>
      </div></div><br class="example-break"/>

      <div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>
        

        <p>The value of the <code class="literal">order-by</code> attribute is an SQL
        ordering, not an HQL ordering.</p>
      </div>

      <p>Associations can even be sorted by arbitrary criteria at runtime
      using a collection <code class="literal">filter()</code>:</p>

      <div class="example"><a id="d5e5495"/><p class="title"><strong>Example 7.20. Sorting via a query filter</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">sortedUsers = s.createFilter( group.getUsers(), "order by this.name" ).list();</pre>
      </div></div><br class="example-break"/>
    </div>

    <div class="section" title="7.3.2. Bidirectional associations"><div class="titlepage"><div><div><h3 class="title"><a id="collections-bidirectional"/>7.3.2. Bidirectional associations</h3></div></div></div>
      

      <p>A <span class="emphasis"><em>bidirectional association</em></span> allows navigation
      from both "ends" of the association. Two kinds of bidirectional
      association are supported: </p><div class="variablelist"><dl><dt><span class="term">one-to-many</span></dt><dd>
              <p>set or bag valued at one end and single-valued at the
              other</p>
            </dd><dt><span class="term">many-to-many</span></dt><dd>
              <p>set or bag valued at both ends</p>
            </dd></dl></div>

      <p>Often there exists a many to one association which is the owner
      side of a bidirectional relationship. The corresponding one to many
      association is in this case annotated by
      <code class="literal">@OneToMany(mappedBy=...)</code></p>

      <div class="example"><a id="d5e5513"/><p class="title"><strong>Example 7.21. Bidirectional one to many with many to one side as association
        owner</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Troop</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;troop&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Soldier</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getSoldiers</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Soldier</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;troop_fk&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Troop</span><span class="java_plain">&nbsp;getTroop</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre>
      </div></div><br class="example-break"/>

      <p><code class="classname">Troop</code> has a bidirectional one to many
      relationship with <code class="literal">Soldier</code> through the
      <code class="literal">troop</code> property. You don't have to (must not) define
      any physical mapping in the <code class="literal">mappedBy</code> side.</p>

      <p>To map a bidirectional one to many, with the one-to-many side as
      the owning side, you have to remove the <code class="literal">mappedBy</code>
      element and set the many to one <code class="literal">@JoinColumn</code> as
      insertable and updatable to false. This solution is not optimized and
      will produce additional UPDATE statements.</p>

      <div class="example"><a id="d5e5524"/><p class="title"><strong>Example 7.22. Bidirectional association with one to many side as
        owner</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Troop</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;troop_fk&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">we&nbsp;need&nbsp;to&nbsp;duplicate&nbsp;the&nbsp;physical&nbsp;information</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Soldier</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getSoldiers</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Soldier</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;troop_fk&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;insertable</span><span class="java_operator">=</span><span class="java_literal">false</span><span class="java_separator">,</span><span class="java_plain">&nbsp;updatable</span><span class="java_operator">=</span><span class="java_literal">false</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Troop</span><span class="java_plain">&nbsp;getTroop</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre>
      </div></div><br class="example-break"/>

      <p>How does the mappping of a bidirectional mapping look like in
      Hibernate mapping xml? There you define a bidirectional one-to-many
      association by mapping a one-to-many association to the same table
      column(s) as a many-to-one association and declaring the many-valued end
      <code class="literal">inverse="true"</code>.</p>

      <div class="example"><a id="d5e5529"/><p class="title"><strong>Example 7.23. Bidirectional one to many via Hibernate mapping files</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;class name="Parent"&gt;
    &lt;id name="id" column="parent_id"/&gt;
    ....
    &lt;set name="children" inverse="true"&gt;
        &lt;key column="parent_id"/&gt;
        &lt;one-to-many class="Child"/&gt;
    &lt;/set&gt;
&lt;/class&gt;

&lt;class name="Child"&gt;
    &lt;id name="id" column="child_id"/&gt;
    ....
    &lt;many-to-one name="parent" 
        class="Parent" 
        column="parent_id"
        not-null="true"/&gt;
&lt;/class&gt;</pre>
      </div></div><br class="example-break"/>

      <p>Mapping one end of an association with
      <code class="literal">inverse="true"</code> does not affect the operation of
      cascades as these are orthogonal concepts.</p>

      <p>A many-to-many association is defined logically using the
      <code class="literal">@ManyToMany</code> annotation. You also have to describe the
      association table and the join conditions using the
      <code class="literal">@JoinTable</code> annotation. If the association is
      bidirectional, one side has to be the owner and one side has to be the
      inverse end (ie. it will be ignored when updating the relationship
      values in the association table):</p>

      <div class="example"><a id="d5e5537"/><p class="title"><strong>Example 7.24. Many to many association via @ManyToMany</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Employer</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;targetEntity</span><span class="java_operator">=</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">test</span><span class="java_separator">.</span><span class="java_plain">metadata</span><span class="java_separator">.</span><span class="java_plain">manytomany</span><span class="java_separator">.</span><span class="java_type">Employee</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cascade</span><span class="java_operator">=</span><span class="java_separator">{</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">MERGE</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">JoinTable</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;EMPLOYER_EMPLOYEE&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;joinColumns</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;EMPER_ID&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inverseJoinColumns</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">JoinColumn</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;EMPEE_ID&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_plain">&nbsp;getEmployees</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;employees</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre>

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Employee</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cascade&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">MERGE</span><span class="java_separator">},</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mappedBy&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;employees&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;targetEntity&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Employer</span><span class="java_separator">.</span><span class="java_keyword">class</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Collection</span><span class="java_plain">&nbsp;getEmployers</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;employers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre>
      </div></div><br class="example-break"/>

      <p>In this example <code class="classname">@JoinTable</code> defines a
      <code class="literal">name</code>, an array of join columns, and an array of
      inverse join columns. The latter ones are the columns of the association
      table which refer to the <code class="classname">Employee</code> primary key
      (the "other side"). As seen previously, the other side don't have to
      (must not) describe the physical mapping: a simple
      <code class="literal">mappedBy</code> argument containing the owner side property
      name bind the two.</p>

      <p>As any other annotations, most values are guessed in a many to
      many relationship. Without describing any physical mapping in a
      unidirectional many to many the following rules applied. The table name
      is the concatenation of the owner table name, <span class="keycap"><strong>_</strong></span> and the
      other side table name. The foreign key name(s) referencing the owner
      table is the concatenation of the owner table name, <span class="keycap"><strong>_</strong></span>
      and the owner primary key column(s). The foreign key name(s) referencing
      the other side is the concatenation of the owner property name,
      <span class="keycap"><strong>_</strong></span>, and the other side primary key column(s). These are
      the same rules used for a unidirectional one to many
      relationship.</p>

      <div class="example"><a id="d5e5550"/><p class="title"><strong>Example 7.25. Default values for <code class="classname">@ManyToMany</code>
        (uni-directional)</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">cascade&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">City</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getImplantedIn</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">City</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">no&nbsp;bidirectional&nbsp;relationship</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre>
      </div></div><br class="example-break"/>

      <p>A <code class="literal">Store_City</code> is used as the join table. The
      <code class="literal">Store_id</code> column is a foreign key to the
      <code class="literal">Store</code> table. The <code class="literal">implantedIn_id</code>
      column is a foreign key to the <code class="literal">City</code> table.</p>

      <p>Without describing any physical mapping in a bidirectional many to
      many the following rules applied. The table name is the concatenation of
      the owner table name, <span class="keycap"><strong>_</strong></span> and the other side table name.
      The foreign key name(s) referencing the owner table is the concatenation
      of the other side property name, <span class="keycap"><strong>_</strong></span>, and the owner
      primary key column(s). The foreign key name(s) referencing the other
      side is the concatenation of the owner property name,
      <span class="keycap"><strong>_</strong></span>, and the other side primary key column(s). These are
      the same rules used for a unidirectional one to many
      relationship.</p>

      <div class="example"><a id="d5e5564"/><p class="title"><strong>Example 7.26. Default values for <code class="classname">@ManyToMany</code>
        (bi-directional)</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">cascade&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">MERGE</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Customer</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getCustomers</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;customers&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Store</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getStores</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre>
      </div></div><br class="example-break"/>

      <p>A <code class="literal">Store_Customer</code> is used as the join table. The
      <code class="literal">stores_id</code> column is a foreign key to the
      <code class="literal">Store</code> table. The <code class="literal">customers_id</code>
      column is a foreign key to the <code class="literal">Customer</code> table.</p>

      <p>Using Hibernate mapping files you can map a bidirectional
      many-to-many association by mapping two many-to-many associations to the
      same database table and declaring one end as
      <span class="emphasis"><em>inverse</em></span>. </p><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h2>Note</h2>
          <p>You cannot select an indexed collection.</p>
        </div>

      <p><a class="xref" href="ch07.html#example-many-to-many-mapping-file" title="Example 7.27. Many to many association using Hibernate mapping files">Example 7.27, “Many to many association using Hibernate mapping files”</a> shows a
      bidirectional many-to-many association that illustrates how each
      category can have many items and each item can be in many
      categories:</p>

      <div class="example"><a id="example-many-to-many-mapping-file"/><p class="title"><strong>Example 7.27. Many to many association using Hibernate mapping files</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;class name="Category"&gt;
    &lt;id name="id" column="CATEGORY_ID"/&gt;
    ...
    &lt;bag name="items" table="CATEGORY_ITEM"&gt;
        &lt;key column="CATEGORY_ID"/&gt;
        &lt;many-to-many class="Item" column="ITEM_ID"/&gt;
    &lt;/bag&gt;
&lt;/class&gt;

&lt;class name="Item"&gt;
    &lt;id name="id" column="ITEM_ID"/&gt;
    ...

    &lt;!-- inverse end --&gt;
    &lt;bag name="categories" table="CATEGORY_ITEM" inverse="true"&gt;
        &lt;key column="ITEM_ID"/&gt;
        &lt;many-to-many class="Category" column="CATEGORY_ID"/&gt;
    &lt;/bag&gt;
&lt;/class&gt;</pre>
      </div></div><br class="example-break"/>

      <p>Changes made only to the inverse end of the association are
      <span class="emphasis"><em>not</em></span> persisted. This means that Hibernate has two
      representations in memory for every bidirectional association: one link
      from A to B and another link from B to A. This is easier to understand
      if you think about the Java object model and how a many-to-many
      relationship in Javais created:</p>

      <div class="example"><a id="d5e5585"/><p class="title"><strong>Example 7.28. Effect of inverse vs. non-inverse side of many to many
        associations</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">category.getItems().add(item);           // The category now "knows" about the relationship
item.getCategories().add(category);      // The item now "knows" about the relationship

session.persist(item);                   // The relationship won't be saved!
session.persist(category);               // The relationship will be saved</pre>
      </div></div><br class="example-break"/>

      <p>The non-inverse side is used to save the in-memory representation
      to the database.</p>
    </div>

    <div class="section" title="7.3.3. Bidirectional associations with indexed collections"><div class="titlepage"><div><div><h3 class="title"><a id="collections-indexedbidirectional"/>7.3.3. Bidirectional associations with indexed collections</h3></div></div></div>
      

      <p>There are some additional considerations for bidirectional
      mappings with indexed collections (where one end is represented as a
      <code class="literal">&lt;list&gt;</code> or <code class="literal">&lt;map&gt;</code>) when
      using Hibernate mapping files. If there is a property of the child class
      that maps to the index column you can use
      <code class="literal">inverse="true"</code> on the collection mapping:</p>

      <div class="example"><a id="d5e5595"/><p class="title"><strong>Example 7.29. Bidirectional association with indexed collection</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;class name="Parent"&gt;
    &lt;id name="id" column="parent_id"/&gt;
    ....
    &lt;map name="children" inverse="true"&gt;
        &lt;key column="parent_id"/&gt;
        &lt;map-key column="name" 
            type="string"/&gt;
        &lt;one-to-many class="Child"/&gt;
    &lt;/map&gt;
&lt;/class&gt;

&lt;class name="Child"&gt;
    &lt;id name="id" column="child_id"/&gt;
    ....
    &lt;property name="name" 
        not-null="true"/&gt;
    &lt;many-to-one name="parent" 
        class="Parent" 
        column="parent_id"
        not-null="true"/&gt;
&lt;/class&gt;</pre>
      </div></div><br class="example-break"/>

      <p>If there is no such property on the child class, the association
      cannot be considered truly bidirectional. That is, there is information
      available at one end of the association that is not available at the
      other end. In this case, you cannot map the collection
      <code class="literal">inverse="true"</code>. Instead, you could use the following
      mapping:</p>

      <div class="example"><a id="d5e5600"/><p class="title"><strong>Example 7.30. Bidirectional association with indexed collection, but no index
        column</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;class name="Parent"&gt;
    &lt;id name="id" column="parent_id"/&gt;
    ....
    &lt;map name="children"&gt;
        &lt;key column="parent_id"
            not-null="true"/&gt;
        &lt;map-key column="name" 
            type="string"/&gt;
        &lt;one-to-many class="Child"/&gt;
    &lt;/map&gt;
&lt;/class&gt;

&lt;class name="Child"&gt;
    &lt;id name="id" column="child_id"/&gt;
    ....
    &lt;many-to-one name="parent" 
        class="Parent" 
        column="parent_id"
        insert="false"
        update="false"
        not-null="true"/&gt;
&lt;/class&gt;</pre>
      </div></div><br class="example-break"/>

      <p>Note that in this mapping, the collection-valued end of the
      association is responsible for updates to the foreign key.</p>
    </div>

    <div class="section" title="7.3.4. Ternary associations"><div class="titlepage"><div><div><h3 class="title"><a id="collections-ternary"/>7.3.4. Ternary associations</h3></div></div></div>
      

      <p>There are three possible approaches to mapping a ternary
      association. One approach is to use a <code class="literal">Map</code> with an
      association as its index:</p>

      <div class="example"><a id="d5e5608"/><p class="title"><strong>Example 7.31. Ternary association mapping</strong></p><div class="example-contents">
        

        <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">@Entity
public class Company {
   @Id 
   int id;
   ...
   @OneToMany // unidirectional
   @MapKeyJoinColumn(name="employee_id")
   Map&lt;Employee, Contract&gt; contracts;
}

// or

&lt;map name="contracts"&gt;
    &lt;key column="employer_id" not-null="true"/&gt;
    &lt;map-key-many-to-many column="employee_id" class="Employee"/&gt;
    &lt;one-to-many class="Contract"/&gt;
&lt;/map&gt;</pre>
      </div></div><br class="example-break"/>

      <p>A second approach is to remodel the association as an entity
      class. This is the most common approach. A final alternative is to use
      composite elements, which will be discussed later.</p>
    </div>

    <div class="section" title="7.3.5. Using an &lt;idbag&gt;"><div class="titlepage"><div><div><h3 class="title"><a id="collections-idbag"/>7.3.5. <code class="literal">Using an &lt;idbag&gt;</code></h3></div></div></div>
      

      <p>The majority of the many-to-many associations and collections of
      values shown previously all map to tables with composite keys, even
      though it has been suggested that entities should have synthetic
      identifiers (surrogate keys). A pure association table does not seem to
      benefit much from a surrogate key, although a collection of composite
      values <span class="emphasis"><em>might</em></span>. For this reason Hibernate provides a
      feature that allows you to map many-to-many associations and collections
      of values to a table with a surrogate key.</p>

      <p>The <code class="literal">&lt;idbag&gt;</code> element lets you map a
      <code class="literal">List</code> (or <code class="literal">Collection</code>) with bag
      semantics. For example:</p>

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;idbag name="lovers" table="LOVERS"&gt;
    &lt;collection-id column="ID" type="long"&gt;
        &lt;generator class="sequence"/&gt;
    &lt;/collection-id&gt;
    &lt;key column="PERSON1"/&gt;
    &lt;many-to-many column="PERSON2" class="Person" fetch="join"/&gt;
&lt;/idbag&gt;</pre>

      <p>An <code class="literal">&lt;idbag&gt;</code> has a synthetic id generator,
      just like an entity class. A different surrogate key is assigned to each
      collection row. Hibernate does not, however, provide any mechanism for
      discovering the surrogate key value of a particular row.</p>

      <p>The update performance of an <code class="literal">&lt;idbag&gt;</code>
      supersedes a regular <code class="literal">&lt;bag&gt;</code>. Hibernate can
      locate individual rows efficiently and update or delete them
      individually, similar to a list, map or set.</p>

      <p>In the current implementation, the <code class="literal">native</code>
      identifier generation strategy is not supported for
      <code class="literal">&lt;idbag&gt;</code> collection identifiers.</p>
    </div>
  </div>

  

  

  <div class="section" title="7.4. Collection examples"><div class="titlepage"><div><div><h2 class="title"><a id="collections-example"/>7.4. Collection examples</h2></div></div></div>
    

    <p>This section covers collection examples.</p>

    <p>The following class has a collection of <code class="literal">Child</code>
    instances:</p>

    <div class="example"><a id="d5e5635"/><p class="title"><strong>Example 7.32. Example classes <code class="classname">Parent</code> and
      <code class="classname">Child</code></strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Parent {
    private long id;
    private Set&lt;Child&gt; children;

    // getter/setter
    ...
}


public class Child {
   private long id;
   private String name

   
   // getter/setter
   ...
}</pre>
    </div></div><br class="example-break"/>

    <p>If each child has, at most, one parent, the most natural mapping is
    a one-to-many association:</p>

    <div class="example"><a id="d5e5641"/><p class="title"><strong>Example 7.33. One to many unidirectional <code class="classname">Parent-Child</code>
      relationship using annotations</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Parent {
    @Id
    @GeneratedValue
    private long id;

    @OneToMany
    private Set&lt;Child&gt; children;

    // getter/setter
    ...
}


public class Child {
   @Id
   @GeneratedValue
   private long id;
   private String name;

   
   // getter/setter
   ...
}</pre>
    </div></div><br class="example-break"/>

    <div class="example"><a id="d5e5645"/><p class="title"><strong>Example 7.34. One to many unidirectional <code class="classname">Parent-Child</code>
      relationship using mapping files</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;hibernate-mapping&gt;

    &lt;class name="Parent"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;set name="children"&gt;
            &lt;key column="parent_id"/&gt;
            &lt;one-to-many class="Child"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Child"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre>
    </div></div><br class="example-break"/>

    <p>This maps to the following table definitions:</p>

    <div class="example"><a id="d5e5650"/><p class="title"><strong>Example 7.35. Table definitions for unidirectional
      <code class="classname">Parent</code>-<code class="classname">Child</code>
      relationship</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table parent ( id bigint not null primary key )
create table child ( id bigint not null primary key, name varchar(255), parent_id bigint )
alter table child add constraint childfk0 (parent_id) references parent</pre>
    </div></div><br class="example-break"/>

    <p>If the parent is <span class="emphasis"><em>required</em></span>, use a bidirectional
    one-to-many association:</p>

    <div class="example"><a id="d5e5657"/><p class="title"><strong>Example 7.36. One to many bidirectional <code class="classname">Parent-Child</code>
      relationship using annotations</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Parent {
    @Id
    @GeneratedValue
    private long id;

    @OneToMany(mappedBy="parent")
    private Set&lt;Child&gt; children;

    // getter/setter
    ...
}


public class Child {
   @Id
   @GeneratedValue
   private long id;

   private String name;
 
   @ManyToOne
   private Parent parent;

   
   // getter/setter
   ...
}</pre>
    </div></div><br class="example-break"/>

    <div class="example"><a id="d5e5661"/><p class="title"><strong>Example 7.37. One to many bidirectional <code class="classname">Parent-Child</code>
      relationship using mapping files</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;hibernate-mapping&gt;

    &lt;class name="Parent"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;set name="children" inverse="true"&gt;
            &lt;key column="parent_id"/&gt;
            &lt;one-to-many class="Child"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Child"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
        &lt;many-to-one name="parent" class="Parent" column="parent_id" not-null="true"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre>
    </div></div><br class="example-break"/>

    <p>Notice the <code class="literal">NOT NULL</code> constraint:</p>

    <div class="example"><a id="d5e5667"/><p class="title"><strong>Example 7.38. Table definitions for bidirectional
      <code class="classname">Parent</code>-<code class="classname">Child</code>
      relationship</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table parent ( id bigint not null primary key )
create table child ( id bigint not null
                     primary key,
                     name varchar(255),
                     parent_id bigint not null )
alter table child add constraint childfk0 (parent_id) references parent</pre>
    </div></div><br class="example-break"/>

    <p>Alternatively, if this association must be unidirectional you can
    enforce the <code class="literal">NOT NULL</code> constraint.</p>

    <div class="example"><a id="d5e5674"/><p class="title"><strong>Example 7.39. Enforcing NOT NULL constraint in unidirectional relation using
      annotations</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Parent {
    @Id
    @GeneratedValue
    private long id;

    @OneToMany(optional=false)
    private Set&lt;Child&gt; children;

    // getter/setter
    ...
}


public class Child {
   @Id
   @GeneratedValue
   private long id;
   private String name;

   
   // getter/setter
   ...
}</pre>
    </div></div><br class="example-break"/>

    <div class="example"><a id="d5e5677"/><p class="title"><strong>Example 7.40. Enforcing NOT NULL constraint in unidirectional relation using
      mapping files</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;hibernate-mapping&gt;

    &lt;class name="Parent"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;set name="children"&gt;
            &lt;key column="parent_id" not-null="true"/&gt;
            &lt;one-to-many class="Child"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Child"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre>
    </div></div><br class="example-break"/>

    <p>On the other hand, if a child has multiple parents, a many-to-many
    association is appropriate.</p>

    <div class="example"><a id="d5e5681"/><p class="title"><strong>Example 7.41. Many to many <code class="classname">Parent-Child</code> relationship
      using annotations</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">public class Parent {
    @Id
    @GeneratedValue
    private long id;

    @ManyToMany
    private Set&lt;Child&gt; children;

    // getter/setter
    ...
}


public class Child {
   @Id
   @GeneratedValue
   private long id;

   private String name;

   
   // getter/setter
   ...
}</pre>
    </div></div><br class="example-break"/>

    <div class="example"><a id="d5e5685"/><p class="title"><strong>Example 7.42. Many to many <code class="classname">Parent-Child</code> relationship
      using mapping files</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">&lt;hibernate-mapping&gt;

    &lt;class name="Parent"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;set name="children" table="childset"&gt;
            &lt;key column="parent_id"/&gt;
            &lt;many-to-many class="Child" column="child_id"/&gt;
        &lt;/set&gt;
    &lt;/class&gt;

    &lt;class name="Child"&gt;
        &lt;id name="id"&gt;
            &lt;generator class="sequence"/&gt;
        &lt;/id&gt;
        &lt;property name="name"/&gt;
    &lt;/class&gt;

&lt;/hibernate-mapping&gt;</pre>
    </div></div><br class="example-break"/>

    <p>Table definitions:</p>

    <div class="example"><a id="d5e5690"/><p class="title"><strong>Example 7.43. Table definitions for many to many releationship</strong></p><div class="example-contents">
      

      <pre xmlns="" xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="">create table parent ( id bigint not null primary key )
create table child ( id bigint not null primary key, name varchar(255) )
create table childset ( parent_id bigint not null,
                        child_id bigint not null,
                        primary key ( parent_id, child_id ) )
alter table childset add constraint childsetfk0 (parent_id) references parent
alter table childset add constraint childsetfk1 (child_id) references child</pre>
    </div></div><br class="example-break"/>

    <p>For more examples and a complete explanation of a parent/child
    relationship mapping, see <a class="xref" href="ch23.html" title="Chapter 23. Example: Parent/Child">Chapter 23, <em>Example: Parent/Child</em></a> for more
    information. Even more complex association mappings are covered in the
    next chapter.</p>
  </div>
</div><hr xmlns="" xmlns:d="http://docbook.org/ns/docbook"/><a xmlns="" xmlns:d="http://docbook.org/ns/docbook" href="legalnotice.html"/><ul xmlns:d="http://docbook.org/ns/docbook" class="docnav"><li class="previous"><a accesskey="p" href="ch06.html"><strong>Prev</strong>Chapter 6. Types</a></li><li class="up"><a accesskey="u" href="#"><strong>Up</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Home</strong></a></li><li class="next"><a accesskey="n" href="ch08.html"><strong>Next</strong>Chapter 8. Association Mappings</a></li></ul></body></html>