<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Hibernate Search</title><link rel="stylesheet" href="css/hibernate-single.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.72.0"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.hibernate.org" class="site_href"><strong>Hibernate.org</strong></a><a href="http://hibernate.org/Documentation/DocumentationOverview" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e2"/>Hibernate Search</h1></div><div><h2 class="subtitle">Apache <span class="trademark">Lucene</span>™ Integration</h2></div><div><h2 class="subtitle">Reference Guide</h2></div><div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Emmanuel</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Bernard</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Hardy</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Ferentschik</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Gustavo</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Fernandes</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Sanne</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Grinovero</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Nabeel Ali</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Memon</span>, and <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Gunnar</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Morling</span></div><div class="editors"/><div class="others"/></div></div><div><p class="releaseinfo">4.4.1.Final</p></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#getting-started">1. Getting started</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e73">1.1. System Requirements</a></span></dt><dt><span class="section"><a href="#d0e141">1.2. Using Maven</a></span></dt><dt><span class="section"><a href="#d0e183">1.3. Configuration</a></span></dt><dt><span class="section"><a href="#d0e397">1.4. Indexing</a></span></dt><dt><span class="section"><a href="#d0e422">1.5. Searching</a></span></dt><dt><span class="section"><a href="#d0e447">1.6. Analyzer</a></span></dt><dt><span class="section"><a href="#d0e536">1.7. What's next</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-architecture">2. Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e557">2.1. Overview</a></span></dt><dt><span class="section"><a href="#d0e635">2.2. Back end</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e646">2.2.1. Lucene</a></span></dt><dt><span class="section"><a href="#d0e668">2.2.2. JMS</a></span></dt><dt><span class="section"><a href="#d0e683">2.2.3. JGroups</a></span></dt></dl></dd><dt><span class="section"><a href="#search-architecture-readerstrategy">2.3. Reader strategy</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e698">2.3.1. <code class="literal">shared</code></a></span></dt><dt><span class="section"><a href="#d0e724">2.3.2. <code class="literal">not-shared</code></a></span></dt><dt><span class="section"><a href="#d0e741">2.3.3. Custom</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#search-configuration">3. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#search-configuration-event">3.1. Enabling Hibernate Search and automatic indexing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e758">3.1.1. Enabling Hibernate Search</a></span></dt><dt><span class="section"><a href="#d0e769">3.1.2. Automatic indexing</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration-indexmanager">3.2. Configuring the <code class="classname">IndexManager</code></a></span></dt><dd><dl><dt><span class="section"><a href="#d0e813">3.2.1. <code class="literal">directory-based</code></a></span></dt><dt><span class="section"><a href="#d0e828">3.2.2. <code class="literal">near-real-time</code></a></span></dt><dt><span class="section"><a href="#d0e856">3.2.3. Custom</a></span></dt></dl></dd><dt><span class="section"><a href="#search-configuration-directory">3.3. Directory configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#infinispan-directories">3.3.1. Infinispan Directory configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1439">3.4. Worker configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-backend">3.4.1. JMS Master/Slave back end</a></span></dt><dt><span class="section"><a href="#jgroups-backend">3.4.2. JGroups Master/Slave back end</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration-reader-strategy">3.5. Reader strategy configuration</a></span></dt><dt><span class="section"><a href="#d0e1995">3.6. Exception handling</a></span></dt><dt><span class="section"><a href="#d0e2031">3.7. Lucene configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#lucene-indexing-performance">3.7.1. Tuning indexing performance</a></span></dt><dt><span class="section"><a href="#search-configuration-directory-lockfactories">3.7.2. LockFactory configuration</a></span></dt><dt><span class="section"><a href="#d0e2627">3.7.3. Index format compatibility</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2658">3.8. Metadata API</a></span></dt><dt><span class="section"><a href="#search-configuration-deploy-on-AS7">3.9. Hibernate Search as JBoss AS module</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-mapping">4. Mapping entities to the index structure</a></span></dt><dd><dl><dt><span class="section"><a href="#search-mapping-entity">4.1. Mapping an entity</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-mapping">4.1.1. Basic mapping</a></span></dt><dt><span class="section"><a href="#d0e3187">4.1.2. Mapping properties multiple times</a></span></dt><dt><span class="section"><a href="#search-mapping-associated">4.1.3. Embedded and associated objects</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3585">4.2. Boosting</a></span></dt><dd><dl><dt><span class="section"><a href="#section-boost-annotation">4.2.1. Static index time boosting</a></span></dt><dt><span class="section"><a href="#d0e3646">4.2.2. Dynamic index time boosting</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3702">4.3. Analysis</a></span></dt><dd><dl><dt><span class="section"><a href="#analyzer">4.3.1. Default analyzer and analyzer by class</a></span></dt><dt><span class="section"><a href="#d0e3762">4.3.2. Named analyzers</a></span></dt><dt><span class="section"><a href="#d0e4141">4.3.3. Dynamic analyzer selection</a></span></dt><dt><span class="section"><a href="#analyzer-retrievinganalyzer">4.3.4. Retrieving an analyzer</a></span></dt></dl></dd><dt><span class="section"><a href="#search-mapping-bridge">4.4. Bridges</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4247">4.4.1. Built-in bridges</a></span></dt><dt><span class="section"><a href="#d0e4335">4.4.2. Tika bridge</a></span></dt><dt><span class="section"><a href="#d0e4431">4.4.3. Custom bridges</a></span></dt></dl></dd><dt><span class="section"><a href="#search-mapping-indexinginterceptor">4.5. Conditional indexing: to index or not based on entity state</a></span></dt><dt><span class="section"><a href="#provided-id">4.6. Providing your own id</a></span></dt><dd><dl><dt><span class="section"><a href="#ProvidedId">4.6.1. The ProvidedId annotation</a></span></dt></dl></dd><dt><span class="section"><a href="#hsearch-mapping-programmaticapi">4.7. Programmatic API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4940">4.7.1. Mapping an entity as indexable</a></span></dt><dt><span class="section"><a href="#d0e4978">4.7.2. Adding DocumentId to indexed entity</a></span></dt><dt><span class="section"><a href="#d0e5000">4.7.3. Defining analyzers</a></span></dt><dt><span class="section"><a href="#d0e5029">4.7.4. Defining full text filter definitions</a></span></dt><dt><span class="section"><a href="#d0e5063">4.7.5. Defining fields for indexing</a></span></dt><dt><span class="section"><a href="#d0e5110">4.7.6. Programmatically defining embedded entities</a></span></dt><dt><span class="section"><a href="#d0e5142">4.7.7. Contained In definition</a></span></dt><dt><span class="section"><a href="#d0e5167">4.7.8. Date/Calendar Bridge</a></span></dt><dt><span class="section"><a href="#d0e5208">4.7.9. Defining bridges</a></span></dt><dt><span class="section"><a href="#d0e5237">4.7.10. Mapping class bridge</a></span></dt><dt><span class="section"><a href="#d0e5260">4.7.11. Mapping dynamic boost</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#search-query">5. Querying</a></span></dt><dd><dl><dt><span class="section"><a href="#section-building-lucene-queries">5.1. Building queries</a></span></dt><dd><dl><dt><span class="section"><a href="#search-query-lucene-api">5.1.1. Building a Lucene query using the Lucene API</a></span></dt><dt><span class="section"><a href="#search-query-querydsl">5.1.2. Building a Lucene query with the Hibernate Search query
      DSL</a></span></dt><dt><span class="section"><a href="#d0e5677">5.1.3. Building a Hibernate Search query</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6119">5.2. Retrieving the results</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6136">5.2.1. Performance considerations</a></span></dt><dt><span class="section"><a href="#d0e6182">5.2.2. Result size</a></span></dt><dt><span class="section"><a href="#d0e6213">5.2.3. ResultTransformer</a></span></dt><dt><span class="section"><a href="#d0e6239">5.2.4. Understanding results</a></span></dt></dl></dd><dt><span class="section"><a href="#query-filter">5.3. Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#query-filter-shard">5.3.1. Using filters in a sharded environment</a></span></dt></dl></dd><dt><span class="section"><a href="#query-faceting">5.4. Faceting</a></span></dt><dd><dl><dt><span class="section"><a href="#section-creating-faceting-request">5.4.1. Creating a faceting request</a></span></dt><dt><span class="section"><a href="#section-sorting-faceting-request">5.4.2. Setting the facet sort order</a></span></dt><dt><span class="section"><a href="#section-applying-faceting-request">5.4.3. Applying a faceting request</a></span></dt><dt><span class="section"><a href="#section-interpreting-facet-result">5.4.4. Interpreting a <code class="classname">Facet</code> result</a></span></dt><dt><span class="section"><a href="#d0e6894">5.4.5. Restricting query results</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6932">5.5. Optimizing the query process</a></span></dt><dd><dl><dt><span class="section"><a href="#query-fieldcaches">5.5.1. Caching index values: FieldCache</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#manual-index-changes">6. Manual index changes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7020">6.1. Adding instances to the index</a></span></dt><dt><span class="section"><a href="#d0e7061">6.2. Deleting instances from the index</a></span></dt><dt><span class="section"><a href="#search-batchindex">6.3. Rebuilding the whole index</a></span></dt><dd><dl><dt><span class="section"><a href="#search-batchindex-flushtoindexes">6.3.1. Using flushToIndexes()</a></span></dt><dt><span class="section"><a href="#search-batchindex-massindexer">6.3.2. Using a MassIndexer</a></span></dt><dt><span class="section"><a href="#d0e7343">6.3.3. Useful parameters for batch indexing</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#search-optimize">7. Index Optimization</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7465">7.1. Automatic optimization</a></span></dt><dt><span class="section"><a href="#d0e7528">7.2. Manual optimization</a></span></dt><dt><span class="section"><a href="#d0e7551">7.3. Adjusting optimization</a></span></dt></dl></dd><dt><span class="chapter"><a href="#search-monitoring">8. Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7595">8.1. JMX</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7624">8.1.1. StatisticsInfoMBean</a></span></dt><dt><span class="section"><a href="#d0e7632">8.1.2. IndexControlMBean</a></span></dt><dt><span class="section"><a href="#d0e7648">8.1.3. IndexingProgressMonitorMBean</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#spatial">9. Spatial</a></span></dt><dd><dl><dt><span class="section"><a href="#spatial-indexing">9.1. Enable indexing of Spatial Coordinates</a></span></dt><dd><dl><dt><span class="section"><a href="#spatial-indexing-range">9.1.1. Indexing coordinates for Double Range Queries</a></span></dt><dt><span class="section"><a href="#spatial-indexing-quadtree">9.1.2. Indexing coordinates in a Grid with Quad Trees</a></span></dt><dt><span class="section"><a href="#spatial-coordinatesinterface">9.1.3. Implementing the Coordinates interface</a></span></dt></dl></dd><dt><span class="section"><a href="#spatial-queries">9.2. Performing Spatial Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#spatial-queries-distance">9.2.1. Returning distance to query point in the search results</a></span></dt></dl></dd><dt><span class="section"><a href="#spatial-multiplecoordinates">9.3. Multiple Coordinate pairs</a></span></dt><dt><span class="section"><a href="#spatial-behind-curtain">9.4. Insight: implementation details of Quad Tree indexing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8105">9.4.1. At indexing level</a></span></dt><dt><span class="section"><a href="#d0e8150">9.4.2. At search level</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#search-lucene-native">10. Advanced features</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8203">10.1. Accessing the SearchFactory</a></span></dt><dt><span class="section"><a href="#IndexReaders">10.2. Using an IndexReader</a></span></dt><dt><span class="section"><a href="#d0e8294">10.3. Accessing a Lucene Directory</a></span></dt><dt><span class="section"><a href="#advanced-features-sharding">10.4. Sharding indexes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8351">10.4.1. Static sharding</a></span></dt><dt><span class="section"><a href="#advanced-features-dynamic-sharding">10.4.2. Dynamic sharding</a></span></dt></dl></dd><dt><span class="section"><a href="#section-sharing-indexes">10.5. Sharing indexes</a></span></dt><dt><span class="section"><a href="#section-services">10.6. Using external services</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8572">10.6.1. Exposing a service</a></span></dt><dt><span class="section"><a href="#d0e8660">10.6.2. Using a service</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8681">10.7. Customizing Lucene's scoring formula</a></span></dt></dl></dd><dt><span class="chapter"><a href="#d0e8782">11. Further reading</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="preface"/>Preface</h2></div></div></div><p>Full text search engines like Apache Lucene are very powerful
    technologies to add efficient free text search capabilities to
    applications. However, Lucene suffers several mismatches when dealing with
    object domain models. Amongst other things indexes have to be kept up to
    date and mismatches between index structure and domain model as well as
    query mismatches have to be avoided.</p><p>Hibernate Search addresses these shortcomings - it indexes your
    domain model with the help of a few annotations, takes care of
    database/index synchronization and brings back regular managed objects
    from free text queries. To achieve this Hibernate Search is combining the
    power of <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.hibernate.org">Hibernate</a> and
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://lucene.apache.org">Apache Lucene</a>.</p></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="getting-started"/>Chapter 1. Getting started</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e73">1.1. System Requirements</a></span></dt><dt><span class="section"><a href="#d0e141">1.2. Using Maven</a></span></dt><dt><span class="section"><a href="#d0e183">1.3. Configuration</a></span></dt><dt><span class="section"><a href="#d0e397">1.4. Indexing</a></span></dt><dt><span class="section"><a href="#d0e422">1.5. Searching</a></span></dt><dt><span class="section"><a href="#d0e447">1.6. Analyzer</a></span></dt><dt><span class="section"><a href="#d0e536">1.7. What's next</a></span></dt></dl></div><p>Welcome to Hibernate Search. The following chapter will guide you
  through the initial steps required to integrate Hibernate Search into an
  existing Hibernate enabled application. In case you are a Hibernate new
  timer we recommend you start <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://hibernate.org/quick-start.html">here</a>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e73"/>1.1. System Requirements</h2></div></div></div><div class="table"><a id="d0e76"/><p class="title"><b>Table 1.1. System requirements</b></p><div class="table-contents"><table summary="System requirements" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td>Java Runtime</td><td>A JDK or JRE version <span class="emphasis"><em>6</em></span> or greater. You
            can download a Java Runtime for Windows/Linux/Solaris <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">here</a>.
            If using Java version <span class="emphasis"><em>7</em></span> make sure you avoid
            builds 0 and 1: those versions contained an optimisation bug which
            would be triggered by Lucene. Hibernate Search 3.x was compatible
            with Java version <span class="emphasis"><em>5</em></span>.</td></tr><tr><td>Hibernate Search</td><td><code class="literal">hibernate-search-4.4.1.Final.jar</code> and all
            runtime dependencies. You can get the jar artifacts either from
            the <code class="literal">dist/lib</code> directory of the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://sourceforge.net/projects/hibernate/files/hibernate-search/">Hibernate
            Search distribution</a> or you can download them from the
            <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://repository.jboss.org/nexus/content/groups/public-jboss/ ">JBoss
            maven repository</a>.</td></tr><tr><td>Hibernate Core</td><td>You will need <code class="literal">hibernate-core-4.2.8.Final.jar</code>
            and its transitive dependencies (either from the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://sourceforge.net/projects/hibernate/files/hibernate3/">distribution
            bundle</a> or the maven repository).</td></tr><tr><td>JPA 2</td><td>Even though Hibernate Search can be used without JPA
            annotations the following instructions will use them for basic
            entity configuration (<span class="emphasis"><em>@Entity, @Id,
            @OneToMany,...</em></span>). This part of the configuration could
            also be expressed in xml or code. <p>Hibernate Search, however,
            has also its own set of annotations (<span class="emphasis"><em>@Indexed,
            @DocumentId, @Field,...</em></span>) for which there exists so far
            no XML based alternative; a better option is the <a href="#hsearch-mapping-programmaticapi" title="4.7. Programmatic API">Section 4.7, “Programmatic API”</a>.</p>
            </td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e141"/>1.2. Using Maven</h2></div></div></div><p>The Hibernate Search artifacts can be found in Maven's central
    repository but are released first in the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://repository.jboss.org/nexus/content/groups/public-jboss/ ">JBoss
    maven repository</a>. So it's not a requirement but we recommend to
    add this repository to your <code class="filename">settings.xml file</code> (see
    also <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://community.jboss.org/wiki/MavenGettingStarted-Users">Maven
    Getting Started</a> for more details).</p><p>This is all you need to add to your pom.xml to get started:</p><div class="example"><a id="d0e157"/><p class="title"><b>Example 1.1. Maven artifact identifier for Hibernate Search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-search</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.4.1.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><div class="example"><a id="d0e162"/><p class="title"><b>Example 1.2. Optional Maven dependencies for Hibernate Search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_comment">&lt;!--&nbsp;If&nbsp;using&nbsp;JPA&nbsp;(2),&nbsp;add:&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-entitymanager</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.2.8.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_comment">&lt;!--&nbsp;Additional&nbsp;Analyzers:&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-search-analyzers</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.4.1.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_comment">&lt;!--&nbsp;Infinispan&nbsp;integration:&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-search-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.4.1.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>Only the <span class="emphasis"><em>hibernate-search</em></span> dependency is
    mandatory.<span class="emphasis"><em> hibernate-entitymanager</em></span> is only required
    if you want to use Hibernate Search in conjunction with JPA.</p><p>To use <span class="emphasis"><em>hibernate-search-infinispan</em></span>, adding the
    JBoss Maven repository is mandatory, because it contains the needed
    Infinispan dependencies which are currently not mirrored by
    <code class="literal">central</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e183"/>1.3. Configuration</h2></div></div></div><p>Once you have downloaded and added all required dependencies to your
    application you have to add a couple of properties to your hibernate
    configuration file. If you are using Hibernate directly this can be done
    in <code class="literal">hibernate.properties</code> or
    <code class="literal">hibernate.cfg.xml</code>. If you are using Hibernate via JPA
    you can also add the properties to <code class="literal">persistence.xml</code>. The
    good news is that for standard use most properties offer a sensible
    default. An example <code class="filename">persistence.xml</code> configuration
    could look like this:</p><div class="example"><a id="d0e200"/><p class="title"><b>Example 1.3. Basic configuration options to be added to
      <code class="literal"><code class="filename">hibernate.properties</code></code>,
      <code class="literal"><code class="filename">hibernate.cfg.xml</code></code> or
      <code class="filename">persistence.xml</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">...</span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.search.default.directory_provider&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;filesystem&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.search.default.indexBase&quot;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;/var/lucene/indexes&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">...&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div></div><br class="example-break"/><p>First you have to tell Hibernate Search which
    <code class="classname">DirectoryProvider</code> to use. This can be achieved by
    setting the <code class="literal">hibernate.search.default.directory_provider</code>
    property. Apache Lucene has the notion of a <code class="literal">Directory</code>
    to store the index files. Hibernate Search handles the initialization and
    configuration of a Lucene <code class="literal">Directory</code> instance via a
    <code class="literal">DirectoryProvider</code>. In this tutorial we will use a a
    directory provider storing the index in the file system. This will give us
    the ability to physically inspect the Lucene indexes created by Hibernate
    Search (eg via <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://code.google.com/p/luke/">Luke</a>).
    Once you have a working configuration you can start experimenting with
    other directory providers (see <a href="#search-configuration-directory" title="3.3. Directory configuration">Section 3.3, “Directory configuration”</a>). Next to the directory
    provider you also have to specify the default base directory for all
    indexes via <code class="literal">hibernate.search.default.indexBase</code>.</p><p>Lets assume that your application contains the Hibernate managed
    classes <code class="classname">example.Book</code> and
    <code class="classname">example.Author</code> and you want to add free text search
    capabilities to your application in order to search the books contained in
    your database.</p><div class="example"><a id="d0e248"/><p class="title"><b>Example 1.4. Example entities Book and Author before adding Hibernate Search
      specific annotations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;example</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subtitle</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;authors&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;publicationDate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;example</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Author</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Author</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>To achieve this you have to add a few annotations to the
    <code class="classname">Book</code> and <code class="classname">Author</code> class. The
    first annotation <code class="literal">@Indexed</code> marks
    <code class="classname">Book</code> as indexable. By design Hibernate Search needs
    to store an untokenized id in the index to ensure index unicity for a
    given entity. <code class="literal">@DocumentId</code> marks the property to use for
    this purpose and is in most cases the same as the database primary key.
    The <code class="literal">@DocumentId</code> annotation is optional in the case
    where an <code class="classname">@Id</code> annotation exists.</p><p>Next you have to mark the fields you want to make searchable. Let's
    start with <code class="literal">title</code> and <code class="literal">subtitle</code> and
    annotate both with <code class="literal">@Field</code>. The parameter
    <code class="literal">index=Index.YES</code> will ensure that the text will be
    indexed, while <code class="literal">analyze=Analyze.YES</code> ensures that the
    text will be analyzed using the default Lucene analyzer. Usually,
    analyzing means chunking a sentence into individual words and potentially
    excluding common words like <code class="literal">'a'</code> or
    '<code class="literal">the</code>'. We will talk more about analyzers a little later
    on. The third parameter we specify within
    <code class="literal">@Field</code>,<code class="literal"> store=Store.NO</code>, ensures that
    the actual data will not be stored in the index. Whether this data is
    stored in the index or not has nothing to do with the ability to search
    for it. From Lucene's perspective it is not necessary to keep the data
    once the index is created. The benefit of storing it is the ability to
    retrieve it via projections ( see <a href="#projections" title="5.1.3.5. Projection">Section 5.1.3.5, “Projection”</a>).</p><p>Without projections, Hibernate Search will per default execute a
    Lucene query in order to find the database identifiers of the entities
    matching the query critera and use these identifiers to retrieve managed
    objects from the database. The decision for or against projection has to
    be made on a case to case basis. The default behaviour is recommended
    since it returns managed objects whereas projections only return object
    arrays.</p><p>Note that <code class="literal">index=Index.YES</code>,
    <code class="literal">analyze=Analyze.YES</code> and
    <code class="literal">store=Store.NO</code> are the default values for these
    paramters and could be ommited.</p><p>After this short look under the hood let's go back to annotating the
    <code class="classname">Book</code> class. Another annotation we have not yet
    discussed is <code class="literal">@DateBridge</code>. This annotation is one of the
    built-in field bridges in Hibernate Search. The Lucene index is purely
    string based. For this reason Hibernate Search must convert the data types
    of the indexed fields to strings and vice versa. A range of predefined
    bridges are provided, including the <code class="classname">DateBridge</code>
    which will convert a <code class="classname">java.util.Date</code> into a
    <code class="classname">String</code> with the specified resolution. For more
    details see <a href="#search-mapping-bridge" title="4.4. Bridges">Section 4.4, “Bridges”</a>.</p><p>This leaves us with <code class="literal">@IndexedEmbedded. </code>This
    annotation is used to index associated entities
    (<code class="literal">@ManyToMany</code>, <code class="literal">@*ToOne</code>,
    <code class="literal">@Embedded</code> and <code class="literal">@ElementCollection</code>) as
    part of the owning entity. This is needed since a Lucene index document is
    a flat data structure which does not know anything about object relations.
    To ensure that the authors' name will be searchable you have to make sure
    that the names are indexed as part of the book itself. On top of
    <code class="literal">@IndexedEmbedded</code> you will also have to mark all fields
    of the associated entity you want to have included in the index with
    <code class="literal">@Indexed</code>. For more details see <a href="#search-mapping-associated" title="4.1.3. Embedded and associated objects">Section 4.1.3, “Embedded and associated objects”</a>.</p><p>These settings should be sufficient for now. For more details on
    entity mapping refer to <a href="#search-mapping-entity" title="4.1. Mapping an entity">Section 4.1, “Mapping an entity”</a>.</p><div class="example"><a id="d0e370"/><p class="title"><b>Example 1.5. Example entities after adding Hibernate Search
      annotations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;example</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
@Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Field(index=Index.YES, analyze=Analyze.YES, store=Store.NO)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Field(index=Index.YES, analyze=Analyze.YES, store=Store.NO)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subtitle</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Field(index = Index.YES, analyze=Analyze.NO, store = Store.YES)
  @DateBridge(resolution = Resolution.DAY)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;publicationDate</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@IndexedEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;authors&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;example</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Author</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Author</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e397"/>1.4. Indexing</h2></div></div></div><p>Hibernate Search will transparently index every entity persisted,
    updated or removed through Hibernate Core. However, you have to create an
    initial Lucene index for the data already present in your database. Once
    you have added the above properties and annotations it is time to trigger
    an initial batch index of your books. You can achieve this by using one of
    the following code snippets (see also <a href="#search-batchindex" title="6.3. Rebuilding the whole index">Section 6.3, “Rebuilding the whole index”</a>):</p><div class="example"><a id="d0e404"/><p class="title"><b>Example 1.6. Using Hibernate Session to index data</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">session</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createIndexer</span><span class="java_separator">().</span><span class="java_plain">startAndWait</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e409"/><p class="title"><b>Example 1.7. Using JPA to index data</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;em&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;entityManagerFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createEntityManager</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;fullTextEntityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">em</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextEntityManager</span><span class="java_separator">.</span><span class="java_plain">createIndexer</span><span class="java_separator">().</span><span class="java_plain">startAndWait</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>After executing the above code, you should be able to see a Lucene
    index under <code class="literal">/var/lucene/indexes/example.Book</code>. Go ahead
    an inspect this index with <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://code.google.com/p/luke/">Luke</a>. It will help you to
    understand how Hibernate Search works.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e422"/>1.5. Searching</h2></div></div></div><p>Now it is time to execute a first search. The general approach is to
    create a Lucene query, either via the Lucene API (<a href="#search-query-lucene-api" title="5.1.1. Building a Lucene query using the Lucene API">Section 5.1.1, “Building a Lucene query using the Lucene API”</a>) or via the Hibernate Search query DSL
    (<a href="#search-query-querydsl" title="5.1.2. Building a Lucene query with the Hibernate Search query DSL">Section 5.1.2, “Building a Lucene query with the Hibernate Search query
      DSL”</a>), and then wrap this query into a
    <code class="classname">org.hibernate.Query</code> in order to get all the
    functionality one is used to from the Hibernate API. The following code
    will prepare a query against the indexed fields, execute it and return a
    list of <code class="classname">Book</code>s.</p><div class="example"><a id="d0e437"/><p class="title"><b>Example 1.8. Using Hibernate Session to create and execute a search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">session</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;create&nbsp;</span><span class="java_keyword">native</span><span class="java_plain">&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;unsing&nbsp;the&nbsp;query&nbsp;DSL</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;alternatively&nbsp;you&nbsp;can&nbsp;write&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;using&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;parser</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;programmatic&nbsp;API</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">The</span><span class="java_plain">&nbsp;</span><span class="java_type">Hibernate</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_plain">&nbsp;DSL&nbsp;is&nbsp;recommended&nbsp;though</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;qb&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;qb</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onFields</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;subtitle&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;authors.name&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;Java&nbsp;rocks!&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;wrap&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;in&nbsp;a&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;hibQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">query</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;execute&nbsp;search</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;hibQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">session</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e442"/><p class="title"><b>Example 1.9. Using JPA to create and execute a search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;em&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;entityManagerFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createEntityManager</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;fullTextEntityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">jpa</span><span class="java_separator">.</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">em</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">getTransaction</span><span class="java_separator">().</span><span class="java_plain">begin</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;create&nbsp;</span><span class="java_keyword">native</span><span class="java_plain">&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;unsing&nbsp;the&nbsp;query&nbsp;DSL</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;alternatively&nbsp;you&nbsp;can&nbsp;write&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;using&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;parser</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or&nbsp;the&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;programmatic&nbsp;API</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">The</span><span class="java_plain">&nbsp;</span><span class="java_type">Hibernate</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_plain">&nbsp;DSL&nbsp;is&nbsp;recommended&nbsp;though</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;qb&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextEntityManager</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;qb</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onFields</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;subtitle&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;authors.name&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;Java&nbsp;rocks!&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;wrap&nbsp;</span><span class="java_type">Lucene</span><span class="java_plain">&nbsp;query&nbsp;in&nbsp;a&nbsp;javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">Query</span>
<!--  --><br/><span class="java_plain">javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;persistenceQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextEntityManager</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">query</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;execute&nbsp;search</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;persistenceQuery</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">getTransaction</span><span class="java_separator">().</span><span class="java_plain">commit</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">em</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e447"/>1.6. Analyzer</h2></div></div></div><p>Let's make things a little more interesting now. Assume that one of
    your indexed book entities has the title "Refactoring: Improving the
    Design of Existing Code" and you want to get hits for all of the following
    queries: "refactor", "refactors", "refactored" and "refactoring". In
    Lucene this can be achieved by choosing an analyzer class which applies
    word stemming during the indexing <span class="bold"><strong>as well
    as</strong></span> the search process. Hibernate Search offers several ways to
    configure the analyzer to be used (see <a href="#analyzer" title="4.3.1. Default analyzer and analyzer by class">Section 4.3.1, “Default analyzer and analyzer by class”</a>):</p><div class="itemizedlist"><ul><li><p>Setting the <code class="literal">hibernate.search.analyzer</code>
        property in the configuration file. The specified class will then be
        the default analyzer.</p></li><li><p>Setting the <code class="literal"><code class="literal">@Analyzer</code></code>
        annotation at the entity level.</p></li><li><p>Setting the <code class="literal">@<code class="literal">Analyzer</code></code>
        annotation at the field level.</p></li></ul></div><p>When using the <code class="literal">@Analyzer</code> annotation one can
    either specify the fully qualified classname of the analyzer to use or one
    can refer to an analyzer definition defined by the
    <code class="literal">@AnalyzerDef</code> annotation. In the latter case the Solr
    analyzer framework with its factories approach is utilized. To find out
    more about the factory classes available you can either browse the Solr
    JavaDoc or read the corresponding section on the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters">Solr
    Wiki.</a></p><p>In the example below a
    <code class="classname">StandardTokenizerFactory</code> is used followed by two
    filter factories, <code class="classname">LowerCaseFilterFactory</code> and
    <code class="classname">SnowballPorterFilterFactory</code>. The standard tokenizer
    splits words at punctuation characters and hyphens while keeping email
    addresses and internet hostnames intact. It is a good general purpose
    tokenizer. The lowercase filter lowercases the letters in each token
    whereas the snowball filter finally applies language specific
    stemming.</p><p>Generally, when using the Solr framework you have to start with a
    tokenizer followed by an arbitrary number of filters.</p><div class="example"><a id="d0e502"/><p class="title"><b>Example 1.10. Using <code class="classname">@AnalyzerDef</code> and the Solr framework
      to define and use an analyzer</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
@AnalyzerDef(name = "customanalyzer",
  tokenizer = @TokenizerDef(factory = StandardTokenizerFactory.class),
  filters = {
    @TokenFilterDef(factory = LowerCaseFilterFactory.class),
    @TokenFilterDef(factory = SnowballPorterFilterFactory.class, params = {
      @Parameter(name = "language", value = "English")
    })
  })</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Analyzer(definition = "customanalyzer")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>@Analyzer(definition = "customanalyzer")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subtitle</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">IndexedEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ManyToMany</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;authors&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashSet</span><span class="java_operator">&lt;</span><span class="java_type">Author</span><span class="java_operator">&gt;</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyze&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">,</span><span class="java_plain">&nbsp;store&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">DAY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;publicationDate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getters</span><span class="java_operator">/</span><span class="java_plain">setters&nbsp;follow&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Using <code class="classname">@AnalyzerDef</code> only defines an Analyzer,
    you still have to apply it to entities and or properties using
    <code class="classname">@Analyzer</code>. Like in the above example the
    <code class="literal">customanalyzer</code> is defined but not applied on the
    entity: it's applied on the <code class="literal">title</code> and
    <code class="literal">subtitle</code> properties only. An analyzer definition is
    global, so you can define it on any entity and reuse the definition on
    other entities.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e536"/>1.7. What's next</h2></div></div></div><p>The above paragraphs helped you getting an overview of Hibernate
    Search. The next step after this tutorial is to get more familiar with the
    overall architecture of Hibernate Search (<a href="#search-architecture" title="Chapter 2. Architecture">Chapter 2, <i xmlns:xlink="http://www.w3.org/1999/xlink">Architecture</i></a>) and explore the basic features in more
    detail. Two topics which were only briefly touched in this tutorial were
    analyzer configuration (<a href="#analyzer" title="4.3.1. Default analyzer and analyzer by class">Section 4.3.1, “Default analyzer and analyzer by class”</a>) and field bridges
    (<a href="#search-mapping-bridge" title="4.4. Bridges">Section 4.4, “Bridges”</a>). Both are important features
    required for more fine-grained indexing. More advanced topics cover
    clustering (<a href="#jms-backend" title="3.4.1. JMS Master/Slave back end">Section 3.4.1, “JMS Master/Slave back end”</a>, <a href="#infinispan-directories" title="3.3.1. Infinispan Directory configuration">Section 3.3.1, “Infinispan Directory configuration”</a>) and large index handling (<a href="#advanced-features-sharding" title="10.4. Sharding indexes">Section 10.4, “Sharding indexes”</a>).</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-architecture"/>Chapter 2. Architecture</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e557">2.1. Overview</a></span></dt><dt><span class="section"><a href="#d0e635">2.2. Back end</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e646">2.2.1. Lucene</a></span></dt><dt><span class="section"><a href="#d0e668">2.2.2. JMS</a></span></dt><dt><span class="section"><a href="#d0e683">2.2.3. JGroups</a></span></dt></dl></dd><dt><span class="section"><a href="#search-architecture-readerstrategy">2.3. Reader strategy</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e698">2.3.1. <code class="literal">shared</code></a></span></dt><dt><span class="section"><a href="#d0e724">2.3.2. <code class="literal">not-shared</code></a></span></dt><dt><span class="section"><a href="#d0e741">2.3.3. Custom</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e557"/>2.1. Overview</h2></div></div></div><p>Hibernate Search consists of an indexing component as well as an
    index search component. Both are backed by Apache Lucene.</p><p>Each time an entity is inserted, updated or removed in/from the
    database, Hibernate Search keeps track of this event (through the
    Hibernate event system) and schedules an index update. All these updates
    are handled without you having to interact with the Apache Lucene APIs
    directly (see <a href="#search-configuration-event" title="3.1. Enabling Hibernate Search and automatic indexing">Section 3.1, “Enabling Hibernate Search and automatic indexing”</a>). Instead, the
    interaction with the underlying Lucene indexes is handled via so called
    <code class="classname">IndexManager</code>s.</p><p>Each Lucene index is managed by one index manager which is uniquely
    identified by name. In most cases there is also a one to one relationship
    between an indexed entity and a single
    <code class="classname">IndexManager</code>. The exceptions are the use cases of
    index sharding and index sharing. The former can be applied when the index
    for a single entity becomes too big and indexing operations are slowing
    down the application. In this case a single entity is indexed into
    multiple indexes each with its own index manager (see <a href="#advanced-features-sharding" title="10.4. Sharding indexes">Section 10.4, “Sharding indexes”</a>). The latter, index
    sharing, is the ability to index multiple entities into the same Lucene
    index (see <a href="#section-sharing-indexes" title="10.5. Sharing indexes">Section 10.5, “Sharing indexes”</a>).</p><p>The index manager abstracts from the specific index configuration.
    In the case of the default index manager this includes details about the
    selected backend, the configured reader strategy and the chosen
    <code class="classname">DirectoryProvider</code>. These components will be
    discussed in greater detail later on. It is recommended that you start
    with the default index manager which uses different Lucene
    <code class="classname">Directory</code> types to manage the indexes (see <a href="#search-configuration-directory" title="3.3. Directory configuration">Section 3.3, “Directory configuration”</a>). You can, however, also
    provide your own <code class="classname">IndexManager</code> implementation (see
    <a href="#configuration-indexmanager" title="3.2. Configuring the IndexManager">Section 3.2, “Configuring the <code class="classname">IndexManager</code>”</a>).</p><p>Once the index is created, you can search for entities and return
    lists of managed entities saving you the tedious object to Lucene
    <code class="classname">Document</code> mapping. The same persistence context is
    shared between Hibernate and Hibernate Search. As a matter of fact, the
    <code class="classname">FullTextSession</code> is built on top of the Hibernate
    <code class="classname">Session</code> so that the application code can use the
    unified <code class="classname">org.hibernate.Query</code> or
    <code class="classname">javax.persistence.Query</code> APIs exactly the same way a
    HQL, JPA-QL or native query would do.</p><p>To be more efficient Hibernate Search batches the write interactions
    with the Lucene index. This batching is the responsibility of the
    <code class="classname">Worker</code>. There are currently two types of batching.
    Outside a transaction, the index update operation is executed right after
    the actual database operation. This is really a no batching setup. In the
    case of an ongoing transaction, the index update operation is scheduled
    for the transaction commit phase and discarded in case of transaction
    rollback. The batching scope is the transaction. There are two immediate
    benefits:</p><div class="itemizedlist"><ul><li><p>Performance: Lucene indexing works better when operation are
        executed in batch.</p></li><li><p>ACIDity: The work executed has the same scoping as the one
        executed by the database transaction and is executed if and only if
        the transaction is committed. This is not ACID in the strict sense of
        it, but ACID behavior is rarely useful for full text search indexes
        since they can be rebuilt from the source at any time.</p></li></ul></div><p>You can think of those two batch modes (no scope vs transactional)
    as the equivalent of the (infamous) autocommit vs transactional behavior.
    From a performance perspective, the <span class="emphasis"><em>in transaction</em></span>
    mode is recommended. The scoping choice is made transparently. Hibernate
    Search detects the presence of a transaction and adjust the scoping (see
    <a href="#configuration-worker">Section 3.4, “Worker configuration”</a>).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>It is recommended - for both your database and Hibernate Search
        - to execute your operations in a transaction, be it JDBC or
        JTA.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Hibernate Search works perfectly fine in the Hibernate / EntityManager
    long conversation pattern aka. atomic conversation.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e635"/>2.2. Back end</h2></div></div></div><p>Hibernate Search offers the ability to let the batched work being
    processed by different back ends. Several back ends are provided out of
    the box and you have the option to plugin your own. It is important to
    understand that in this context back end encompasses more than just the
    configuration option
    <code class="literal">hibernate.search.default.worker.backend</code>. This property
    just specifies a implementation of the
    <code class="classname">BackendQueueProcessor</code> interface which is a part of
    a back end configuration. In most cases, however, additional configuration
    settings are needed to successfully configure a specific backend setup,
    like for example the JMS back end.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e646"/>2.2.1. Lucene</h3></div></div></div><p>In this mode, all index update operations applied on a given node
      (JVM) will be executed to the Lucene directories (through the directory
      providers) by the same node. This mode is typically used in non
      clustered environment or in clustered environments where the directory
      store is shared.</p><div class="mediaobject" align="center"><img src="lucene-backend.png" align="middle"/><div class="caption"><p>Lucene back end configuration.</p></div></div><p>This mode targets non clustered applications, or clustered
      applications where the <code class="classname">Directory</code> is taking care
      of the locking strategy.</p><p>The main advantage is simplicity and immediate visibility of the
      changes in Lucene queries (a requirement in some applications).</p><p>An alternative back end viable for non-clustered and non-shared
      index configurations is the near-real-time backend.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e668"/>2.2.2. JMS</h3></div></div></div><p>All index update operations applied on a given node are sent to a
      JMS queue. A unique reader will then process the queue and update the
      master index. The master index is then replicated on a regular basis to
      the slave copies. This is known as the master/slaves pattern. The master
      is the sole responsible for updating the Lucene index. The slaves can
      accept read as well as write operations. However, they only process the
      read operation on their local index copy and delegate the update
      operations to the master.</p><div class="mediaobject" align="center"><img src="jms-backend.png" align="middle"/><div class="caption"><p>JMS back end configuration.</p></div></div><p>This mode targets clustered environments where throughput is
      critical, and index update delays are affordable. Reliability is ensured
      by the JMS provider and by having the slaves working on a local copy of
      the index.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e683"/>2.2.3. JGroups</h3></div></div></div><p>The JGroups based back end works similar to the JMS one and is
      designed after the same master/slave pattern. However, instead of JMS
      the JGroups toolkit is used as a replication mechanism. This back end
      can be used as an alternative to JMS when response time is critical, but
      i.e. JNDI service is not available.</p><p>Note that while JMS can usually be configured to use persistent queues,
      JGroups talks directly to other nodes over network. Message delivery to
      other reachable nodes is guaranteed, but if no master node is
      available, index operations are silently discarded. This backend
      can be configured to use asynchronous messages, or to wait for each
      indexing operation to be completed on the remote node before returning.</p><p>The JGroups backend can be configured with static master or slave roles,
      or can be setup to perform an auto-election of the master. This mode is
      particularly useful to have the system automatically pick a new master
      in case of failure, but during a reelection process some indexing
      operations might be lost. For this reason this mode is not suited for use cases
      requiring strong consistency guarantees. When configured to perform an
      automatic election, the master node is defined as an hash on the index name:
      the role is therefore possibly different for each index or shard.
      </p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-architecture-readerstrategy"/>2.3. Reader strategy</h2></div></div></div><p>When executing a query, Hibernate Search interacts with the Apache
    Lucene indexes through a reader strategy. Choosing a reader strategy will
    depend on the profile of the application (frequent updates, read mostly,
    asynchronous index update etc). See also <a href="#configuration-reader-strategy" title="3.5. Reader strategy configuration">Section 3.5, “Reader strategy configuration”</a></p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e698"/>2.3.1. <code class="literal">shared</code></h3></div></div></div><p>With this strategy, Hibernate Search will share the same
      <code class="classname">IndexReader</code>, for a given Lucene index, across
      multiple queries and threads provided that the
      <code class="classname">IndexReader</code> is still up-to-date. If the
      <code class="classname">IndexReader</code> is not up-to-date, a new one is
      opened and provided. Each <code class="classname">IndexReader</code> is made of
      several <code class="classname">SegmentReader</code>s. This strategy only
      reopens segments that have been modified or created after last opening
      and shares the already loaded segments from the previous instance. This
      strategy is the default.</p><p>The name of this strategy is <code class="literal">shared</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e724"/>2.3.2. <code class="literal">not-shared</code></h3></div></div></div><p>Every time a query is executed, a Lucene
      <code class="classname">IndexReader</code> is opened. This strategy is not the
      most efficient since opening and warming up an
      <code class="classname">IndexReader</code> can be a relatively expensive
      operation.</p><p>The name of this strategy is <code class="literal">not-shared</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e741"/>2.3.3. Custom</h3></div></div></div><p>You can write your own reader strategy that suits your application
      needs by implementing
      <code class="classname">org.hibernate.search.reader.ReaderProvider</code>. The
      implementation must be thread safe.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration"/>Chapter 3. Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#search-configuration-event">3.1. Enabling Hibernate Search and automatic indexing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e758">3.1.1. Enabling Hibernate Search</a></span></dt><dt><span class="section"><a href="#d0e769">3.1.2. Automatic indexing</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration-indexmanager">3.2. Configuring the <code class="classname">IndexManager</code></a></span></dt><dd><dl><dt><span class="section"><a href="#d0e813">3.2.1. <code class="literal">directory-based</code></a></span></dt><dt><span class="section"><a href="#d0e828">3.2.2. <code class="literal">near-real-time</code></a></span></dt><dt><span class="section"><a href="#d0e856">3.2.3. Custom</a></span></dt></dl></dd><dt><span class="section"><a href="#search-configuration-directory">3.3. Directory configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#infinispan-directories">3.3.1. Infinispan Directory configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e1439">3.4. Worker configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-backend">3.4.1. JMS Master/Slave back end</a></span></dt><dt><span class="section"><a href="#jgroups-backend">3.4.2. JGroups Master/Slave back end</a></span></dt></dl></dd><dt><span class="section"><a href="#configuration-reader-strategy">3.5. Reader strategy configuration</a></span></dt><dt><span class="section"><a href="#d0e1995">3.6. Exception handling</a></span></dt><dt><span class="section"><a href="#d0e2031">3.7. Lucene configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#lucene-indexing-performance">3.7.1. Tuning indexing performance</a></span></dt><dt><span class="section"><a href="#search-configuration-directory-lockfactories">3.7.2. LockFactory configuration</a></span></dt><dt><span class="section"><a href="#d0e2627">3.7.3. Index format compatibility</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e2658">3.8. Metadata API</a></span></dt><dt><span class="section"><a href="#search-configuration-deploy-on-AS7">3.9. Hibernate Search as JBoss AS module</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration-event"/>3.1. Enabling Hibernate Search and automatic indexing</h2></div></div></div><p>Let's start with the most basic configuration question - how do I
    enable Hibernate Search?</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e758"/>3.1.1. Enabling Hibernate Search</h3></div></div></div><p>The good news is that Hibernate Search is enabled out of the box
      when detected on the classpath by Hibernate Core. If, for some reason
      you need to disable it, set
      <code class="literal">hibernate.search.autoregister_listeners</code> to
      <code class="constant">false</code>. Note that there is no performance penalty
      when the listeners are enabled but no entities are annotated as
      indexed.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e769"/>3.1.2. Automatic indexing</h3></div></div></div><p>By default, every time an object is inserted, updated or deleted
      through Hibernate, Hibernate Search updates the according Lucene index.
      It is sometimes desirable to disable that features if either your index
      is read-only or if index updates are done in a batch way (see <a href="#search-batchindex" title="6.3. Rebuilding the whole index">Section 6.3, “Rebuilding the whole index”</a>).</p><p>To disable event based indexing, set</p><pre class="programlisting">hibernate.search.indexing_strategy = manual</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In most case, the JMS backend provides the best of both world, a
        lightweight event based system keeps track of all changes in the
        system, and the heavyweight indexing process is done by a separate
        process or machine.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-indexmanager"/>3.2. Configuring the <code class="classname">IndexManager</code></h2></div></div></div><p>The role of the index manager component is described in <a href="#search-architecture" title="Chapter 2. Architecture">Chapter 2, <i xmlns:xlink="http://www.w3.org/1999/xlink">Architecture</i></a>. Hibernate Search provides two possible
    implementations for this interface to choose from.</p><div class="itemizedlist"><ul><li><p><code class="literal">directory-based</code>: the default implementation
        which uses the Lucene <code class="classname">Directory</code> abstraction to
        manage index files.</p></li><li><p><code class="literal">near-real-time</code>: avoid flushing writes to disk
        at each commit. This index manager is also
        <code class="classname">Directory</code> based, but also makes uses of
        Lucene's NRT functionality.</p></li></ul></div><p>To select an alternative you specify the property:</p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].indexmanager = near-real-time</pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e813"/>3.2.1. <code class="literal">directory-based</code></h3></div></div></div><p>The default <code class="classname">IndexManager</code> implementation.
      This is the one mostly referred to in this documentation. It is highly
      configurable and allows you to select different settings for the reader
      strategy, back ends and directory providers. Refer to <a href="#search-configuration-directory" title="3.3. Directory configuration">Section 3.3, “Directory configuration”</a>, <a href="#configuration-worker">Section 3.4, “Worker configuration”</a> and <a href="#configuration-reader-strategy" title="3.5. Reader strategy configuration">Section 3.5, “Reader strategy configuration”</a> for more details.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e828"/>3.2.2. <code class="literal">near-real-time</code></h3></div></div></div><p>The <code class="classname">NRTIndexManager</code> is an extension of the
      default <code class="classname">IndexManager</code>, leveraging the Lucene NRT
      (Near Real Time) features for extreme low latency index writes. As a
      tradeoff it requires a non-clustered and non-shared index. In other
      words, it will ignore configuration settings for alternative back ends
      other than <code class="literal">lucene</code> and will acquire exclusive write
      locks on the <code class="classname">Directory</code>.</p><p>To achieve this low latency writes, the
      <code class="classname">IndexWriter</code> will not flush every change to disk.
      Queries will be allowed to read updated state from the unflushed index
      writer buffers; the downside of this strategy is that if the application
      crashes or the <code class="classname">IndexWriter</code> is otherwise killed
      you'll have to rebuild the indexes as some updates might be lost.</p><p>Because of these downsides, and because a master node in cluster
      can be configured for good performance as well, the NRT configuration is
      only recommended for non clustered websites with a limited amount of
      data.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e856"/>3.2.3. Custom</h3></div></div></div><p>It is also possible to configure a custom
      <code class="classname">IndexManager</code> implementation by specifying the
      fully qualified class name of your custom implementation. This
      implementation must have a no-argument constructor:</p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].indexmanager = my.corp.myapp.CustomIndexManager</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Your custom index manager implementation doesn't need to use the
        same components as the default implementations. For example, you can
        delegate to a remote indexing service which doesn't expose a
        <code class="classname">Directory</code> interface.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration-directory"/>3.3. Directory configuration</h2></div></div></div><p>As we have seen in <a href="#configuration-indexmanager" title="3.2. Configuring the IndexManager">Section 3.2, “Configuring the <code class="classname">IndexManager</code>”</a> the
    default index manager uses Lucene's notion of a
    <code class="classname">Directory</code> to store the index files. The
    <code class="classname">Directory</code> implementation can be customized and
    Lucene comes bundled with a file system and an in-memory implementation.
    <code class="classname">DirectoryProvider</code> is the Hibernate Search
    abstraction around a Lucene <code class="classname">Directory</code> and handles
    the configuration and the initialization of the underlying Lucene
    resources. <a href="#directory-provider-table" title="Table 3.1. List of built-in DirectoryProvider">Table 3.1, “List of built-in <code class="classname">DirectoryProvider</code>”</a> shows the list of
    the directory providers available in Hibernate Search together with their
    corresponding options.</p><p>To configure your <code class="classname">DirectoryProvider</code> you have
    to understand that each indexed entity is associated to a Lucene index
    (except of the case where multiple entities share the same index - <a href="#section-sharing-indexes" title="10.5. Sharing indexes">Section 10.5, “Sharing indexes”</a>). The name of the index is given by
    the <code class="constant">index</code> property of the
    <code class="classname">@Indexed</code> annotation. If the
    <code class="constant">index</code> property is not specified the fully qualified
    name of the indexed class will be used as name (recommended).</p><p>Knowing the index name, you can configure the directory provider and
    any additional options by using the prefix
    <code class="constant">hibernate.search.</code><em class="replaceable"><code>&lt;indexname&gt;</code></em>.
    The name <code class="constant">default</code>
    (<code class="constant">hibernate.search.default</code>) is reserved and can be
    used to define properties which apply to all indexes. <a href="#example-configuring-directory-providers" title="Example 3.2. Configuring directory providers">Example 3.2, “Configuring directory providers”</a> shows how
    <code class="constant">hibernate.search.default.directory_provider</code> is used
    to set the default directory provider to be the filesystem one.
    <code class="constant">hibernate.search.default.indexBase</code> sets then the
    default base directory for the indexes. As a result the index for the
    entity <code class="classname">Status</code> is created in
    <code class="filename">/usr/lucene/indexes/org.hibernate.example.Status</code>.</p><p>The index for the <code class="classname">Rule</code> entity, however, is
    using an in-memory directory, because the default directory provider for
    this entity is overridden by the property
    <code class="constant">hibernate.search.Rules.directory_provider</code>.</p><p>Finally the <code class="classname">Action</code> entity uses a custom
    directory provider <code class="classname">CustomDirectoryProvider</code>
    specified via
    <code class="constant">hibernate.search.Actions.directory_provider</code>.</p><div class="example"><a id="d0e955"/><p class="title"><b>Example 3.1. Specifying the index name</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">example</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Status</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_literal">&quot;Rules&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Rule</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_literal">&quot;Actions&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Action</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div class="example"><a id="example-configuring-directory-providers"/><p class="title"><b>Example 3.2. Configuring directory providers</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.directory_provider = filesystem
hibernate.search.default.indexBase = /usr/lucene/indexes
hibernate.search.Rules.directory_provider = ram
hibernate.search.Actions.directory_provider = com.acme.hibernate.CustomDirectoryProvider</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Using the described configuration scheme you can easily define
      common rules like the directory provider and base directory, and
      override those defaults later on on a per index basis.</p></div><div class="table"><a id="directory-provider-table"/><p class="title"><b>Table 3.1. List of built-in <code class="classname">DirectoryProvider</code></b></p><div class="table-contents"><table summary="List of built-in DirectoryProvider" border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Name and description</th><th align="center">Properties</th></tr></thead><tbody><tr><td><span class="property">ram</span>: Memory based directory, the
            directory will be uniquely identified (in the same deployment
            unit) by the <code class="literal">@Indexed.index</code> element</td><td>none</td></tr><tr><td><span class="property">filesystem</span>: File system based
            directory. The directory used will be &lt;indexBase&gt;/&lt;
            indexName &gt;</td><td><p><code class="literal">indexBase</code> : base
            directory</p><p><code class="literal">indexName</code>: override
            @Indexed.index (useful for sharded
            indexes)</p><p><code class="literal">locking_strategy</code> :
            optional, see <a href="#search-configuration-directory-lockfactories" title="3.7.2. LockFactory configuration">Section 3.7.2, “LockFactory configuration”</a>
            </p><p><code class="literal">filesystem_access_type</code>: allows to
            determine the exact type of <code class="classname">FSDirectory</code>
            implementation used by this
            <code class="classname">DirectoryProvider</code>. Allowed values are
            <code class="literal">auto</code> (the default value, selects
            <code class="classname">NIOFSDirectory</code> on non Windows systems,
            <code class="classname">SimpleFSDirectory</code> on Windows),
            <code class="literal">simple</code>
            (<code class="classname">SimpleFSDirectory</code>), <code class="literal">nio</code>
            (<code class="classname">NIOFSDirectory</code>), <code class="literal">mmap</code>
            (<code class="classname">MMapDirectory</code>). Make sure to refer to
            Javadocs of these <code class="classname">Directory</code> implementations
            before changing this setting. Even though
            <code class="classname">NIOFSDirectory</code> or
            <code class="classname">MMapDirectory</code> can bring substantial
            performace boosts they also have their issues.</p></td></tr><tr><td><p><span class="property">filesystem-master</span>: File system
            based directory. Like <code class="literal">filesystem</code>. It also
            copies the index to a source directory (aka copy directory) on a
            regular basis.</p><p>The recommended value for the refresh
            period is (at least) 50% higher that the time to copy the
            information (default 3600 seconds - 60 minutes).</p><p>Note
            that the copy is based on an incremental copy mechanism reducing
            the average copy time.</p><p>DirectoryProvider typically
            used on the master node in a JMS back end cluster.</p><p>The
            <code class="literal"> buffer_size_on_copy</code> optimum depends on your
            operating system and available RAM; most people reported good
            results using values between 16 and 64MB.</p></td><td><p><code class="literal">indexBase</code>: base
            directory</p><p><code class="literal">indexName</code>: override
            @Indexed.index (useful for sharded
            indexes)</p><p><code class="literal">sourceBase</code>: source (copy)
            base directory.</p><p><code class="literal">source</code>: source
            directory suffix (default to <code class="literal">@Indexed.index</code>).
            The actual source directory name being
            <code class="filename">&lt;sourceBase&gt;/&lt;source&gt;</code>
            </p><p><code class="literal">refresh</code>: refresh period in seconds
            (the copy will take place every <code class="constant">refresh</code>
            seconds). If a copy is still in progress when the following
            <code class="constant">refresh</code> period elapses, the second copy
            operation will be
            skipped.</p><p><code class="literal">buffer_size_on_copy</code>: The
            amount of MegaBytes to move in a single low level copy
            instruction; defaults to
            16MB.</p><p><code class="literal">locking_strategy</code> : optional,
            see <a href="#search-configuration-directory-lockfactories" title="3.7.2. LockFactory configuration">Section 3.7.2, “LockFactory configuration”</a>
            </p><p><code class="literal">filesystem_access_type</code>: allows to
            determine the exact type of <code class="classname">FSDirectory</code>
            implementation used by this
            <code class="classname">DirectoryProvider</code>. Allowed values are
            <code class="literal">auto</code> (the default value, selects
            <code class="classname">NIOFSDirectory</code> on non Windows systems,
            <code class="classname">SimpleFSDirectory</code> on Windows),
            <code class="literal">simple</code>
            (<code class="classname">SimpleFSDirectory</code>), <code class="literal">nio</code>
            (<code class="classname">NIOFSDirectory</code>), <code class="literal">mmap</code>
            (<code class="classname">MMapDirectory</code>). Make sure to refer to
            Javadocs of these <code class="classname">Directory</code> implementations
            before changing this setting. Even though
            <code class="classname">NIOFSDirectory</code> or
            <code class="classname">MMapDirectory</code> can bring substantial
            performace boosts they also have their issues.</p></td></tr><tr><td><p><span class="property">filesystem-slave</span>: File system
            based directory. Like <code class="literal">filesystem</code>, but retrieves
            a master version (source) on a regular basis. To avoid locking and
            inconsistent search results, 2 local copies are
            kept.</p><p>The recommended value for the refresh period is
            (at least) 50% higher that the time to copy the information
            (default 3600 seconds - 60 minutes).</p><p>Note that the
            copy is based on an incremental copy mechanism reducing the
            average copy time. If a copy is still in progress when
            <code class="constant">refresh</code> period elapses, the second copy
            operation will be skipped.</p><p>DirectoryProvider typically
            used on slave nodes using a JMS back end.</p><p>The
            <code class="literal"> buffer_size_on_copy</code> optimum depends on your
            operating system and available RAM; most people reported good
            results using values between 16 and 64MB.</p></td><td><p><code class="literal">indexBase</code>: Base
            directory</p><p><code class="literal">indexName</code>: override
            @Indexed.index (useful for sharded
            indexes)</p><p><code class="literal">sourceBase</code>: Source (copy)
            base directory.</p><p><code class="literal">source</code>: Source
            directory suffix (default to <code class="literal">@Indexed.index</code>).
            The actual source directory name being
            <code class="filename">&lt;sourceBase&gt;/&lt;source&gt;</code>
            </p><p><code class="literal">refresh</code>: refresh period in second
            (the copy will take place every refresh
            seconds).</p><p><code class="literal">buffer_size_on_copy</code>: The
            amount of MegaBytes to move in a single low level copy
            instruction; defaults to
            16MB.</p><p><code class="literal">locking_strategy</code> : optional,
            see <a href="#search-configuration-directory-lockfactories" title="3.7.2. LockFactory configuration">Section 3.7.2, “LockFactory configuration”</a>
            </p><p><code class="literal">retry_marker_lookup</code> : optional,
            default to 0. Defines how many times we look for the marker files
            in the source directory before failing. Waiting 5 seconds between
            each try. </p><p><code class="literal">retry_initialize_period</code>
            : optional, set an integer value in seconds to enable the retry
            initialize feature: if the slave can't find the master index it
            will try again until it's found in background, without preventing
            the application to start: fullText queries performed before the
            index is initialized are not blocked but will return empty
            results. When not enabling the option or explicitly setting it to
            zero it will fail with an exception instead of scheduling a retry
            timer. To prevent the application from starting without an invalid
            index but still control an initialization timeout, see
            <code class="literal">retry_marker_lookup</code>
            instead.</p><p><code class="literal">filesystem_access_type</code>:
            allows to determine the exact type of
            <code class="classname">FSDirectory</code> implementation used by this
            <code class="classname">DirectoryProvider</code>. Allowed values are
            <code class="literal">auto</code> (the default value, selects
            <code class="classname">NIOFSDirectory</code> on non Windows systems,
            <code class="classname">SimpleFSDirectory</code> on Windows),
            <code class="literal">simple</code>
            (<code class="classname">SimpleFSDirectory</code>), <code class="literal">nio</code>
            (<code class="classname">NIOFSDirectory</code>), <code class="literal">mmap</code>
            (<code class="classname">MMapDirectory</code>). Make sure to refer to
            Javadocs of these <code class="classname">Directory</code> implementations
            before changing this setting. Even though
            <code class="classname">NIOFSDirectory</code> or
            <code class="classname">MMapDirectory</code> can bring substantial
            performace boosts they also have their issues.</p></td></tr><tr><td><p><span class="property">infinispan</span>: Infinispan based
            directory. Use it to store the index in a distributed grid, making
            index changes visible to all elements of the cluster very quickly.
            Also see <a href="#infinispan-directories" title="3.3.1. Infinispan Directory configuration">Section 3.3.1, “Infinispan Directory configuration”</a> for additional
            requirements and configuration settings. Infinispan needs a global
            configuration and additional dependencies; the settings defined
            here apply to each different index.</p></td><td><p><code class="literal">locking_cachename</code>: name of the
            Infinispan cache to use to store
            locks.</p><p><code class="literal">data_cachename</code> : name of the
            Infinispan cache to use to store the largest data chunks; this
            area will contain the largest objects, use replication if you have
            enough memory or switch to distribution.</p>
            <p><code class="literal">metadata_cachename</code>: name of the
            Infinispan cache to use to store the metadata relating to the
            index; this data is rather small and read very often, it's
            recommended to have this cache setup using replication.</p>
            <p><code class="literal">chunk_size</code>: large files of the index are
            split in smaller chunks, you might want to set the highest value
            efficiently handled by your network. Networking tuning might be
            useful.</p></td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>If the built-in directory providers do not fit your needs, you can
      write your own directory provider by implementing the
      <code class="classname">org.hibernate.store.DirectoryProvider</code> interface.
      In this case, pass the fully qualified class name of your provider into
      the <code class="literal">directory_provider</code> property. You can pass any
      additional properties using the prefix
      <code class="constant">hibernate.search.</code><em class="replaceable"><code>&lt;indexname&gt;</code></em>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="infinispan-directories"/>3.3.1. Infinispan Directory configuration</h3></div></div></div><p>Infinispan is a distributed, scalable, highly available data grid
      platform which supports autodiscovery of peer nodes. Using Infinispan
      and Hibernate Search in combination, it is possible to store the Lucene
      index in a distributed environment where index updates are quickly
      available on all nodes.</p><p>This section describes in greater detail how to configure
      Hibernate Search to use an Infinispan Lucene Directory.</p><p>When using an Infinispan Directory the index is stored in memory
      and shared across multiple nodes. It is considered a single directory
      distributed across all participating nodes. If a node updates the index,
      all other nodes are updated as well. Updates on one node can be
      immediately searched for in the whole cluster.</p><p>The default configuration replicates all data defining the index
      across all nodes, thus consuming a significant amount of memory. For
      large indexes it's suggested to enable data distribution, so that each
      piece of information is replicated to a subset of all cluster
      members.</p><p>It is also possible to offload part or most information to a
      <code class="literal">CacheStore</code>, such as plain filesystem, Amazon S3,
      Cassandra, Berkley DB or standard relational databases. You can
      configure it to have a <code class="literal">CacheStore</code> on each node or
      have a single centralized one shared by each node.</p><p>See the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://docs.jboss.org/author/display/ISPN/Home"> Infinispan
      documentation</a> for all Infinispan configuration options.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1348"/>3.3.1.1. Requirements</h4></div></div></div><p>To use the Infinispan directory via Maven, add the following
        dependencies:</p><div class="example"><a id="d0e1353"/><p class="title"><b>Example 3.3. Maven dependencies for Hibernate Search</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-search</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.4.1.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.hibernate</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">groupId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">hibernate-search-infinispan</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">artifactId</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">4.4.1.Final</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependency</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>For the non-maven users, add
        <code class="literal">hibernate-search-infinispan.jar</code>,
        <code class="literal">infinispan-lucene-directory.jar</code> and
        <code class="literal">infinispan-core.jar</code> to your application classpath.
        These last two jars are distributed by <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jboss.org/infinispan/downloads">Infinispan</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1372"/>3.3.1.2. Architecture</h4></div></div></div><p>Even when using an Infinispan directory it's still recommended
        to use the JMS Master/Slave or JGroups backend, because in Infinispan
        all nodes will share the same index and it is likely that
        <code class="classname">IndexWriter</code>s being active on different nodes
        will try to acquire the lock on the same index. So instead of sending
        updates directly to the index, send it to a JMS queue or JGroups
        channel and have a single node apply all changes on behalf of all
        other nodes.</p><p>Configuring a non-default backend is not a requirement but a
        performance optimization as locks are enabled to have a single node
        writing.</p><p>To configure a JMS slave only the backend must be replaced, the
        directory provider must be set to <code class="literal">infinispan</code>; set
        the same directory provider on the master, they will connect without
        the need to setup the copy job across nodes. Using the JGroups backend
        is very similar - just combine the backend configuration with the
        <code class="literal">infinispan</code> directory provider.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1390"/>3.3.1.3. Infinispan Configuration</h4></div></div></div><p>The most simple configuration only requires to enable the
        backend:</p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].directory_provider = infinispan</pre><p>That's all what is needed to get a cluster-replicated index, but
        the default configuration does not enable any form of permanent
        persistence for the index; to enable such a feature an Infinispan
        configuration file should be provided.</p><p>To use Infinispan, Hibernate Search requires a
        <code class="classname">CacheManager</code>; it can lookup and reuse an
        existing <code class="classname">CacheManager,</code> via JNDI, or start and
        manage a new one. In the latter case Hibernate Search will start and
        stop it ( closing occurs when the Hibernate
        <code class="classname">SessionFactory</code> is closed).</p><p>To use and existing <code class="classname">CacheManager</code> via JNDI
        (optional parameter):</p><pre class="programlisting">hibernate.search.infinispan.cachemanager_jndiname = [jndiname]</pre><p>To start a new <code class="classname">CacheManager</code> from a
        configuration file (optional parameter):</p><pre class="programlisting">hibernate.search.infinispan.configuration_resourcename = [infinispan configuration filename]</pre><p>If both parameters are defined, JNDI will have priority. If none
        of these is defined, Hibernate Search will use the default Infinispan
        configuration included in
        <code class="literal">hibernate-search-infinispan.jar</code>. This configuration
        should work fine in most cases but does not store the index in a
        persistent cache store.</p><p>As mentioned in <a href="#directory-provider-table" title="Table 3.1. List of built-in DirectoryProvider">Table 3.1, “List of built-in <code class="classname">DirectoryProvider</code>”</a>, each
        index makes use of three caches, so three different caches should be
        configured as shown in the
        <code class="literal">default-hibernatesearch-infinispan.xml</code> provided in
        the <code class="literal">hibernate-search-infinispan.jar</code>. Several
        indexes can share the same caches.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1439"/>3.4. Worker configuration</h2></div></div></div><p>It is possible to refine how Hibernate Search interacts with Lucene
    through the worker configuration. There exist several architectural
    components and possible extension points. Let's have a closer look.</p><p>First there is a <code class="classname">Worker</code>. An implementation of
    the <code class="classname">Worker</code> interface is responsible for receiving
    all entity changes, queuing them by context and applying them once a
    context ends. The most intuitive context, especially in connection with
    ORM, is the transaction. For this reason Hibernate Search will per default
    use the <code class="classname">TransactionalWorker</code> to scope all changes
    per transaction. One can, however, imagine a scenario where the context
    depends for example on the number of entity changes or some other
    application (lifecycle) events. For this reason the
    <code class="classname">Worker</code> implementation is configurable as shown in
    <a href="#table-worker-configuration" title="Table 3.2. Scope configuration">Table 3.2, “Scope configuration”</a>.</p><div class="table"><a id="table-worker-configuration"/><p class="title"><b>Table 3.2. Scope configuration</b></p><div class="table-contents"><table summary="Scope configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><span class="property">hibernate.search.worker.scope</span></td><td>The fully qualified class name of the
            <code class="classname">Worker</code> implementation to use. If this
            property is not set, empty or <code class="literal">transaction</code> the
            default <code class="classname">TransactionalWorker</code> is
            used.</td></tr><tr><td><span class="property">hibernate.search.worker.*</span></td><td>All configuration properties prefixed with
            <code class="literal">hibernate.search.worker</code> are passed to the
            Worker during initialization. This allows adding custom, worker
            specific parameters.</td></tr></tbody></table></div></div><br class="table-break"/><p>Once a context ends it is time to prepare and apply the index
    changes. This can be done synchronously or asynchronously from within a
    new thread. Synchronous updates have the advantage that the index is at
    all times in sync with the databases. Asynchronous updates, on the other
    hand, can help to minimize the user response time. The drawback is
    potential discrepancies between database and index states. Lets look at
    the configuration options shown in <a href="#table-work-execution-configuration" title="Table 3.3. Execution configuration">Table 3.3, “Execution configuration”</a>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The following options can be different on each index; in fact they
      need the indexName prefix or use <code class="literal">default</code> to set the
      default value for all indexes.</p></div><div class="table"><a id="table-work-execution-configuration"/><p class="title"><b>Table 3.3. Execution configuration</b></p><div class="table-contents"><table summary="Execution configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.execution</span></td><td><p><code class="literal">sync</code>: synchronous execution
            (default)</p><p><code class="literal">async</code>: asynchronous
            execution</p></td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.thread_pool.size</span></td><td>The backend can apply updates from the same transaction
            context (or batch) in parallel, using a threadpool. The default
            value is 1. You can experiment with larger values if you have many
            operations per transaction.</td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.buffer_queue.max</span></td><td>Defines the maximal number of work queue if the thread poll
            is starved. Useful only for asynchronous execution. Default to
            infinite. If the limit is reached, the work is done by the main
            thread.</td></tr></tbody></table></div></div><br class="table-break"/><p>So far all work is done within the same Virtual Machine (VM), no
    matter which execution mode. The total amount of work has not changed for
    the single VM. Luckily there is a better approach, namely delegation. It
    is possible to send the indexing work to a different server by configuring
    hibernate.search.worker.backend - see <a href="#table-backend-configuration" title="Table 3.4. Backend configuration">Table 3.4, “Backend configuration”</a>. Again this option can be
    configured differently for each index.</p><div class="table"><a id="table-backend-configuration"/><p class="title"><b>Table 3.4. Backend configuration</b></p><div class="table-contents"><table summary="Backend configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.backend</span></td><td><p><code class="literal">lucene</code>: The default backend which
            runs index updates in the same VM. Also used when the property is
            undefined or empty.</p><p><code class="literal">jms</code>: JMS
            backend. Index updates are send to a JMS queue to be processed by
            an indexing master. See <a href="#table-jms-backend-configuration" title="Table 3.5. JMS backend configuration">Table 3.5, “JMS backend configuration”</a> for additional
            configuration options and <a href="#jms-backend" title="3.4.1. JMS Master/Slave back end">Section 3.4.1, “JMS Master/Slave back end”</a> for a more
            detailed description of this setup.</p>
            <p><code class="literal">jgroupsMaster</code>,
            <code class="literal">jgroupsSlave</code> or <code class="literal">jgroups</code>:
            Backend using <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jgroups.org/">JGroups</a>
            as communication layer. See <a href="#jgroups-backend" title="3.4.2. JGroups Master/Slave back end">Section 3.4.2, “JGroups Master/Slave back end”</a> for
            a more detailed description of this setup.</p>
            <p><code class="literal">blackhole</code>: Mainly a test/developer
            setting which ignores all indexing work</p> <p>You can also
            specify the fully qualified name of a class implementing
            <code class="classname">BackendQueueProcessor</code>. This way you can
            implement your own communication layer. The implementation is
            responsible for returning a <code class="classname">Runnable</code>
            instance which on execution will process the index
            work.</p></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="table-jms-backend-configuration"/><p class="title"><b>Table 3.5. JMS backend configuration</b></p><div class="table-contents"><table summary="JMS backend configuration" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.jndi.*</span></td><td>Defines the JNDI properties to initiate the InitialContext
            (if needed). JNDI is only used by the JMS back end.</td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.jms.connection_factory</span></td><td>Mandatory for the JMS back end. Defines the JNDI name to
            lookup the JMS connection factory from
            (<code class="literal">/ConnectionFactory</code> by default in JBoss
            AS)</td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.jms.queue</span></td><td>Mandatory for the JMS back end. Defines the JNDI name to
            lookup the JMS queue from. The queue will be used to post work
            messages.</td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.jms.login</span></td><td>Optional for the JMS slaves. Use it when your queue
            requires login credentials to define your login.</td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.​worker.jms.login</span></td><td>Optional for the JMS slaves. Use it when your queue
            requires login credentials to define your password.</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>As you probably noticed, some of the shown properties are
      correlated which means that not all combinations of property values make
      sense. In fact you can end up with a non-functional configuration. This
      is especially true for the case that you provide your own
      implementations of some of the shown interfaces. Make sure to study the
      existing code before you write your own <code class="classname">Worker</code> or
      <code class="classname">BackendQueueProcessor</code> implementation.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="jms-backend"/>3.4.1. JMS Master/Slave back end</h3></div></div></div><p>This section describes in greater detail how to configure the
      Master/Slave Hibernate Search architecture.</p><div class="mediaobject" align="center"><img src="jms-backend.png" align="middle"/><div class="caption"><p>JMS back end configuration.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1673"/>3.4.1.1. Slave nodes</h4></div></div></div><p>Every index update operation is sent to a JMS queue. Index
        querying operations are executed on a local index copy.</p><div class="example"><a id="d0e1678"/><p class="title"><b>Example 3.4. JMS Slave configuration</b></p><div class="example-contents"><pre class="programlisting">### slave configuration

## DirectoryProvider
# (remote) master location
hibernate.search.default.sourceBase = /mnt/mastervolume/lucenedirs/mastercopy

# local copy location
hibernate.search.default.indexBase = /Users/prod/lucenedirs

# refresh every half hour
hibernate.search.default.refresh = 1800

# appropriate directory provider
hibernate.search.default.directory_provider = filesystem-slave

## Backend configuration
hibernate.search.default.worker.backend = jms
hibernate.search.default.worker.jms.connection_factory = /ConnectionFactory
hibernate.search.default.worker.jms.queue = queue/hibernatesearch
#optionally authentication credentials:
hibernate.search.default.worker.jms.login = myname
hibernate.search.default.worker.jms.password = wonttellyou
#optional jndi configuration (check your JMS provider for more information)

## Optional asynchronous execution strategy
# hibernate.search.default.worker.execution = async
# hibernate.search.default.worker.thread_pool.size = 2
# hibernate.search.default.worker.buffer_queue.max = 50</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>A file system local copy is recommended for faster search
          results.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1686"/>3.4.1.2. Master node</h4></div></div></div><p>Every index update operation is taken from a JMS queue and
        executed. The master index is copied on a regular basis.</p><div class="example"><a id="d0e1691"/><p class="title"><b>Example 3.5. JMS Master configuration</b></p><div class="example-contents"><pre class="programlisting">### master configuration

## DirectoryProvider
# (remote) master location where information is copied to
hibernate.search.default.sourceBase = /mnt/mastervolume/lucenedirs/mastercopy

# local master location
hibernate.search.default.indexBase = /Users/prod/lucenedirs

# refresh every half hour
hibernate.search.default.refresh = 1800

# appropriate directory provider
hibernate.search.default.directory_provider = filesystem-master

## Backend configuration
#Backend is the default lucene one</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>It is recommended that the refresh period be higher than the
          expected copy time; if a copy operation is still being performed
          when the next refresh triggers, the second refresh is skipped: it's
          safe to set this value low even when the copy time is not
          known.</p></div><p>In addition to the Hibernate Search framework configuration, a
        Message Driven Bean has to be written and set up to process the index
        works queue through JMS.</p><div class="example"><a id="d0e1701"/><p class="title"><b>Example 3.6. Message Driven Bean processing the indexing queue</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">MessageDriven</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">activationConfig&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;destinationType&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;javax.jms.Queue&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;destination&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;queue/hibernatesearch&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ActivationConfigProperty</span><span class="java_separator">(</span><span class="java_plain">propertyName</span><span class="java_operator">=</span><span class="java_literal">&quot;DLQMaxResent&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;propertyValue</span><span class="java_operator">=</span><span class="java_literal">&quot;1&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MDBSearchController</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AbstractJMSHibernateSearchController</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">MessageListener</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">PersistenceContext</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityManager</span><span class="java_plain">&nbsp;em</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">method&nbsp;retrieving&nbsp;the&nbsp;appropriate&nbsp;session</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">protected</span><span class="java_plain">&nbsp;</span><span class="java_type">Session</span><span class="java_plain">&nbsp;getSession</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Session</span><span class="java_separator">)</span><span class="java_plain">&nbsp;em</span><span class="java_separator">.</span><span class="java_plain">getDelegate</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">potentially&nbsp;close&nbsp;the&nbsp;session&nbsp;opened&nbsp;in&nbsp;#getSession</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;not&nbsp;needed&nbsp;here</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">protected</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;cleanSessionIfNeeded</span><span class="java_separator">(</span><span class="java_type">Session</span><span class="java_plain">&nbsp;session</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>This example inherits from the abstract JMS controller class
        available in the Hibernate Search source code and implements a JavaEE
        MDB. This implementation is given as an example and can be adjusted to
        make use of non Java EE Message Driven Beans. For more information
        about the <code class="methodname">getSession()</code> and
        <code class="methodname">cleanSessionIfNeeded()</code>, please check
        <code class="classname">AbstractJMSHibernateSearchController</code>'s
        javadoc.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="jgroups-backend"/>3.4.2. JGroups Master/Slave back end</h3></div></div></div><p>This section describes how to configure the JGroups Master/Slave
      back end. The master and slave roles are similar to what is illustrated
      in <a href="#jms-backend" title="3.4.1. JMS Master/Slave back end">Section 3.4.1, “JMS Master/Slave back end”</a>, only a different backend
      (<code class="constant">hibernate.search.worker.backend</code>) needs to be
      set.</p><p>A specific backend can be configured to act either as a slave
      using <code class="literal">jgroupsSlave</code>, as a master using
      <code class="literal">jgroupsMaster</code>, or can automatically switch between
      the roles as needed by using <code class="literal">jgroups</code>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Either you specify a single <code class="literal">jgroupsMaster</code> and
        a set of <code class="literal">jgroupsSlave</code> instances, or you specify all
        instances as <code class="literal">jgroups</code>. Never mix the two
        approaches!</p></div><p>All backends configured to use JGroups share the same channel. The
      JGroups <code class="classname">JChannel</code> is the main communication link
      across all nodes participating in the same cluster group; since it is
      convenient to have just one channel shared across all backends, the
      Channel configuration properties are not defined on a per-worker section
      but are defined globally. See <a href="#jgroups-channel-configuration" title="3.4.2.4. JGroups channel configuration">Section 3.4.2.4, “JGroups channel configuration”</a>.</p><p>Table <a href="#table-jgroups-backend-configuration" title="Table 3.6. JGroups backend configuration properties">Table 3.6, “JGroups backend configuration properties”</a>
      contains all configuration options which can be set independently on
      each index backend. These apply to all three variants of the backend:
      <code class="literal">jgroupsSlave</code>, <code class="literal">jgroupsMaster</code>,
      <code class="literal">jgroups</code>. It is very unlikely that you need to change
      any of these from their defaults.</p><div class="table"><a id="table-jgroups-backend-configuration"/><p class="title"><b>Table 3.6. JGroups backend configuration properties</b></p><div class="table-contents"><table summary="JGroups backend configuration properties" border="1"><colgroup><col/><col/></colgroup><tbody><tr><td><span class="bold"><strong>Property</strong></span></td><td><span class="bold"><strong>Description</strong></span></td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.jgroups.block_waiting_ack</span></td><td>Set to either <code class="literal">true</code> or
              <code class="literal">false</code>. False is more efficient but will not
              wait for the operation to be delivered to the peers. Defaults to
              <code class="literal">true</code> when the backend is synchronous, to
              <code class="literal">false</code> when the backend is
              <code class="literal">async</code>.</td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.jgroups.​messages_timeout</span></td><td>The timeout of waiting for a single command to be
              acknowledged and executed when
              <code class="literal">block_waiting_ack</code> is <code class="literal">true</code>,
              or just acknowledged otherwise. Value in milliseconds, defaults
              to <code class="literal">20000</code>.</td></tr><tr><td><span class="property">hibernate.search.&lt;indexName&gt;.jgroups.delegate_backend</span></td><td>The master node receiving indexing operations forwards
              them to a standard backend to be performed. Defaults to
              <code class="literal">lucene</code>. See also <a href="#table-backend-configuration" title="Table 3.4. Backend configuration">Table 3.4, “Backend configuration”</a> for other options, but
              probably the only useful option is <code class="literal">blackhole</code>,
              or a custom implementation, to help isolating network latency
              problems.</td></tr></tbody></table></div></div><br class="table-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1832"/>3.4.2.1. Slave nodes</h4></div></div></div><p>Every index update operation is sent through a JGroups channel
        to the master node. Index querying operations are executed on a local
        index copy. Enabling the JGroups worker only makes sure the index
        operations are sent to the master, you still have to synchronize
        configuring an appropriate directory (See
        <code class="literal">filesystem-master</code>,
        <code class="literal">filesystem-slave</code> or <code class="literal">infinispan</code>
        options in <a href="#search-configuration-directory" title="3.3. Directory configuration">Section 3.3, “Directory configuration”</a>).</p><div class="example"><a id="d0e1848"/><p class="title"><b>Example 3.7. JGroups Slave configuration</b></p><div class="example-contents"><pre class="programlisting">### slave configuration
hibernate.search.default.worker.backend = jgroupsSlave     </pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1853"/>3.4.2.2. Master node</h4></div></div></div><p>Every index update operation is taken from a JGroups channel and
        executed. The master index is copied on a regular basis.</p><div class="example"><a id="d0e1858"/><p class="title"><b>Example 3.8. JGroups Master configuration</b></p><div class="example-contents"><pre class="programlisting">### master configuration
hibernate.search.default.worker.backend = jgroupsMaster   </pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e1863"/>3.4.2.3. Automatic master election</h4></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>This feature is considered experimental. In particular during
          a re-election process there is a small window of time in which
          indexing requests could be lost.</p></div><p>In this mode the different nodes will autonomously elect a
        master node. When a master fails, a new node is elected
        automatically.</p><p>When setting this backend it is expected that all Hibernate
        Search instances in the same cluster use the same backend for each
        specific index: this configuration is an alternative to the static
        <code class="literal">jgroupsMaster</code> and <code class="literal">jgroupsSlave</code>
        approach so make sure to not mix them.</p><p>To synchronize the indexes in this configuration avoid
        <code class="literal">filesystem-master</code> and
        <code class="literal">filesystem-slave</code> directory providers as their
        behaviour can not be switched dynamically; use the Infinispan
        <code class="literal">Directory</code> instead, which has no need for different
        configurations on each instance and allows dynamic switching of
        writers; see also <a href="#infinispan-directories" title="3.3.1. Infinispan Directory configuration">Section 3.3.1, “Infinispan Directory configuration”</a>.</p><div class="example"><a id="d0e1892"/><p class="title"><b>Example 3.9. JGroups configuration for automatic master
          configuration</b></p><div class="example-contents"><pre class="programlisting">### automatic configuration
hibernate.search.default.worker.backend = jgroups  </pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Should you use <code class="literal">jgroups</code> or the couple
          <code class="literal">jgroupsMaster</code>,
          <code class="literal">jgroupsSlave</code>?</p><p>The dynamic <code class="literal">jgroups</code> backend is better
          suited for environments in which your master is more likely to need
          to failover to a different machine, as in clouds. The static
          configuration has the benefit of keeping the master at a well known
          location: your architecture might take advantage of it by sending
          most write requests to the known master. Also optimisation and
          MassIndexer operations need to be triggered on the master
          node.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="jgroups-channel-configuration"/>3.4.2.4. JGroups channel configuration</h4></div></div></div><p>Configuring the JGroups channel essentially entails specifying
        the transport in terms of a network protocol stack. To configure the
        JGroups transport, point the configuration property
        <code class="constant">hibernate.search.services.jgroups.configurationFile</code>
        to a JGroups configuration file; this can be either a file path or a
        Java resource name.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>If no property is explicitly specified it is assumed that the
          JGroups default configuration file <code class="literal">flush-udp.xml</code>
          is used. This example configuration is known to work in most
          scenarios, with the notable exception of Amazon AWS; refer to the
          <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.jgroups.org/manual-3.x/html/">JGroups
          manual</a> for more examples and protocol configuration
          details.</p></div><p>The default cluster name is <code class="literal">Hibernate Search
        Cluster</code> which can be configured as seen in <a href="#example-jgroups-cluster-name" title="Example 3.10. JGroups cluster name configuration">Example 3.10, “JGroups cluster name configuration”</a>.</p><div class="example"><a id="example-jgroups-cluster-name"/><p class="title"><b>Example 3.10. JGroups cluster name configuration</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.services.jgroups.clusterName = My-Custom-Cluster-Id</pre></div></div><br class="example-break"/><p>The cluster name is what identifies a group: by changing the
        name you can run different clusters in the same network in
        isolation.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e1945"/>3.4.2.4.1. JGroups channel instance injection</h5></div></div></div><p>For programmatic configurations, one additional option is
          available to configure the JGroups channel: to pass an existing
          channel instance to Hibernate Search directly using the property
          <code class="literal">hibernate.search.services.jgroups.providedChannel</code>,
          as shown in the following example.</p></div><p/><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">backend</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">impl</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">jgroups</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">JGroupsChannelProvider</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">jgroups</span><span class="java_separator">.</span><span class="java_type">JChannel</span><span class="java_plain">&nbsp;channel&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">Map</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">String</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;properties&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_operator">&lt;</span><span class="java_type">String</span><span class="java_separator">,</span><span class="java_type">String</span><span class="java_separator">)(</span><span class="java_literal">1</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">properties</span><span class="java_separator">.</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">JGroupsChannelProvider</span><span class="java_separator">.</span><span class="java_plain">CHANNEL_INJECT</span><span class="java_separator">,</span><span class="java_plain">&nbsp;channel&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;emf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Persistence</span><span class="java_separator">.</span><span class="java_plain">createEntityManagerFactory</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;userPU&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;properties&nbsp;</span><span class="java_separator">);</span></pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="configuration-reader-strategy"/>3.5. Reader strategy configuration</h2></div></div></div><p>The different reader strategies are described in <a href="#search-architecture-readerstrategy" title="2.3. Reader strategy">Reader strategy</a>. Out of the box strategies
    are:</p><div class="itemizedlist"><ul><li><p><code class="literal">shared</code>: share index readers across several
        queries. This strategy is the most efficient.</p></li><li><p><code class="literal">not-shared</code>: create an index reader for each
        individual query</p></li></ul></div><p>The default reader strategy is <code class="literal">shared</code>. This can
    be adjusted:</p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].reader.strategy = not-shared</pre><p>Adding this property switches to the <code class="literal">not-shared</code>
    strategy.</p><p>Or if you have a custom reader strategy:</p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].reader.strategy = my.corp.myapp.CustomReaderProvider</pre><p>where <code class="classname">my.corp.myapp.CustomReaderProvider</code> is
    the custom strategy implementation.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e1995"/>3.6. Exception handling</h2></div></div></div><p>Hibernate Search allows you to configure how exceptions are handled
    during the indexing process. If no configuration is provided then
    exceptions are logged to the log output by default. It is possible to
    explicitly declare the exception logging mechanism as seen below:</p><pre class="programlisting">hibernate.search.error_handler = log</pre><p>The default exception handling occurs for both synchronous and
    asynchronous indexing. Hibernate Search provides an easy mechanism to
    override the default error handling implementation.</p><p>In order to provide your own implementation you must implement the
    <code class="classname">ErrorHandler</code> interface, which provides the
    <code class="code">handle(ErrorContext context)</code> method.
    <code class="code">ErrorContext</code> provides a reference to the primary
    <code class="code">LuceneWork</code> instance, the underlying exception and any
    subsequent <code class="code">LuceneWork</code> instances that could not be processed
    due to the primary exception.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ErrorContext</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">LuceneWork</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getFailingOperations</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">LuceneWork</span><span class="java_plain">&nbsp;getOperationAtFault</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">Throwable</span><span class="java_plain">&nbsp;getThrowable</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">boolean</span><span class="java_plain">&nbsp;hasErrors</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>To register this error handler with Hibernate Search you must
    declare the fully qualified classname of your
    <code class="classname">ErrorHandler</code> implementation in the configuration
    properties:</p><pre class="programlisting">hibernate.search.error_handler = CustomerErrorHandler</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2031"/>3.7. Lucene configuration</h2></div></div></div><p>Even though Hibernate Search will try to shield you as much as
    possible from Lucene specifics, there are several Lucene specifics which
    can be directly configured, either for performance reasons or for
    satisfying a specific usecase. The following sections discuss these
    configuration options.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="lucene-indexing-performance"/>3.7.1. Tuning indexing performance</h3></div></div></div><p>Hibernate Search allows you to tune the Lucene indexing
      performance by specifying a set of parameters which are passed through
      to underlying Lucene <code class="literal">IndexWriter</code> such as
      <code class="literal">mergeFactor</code>, <code class="literal">maxMergeDocs</code> and
      <code class="literal">maxBufferedDocs</code>. You can specify these parameters
      either as default values applying for all indexes, on a per index basis,
      or even per shard.</p><p>There are several low level <code class="literal">IndexWriter</code>
      settings which can be tuned for different use cases. These parameters
      are grouped by the <code class="literal">indexwriter</code> keyword:
      </p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].indexwriter.&lt;parameter_name&gt;</pre><p>If no value is set for an <code class="literal">indexwriter</code> value in
      a specific shard configuration, Hibernate Search will look at the index
      section, then at the default section.</p><div class="example"><a id="example-performamce-option-configuration"/><p class="title"><b>Example 3.11. Example performance option configuration</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.Animals.2.indexwriter.max_merge_docs = 10
hibernate.search.Animals.2.indexwriter.merge_factor = 20
hibernate.search.Animals.2.indexwriter.term_index_interval = default
hibernate.search.default.indexwriter.max_merge_docs = 100
hibernate.search.default.indexwriter.ram_buffer_size = 64</pre></div></div><p><br class="example-break"/> The configuration in <a href="#example-performamce-option-configuration" title="Example 3.11. Example performance option configuration">Example 3.11, “Example performance option configuration”</a> will result in
      these settings applied on the second shard of the
      <code class="classname">Animal</code> index:</p><div class="itemizedlist"><ul><li><p><code class="literal">max_merge_docs</code> = 10</p></li><li><p><code class="literal">merge_factor</code> = 20</p></li><li><p><code class="literal">ram_buffer_size</code> = 64MB</p></li><li><p><code class="literal">term_index_interval</code> = Lucene default</p></li></ul></div><p>All other values will use the defaults defined in Lucene.</p><p>The default for all values is to leave them at Lucene's own
      default. The values listed in <a href="#table-performance-parameters" title="Table 3.7. List of indexing performance and behavior properties">Table 3.7, “List of indexing performance and behavior properties”</a> depend for this reason on the
      version of Lucene you are using. The values shown are relative to
      version <code class="literal">2.4</code>. For more information about Lucene
      indexing performance, please refer to the Lucene documentation.</p><div class="table"><a id="table-performance-parameters"/><p class="title"><b>Table 3.7. List of indexing performance and behavior properties</b></p><div class="table-contents"><table summary="List of indexing performance and behavior properties" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">Property</th><th align="center">Description</th><th align="center">Default Value</th></tr></thead><tbody><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​exclusive_index_use</span>
              </td><td>
                <p>Set to <code class="literal">true</code> when no other process
                will need to write to the same index. This will enable
                Hibernate Search to work in exclusive mode on the index and
                improve performance when writing changes to the index.</p>
              </td><td><code class="literal">true</code> (improved performance, releases
              locks only at shutdown)</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​max_queue_length</span>
              </td><td>
                <p>Each index has a separate "pipeline" which contains the
                updates to be applied to the index. When this queue is full
                adding more operations to the queue becomes a blocking
                operation. Configuring this setting doesn't make much sense
                unless the <code class="literal">worker.execution</code> is configured
                as <code class="literal">async</code>.</p>
              </td><td>
                <code class="literal">1000</code>
              </td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.max_buffered_delete_terms</span>
              </td><td>
                <p>Determines the minimal number of delete terms required
                before the buffered in-memory delete terms are applied and
                flushed. If there are documents buffered in memory at the
                time, they are merged and a new segment is created.</p>
              </td><td>Disabled (flushes by RAM usage)</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.max_buffered_docs</span>
              </td><td>
                <p>Controls the amount of documents buffered in memory
                during indexing. The bigger the more RAM is consumed.</p>
              </td><td>Disabled (flushes by RAM usage)</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.max_merge_docs</span>
              </td><td>
                <p>Defines the largest number of documents allowed in a
                segment. Smaller values perform better on frequently changing
                indexes, larger values provide better search performance if
                the index does not change often.</p>
              </td><td>Unlimited (Integer.MAX_VALUE)</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.merge_factor</span>
              </td><td>
                <p>Controls segment merge frequency and size.</p>

                <p>Determines how often segment indexes are merged when
                insertion occurs. With smaller values, less RAM is used while
                indexing, and searches on unoptimized indexes are faster, but
                indexing speed is slower. With larger values, more RAM is used
                during indexing, and while searches on unoptimized indexes are
                slower, indexing is faster. Thus larger values (&gt; 10) are
                best for batch index creation, and smaller values (&lt; 10)
                for indexes that are interactively maintained. The value must
                not be lower than 2.</p>
              </td><td>10</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.merge_min_size</span>
              </td><td>
                <p>Controls segment merge frequency and size.</p>

                <p>Segments smaller than this size (in MB) are always
                considered for the next segment merge operation.</p>

                <p>Setting this too large might result in expensive merge
                operations, even tough they are less frequent.</p>

                <p>See also
                <code class="classname">org.apache.lucene.index.LogDocMergePolicy</code>.
                <code class="literal">minMergeSize</code>.</p>
              </td><td>0 MB (actually ~1K)</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.merge_max_size</span>
              </td><td>
                <p>Controls segment merge frequency and size.</p>

                <p>Segments larger than this size (in MB) are never merged
                in bigger segments.</p>

                <p>This helps reduce memory requirements and avoids some
                merging operations at the cost of optimal search speed. When
                optimizing an index this value is ignored.</p>

                <p>See also
                <code class="classname">org.apache.lucene.index.LogDocMergePolicy</code>.
                <code class="literal">maxMergeSize</code>.</p>
              </td><td>Unlimited</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.merge_max_optimize_size</span>
              </td><td>
                <p>Controls segment merge frequency and size.</p>

                <p>Segments larger than this size (in MB) are not merged in
                bigger segments even when optimizing the index (see
                <code class="literal">merge_max_size</code> setting as well).</p>

                <p>Applied to
                <code class="classname">org.apache.lucene.index.LogDocMergePolicy</code>.
                <code class="literal">maxMergeSizeForOptimize</code>.</p>
              </td><td>Unlimited</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.merge_calibrate_by_deletes</span>
              </td><td>
                <p>Controls segment merge frequency and size.</p>

                <p>Set to <code class="literal">false</code> to not consider deleted
                documents when estimating the merge policy.</p>

                <p>Applied to
                <code class="classname">org.apache.lucene.index.LogMergePolicy</code>.
                <code class="literal">calibrateSizeByDeletes</code>.</p>
              </td><td>
                <code class="literal">true</code>
              </td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.ram_buffer_size</span>
              </td><td>
                <p>Controls the amount of RAM in MB dedicated to document
                buffers. When used together max_buffered_docs a flush occurs
                for whichever event happens first.</p>

                <p>Generally for faster indexing performance it's best to
                flush by RAM usage instead of document count and use as large
                a RAM buffer as you can.</p>
              </td><td>16 MB</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.term_index_interval</span>
              </td><td>
                <p>Expert: Set the interval between indexed terms.</p>

                <p>Large values cause less memory to be used by
                IndexReader, but slow random-access to terms. Small values
                cause more memory to be used by an IndexReader, and speed
                random-access to terms. See Lucene documentation for more
                details.</p>
              </td><td>128</td></tr><tr><td>
                <span class="property">hibernate.search.​[default|&lt;indexname&gt;].​indexwriter.use_compound_file</span>
              </td><td>The advantage of using the compound file format is that
              less file descriptors are used. The disadvantage is that
              indexing takes more time and temporary disk space. You can set
              this parameter to <code class="literal">false</code> in an attempt to
              improve the indexing time, but you could run out of file
              descriptors if <code class="literal">mergeFactor</code> is also
              large.<p>Boolean parameter, use "<code class="literal">true</code>" or
              "<code class="literal">false</code>". The default value for this option is
              <code class="literal">true</code>.</p></td><td>true</td></tr><tr><td>
                <span class="property">hibernate.search.​enable_dirty_check</span>
              </td><td>
                <p>Not all entity changes require an update of the Lucene
                index. If all of the updated entity properties (dirty
                properties) are not indexed Hibernate Search will skip the
                re-indexing work.</p>

                <p>Disable this option if you use custom
                <code class="literal">FieldBridge</code>s which need to be invoked at
                each update event (even though the property for which the
                field bridge is configured has not changed).</p>

                <p>This optimization will not be applied on classes using a
                <code class="literal">@ClassBridge</code> or a
                <code class="literal">@DynamicBoost</code>.</p>

                <p>Boolean parameter, use "<code class="literal">true</code>" or
                "<code class="literal">false</code>". The default value for this option
                is <code class="literal">true</code>.</p>
              </td><td>true</td></tr></tbody></table></div></div><br class="table-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>When your architecture permits it, always keep
        <code class="literal">hibernate.search.default.exclusive_index_use=true</code>
        as it greatly improves efficiency in index writing. This is the
        default since Hibernate Search version 4.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>To tune the indexing speed it might be useful to time the object
        loading from database in isolation from the writes to the index. To
        achieve this set the <code class="literal">blackhole</code> as worker backend
        and start your indexing routines. This backend does not disable
        Hibernate Search: it will still generate the needed changesets to the
        index, but will discard them instead of flushing them to the index. In
        contrast to setting the
        <code class="literal">hibernate.search.indexing_strategy</code> to
        <code class="literal">manual</code>, using <code class="literal">blackhole</code> will
        possibly load more data from the database. because associated entities
        are re-indexed as well.</p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].worker.backend blackhole</pre><p>The recommended approach is to focus first on optimizing the
        object loading, and then use the timings you achieve as a baseline to
        tune the indexing process.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The <code class="literal">blackhole</code> backend is not meant to be used
        in production, only as a tool to identify indexing bottlenecks.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="lucene-segment-size"/>3.7.1.1. Control segment size</h4></div></div></div><p>The options <code class="literal">merge_max_size</code>,
        <code class="literal">merge_max_optimize_size</code>,
        <code class="literal">merge_calibrate_by_deletes</code> give you control on the
        maximum size of the segments being created, but you need to understand
        how they affect file sizes. If you need to hard limit the size,
        consider that merging a segment is about adding it together with
        another existing segment to form a larger one, so you might want to
        set the <code class="literal">max_size</code> for merge operations to less than
        half of your hard limit. Also segments might initially be generated
        larger than your expected size at first creation time: before they are
        ever merged. A segment is never created much larger than
        <code class="literal">ram_buffer_size</code>, but the threshold is checked as an
        estimate.</p><p>Example:</p><pre class="programlisting">//to be fairly confident no files grow above 15MB, use:
hibernate.search.default.indexwriter.ram_buffer_size = 10
hibernate.search.default.indexwriter.merge_max_optimize_size = 7
hibernate.search.default.indexwriter.merge_max_size = 7</pre></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>When using the Infinispan Directory to cluster indexes make sure
        that your segments are smaller than the <code class="literal">chunk_size</code>
        so that you avoid fragmenting segments in the grid. Note that the
        <code class="literal">chunk_size</code> of the Infinispan Directory is expressed
        in bytes, while the index tuning options are in MB.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-configuration-directory-lockfactories"/>3.7.2. LockFactory configuration</h3></div></div></div><p>Lucene <code class="classname">Directory</code>s have default locking
      strategies which work generally good enough for most cases, but it's
      possible to specify for each index managed by Hibernate Search a
      specific <code class="classname">LockingFactory</code> you want to use. This is
      generally not needed but could be useful.</p><p>Some of these locking strategies require a filesystem level lock
      and may be used even on RAM based indexes, this combination is valid but
      in this case the <code class="literal">indexBase</code> configuration option
      usually needed only for filesystem based
      <code class="classname">Directory</code> instances must be specified to point to
      a filesystem location where to store the lock marker files.</p><p>To select a locking factory, set the
      <code class="literal">hibernate.search.&lt;index&gt;.locking_strategy</code>
      option to one of <code class="literal">simple</code>, <code class="literal">native</code>,
      <code class="literal">single</code> or <code class="literal">none</code>. Alternatively set
      it to the fully qualified name of an implementation of
      <code class="literal">org.hibernate.search.store.LockFactoryProvider</code>.</p><div class="table"><a id="search-configuration-directory-lockfactories-table"/><p class="title"><b>Table 3.8. List of available LockFactory implementations</b></p><div class="table-contents"><table summary="List of available LockFactory implementations" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th align="center">name</th><th align="center">Class</th><th align="center">Description</th></tr></thead><tbody><tr><td><span class="property">simple</span></td><td>org.apache.lucene.store.​SimpleFSLockFactory</td><td><p>Safe implementation based on Java's File API, it
              marks the usage of the index by creating a marker file.</p>
              <p>If for some reason you had to kill your application, you
              will need to remove this file before restarting
              it.</p></td></tr><tr><td><span class="property">native</span></td><td>org.apache.lucene.store.​NativeFSLockFactory</td><td><p>As does <code class="literal">simple</code> this also marks
              the usage of the index by creating a marker file, but this one
              is using native OS file locks so that even if the JVM is
              terminated the locks will be cleaned up.</p> <p>This
              implementation has known problems on NFS, avoid it on network
              shares.</p> <p><code class="literal">native</code> is the default
              implementation for the <code class="literal">filesystem</code>,
              <code class="literal">filesystem-master</code> and
              <code class="literal">filesystem-slave</code> directory
              providers.</p></td></tr><tr><td><span class="property">single</span></td><td>org.apache.lucene.store.​SingleInstanceLockFactory</td><td><p>This LockFactory doesn't use a file marker but is a
              Java object lock held in memory; therefore it's possible to use
              it only when you are sure the index is not going to be shared by
              any other process.</p> <p>This is the default
              implementation for the <code class="literal">ram</code> directory
              provider.</p></td></tr><tr><td><span class="property">none</span></td><td>org.apache.lucene.store.​NoLockFactory</td><td><p>All changes to this index are not coordinated by
              any lock; test your application carefully and make sure you know
              what it means.</p></td></tr></tbody></table></div></div><br class="table-break"/><p>Configuration example:</p><pre class="programlisting">hibernate.search.default.locking_strategy = simple
hibernate.search.Animals.locking_strategy = native
hibernate.search.Books.locking_strategy = org.custom.components.MyLockingFactory</pre><p>The Infinispan Directory uses a custom implementation; it's still
      possible to override it but make sure you understand how that will work,
      especially with clustered indexes.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e2627"/>3.7.3. Index format compatibility</h3></div></div></div><p>While Hibernate Search strives to offer a backwards compatible API
      making it easy to port your application to newer versions, it still
      delegates to Apache Lucene to handle the index writing and searching.
      This creates a dependency to the Lucene index format. The Lucene
      developers of course attempt to keep a stable index format, but
      sometimes a change in the format can not be avoided. In those cases you
      either have to reindex all your data or use an index upgrade tool.
      Sometimes Lucene is also able to read the old format so you don't need
      to take specific actions (besides making backup of your index).</p><p>While an index format incompatibility is a rare event, it can
      happen more often that Lucene's <code class="classname">Analyzer</code>
      implementations might slightly change its behaviour. This can lead to a
      poor recall score, possibly missing many hits from the results.</p><p>Hibernate Search exposes a configuration property
      <code class="literal">hibernate.search.lucene_version</code> which instructs the
      analyzers and other Lucene classes to conform to their behaviour as
      defined in an (older) specific version of Lucene. See also
      <code class="classname">org.apache.lucene.util.Version</code> contained in the
      <code class="filename">lucene-core.jar</code>. Depending on the specific version
      of Lucene you're using you might have different options available. When
      this option is not specified, Hibernate Search will instruct Lucene to
      use the default version, which is usually the best option for new
      projects. Still it's recommended to define the version you're using
      explicitly in the configuration so that when you happen to upgrade
      Lucene the analyzers will not change behaviour. You can then choose to
      update this value at a later time, when you for example have the chance
      to rebuild the index from scratch.</p><div class="example"><a id="d0e2648"/><p class="title"><b>Example 3.12. Force Analyzers to be compatible with a Lucene 3.0 created
        index</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.lucene_version = LUCENE_30</pre></div></div><br class="example-break"/><p>This option is global for the configured
      <code class="classname">SearchFactory</code> and affects all Lucene APIs having
      such a parameter, as this should be applied consistently. So if you are
      also making use of Lucene bypassing Hibernate Search, make sure to apply
      the same value too.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2658"/>3.8. Metadata API</h2></div></div></div><p>After looking at all these different configuration options, it is
    time to have a look at an API which allows you to prorgammatically access
    parts of the configuration. Via the metadata API you can determine the
    indexed types and also how they are mapped (see <a href="#search-mapping" title="Chapter 4. Mapping entities to the index structure">Chapter 4, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mapping entities to the index structure</i></a>) to the index structure. The entry point into
    this API is the <code class="classname">SearchFactory</code>. It offers two
    methods, namely <code class="methodname">getIndexedTypes()</code> and
    <code class="methodname">getIndexedTypeDescriptor(Class&lt;?&gt;)</code>. The
    former returns a set of all indexed type, where as the latter allows to
    retrieve a so called <code class="classname">IndexedTypeDescriptor</code>for a
    gven type. This descriptor allows you determine whether the type is
    indexed at all and, if so, whether the index is for example sharded or not
    (see <a href="#advanced-features-sharding" title="10.4. Sharding indexes">Section 10.4, “Sharding indexes”</a>). It also
    allows you to determine the static boost of the type (see <a href="#section-boost-annotation" title="4.2.1. Static index time boosting">Section 4.2.1, “Static index time boosting”</a>) as well as its dynamic boost
    strategy (see <a href="#section-dynamic-boost">Section 4.2.2, “Dynamic index time boosting”</a>). Most importantly,
    however, you get information about the indexed properties and generated
    Lucene <code class="classname">Document</code> fields. This is exposed via
    <code class="classname">PropertyDescriptor</code>s respectively
    <code class="classname">FieldDescriptor</code>s. The easiest way to get to know
    the API is to explore it via the IDE or its javadocs.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>All descriptor instances of the metadata API are read only. They
        do not allow to change any runtime configuration.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-configuration-deploy-on-AS7"/>3.9. Hibernate Search as JBoss AS module</h2></div></div></div><p>Provided you're deploying on JBoss AS 7.2.x or JBoss EAP 6.1, there
    is an additional way to add the search dependencies to your
    application.</p><p>In JBoss AS 7 class loading is based on modules that have to define
    explicit dependencies on other modules. Modules allow to share the same
    artifacts across multiple applications getting you smaller and quicker
    deployments.</p><p>More details about modules are described in <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://docs.jboss.org/author/display/AS72/Class+Loading+in+AS7">Class
    Loading in AS7</a>.</p><p>You can download the pre-packaged Hibernate Search modules
    from:</p><div class="itemizedlist"><ul><li><p><a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://downloads.sourceforge.net/project/hibernate/hibernate-search/4.4.1.Final/hibernate-search-modules-4.4.1.Final-jbossas-72-dist.zip">Sourceforge</a></p></li><li><p>Maven: <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://repository.jboss.org/nexus/index.html#nexus-search;gav~org.hibernate~hibernate-search-modules~~~">org.hibernate:hibernate-search-modules-4.4.1.Final-jbossas-72-dist:zip</a></p></li></ul></div><p>Unpack the modules in your JBoss AS <code class="literal">modules</code>
    directory: this will create modules for Hibernate Search, Apache Lucene
    and some useful Solr libraries. The Hibernate Search modules are:</p><div class="itemizedlist"><ul><li><p><span class="emphasis"><em>org.hibernate.search.orm:main</em></span>, for users of
        Hibernate Search with Hibernate; this will transitively include
        Hibernate ORM.</p></li><li><p><span class="emphasis"><em>org.hibernate.search.engine:main</em></span>, for
        projects depending on the internal indexing engine that don't require
        other dependencies to Hibernate.</p></li></ul></div><p>There are two ways to include the dependencies in your
    project:</p><div class="variablelist"><dl><dt><span class="term">Using the manifest</span></dt><dd><p>Add this entry to the MANIFEST.MF in your archive:</p><pre class="programlisting">Dependencies: org.hibernate.search.orm services</pre></dd><dt><span class="term">Using jboss-deployment-structure.xml</span></dt><dd><p>This is a proprietary JBoss AS descriptor, add a
          WEB-INF/jboss-deployment-structure.xml in your archive with
          content:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">jboss-deployment-structure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">module</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.hibernate.search.orm&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">services</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;export&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">dependencies</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">jboss-deployment-structure</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>More information about the descriptor can be found in the
          <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://docs.jboss.org/author/display/AS72/Class+Loading+in+AS7">JBoss
          AS 7 documentation</a>.</p></dd></dl></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Modular classloading is a feature of JBoss EAP as well, but if you are using
      JBoss EAP, you're reading the wrong version of the user guide! JBoss EAP subscriptions
      include official support for Hibernate Search (as part of the WFK) and come with
      a different edition of this guide specifically tailored for EAP users.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-mapping"/>Chapter 4. Mapping entities to the index structure</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#search-mapping-entity">4.1. Mapping an entity</a></span></dt><dd><dl><dt><span class="section"><a href="#basic-mapping">4.1.1. Basic mapping</a></span></dt><dt><span class="section"><a href="#d0e3187">4.1.2. Mapping properties multiple times</a></span></dt><dt><span class="section"><a href="#search-mapping-associated">4.1.3. Embedded and associated objects</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3585">4.2. Boosting</a></span></dt><dd><dl><dt><span class="section"><a href="#section-boost-annotation">4.2.1. Static index time boosting</a></span></dt><dt><span class="section"><a href="#d0e3646">4.2.2. Dynamic index time boosting</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e3702">4.3. Analysis</a></span></dt><dd><dl><dt><span class="section"><a href="#analyzer">4.3.1. Default analyzer and analyzer by class</a></span></dt><dt><span class="section"><a href="#d0e3762">4.3.2. Named analyzers</a></span></dt><dt><span class="section"><a href="#d0e4141">4.3.3. Dynamic analyzer selection</a></span></dt><dt><span class="section"><a href="#analyzer-retrievinganalyzer">4.3.4. Retrieving an analyzer</a></span></dt></dl></dd><dt><span class="section"><a href="#search-mapping-bridge">4.4. Bridges</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4247">4.4.1. Built-in bridges</a></span></dt><dt><span class="section"><a href="#d0e4335">4.4.2. Tika bridge</a></span></dt><dt><span class="section"><a href="#d0e4431">4.4.3. Custom bridges</a></span></dt></dl></dd><dt><span class="section"><a href="#search-mapping-indexinginterceptor">4.5. Conditional indexing: to index or not based on entity state</a></span></dt><dt><span class="section"><a href="#provided-id">4.6. Providing your own id</a></span></dt><dd><dl><dt><span class="section"><a href="#ProvidedId">4.6.1. The ProvidedId annotation</a></span></dt></dl></dd><dt><span class="section"><a href="#hsearch-mapping-programmaticapi">4.7. Programmatic API</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4940">4.7.1. Mapping an entity as indexable</a></span></dt><dt><span class="section"><a href="#d0e4978">4.7.2. Adding DocumentId to indexed entity</a></span></dt><dt><span class="section"><a href="#d0e5000">4.7.3. Defining analyzers</a></span></dt><dt><span class="section"><a href="#d0e5029">4.7.4. Defining full text filter definitions</a></span></dt><dt><span class="section"><a href="#d0e5063">4.7.5. Defining fields for indexing</a></span></dt><dt><span class="section"><a href="#d0e5110">4.7.6. Programmatically defining embedded entities</a></span></dt><dt><span class="section"><a href="#d0e5142">4.7.7. Contained In definition</a></span></dt><dt><span class="section"><a href="#d0e5167">4.7.8. Date/Calendar Bridge</a></span></dt><dt><span class="section"><a href="#d0e5208">4.7.9. Defining bridges</a></span></dt><dt><span class="section"><a href="#d0e5237">4.7.10. Mapping class bridge</a></span></dt><dt><span class="section"><a href="#d0e5260">4.7.11. Mapping dynamic boost</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-mapping-entity"/>4.1. Mapping an entity</h2></div></div></div><p>In <a href="#getting-started" title="Chapter 1. Getting started">Chapter 1, <i xmlns:xlink="http://www.w3.org/1999/xlink">Getting started</i></a> you have already learned that
    all the metadata information needed to index entities is described through
    annotations. There is no need for xml mapping files. You can still use
    Hibernate mapping files for the basic Hibernate configuration, but the
    Hibernate Search specific configuration has to be expressed via
    annotations.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>There is no XML configuration available for Hibernate Search but
      we provide a powerful programmatic mapping API that elegantly replaces
      this kind of deployment form (see <a href="#hsearch-mapping-programmaticapi" title="4.7. Programmatic API">Section 4.7, “Programmatic API”</a> for more
      information).</p><p>If you want to contribute the XML mapping implementation, see
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://hibernate.onjira.com/browse/HSEARCH-210">HSEARCH-210</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="basic-mapping"/>4.1.1. Basic mapping</h3></div></div></div><p>Lets start with the most commonly used annotations when mapping an
      entity.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="indexed-annotation"/>4.1.1.1. @Indexed</h4></div></div></div><p>Foremost you must declare a persistent class as indexable by
        annotating the class with <code class="literal">@Indexed.</code> All entities
        not annotated with <code class="literal">@Indexed</code> will be ignored by the
        indexing process.</p><div class="example"><a id="d0e2799"/><p class="title"><b>Example 4.1. Making a class indexable with
          <code class="classname">@Indexed</code></b></p><div class="example-contents"><pre class="programlisting">@Entity
<span class="bold"><strong>@Indexed</strong></span>
public class Essay {
    ...
}</pre></div></div><br class="example-break"/><p>You can optionally specify the
        <code class="literal"><code class="methodname">Indexed.index</code></code> attribute to
        change the default name of the index. For more information regarding
        index naming see <a href="#search-configuration-directory" title="3.3. Directory configuration">Section 3.3, “Directory configuration”</a>.</p><p>You can also specify an optional indexing interceptor. For more
        information see <a href="#search-mapping-indexinginterceptor" title="4.5. Conditional indexing: to index or not based on entity state">Section 4.5, “Conditional indexing: to index or not based on entity state”</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="field-annotation"/>4.1.1.2. @Field</h4></div></div></div><p>For each property (or attribute) of your entity, you have the
        ability to describe how it will be indexed. The default (no annotation
        present) means that the property is ignored by the indexing process.
        <code class="literal">@Field</code> does declare a property as indexed and
        allows you to configure several aspects of the indexing process by
        setting one or more of the following attributes:</p><div class="itemizedlist"><ul><li><p><code class="literal">name</code>: describe under which name the
            property should be stored in the Lucene Document. The default
            value is the property name (following the JavaBeans
            convention)</p></li><li><p><code class="literal">store</code>: describe whether or not the
            property is stored in the Lucene index. You can store the value
            <code class="literal">Store.YES</code> (consuming more space in the index
            but allowing projection, see <a href="#projections" title="5.1.3.5. Projection">Section 5.1.3.5, “Projection”</a>), store
            it in a compressed way <code class="literal">Store.COMPRESS</code> (this
            does consume more CPU), or avoid any storage
            <code class="literal">Store.NO</code> (this is the default value). When a
            property is stored, you can retrieve its original value from the
            Lucene Document. Storing the property has no impact though on
            whether the value is searchable or not.</p></li><li><p><code class="literal">index</code>: describe whether the property is
            indexed or not. The different values are
            <code class="literal">Index.NO</code> (no indexing, i.e. cannot be found by
            a query), <code class="literal">Index.YES</code> (the element gets indexed
            and is searchable). The default value is
            <code class="literal">Index.YES</code>. <code class="literal">Index.NO</code> can be
            useful for cases where a property is not required to be
            searchable, but should be available for projection.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p><code class="literal">Index.NO</code> in combination with
              <code class="literal">Analyze.YES</code> or <code class="literal">Norms.YES</code>
              is not useful, since <code class="literal">analyze</code> and
              <code class="literal">norms</code> require the property to be
              indexed</p></div></li><li><p><code class="literal">analyze</code>: determines whether the property
            is analyzed (<code class="literal">Analyze.YES</code>) or not
            (<code class="literal">Analyze.NO</code>). The default value is
            <code class="literal">Analyze.YES</code>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Whether or not you want to analyze a property depends on
                whether you wish to search the element as is, or by the words
                it contains. It make sense to analyze a text field, but
                probably not a date field.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Fields used for sorting or faceting <span class="emphasis"><em>must
                not</em></span> be analyzed.</p></div></li><li><p><code class="literal">norms</code>: describes whether index time
            boosting information should be stored
            (<code class="literal">Norms.YES</code>) or not
            (<code class="literal">Norms.NO</code>). Not storing the norms can save a
            considerable amount of memory, but index time boosting will not be
            available in this case. The default value is
            <code class="literal">Norms.YES</code>.</p></li><li><p><code class="literal">termVector</code>: describes collections of
            term-frequency pairs. This attribute enables the storing of the
            term vectors within the documents during indexing. The default
            value is <code class="literal">TermVector.NO</code>.</p><p>The different values of this attribute are:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Value</th><th align="center">Definition</th></tr></thead><tbody><tr><td align="left">TermVector.YES</td><td align="left">Store the term vectors of each document. This
                    produces two synchronized arrays, one contains document
                    terms and the other contains the term's frequency.</td></tr><tr><td align="left">TermVector.NO</td><td align="left">Do not store term vectors.</td></tr><tr><td align="left">TermVector.WITH_OFFSETS</td><td align="left">Store the term vector and token offset information.
                    This is the same as TermVector.YES plus it contains the
                    starting and ending offset position information for the
                    terms.</td></tr><tr><td align="left">TermVector.WITH_POSITIONS</td><td align="left">Store the term vector and token position
                    information. This is the same as TermVector.YES plus it
                    contains the ordinal positions of each occurrence of a
                    term in a document.</td></tr><tr><td align="left">TermVector.WITH_POSITION_OFFSETS</td><td align="left">Store the term vector, token position and offset
                    information. This is a combination of the YES,
                    WITH_OFFSETS and WITH_POSITIONS.</td></tr></tbody></table></div></li><li><p><code class="literal">indexNullAs</code>: Per default
            <code class="constant">null</code> values are ignored and not indexed.
            However, using <em class="parameter"><code>indexNullAs</code></em> you can specify
            a string which will be inserted as token for the
            <code class="constant">null</code> value. Per default this value is set to
            <code class="constant">org.hibernate.search.annotations.Field.DO_NOT_INDEX_NULL</code>
            indicating that <code class="constant">null</code> values should not be
            indexed. You can set this value to <code class="constant">DEFAULT_NULL_TOKEN
            </code>to indicate that a default <code class="constant">null</code>
            token should be used. This default <code class="constant">null</code> token
            can be specified in the configuration using
            <code class="literal">hibernate.search.default_null_token</code>. If this
            property is not set the string "_null_" will be used as default.
            </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When <em class="parameter"><code>indexNullAs</code></em> is used, it is
                important to use the chosen <code class="constant">null</code> token in
                search queries (see <a href="#search-query" title="Chapter 5. Querying">Querying</a>) in order
                to find <code class="constant">null</code> values. It is also advisable
                to use this feature only with un-analyzed fields
                (<code class="literal"><code class="literal">analyze=</code>Analyze.NO</code>).</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>When implementing a custom
                <code class="classname">FieldBridge</code> or
                <code class="classname">TwoWayFieldBridge</code> it is up to the
                developer to handle the indexing of null values (see JavaDocs
                of
                <code class="methodname">LuceneOptions.indexNullAs()</code>).</p></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="numeric-field-annotation"/>4.1.1.3. @NumericField</h4></div></div></div><p>There exists also a companion annotation to
        <code class="classname">@Field,</code> called
        <code class="classname">@NumericField.</code> It can be specified in the same
        scope as <code class="classname">@Field</code> or
        <code class="classname">@DocumentId</code>, but only on
        <code class="classname">Integer</code>, <code class="classname">Long</code>,
        <code class="classname">Float</code> or <code class="classname">Double</code>
        properties. When used, the annoated property will be indexed using a
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://en.wikipedia.org/wiki/Trie">Trie structure</a>.
        This enables efficient range queries and sorting, resulting in query
        response times being orders of magnitude faster than the same query
        with plain <code class="classname">@Field</code>. The
        <code class="classname">@NumericField</code> annotation accepts the following
        parameters: </p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Value</th><th align="center">Definition</th></tr></thead><tbody><tr><td align="left">forField</td><td align="left">(Optional) Specify the name of of the related @Field
                  that will be indexed as numeric. It's only mandatory when
                  the property contains more than a @Field declaration</td></tr><tr><td align="left">precisionStep</td><td align="left">(Optional) Change the way that the Trie structure is
                  stored in the index. Smaller precisionSteps lead to more
                  disk space usage and faster range and sort queries. Larger
                  values lead to less space used and range query performance
                  more close to the range query in normal @Fields. Default
                  value is 4.</td></tr></tbody></table></div><p>Lucene supports the numeric types: Double, Long,
        Integer and Float. Other numeric types should use the default string
        encoding (via <code class="classname">@Field</code>), unless the application
        can deal with a potential loss in precision, in which case a custom
        <code class="classname">NumericFieldBridge</code> can be used. See <a href="#example-custom-numericfieldbridge" title="Example 4.2. Defining a custom NumericFieldBridge for BigDecimal">Example 4.2, “Defining a custom <code class="classname">NumericFieldBridge for
          BigDecimal</code>”</a>.</p><div class="example"><a id="example-custom-numericfieldbridge"/><p class="title"><b>Example 4.2. Defining a custom <code class="classname">NumericFieldBridge for
          BigDecimal</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BigDecimalNumericFieldBridge</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">NumericFieldBridge</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;storeFactor&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_separator">.</span><span class="java_plain">valueOf</span><span class="java_separator">(</span><span class="java_literal">100</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;set</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Document</span><span class="java_plain">&nbsp;document</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">LuceneOptions</span><span class="java_plain">&nbsp;luceneOptions</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;decimalValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;indexedValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_separator">.</span><span class="java_plain">valueOf</span><span class="java_separator">(</span><span class="java_plain">&nbsp;decimalValue</span><span class="java_separator">.</span><span class="java_plain">multiply</span><span class="java_separator">(</span><span class="java_plain">&nbsp;storeFactor&nbsp;</span><span class="java_separator">).</span><span class="java_plain">longValue</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">addNumericFieldToDocument</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;indexedValue</span><span class="java_separator">,</span><span class="java_plain">&nbsp;document&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;get</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Document</span><span class="java_plain">&nbsp;document</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fromLucene&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;document</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;storedBigDecimal&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_separator">(</span><span class="java_plain">&nbsp;fromLucene&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;storedBigDecimal</span><span class="java_separator">.</span><span class="java_plain">divide</span><span class="java_separator">(</span><span class="java_plain">&nbsp;storeFactor&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/><p>You would use this custom bridge like seen in <a href="#example-useof-custom-numericfieldbridge" title="Example 4.3. Use of BigDecimalNumericFieldBridge">Example 4.3, “Use of BigDecimalNumericFieldBridge”</a>. In this case
        three annotations are used - <code class="classname">@Field</code>,
        <code class="classname">@NumericField</code> and
        <code class="classname">@FieldBridge</code>. <code class="classname">@Field</code> is
        required to mark the property for being indexed (a standalone
        <code class="classname">@NumericField</code> is never allowed).
        <code class="classname">@NumericField</code> might be ommited in this specific
        case, because the used <code class="classname">@FieldBridge</code> annotation
        refers already to a <code class="classname">NumericFieldBridge</code>
        instance. However, the use of <code class="classname">@NumericField</code> is
        recommended to make the use of the property as numeric value
        explicit.</p><div class="example"><a id="example-useof-custom-numericfieldbridge"/><p class="title"><b>Example 4.3. Use of BigDecimalNumericFieldBridge</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">NumericField</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">FieldBridge</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimalNumericFieldBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;price</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;getPrice</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;price</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setPrice</span><span class="java_separator">(</span><span class="java_type">BigDecimal</span><span class="java_plain">&nbsp;price</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">price&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;price</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="id-annotation"/>4.1.1.4. @Id</h4></div></div></div><p>Finally, the id property of an entity is a special property used
        by Hibernate Search to ensure index unicity of a given entity. By
        design, an id has to be stored and must not be tokenized. To mark a
        property as index id, use the <code class="literal">@DocumentId</code>
        annotation. If you are using JPA and you have specified
        <code class="classname">@Id</code> you can omit
        <code class="classname">@DocumentId</code>. The chosen entity id will also be
        used as document id.</p><div class="example"><a id="example-annotated-entity"/><p class="title"><b>Example 4.4. Specifying indexed properties</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Essay</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Field(name="Abstract", store=Store.YES)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getSummary</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;summary</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Lob</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getText</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;text</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Field 
    @NumericField(precisionStep = 6)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">float</span><span class="java_plain">&nbsp;getGrade</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;grade</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p><a href="#example-annotated-entity" title="Example 4.4. Specifying indexed properties">Example 4.4, “Specifying indexed properties”</a> defines an index with
        four fields: <code class="literal">id</code> , <code class="literal">Abstract</code>,
        <code class="literal">text</code> and <code class="literal">grade</code> . Note that by
        default the field name is decapitalized, following the JavaBean
        specification. The <code class="literal">grade</code> field is annotated as
        Numeric with a slightly larger precisionStep than the default.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3187"/>4.1.2. Mapping properties multiple times</h3></div></div></div><p>Sometimes one has to map a property multiple times per index, with
      slightly different indexing strategies. For example, sorting a query by
      field requires the field to be un-analyzed. If one wants to search by
      words in this property and still sort it, one need to index it twice -
      once analyzed and once un-analyzed. @Fields allows to achieve this
      goal.</p><div class="example"><a id="example-fields-annotation"/><p class="title"><b>Example 4.5. Using @Fields to map a property multiple times</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_separator">(</span><span class="java_plain">index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Book&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Fields( {</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;summary_forSort&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyze&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">,</span><span class="java_plain">&nbsp;store&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>} )</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getSummary</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;summary</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>In <a href="#example-fields-annotation" title="Example 4.5. Using @Fields to map a property multiple times">Example 4.5, “Using @Fields to map a property multiple times”</a> the field
      <code class="literal">summary</code> is indexed twice, once as
      <code class="literal">summary</code> in a tokenized way, and once as
      <code class="literal">summary_forSort</code> in an untokenized way. @Field
      supports 2 attributes useful when @Fields is used:</p><div class="itemizedlist"><ul><li><p>analyzer: defines a @Analyzer annotation per field rather than
          per property</p></li><li><p>bridge: defines a @FieldBridge annotation per field rather
          than per property</p></li></ul></div><p>See below for more information about analyzers and field
      bridges.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-mapping-associated"/>4.1.3. Embedded and associated objects</h3></div></div></div><p>Associated objects as well as embedded objects can be indexed as
      part of the root entity index. This is useful if you expect to search a
      given entity based on properties of associated objects. In <a href="#example-indexing-associations" title="Example 4.6. Indexing associations">Example 4.6, “Indexing associations”</a>t the aim is to return places
      where the associated city is Atlanta (In the Lucene query parser
      language, it would translate into <code class="code">address.city:Atlanta</code>).
      The place fields will be indexed in the <code class="literal">Place</code> index.
      The <code class="literal">Place</code> index documents will also contain the
      fields <code class="literal">address.id</code>, <code class="literal">address.street</code>,
      and <code class="literal">address.city</code> which you will be able to
      query.</p><div class="example"><a id="example-indexing-associations"/><p class="title"><b>Example 4.6. Indexing associations</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Place</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span><span class="java_separator">(</span><span class="java_plain">cascade&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">REMOVE&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@IndexedEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;address</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;street</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@ContainedIn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;address&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Place</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;places</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Be careful. Because the data is denormalized in the Lucene index
      when using the <code class="classname">@IndexedEmbedded</code> technique,
      Hibernate Search needs to be aware of any change in the
      <code class="classname">Place</code> object and any change in the
      <code class="classname">Address</code> object to keep the index up to date. To
      make sure the <code class="literal"><code class="classname">Place</code></code> Lucene
      document is updated when it's <code class="classname">Address</code> changes,
      you need to mark the other side of the bidirectional relationship with
      <code class="classname">@ContainedIn</code>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p><code class="literal">@ContainedIn</code> is useful on both associations
        pointing to entities and on embedded (collection of) objects.</p></div><p>Let's make <a href="#example-indexing-associations" title="Example 4.6. Indexing associations">Example 4.6, “Indexing associations”</a> a bit
      more complex by nesting @IndexedEmbedded as seen in <a href="#example-nested-index-embedded" title="Example 4.7. Nested usage of @IndexedEmbedded and @ContainedIn">Example 4.7, “Nested usage of <code class="classname">@IndexedEmbedded</code> and
        <code class="classname">@ContainedIn</code>”</a>.</p><div class="example"><a id="example-nested-index-embedded"/><p class="title"><b>Example 4.7. Nested usage of <code class="classname">@IndexedEmbedded</code> and
        <code class="classname">@ContainedIn</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Place</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToOne</span><span class="java_separator">(</span><span class="java_plain">cascade&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">REMOVE&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@IndexedEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;address</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;street</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;city</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@IndexedEmbedded(depth = 1, prefix = "ownedBy_")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Owner</span><span class="java_plain">&nbsp;ownedBy</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@ContainedIn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">mappedBy</span><span class="java_operator">=</span><span class="java_literal">&quot;address&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Place</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;places</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Owner</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>As you can see, any <code class="literal">@*ToMany, @*ToOne</code> and
      <code class="literal">@Embedded</code> attribute can be annotated with
      <code class="literal">@IndexedEmbedded</code>. The attributes of the associated
      class will then be added to the main entity index. In <a href="#example-nested-index-embedded" title="Example 4.7. Nested usage of @IndexedEmbedded and @ContainedIn">Example 4.7, “Nested usage of <code class="classname">@IndexedEmbedded</code> and
        <code class="classname">@ContainedIn</code>”</a> the index will contain the
      following fields</p><div class="itemizedlist"><ul><li><p>id</p></li><li><p>name</p></li><li><p>address.street</p></li><li><p>address.city</p></li><li><p>address.ownedBy_name</p></li></ul></div><p>The default prefix is <code class="literal">propertyName.</code>, following
      the traditional object navigation convention. You can override it using
      the <code class="literal">prefix</code> attribute as it is shown on the
      <code class="literal">ownedBy</code> property.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The prefix cannot be set to the empty string.</p></div><p>The <code class="literal">depth</code> property is necessary when the object
      graph contains a cyclic dependency of classes (not instances). For
      example, if <code class="classname">Owner</code> points to
      <code class="classname">Place</code>. Hibernate Search will stop including
      Indexed embedded attributes after reaching the expected depth (or the
      object graph boundaries are reached). A class having a self reference is
      an example of cyclic dependency. In our example, because
      <code class="literal">depth</code> is set to 1, any
      <code class="literal">@IndexedEmbedded</code> attribute in Owner (if any) will be
      ignored.</p><p>Using <code class="literal">@IndexedEmbedded</code> for object associations
      allows you to express queries (using Lucene's query syntax) such
      as:</p><div class="itemizedlist"><ul><li><p>Return places where name contains JBoss and where address city
          is Atlanta. In Lucene query this would be</p><pre class="programlisting">+name:jboss +address.city:atlanta</pre></li><li><p>Return places where name contains JBoss and where owner's name
          contain Joe. In Lucene query this would be</p><pre class="programlisting">+name:jboss +address.ownedBy_name:joe</pre></li></ul></div><p>In a way it mimics the relational join operation in a more
      efficient way (at the cost of data duplication). Remember that, out of
      the box, Lucene indexes have no notion of association, the join
      operation is simply non-existent. It might help to keep the relational
      model normalized while benefiting from the full text index speed and
      feature richness.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>An associated object can itself (but does not have to) be
          <code class="literal">@Indexed</code></p></div><p>When @IndexedEmbedded points to an entity, the association has to
      be directional and the other side has to be annotated
      <code class="literal">@ContainedIn</code> (as seen in the previous example). If
      not, Hibernate Search has no way to update the root index when the
      associated entity is updated (in our example, a <code class="literal">Place</code>
      index document has to be updated when the associated
      <code class="classname">Address</code> instance is updated).</p><p>Sometimes, the object type annotated by
      <code class="classname">@IndexedEmbedded</code> is not the object type targeted
      by Hibernate and Hibernate Search. This is especially the case when
      interfaces are used in lieu of their implementation. For this reason you
      can override the object type targeted by Hibernate Search using the
      <code class="methodname">targetElement</code> parameter.</p><div class="example"><a id="d0e3415"/><p class="title"><b>Example 4.8. Using the <code class="literal">targetElement</code> property of
        <code class="classname">@IndexedEmbedded</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;street</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">IndexedEmbedded</span><span class="java_separator">(</span><span class="java_plain">depth&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">,</span><span class="java_plain">&nbsp;prefix&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;ownedBy_&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>targetElement = Owner.class<span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Target</span><span class="java_separator">(</span><span class="java_type">Owner</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;ownedBy</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Embeddable</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Owner</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="search-mapping-associated-viapaths"/>4.1.3.1. Limiting object embedding to specific paths</h4></div></div></div><p>The <code class="classname">@IndexedEmbedded</code> annotation provides
        also an attribute <code class="methodname">includePaths</code> which can be
        used as an alternative to <code class="methodname">depth</code>, or be
        combined with it.</p><p>When using only <code class="methodname">depth</code> all indexed
        fields of the embedded type will be added recursively at the same
        depth; this makes it harder to pick only a specific path without
        adding all other fields as well, which might not be needed.</p><p>To avoid unnecessarily loading and indexing entities you can
        specify exactly which paths are needed. A typical application might
        need different depths for different paths, or in other words it might
        need to specify paths explicitly, as shown in <a href="#indexedembedded-includePath" title="Example 4.9. Using the includePaths property of @IndexedEmbedded">Example 4.9, “Using the <code class="literal">includePaths</code> property of
          <code class="classname">@IndexedEmbedded</code>”</a></p><div class="example"><a id="indexedembedded-includePath"/><p class="title"><b>Example 4.9. Using the <code class="literal">includePaths</code> property of
          <code class="classname">@IndexedEmbedded</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getSurname</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;surname</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>@IndexedEmbedded(includePaths = { "name" })</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Person</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getParents</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;parents</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ContainedIn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Human</span><span class="java_plain">&nbsp;getChild</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;child</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_operator">//</span><span class="java_plain">other&nbsp;fields&nbsp;omitted</span></pre></div></div><br class="example-break"/><p>Using a mapping as in <a href="#indexedembedded-includePath" title="Example 4.9. Using the includePaths property of @IndexedEmbedded">Example 4.9, “Using the <code class="literal">includePaths</code> property of
          <code class="classname">@IndexedEmbedded</code>”</a>, you would be able to search
        on a <code class="classname">Person</code> by <code class="literal">name</code> and/or
        <code class="literal">surname</code>, and/or the <code class="literal">name</code> of the
        parent. It will not index the <code class="literal">surname</code> of the
        parent, so searching on parent's surnames will not be possible but
        speeds up indexing, saves space and improve overall
        performance.</p><p>The <code class="classname">@IndexedEmbedded</code>
        <code class="methodname">includePaths</code> will include the specified paths
        <span class="emphasis"><em>in addition to</em></span> what you would index normally
        specifying a limited value for <code class="methodname">depth</code>. When
        using <code class="methodname">includePaths</code>, and leaving
        <code class="methodname">depth</code> undefined, behavior is equivalent to
        setting <code class="methodname">depth</code><code class="literal">=0</code>: only the
        included paths are indexed.</p><div class="example"><a id="indexedembedded-includePathsAndDepth"/><p class="title"><b>Example 4.10. Using the <code class="literal">includePaths</code> property of
          <code class="classname">@IndexedEmbedded</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Human</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getSurname</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;surname</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">OneToMany</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>@IndexedEmbedded(depth = 2, includePaths = { "parents.parents.name" })</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">Human</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getParents</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;parents</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ContainedIn</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;@</span><span class="java_type">ManyToOne</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Human</span><span class="java_plain">&nbsp;getChild</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;child</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_operator">//</span><span class="java_plain">other&nbsp;fields&nbsp;omitted</span></pre></div></div><br class="example-break"/><p>In <a href="#indexedembedded-includePathsAndDepth" title="Example 4.10. Using the includePaths property of @IndexedEmbedded">Example 4.10, “Using the <code class="literal">includePaths</code> property of
          <code class="classname">@IndexedEmbedded</code>”</a>, every
        human will have it's name and surname attributes indexed. The name and
        surname of parents will be indexed too, recursively up to second line
        because of the <code class="methodname">depth</code> attribute. It will be
        possible to search by name or surname, of the person directly, his
        parents or of his grand parents. Beyond the second level, we will in
        addition index one more level but only the name, not the
        surname.</p><p>This results in the following fields in the index:</p><div class="itemizedlist"><ul><li><p><code class="literal">id</code> - as primary key</p></li><li><p><code class="literal">_hibernate_class</code> - stores entity
            type</p></li><li><p><code class="literal">name</code> - as direct field</p></li><li><p><code class="literal">surname</code> - as direct field</p></li><li><p><code class="literal">parents.name</code> - as embedded field at depth
            1</p></li><li><p><code class="literal">parents.surname</code> - as embedded field at
            depth 1</p></li><li><p><code class="literal">parents.parents.name</code> - as embedded field
            at depth 2</p></li><li><p><code class="literal">parents.parents.surname</code> - as embedded
            field at depth 2</p></li><li><p><code class="literal">parents.parents.parents.name</code> - as
            additional path as specifyed by
            <code class="methodname">includePaths</code>. The first
            <code class="literal">parents.</code> is inferred from the field name, the
            remaining path is the attribute of
            <code class="methodname">includePaths</code></p></li></ul></div><p>Having explicit control of the indexed paths might be easier if
        you're designing your application by defining the needed queries
        first, as at that point you might know exactly which fields you need,
        and which other fields are unnecessary to implement your use
        case.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3585"/>4.2. Boosting</h2></div></div></div><p>Lucene has the notion of <span class="emphasis"><em>boosting</em></span> which allows
    you to give certain documents or fields more or less importance than
    others. Lucene differentiates between index and search time boosting. The
    following sections show you how you can achieve index time boosting using
    Hibernate Search.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-boost-annotation"/>4.2.1. Static index time boosting</h3></div></div></div><p>To define a static boost value for an indexed class or property
      you can use the <code class="classname">@Boost</code> annotation. You can use
      this annotation within @Field or specify it directly on method or class
      level.</p><div class="example"><a id="example-boost"/><p class="title"><b>Example 4.11. Different ways of using @Boost</b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
<span class="bold"><strong>@Boost(1.7f)</strong></span>
public class Essay {
    ...

    @Id
    @DocumentId
    public Long getId() { return id; }

    @Field(name="Abstract", store=Store.YES, boost=<span class="bold"><strong>@Boost(2f)</strong></span>)
    <span class="bold"><strong>@Boost(1.5f)</strong></span>
    public String getSummary() { return summary; }

    @Lob
    @Field(boost=<span class="bold"><strong>@Boost(1.2f)</strong></span>)
    public String getText() { return text; }

    @Field
    public String getISBN() { return isbn; }

}        </pre></div></div><br class="example-break"/><p>In <a href="#example-boost" title="Example 4.11. Different ways of using @Boost">Example 4.11, “Different ways of using @Boost”</a>, <code class="classname">Essay</code>'s
      probability to reach the top of the search list will be multiplied by
      1.7. The <code class="methodname">summary</code> field will be 3.0 (2 * 1.5,
      because <code class="methodname">@Field.boost</code> and
      <code class="classname">@Boost</code> on a property are cumulative) more
      important than the <code class="methodname">isbn</code> field. The
      <code class="methodname">text</code> field will be 1.2 times more important
      than the <code class="methodname">isbn</code> field. Note that this explanation
      is wrong in strictest terms, but it is simple and close enough to
      reality for all practical purposes. Please check the Lucene
      documentation or the excellent <em class="citetitle">Lucene In Action </em>
      from Otis Gospodnetic and Erik Hatcher.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3646"/>4.2.2. Dynamic index time boosting</h3></div></div></div><p>The <code class="literal">@Boost </code>annotation used in <a href="#section-boost-annotation" title="4.2.1. Static index time boosting">Section 4.2.1, “Static index time boosting”</a> defines a static boost factor which
      is independent of the state of of the indexed entity at runtime.
      However, there are usecases in which the boost factor may depend on the
      actual state of the entity. In this case you can use the
      <code class="literal">@DynamicBoost </code>annotation together with an
      accompanying custom <code class="classname">BoostStrategy</code>.</p><div class="example"><a id="example-dynamic-boosting"/><p class="title"><b>Example 4.12. Dynamic boost example</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;enum&nbsp;</span><!-- <br/> --><span class="java_type">PersonType</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;NORMAL</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;VIP</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
@DynamicBoost(impl = VIPBoostStrategy.class)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">PersonType</span><span class="java_plain">&nbsp;type</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">VIPBoostStrategy</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">BoostStrategy</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public float defineBoost(Object value)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;person&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Person</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;person</span><span class="java_separator">.</span><span class="java_plain">getType</span><span class="java_separator">().</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">PersonType</span><span class="java_separator">.</span><span class="java_plain">VIP&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">2.0f</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">1.0f</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>In <a href="#example-dynamic-boosting" title="Example 4.12. Dynamic boost example">Example 4.12, “Dynamic boost example”</a> a dynamic boost is
      defined on class level specifying
      <code class="classname">VIPBoostStrategy</code> as implementation of the
      <code class="classname">BoostStrategy</code> interface to be used at indexing
      time. You can place the <code class="literal">@DynamicBoost</code> either at class
      or field level. Depending on the placement of the annotation either the
      whole entity is passed to the <code class="methodname">defineBoost</code>
      method or just the annotated field/property value. It's up to you to
      cast the passed object to the correct type. In the example all indexed
      values of a VIP person would be double as important as the values of a
      normal person.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The specified <code class="classname">BoostStrategy</code>
          implementation must define a public no-arg constructor.</p></div><p>Of course you can mix and match <code class="literal">@Boost</code> and
      <code class="literal">@DynamicBoost</code> annotations in your entity. All defined
      boost factors are cumulative.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e3702"/>4.3. Analysis</h2></div></div></div><p><code class="literal">Analysis</code> is the process of converting text into
    single terms (words) and can be considered as one of the key features of a
    fulltext search engine. Lucene uses the concept of
    <code class="classname">Analyzer</code>s to control this process. In the following
    section we cover the multiple ways Hibernate Search offers to configure
    the analyzers.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="analyzer"/>4.3.1. Default analyzer and analyzer by class</h3></div></div></div><p>The default analyzer class used to index tokenized fields is
      configurable through the <code class="literal">hibernate.search.analyzer</code>
      property. The default value for this property is
      <code class="classname">org.apache.lucene.analysis.standard.StandardAnalyzer</code>.</p><p>You can also define the analyzer class per entity, property and
      even per @Field (useful when multiple fields are indexed from a single
      property).</p><div class="example"><a id="d0e3725"/><p class="title"><b>Example 4.13. Different ways of using @Analyzer</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
@Analyzer(impl = EntityAnalyzer.class)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MyEntity</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Analyzer(impl = PropertyAnalyzer.class)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;summary</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span>analyzer = @Analyzer(impl = FieldAnalyzer.class<span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;body</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>In this example, <code class="classname">EntityAnalyzer</code> is used to
      index all tokenized properties (eg. <code class="literal">name</code>), except
      <code class="literal">summary</code> and <code class="literal">body</code> which are indexed
      with <code class="classname">PropertyAnalyzer</code> and
      <code class="classname">FieldAnalyzer</code> respectively.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="caution"><h2>Caution</h2><p>Mixing different analyzers in the same entity is most of the
        time a bad practice. It makes query building more complex and results
        less predictable (for the novice), especially if you are using a
        QueryParser (which uses the same analyzer for the whole query). As a
        rule of thumb, for any given field the same analyzer should be used
        for indexing and querying.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e3762"/>4.3.2. Named analyzers</h3></div></div></div><p>Analyzers can become quite complex to deal with. For this reason
      introduces Hibernate Search the notion of analyzer definitions. An
      analyzer definition can be reused by many
      <code class="classname">@Analyzer</code> declarations and is composed of:</p><div class="itemizedlist"><ul><li><p>a name: the unique string used to refer to the
          definition</p></li><li><p>a list of char filters: each char filter is responsible to
          pre-process input characters before the tokenization. Char filters
          can add, change or remove characters; one common usage is for
          characters normalization</p></li><li><p>a tokenizer: responsible for tokenizing the input stream into
          individual words</p></li><li><p>a list of filters: each filter is responsible to remove,
          modify or sometimes even add words into the stream provided by the
          tokenizer</p></li></ul></div><p>This separation of tasks - a list of char filters, and a tokenizer
      followed by a list of filters - allows for easy reuse of each individual
      component and let you build your customized analyzer in a very flexible
      way (just like Lego). Generally speaking the char filters do some
      pre-processing in the character input, then the
      <code class="classname">Tokenizer</code> starts the tokenizing process by
      turning the character input into tokens which are then further processed
      by the <code class="classname">TokenFilter</code>s. Hibernate Search supports
      this infrastructure by utilizing the Solr analyzer framework.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Some of the analyzers and filters will require additional
        dependencies. For example to use the snowball stemmer you have to also
        include the <code class="literal">lucene-snowball</code> jar and for the
        <code class="classname">PhoneticFilterFactory</code> you need the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://commons.apache.org/codec">commons-codec</a> jar. Your
        distribution of Hibernate Search provides these dependencies in its
        <code class="filename">lib/optional</code> directory. Have a look at <a href="#table-available-tokenizers" title="Table 4.2. Example of available tokenizers">Table 4.2, “Example of available tokenizers”</a> and <a href="#table-available-filters" title="Table 4.3. Examples of available filters">Table 4.3, “Examples of available filters”</a> to see which anaylzers and filters
        have additional dependencies</p><p>Prior to Search version 3.3.0.Beta2 it was required to add the
        Solr dependency <span class="emphasis"><em>org.apache.solr:solr-core</em></span> when
        you wanted to use the analyzer definition framework. In case you are
        using Maven this is no longer needed: all required Solr dependencies
        are now defined as dependencies of the artifact
        <span class="emphasis"><em>org.hibernate:hibernate-search-analyzers</em></span>; just
        add the following dependency :</p><pre class="programlisting">&lt;dependency&gt;
   &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
   &lt;artifactId&gt;hibernate-search-analyzers&lt;/artifactId&gt;
   &lt;version&gt;4.4.1.Final&lt;/version&gt;
&lt;dependency&gt;</pre></div><p>Let's have a look at a concrete example now - <a href="#example-analyzer-def" title="Example 4.14. @AnalyzerDef and the Solr framework">Example 4.14, “<code class="classname">@AnalyzerDef</code> and the Solr
        framework”</a>. First a char filter is defined by its
      factory. In our example, a mapping char filter is used, and will replace
      characters in the input based on the rules specified in the mapping
      file. Next a tokenizer is defined. This example uses the standard
      tokenizer. Last but not least, a list of filters is defined by their
      factories. In our example, the <code class="classname">StopFilter</code> filter
      is built reading the dedicated words property file. The filter is also
      expected to ignore case.</p><div class="example"><a id="example-analyzer-def"/><p class="title"><b>Example 4.14. <code class="classname">@AnalyzerDef</code> and the Solr
        framework</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">AnalyzerDef</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">name</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;customanalyzer&quot;</span><!-- <br/> --><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;charFilters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">CharFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MappingCharFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;mapping&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org/hibernate/search/test/analyzer/solr/mapping-chars.properties&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">},</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ISOLatin1AccentFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StopFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;words&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org/hibernate/search/test/analyzer/solr/stoplist.properties&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;ignoreCase&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;true&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Team</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Filters and char filters are applied in the order they are
        defined in the <code class="classname">@AnalyzerDef</code> annotation. Order
        matters!</p></div><p>Some tokenizers, token filters or char filters load resources like
      a configuration or metadata file. This is the case for the stop filter
      and the synonym filter. If the resource charset is not using the VM
      default, you can explicitly specify it by adding a
      <code class="literal">resource_charset</code> parameter.</p><div class="example"><a id="example-analyzer-def-charset"/><p class="title"><b>Example 4.15. Use a specific charset to load the property file</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">AnalyzerDef</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">name</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_literal">&quot;customanalyzer&quot;</span><!-- <br/> --><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;charFilters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">CharFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">MappingCharFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;mapping&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org/hibernate/search/test/analyzer/solr/mapping-chars.properties&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">},</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ISOLatin1AccentFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StopFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;words&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;org/hibernate/search/test/analyzer/solr/stoplist.properties&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;resource_charset&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;UTF-16BE&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;ignoreCase&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;true&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Team</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Once defined, an analyzer definition can be reused by an
      <code class="classname">@Analyzer</code> declaration as seen in <a href="#example-referencing-analyzer-def">Example 4.16, “Referencing an
        analyzer by name”</a>.</p><div class="example"><a id="d0e3857"/><p class="title"><b>Example 4.16. Referencing an
        analyzer by name</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;customanalyzer&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Team</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;location</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Analyzer(definition = "customanalyzer")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;description</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Analyzer instances declared by <code class="classname">@AnalyzerDef</code>
      are also available by their name in the
      <code class="classname">SearchFactory</code> which is quite useful wen building
      queries.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Analyzer</span><!-- <br/> --><span class="java_plain">&nbsp;analyzer&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">getAnalyzer</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;customanalyzer&quot;</span><!-- <br/> --><span class="java_separator">);</span></pre><p>Fields in queries should be analyzed with the same analyzer used
      to index the field so that they speak a common "language": the same
      tokens are reused between the query and the indexing process. This rule
      has some exceptions but is true most of the time. Respect it unless you
      know what you are doing.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e3877"/>4.3.2.1. Available analyzers</h4></div></div></div><p>Solr and Lucene come with a lot of useful default char filters,
        tokenizers and filters. You can find a complete list of char filter
        factories, tokenizer factories and filter factories at <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters">http://wiki.apache.org/solr/AnalyzersTokenizersTokenFilters</a>.
        Let's check a few of them.</p><div class="table"><a id="table-available-char-filters"/><p class="title"><b>Table 4.1. Example of available char filters</b></p><div class="table-contents"><table summary="Example of available char filters" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Factory</th><th align="center">Description</th><th align="center">Parameters</th><th align="center">Additional dependencies</th></tr></thead><tbody><tr><td><code class="classname">MappingCharFilterFactory</code></td><td>Replaces one or more characters with one or more
                characters, based on mappings specified in the resource
                file</td><td><p><code class="literal">mapping</code>: points to a resource
                file containing the mappings using the format: </p><div class="literallayout"><p><br/>
                    "á" =&gt; "a"<br/>
                    "ñ" =&gt; "n"<br/>
                    "ø" =&gt; "o"<br/>
                </p></div><p> </p></td><td>none</td></tr><tr><td><code class="classname">HTMLStripCharFilterFactory</code></td><td>Remove HTML standard tags, keeping the text</td><td>none</td><td>none</td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="table-available-tokenizers"/><p class="title"><b>Table 4.2. Example of available tokenizers</b></p><div class="table-contents"><table summary="Example of available tokenizers" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Factory</th><th align="center">Description</th><th align="center">Parameters</th><th align="center">Additional dependencies</th></tr></thead><tbody><tr><td><code class="classname">StandardTokenizerFactory</code></td><td>Use the Lucene StandardTokenizer</td><td>none</td><td>none</td></tr><tr><td><code class="classname">HTMLStripCharFilterFactory</code></td><td>Remove HTML tags, keep the text and pass it to a
                StandardTokenizer.</td><td>none</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">PatternTokenizerFactory</code></td><td>Breaks text at the specified regular expression
                pattern.</td><td><p><code class="literal">pattern</code>: the regular
                expression to use for tokenizing</p><p>group: says which
                pattern group to extract into tokens</p></td><td><code class="literal">solr-core</code></td></tr></tbody></table></div></div><br class="table-break"/><div class="table"><a id="table-available-filters"/><p class="title"><b>Table 4.3. Examples of available filters</b></p><div class="table-contents"><table summary="Examples of available filters" border="1"><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th align="center">Factory</th><th align="center">Description</th><th align="center">Parameters</th><th align="center">Additional dependencies</th></tr></thead><tbody><tr><td><code class="classname">StandardFilterFactory</code></td><td>Remove dots from acronyms and 's from words</td><td>none</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">LowerCaseFilterFactory</code></td><td>Lowercases all words</td><td>none</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">StopFilterFactory</code></td><td>Remove words (tokens) matching a list of stop
                words</td><td><p><code class="literal">words</code>: points to a resource
                file containing the stop words</p><p>ignoreCase: true if
                <code class="literal">case</code> should be ignore when comparing stop
                words, <code class="literal">false</code> otherwise </p></td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">SnowballPorterFilterFactory</code></td><td>Reduces a word to it's root in a given language. (eg.
                protect, protects, protection share the same root). Using such
                a filter allows searches matching related words.</td><td><code class="literal">language</code>: Danish, Dutch, English,
                Finnish, French, German, Italian, Norwegian, Portuguese,
                Russian, Spanish, Swedish and a few more</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">ISOLatin1AccentFilterFactory</code></td><td>Remove accents for languages like French</td><td>none</td><td><code class="literal">solr-core</code></td></tr><tr><td><code class="classname">PhoneticFilterFactory</code></td><td>Inserts phonetically similar tokens into the token
                stream</td><td><p><code class="literal">encoder</code>: One of
                DoubleMetaphone, Metaphone, Soundex or
                RefinedSoundex</p><p>inject: <code class="constant">true</code>
                will add tokens to the stream, <code class="constant">false</code> will
                replace the existing token
                </p><p><code class="literal">maxCodeLength</code>: sets the
                maximum length of the code to be generated. Supported only for
                Metaphone and DoubleMetaphone encodings</p></td><td><code class="literal">solr-core</code> and
                <code class="literal">commons-codec</code></td></tr><tr><td><code class="classname">CollationKeyFilterFactory</code></td><td>Converts each token into its
                <code class="classname">java.text.CollationKey</code>, and then
                encodes the <code class="classname">CollationKey</code> with
                <code class="classname">IndexableBinaryStringTools</code>, to allow it
                to be stored as an index term.</td><td><code class="literal">custom</code>, <code class="literal">language</code>,
                <code class="literal">country</code>, <code class="literal">variant</code>,
                <code class="literal">strength</code>, <code class="literal">decomposition
                </code>see Lucene's
                <code class="classname">CollationKeyFilter</code> javadocs for more
                info</td><td><code class="literal">solr-core</code> and
                <code class="literal">commons-io</code></td></tr></tbody></table></div></div><br class="table-break"/><p>We recommend to check all the implementations of
        <code class="classname">org.apache.solr.analysis.TokenizerFactory</code> and
        <code class="classname">org.apache.solr.analysis.TokenFilterFactory</code> in
        your IDE to see the implementations available.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4141"/>4.3.3. Dynamic analyzer selection</h3></div></div></div><p>So far all the introduced ways to specify an analyzer were static.
      However, there are use cases where it is useful to select an analyzer
      depending on the current state of the entity to be indexed, for example
      in a multilingual applications. For an <code class="classname">BlogEntry</code>
      class for example the analyzer could depend on the language property of
      the entry. Depending on this property the correct language specific
      stemmer should be chosen to index the actual text.</p><p>To enable this dynamic analyzer selection Hibernate Search
      introduces the <code class="classname">AnalyzerDiscriminator</code> annotation.
      <a href="#example-analyzer-discriminator" title="Example 4.17. Usage of @AnalyzerDiscriminator">Example 4.17, “Usage of @AnalyzerDiscriminator”</a> demonstrates the usage
      of this annotation.</p><div class="example"><a id="example-analyzer-discriminator"/><p class="title"><b>Example 4.17. Usage of @AnalyzerDiscriminator</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;de&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GermanStemFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BlogEntry</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDiscriminator</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LanguageDiscriminator</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;language</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;text</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Set</span><span class="java_operator">&lt;</span><span class="java_type">BlogEntry</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;references</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;standard&nbsp;getter</span><span class="java_operator">/</span><span class="java_plain">setter</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">LanguageDiscriminator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Discriminator</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getAnalyzerDefinitionName</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;value</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;field</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_operator">||</span><span class="java_plain">&nbsp;</span><span class="java_operator">!</span><span class="java_separator">(</span><span class="java_plain">&nbsp;entity&nbsp;</span><span class="java_keyword">instanceof</span><span class="java_plain">&nbsp;</span><span class="java_type">Article</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>The prerequisite for using
      <code class="classname">@AnalyzerDiscriminator</code> is that all analyzers
      which are going to be used dynamically are predefined via
      <code class="classname">@AnalyzerDef</code> definitions. If this is the case,
      one can place the <code class="classname">@AnalyzerDiscriminator</code>
      annotation either on the class or on a specific property of the entity
      for which to dynamically select an analyzer. Via the
      <code class="literal">impl</code> parameter of the
      <code class="classname">AnalyzerDiscriminator</code> you specify a concrete
      implementation of the <code class="classname">Discriminator</code> interface. It
      is up to you to provide an implementation for this interface. The only
      method you have to implement is
      <code class="classname">getAnalyzerDefinitionName()</code> which gets called for
      each field added to the Lucene document. The entity which is getting
      indexed is also passed to the interface method. The
      <code class="literal">value</code> parameter is only set if the
      <code class="classname">AnalyzerDiscriminator</code> is placed on property level
      instead of class level. In this case the value represents the current
      value of this property.</p><p>An implemention of the <code class="classname">Discriminator</code>
      interface has to return the name of an existing analyzer definition or
      <code class="classname">null</code> if the default analyzer should not be
      overridden. <a href="#example-analyzer-discriminator" title="Example 4.17. Usage of @AnalyzerDiscriminator">Example 4.17, “Usage of @AnalyzerDiscriminator”</a> assumes
      that the language parameter is either 'de' or 'en' which matches the
      specified names in the <code class="classname">@AnalyzerDef</code>s.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="analyzer-retrievinganalyzer"/>4.3.4. Retrieving an analyzer</h3></div></div></div><p>In some situations retrieving analyzers can be handy. For example,
      if your domain model makes use of multiple analyzers (maybe to benefit
      from stemming, use phonetic approximation and so on), you need to make
      sure to use the same analyzers when you build your query.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This rule can be broken but you need a good reason for it. If
        you are unsure, use the same analyzers. If you use the Hibernate
        Search query DSL (see <a href="#search-query-querydsl" title="5.1.2. Building a Lucene query with the Hibernate Search query DSL">Section 5.1.2, “Building a Lucene query with the Hibernate Search query
      DSL”</a>), you
        don't have to think about it. The query DSL does use the right
        analyzer transparently for you.</p></div><p>Whether you are using the Lucene programmatic API or the Lucene
      query parser, you can retrieve the scoped analyzer for a given entity. A
      scoped analyzer is an analyzer which applies the right analyzers
      depending on the field indexed. Remember, multiple analyzers can be
      defined on a given entity each one working on an individual field. A
      scoped analyzer unifies all these analyzers into a context-aware
      analyzer. While the theory seems a bit complex, using the right analyzer
      in a query is very easy.</p><div class="example"><a id="d0e4217"/><p class="title"><b>Example 4.18. Using the scoped analyzer when building a full-text
        query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">apache</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">lucene</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">queryParser</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">QueryParser</span><!-- <br/> --><span class="java_plain">&nbsp;parser&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">QueryParser</span><!-- <br/> --><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">().</span><span class="java_plain">getAnalyzer</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;parser</span><span class="java_separator">.</span><span class="java_plain">parse</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;title:sky&nbsp;Or&nbsp;title_stemmed:diamond&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;a&nbsp;list&nbsp;of&nbsp;managed&nbsp;objects</span>
</pre></div></div><br class="example-break"/><p>In the example above, the song title is indexed in two fields: the
      standard analyzer is used in the field <code class="literal">title</code> and a
      stemming analyzer is used in the field <code class="literal">title_stemmed</code>.
      By using the analyzer provided by the search factory, the query uses the
      appropriate analyzer depending on the field targeted.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>You can also retrieve analyzers defined via
        <code class="classname">@AnalyzerDef</code> by their definition name using
        <code class="code">searchFactory.getAnalyzer(String)</code>.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-mapping-bridge"/>4.4. Bridges</h2></div></div></div><p>When discussing the basic mapping for an entity one important fact
    was so far disregarded. In Lucene all index fields have to be represented
    as strings. All entity properties annotated with <code class="literal">@Field</code>
    have to be converted to strings to be indexed. The reason we have not
    mentioned it so far is, that for most of your properties Hibernate Search
    does the translation job for you thanks to a set of built-in bridges.
    However, in some cases you need a more fine grained control over the
    translation process.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4247"/>4.4.1. Built-in bridges</h3></div></div></div><p>Hibernate Search comes bundled with a set of built-in bridges
      between a Java property type and its full text representation.</p><div class="variablelist"><dl><dt><span class="term">null</span></dt><dd><p>Per default <code class="constant">null</code> elements are not
            indexed. Lucene does not support null elements. However, in some
            situation it can be useful to insert a custom token representing
            the <code class="constant">null</code> value. See <a href="#field-annotation" title="4.1.1.2. @Field">Section 4.1.1.2, “@Field”</a> for more information.</p></dd><dt><span class="term">java.lang.String</span></dt><dd><p>Strings are indexed as are</p></dd><dt><span class="term">short, Short, integer, Integer, long, Long, float, Float,
          double, Double, BigInteger, BigDecimal</span></dt><dd><p>Numbers are converted into their string representation. Note
            that numbers cannot be compared by Lucene (ie used in ranged
            queries) out of the box: they have to be padded </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Using a Range query has drawbacks; an alternative
                approach is to use a Filter query which will filter the result
                query to the appropriate range.</p><p>Hibernate Search will support a padding mechanism</p></div></dd><dt><span class="term">java.util.Date</span></dt><dd><p>Dates are stored as yyyyMMddHHmmssSSS in GMT time
            (200611072203012 for Nov 7th of 2006 4:03PM and 12ms EST). You
            shouldn't really bother with the internal format. What is
            important is that when using a TermRangeQuery, you should know
            that the dates have to be expressed in GMT time.</p><p>Usually, storing the date up to the millisecond is not
            necessary. <code class="literal">@DateBridge</code> defines the appropriate
            resolution you are willing to store in the index
            (<code class="literal">@DateBridge(resolution=Resolution.DAY)</code>). The
            date pattern will then be truncated accordingly.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Meeting</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze</span><span class="java_operator">=</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@DateBridge(resolution=Resolution.MINUTE)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;date</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>A Date whose resolution is lower than
              <code class="literal">MILLISECOND</code> cannot be a
              <code class="literal">@DocumentId</code></p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>The default <code class="classname">Date</code> bridge uses
              Lucene's <code class="classname">DateTools</code> to convert from and to
              <code class="classname">String</code>. This means that all dates are
              expressed in GMT time. If your requirements are to store dates
              in a fixed time zone you have to implement a custom date bridge.
              Make sure you understand the requirements of your applications
              regarding to date indexing and searching.</p></div></dd><dt><span class="term">java.net.URI, java.net.URL</span></dt><dd><p>URI and URL are converted to their string
            representation</p></dd><dt><span class="term">java.lang.Class</span></dt><dd><p>Class are converted to their fully qualified class name. The
            thread context classloader is used when the class is
            rehydrated</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4335"/>4.4.2. Tika bridge</h3></div></div></div><p>Hibernate Search allows you to extract text from various document
      types using the built-in <code class="classname">TikaBridge</code> which
      utilizes <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://tika.apache.org">Apache Tika</a> to
      extract text and metadata from the provided documents. The
      <code class="classname">TikaBridge</code> annotation can be used with
      <code class="classname">String</code>, <code class="classname">URI</code>,
      <code class="classname">byte[]</code> or <code class="classname">java.sql.Blob</code>
      properties. In the case of <code class="classname">String</code> and
      <code class="classname">URI</code> the bridge interprets the values are file
      paths and tries to open a file to parse the document. In the case of
      <code class="classname">byte[]</code> and <code class="classname">Blob</code> the values
      are directly passed to Tika for parsing.</p><p>Tika uses metadata as in- and output of the parsing process and it
      also allows to provide additional context information. This process is
      described in <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://tika.apache.org/1.1/parser.html#apiorgapachetikametadataMetadata.html">Parser
      interface</a>. The Hibernate Search Tika bridge allows you to make
      use of these additional configuration options by providing two
      interfaces in conjunction with <code class="classname">TikaBridge</code>. The
      first interface is the <code class="classname">TikaParseContextProvider</code>.
      It allows you to create a custom <code class="classname">ParseContext</code> for
      the document parsing. The second interface is
      <code class="classname">TikaMetadataProcessor</code> which has two methods -
      <code class="methodname">prepareMetadata()</code> and <code class="methodname">set(String,
      Object, Document, LuceneOptions, Metadata metadata)</code>. The
      former allows to add additional metadata to the parsing process (for
      example the file name) and the latter allows you to index metadata
      discovered during the parsing process.</p><p><code class="classname">TikaParseContextProvider</code> as well as
      <code class="classname">TikaMetadataProcessor</code> implementation classes can
      both be specified as parameters on the TikaBridge annotation.</p><div class="example"><a id="example-tika-mapping"/><p class="title"><b>Example 4.19. Example mapping with Apache Tika</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@TikaBridge(metadataProcessor = Mp3TikaMetadataProcessor.class)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;mp3FileName</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;queryBuilder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;queryBuilder</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;mp3FileName&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>.ignoreFieldBridge()<span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">mandatory</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Apes&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_separator">).</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>In the <a href="#example-tika-mapping" title="Example 4.19. Example mapping with Apache Tika">Example 4.19, “Example mapping with Apache Tika”</a> the property
      <code class="methodname">mp3FileName</code> represents a path to an MP3 file;
      the headers of this file will be indexed and so the performed query will
      be able to match the MP3 metadata.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>TikaBridge does not implement TwoWayFieldBridge: queries built
        using the DSL (as in the <a href="#example-tika-mapping" title="Example 4.19. Example mapping with Apache Tika">Example 4.19, “Example mapping with Apache Tika”</a>) need
        to explicitly enable the option
        <code class="methodname">ignoreFieldBridge()</code>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4431"/>4.4.3. Custom bridges</h3></div></div></div><p>Sometimes, the built-in bridges of Hibernate Search do not cover
      some of your property types, or the String representation used by the
      bridge does not meet your requirements. The following paragraphs
      describe several solutions to this problem.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4436"/>4.4.3.1. StringBridge</h4></div></div></div><p>The simplest custom solution is to give Hibernate Search an
        implementation of your expected <code class="classname">Object</code> to
        <code class="classname">String</code> bridge. To do so you need to implement
        the <code class="literal">org.hibernate.search.bridge.StringBridge</code>
        interface. All implementations have to be thread-safe as they are used
        concurrently.</p><div class="example"><a id="example-custom-string-bridge"/><p class="title"><b>Example 4.20. Custom <code class="classname">StringBridge</code>
          implementation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;Padding&nbsp;Integer&nbsp;bridge.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;All&nbsp;numbers&nbsp;will&nbsp;be&nbsp;padded&nbsp;with&nbsp;0&nbsp;to&nbsp;match&nbsp;5&nbsp;digits</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@author</span><span class="java_javadoc_comment">&nbsp;Emmanuel&nbsp;Bernard</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">PaddedIntegerBridge</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span>StringBridge<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">5</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public String objectToString(Object object)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">((</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;object</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IllegalArgumentException</span><span class="java_separator">(</span><span class="java_literal">&quot;Number&nbsp;too&nbsp;big&nbsp;to&nbsp;be&nbsp;padded&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;paddedInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">();</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex</span><span class="java_operator">++</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">'0'</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>Given the string bridge defined in <a href="#example-custom-string-bridge" title="Example 4.20. Custom StringBridge implementation">Example 4.20, “Custom <code class="classname">StringBridge</code>
          implementation”</a>, any property or field can
        use this bridge thanks to the <code class="literal">@FieldBridge</code>
        annotation:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA">@FieldBridge(impl = PaddedIntegerBridge.class)</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;length</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4475"/>4.4.3.1.1. Parameterized bridge</h5></div></div></div><p>Parameters can also be passed to the bridge implementation
          making it more flexible. <a href="#example-passing-bridge-paremters" title="Example 4.21. Passing parameters to your bridge implementation">Example 4.21, “Passing parameters to your bridge implementation”</a> implements a
          <code class="classname">ParameterizedBridge</code> interface and parameters
          are passed through the <code class="literal">@FieldBridge</code>
          annotation.</p><div class="example"><a id="example-passing-bridge-paremters"/><p class="title"><b>Example 4.21. Passing parameters to your bridge implementation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaddedIntegerBridge</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">StringBridge</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span>ParameterizedBridge<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;PADDING_PROPERTY&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;padding&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">5</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">default</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public void setParameterValues(Map&lt;String,String&gt; parameters)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;PADDING_PROPERTY&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">padding&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_separator">.</span><span class="java_plain">parseInt</span><span class="java_separator">(</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;objectToString</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;object</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">((</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;object</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IllegalArgumentException</span><span class="java_separator">(</span><span class="java_literal">&quot;Number&nbsp;too&nbsp;big&nbsp;to&nbsp;be&nbsp;padded&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;paddedInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">();</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex</span><span class="java_operator">++</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">'0'</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">rawInteger</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">on&nbsp;the&nbsp;property</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">FieldBridge</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PaddedIntegerBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params = @Parameter(name="padding", value="10")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;length</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>The <code class="classname">ParameterizedBridge</code> interface can
          be implemented by <code class="classname">StringBridge</code>,
          <code class="classname">TwoWayStringBridge</code>,
          <code class="classname">FieldBridge</code> implementations.</p><p>All implementations have to be thread-safe, but the parameters
          are set during initialization and no special care is required at
          this stage.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4518"/>4.4.3.1.2. Type aware bridge</h5></div></div></div><p>It is sometimes useful to get the type the bridge is applied
          on:</p><div class="itemizedlist"><ul><li><p>the return type of the property for field/getter-level
              bridges</p></li><li><p>the class type for class-level bridges</p></li></ul></div><p>An example is a bridge that deals with enums in a custom
          fashion but needs to access the actual enum type. Any bridge
          implementing <code class="classname">AppliedOnTypeAwareBridge</code> will
          get the type the bridge is applied on injected. Like parameters, the
          type injected needs no particular care with regard to
          thread-safety.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e4535"/>4.4.3.1.3. Two-way bridge</h5></div></div></div><p>If you expect to use your bridge implementation on an id
          property (ie annotated with <code class="literal">@DocumentId</code> ), you
          need to use a slightly extended version of
          <code class="literal">StringBridge</code> named
          <code class="classname">TwoWayStringBridge</code>. Hibernate Search needs to
          read the string representation of the identifier and generate the
          object out of it. There is no difference in the way the
          <code class="literal">@FieldBridge</code> annotation is used.</p><div class="example"><a id="d0e4552"/><p class="title"><b>Example 4.22. Implementing a TwoWayStringBridge usable for id
            properties</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">PaddedIntegerBridge</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">TwoWayStringBridge</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ParameterizedBridge</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;PADDING_PROPERTY&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;padding&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">5</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">default</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setParameterValues</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Object</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">PADDING_PROPERTY</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">padding&nbsp;</span><span class="java_operator">!=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">padding&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;objectToString</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_plain">&nbsp;object</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;rawInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">((</span><span class="java_type">Integer</span><span class="java_separator">)</span><span class="java_plain">&nbsp;object</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;padding</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">throw</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IllegalArgumentException</span><span class="java_separator">(</span><span class="java_literal">&quot;Number&nbsp;too&nbsp;big&nbsp;to&nbsp;be&nbsp;padded&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_plain">&nbsp;paddedInteger&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StringBuilder</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;rawInteger</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">();</span><span class="java_plain">&nbsp;padIndex&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;padding&nbsp;</span><span class="java_separator">;</span><span class="java_plain">&nbsp;padIndex</span><span class="java_operator">++</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_literal">'0'</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;paddedInteger</span><span class="java_separator">.</span><span class="java_plain">append</span><span class="java_separator">(</span><span class="java_plain">rawInteger</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public Object stringToObject(String stringValue)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_separator">(</span><span class="java_plain">stringValue</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">On</span><span class="java_plain">&nbsp;an&nbsp;id&nbsp;property</span><span class="java_operator">:</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">FieldBridge</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">PaddedIntegerBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;padding&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;10&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>It is important for the two-way process to be idempotent (ie
            object = stringToObject( objectToString( object ) ) ).</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4563"/>4.4.3.2. FieldBridge</h4></div></div></div><p>Some use cases require more than a simple object to string
        translation when mapping a property to a Lucene index. To give you the
        greatest possible flexibility you can also implement a bridge as a
        <code class="classname">FieldBridge</code>. This interface gives you a
        property value and let you map it the way you want in your Lucene
        <code class="classname">Document</code>. You can for example store a property
        in two different document fields. The interface is very similar in its
        concept to the Hibernate <code class="classname">UserType</code>s.</p><div class="example"><a id="example-field-bridge"/><p class="title"><b>Example 4.23. Implementing the FieldBridge interface</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;Store&nbsp;the&nbsp;date&nbsp;in&nbsp;3&nbsp;different&nbsp;fields&nbsp;-&nbsp;year,&nbsp;month,&nbsp;day&nbsp;-&nbsp;to&nbsp;ease&nbsp;Range&nbsp;Query&nbsp;per</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;year,&nbsp;month&nbsp;or&nbsp;day&nbsp;(eg&nbsp;get&nbsp;all&nbsp;the&nbsp;elements&nbsp;of&nbsp;December&nbsp;for&nbsp;the&nbsp;last&nbsp;5&nbsp;years).</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@author</span><span class="java_javadoc_comment">&nbsp;Emmanuel&nbsp;Bernard</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">DateSplitBridge</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">FieldBridge</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeZone</span><span class="java_plain">&nbsp;GMT&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeZone</span><span class="java_separator">.</span><span class="java_plain">getTimeZone</span><span class="java_separator">(</span><span class="java_literal">&quot;GMT&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public void set(String name, Object value, Document document, 
                    LuceneOptions luceneOptions)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;date&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Date</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Calendar</span><span class="java_plain">&nbsp;cal&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GregorianCalendar</span><span class="java_separator">.</span><span class="java_plain">getInstance</span><span class="java_separator">(</span><span class="java_plain">GMT</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cal</span><span class="java_separator">.</span><span class="java_plain">setTime</span><span class="java_separator">(</span><span class="java_plain">date</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;year&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cal</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_type">Calendar</span><span class="java_separator">.</span><span class="java_plain">YEAR</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;month&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cal</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_type">Calendar</span><span class="java_separator">.</span><span class="java_plain">MONTH</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">1</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;day&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;cal</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_type">Calendar</span><span class="java_separator">.</span><span class="java_plain">DAY_OF_MONTH</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;set&nbsp;year</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">addFieldToDocument</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;.year&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_separator">.</span><span class="java_plain">valueOf</span><span class="java_separator">(</span><span class="java_plain">&nbsp;year&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;set&nbsp;month&nbsp;and&nbsp;pad&nbsp;it&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;needed</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">addFieldToDocument</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;.month&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;month&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;0&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_separator">.</span><span class="java_plain">valueOf</span><span class="java_separator">(</span><span class="java_plain">&nbsp;month&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;set&nbsp;day&nbsp;and&nbsp;pad&nbsp;it&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;needed</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">addFieldToDocument</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;.day&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;</span><span class="java_operator">&lt;</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_plain">&nbsp;</span><span class="java_operator">?</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;0&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_separator">.</span><span class="java_plain">valueOf</span><span class="java_separator">(</span><span class="java_plain">&nbsp;day&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">property</span>
@FieldBridge(impl = DateSplitBridge.class)</span>
<!--  --><br/><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;date</span><span class="java_separator">;</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>In <a href="#example-field-bridge" title="Example 4.23. Implementing the FieldBridge interface">Example 4.23, “Implementing the FieldBridge interface”</a> the fields are not
        added directly to Document. Instead the addition is delegated to the
        <code class="classname">LuceneOptions</code> helper; this helper will apply
        the options you have selected on <code class="literal">@Field</code>, like
        <code class="literal">Store</code> or <code class="literal">TermVector</code>, or apply
        the choosen <code class="classname">@Boost</code> value. It is especially
        useful to encapsulate the complexity of <code class="literal">COMPRESS</code>
        implementations. Even though it is recommended to delegate to
        <code class="classname">LuceneOptions</code> to add fields to the
        <code class="classname">Document</code>, nothing stops you from editing the
        <code class="classname">Document</code> directly and ignore the
        <code class="classname">LuceneOptions</code> in case you need to.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Classes like <code class="classname">LuceneOptions</code> are created
          to shield your application from changes in Lucene API and simplify
          your code. Use them if you can, but if you need more flexibility
          you're not required to.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e4628"/>4.4.3.3. ClassBridge</h4></div></div></div><p>It is sometimes useful to combine more than one property of a
        given entity and index this combination in a specific way into the
        Lucene index. The <code class="classname">@ClassBridge</code> respectively
        <code class="classname">@ClassBridges</code> annotations can be defined at
        class level (as opposed to the property level). In this case the
        custom field bridge implementation receives the entity instance as the
        value parameter instead of a particular property. Though not shown in
        <a href="#example-class-bridge" title="Example 4.24. Implementing a class bridge">Example 4.24, “Implementing a class bridge”</a>,
        <code class="classname">@ClassBridge</code> supports the
        <code class="methodname">termVector</code> attribute discussed in section
        <a href="#basic-mapping" title="4.1.1. Basic mapping">Section 4.1.1, “Basic mapping”</a>.</p><div class="example"><a id="example-class-bridge"/><p class="title"><b>Example 4.24. Implementing a class bridge</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
@ClassBridge<span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;branchnetwork&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>CatFieldsClassBridge.class<span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;sepChar&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Department</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;network</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;branchHead</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;branch</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;maxEmployees</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CatFieldsClassBridge</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">FieldBridge</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ParameterizedBridge</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;sepChar</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setParameterValues</span><span class="java_separator">(</span><span class="java_type">Map</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">sepChar&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_separator">)</span><span class="java_plain">&nbsp;parameters</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;sepChar&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public void set(
        String name, Object value, Document document, LuceneOptions luceneOptions)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_type">In</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;particular&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;field&nbsp;was&nbsp;passed</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;from&nbsp;the&nbsp;name&nbsp;field&nbsp;of&nbsp;the&nbsp;</span><span class="java_type">ClassBridge</span><span class="java_plain">&nbsp;</span><span class="java_type">Annotation</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">This</span><span class="java_plain">&nbsp;is&nbsp;not</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;a&nbsp;requirement</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">It</span><span class="java_plain">&nbsp;just&nbsp;works&nbsp;that&nbsp;way&nbsp;in&nbsp;</span><span class="java_keyword">this</span><span class="java_plain">&nbsp;instance</span><span class="java_separator">.</span><span class="java_plain">&nbsp;</span><span class="java_type">The</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;actual&nbsp;name&nbsp;could&nbsp;be&nbsp;supplied&nbsp;by&nbsp;hard&nbsp;coding&nbsp;it&nbsp;below</span><span class="java_separator">.</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Department</span><span class="java_plain">&nbsp;dep&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Department</span><span class="java_separator">)</span><span class="java_plain">&nbsp;value</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fieldValue1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;dep</span><span class="java_separator">.</span><span class="java_plain">getBranch</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;fieldValue1&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldValue1&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fieldValue2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;dep</span><span class="java_separator">.</span><span class="java_plain">getNetwork</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;fieldValue2&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fieldValue2&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;fieldValue&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fieldValue1&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;sepChar&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;fieldValue2</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Field</span><span class="java_plain">&nbsp;field&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_separator">,</span><span class="java_plain">&nbsp;fieldValue</span><span class="java_separator">,</span><span class="java_plain">&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">getStore</span><span class="java_separator">(),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">getIndex</span><span class="java_separator">(),</span><span class="java_plain">&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">getTermVector</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field</span><span class="java_separator">.</span><span class="java_plain">setBoost</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneOptions</span><span class="java_separator">.</span><span class="java_plain">getBoost</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document</span><span class="java_separator">.</span><span class="java_plain">add</span><span class="java_separator">(</span><span class="java_plain">&nbsp;field&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>In this example, the particular
        <code class="classname">CatFieldsClassBridge</code> is applied to the
        <code class="literal">department</code> instance, the field bridge then
        concatenate both branch and network and index the
        concatenation.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-mapping-indexinginterceptor"/>4.5. Conditional indexing: to index or not based on entity state</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>This feature is considered experimental. More operation types
      might be added in the future depending on user feedback.</p></div><p>In some situations, you want to index an entity only when it is in a
    given state, for example:</p><div class="itemizedlist"><ul><li><p>only index blog entries marked as published</p></li><li><p>no longer index invoices when they are marked archived</p></li></ul></div><p>This serves both functional and technical needs. You don't want your
    blog readers to find your draft entries and filtering them off the query
    is a bit annoying. Very few of your entities are actually required to be
    indexed and you want to limit indexing overhead and keep indexes small and
    fast.</p><p>Hibernate Search lets you intercept entity indexing operations and
    override them. It is quite simple:</p><div class="itemizedlist"><ul><li><p>Write an <code class="classname">EntityIndexingInterceptor</code> class
        with your entity state based logic</p></li><li><p>Mark the entity as intercepted by this implementation</p></li></ul></div><p>Let's look at the blog example at <a href="#example-search-mapping-indexinginterceptor-blog" title="Example 4.25. Index blog entries only when they are published and remove them when they are in a different state">Example 4.25, “Index blog entries only when they are published and remove them
      when they are in a different state”</a></p><div class="example"><a id="example-search-mapping-indexinginterceptor-blog"/><p class="title"><b>Example 4.25. Index blog entries only when they are published and remove them
      when they are in a different state</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;Only&nbsp;index&nbsp;blog&nbsp;when&nbsp;it&nbsp;is&nbsp;in&nbsp;published&nbsp;state</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@author</span><span class="java_javadoc_comment">&nbsp;Emmanuel&nbsp;Bernard&nbsp;&lt;emmanuel</span><span class="java_javadoc_tag">@hibernate</span><span class="java_javadoc_comment">.org&gt;</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;*/</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexWhenPublishedInterceptor</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">EntityIndexingInterceptor</span><span class="java_operator">&lt;</span><span class="java_type">Blog</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_plain">&nbsp;onAdd</span><span class="java_separator">(</span><span class="java_type">Blog</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">entity</span><span class="java_separator">.</span><span class="java_plain">getStatus</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_type">BlogStatus</span><span class="java_separator">.</span><span class="java_plain">PUBLISHED</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_separator">.</span><span class="java_plain">APPLY_DEFAULT</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_separator">.</span><span class="java_plain">SKIP</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_plain">&nbsp;onUpdate</span><span class="java_separator">(</span><span class="java_type">Blog</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">entity</span><span class="java_separator">.</span><span class="java_plain">getStatus</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_type">BlogStatus</span><span class="java_separator">.</span><span class="java_plain">PUBLISHED</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_separator">.</span><span class="java_plain">UPDATE</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_separator">.</span><span class="java_plain">REMOVE</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_plain">&nbsp;onDelete</span><span class="java_separator">(</span><span class="java_type">Blog</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_separator">.</span><span class="java_plain">APPLY_DEFAULT</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexingOverride</span><span class="java_plain">&nbsp;onCollectionUpdate</span><span class="java_separator">(</span><span class="java_type">Blog</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;onUpdate</span><span class="java_separator">(</span><span class="java_plain">entity</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_separator">(</span><span class="java_plain">interceptor</span><span class="java_operator">=</span><span class="java_type">IndexWhenPublishedInterceptor</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Blog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;getId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setId</span><span class="java_separator">(</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getTitle</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setTitle</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">title&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;title</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">BlogStatus</span><span class="java_plain">&nbsp;getStatus</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;status</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setStatus</span><span class="java_separator">(</span><span class="java_type">BlogStatus</span><span class="java_plain">&nbsp;status</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">status&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;status</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">BlogStatus</span><span class="java_plain">&nbsp;status</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>We mark the <code class="classname">Blog</code> entity with
    <code class="methodname">@Indexed.interceptor</code>. As you can see,
    <code class="classname">IndexWhenPublishedInterceptor</code> implements
    <code class="classname">EntityIndexingInterceptor</code> and accepts
    <code class="classname">Blog</code> entities (it could have accepted superclasses
    as well - for example <code class="classname">Object</code> if you create a
    generic interceptor.</p><p>You can react to several planned indexing events:</p><div class="itemizedlist"><ul><li><p>when an entity is added to your datastore</p></li><li><p>when an entity is updated in your datastore</p></li><li><p>when an entity is deleted from your datastore</p></li><li><p>when a collection own by this entity is updated in your
        datastore</p></li></ul></div><p>For each occurring event you can respond with one of the following
    actions:</p><div class="itemizedlist"><ul><li><p><code class="literal">APPLY_DEFAULT</code>: that's the basic operation
        that lets Hibernate Search update the index as expected - creating,
        updating or removing the document</p></li><li><p><code class="literal">SKIP</code>: ask Hibernate Search to not do anything
        to the index for this event - data will not be created, updated or
        removed from the index in any way</p></li><li><p><code class="literal">REMOVE</code>: ask Hibernate Search to remove
        indexing data about this entity - you can safely ask for
        <code class="literal">REMOVE</code> even if the entity has not yet been
        indexed</p></li><li><p><code class="literal">UPDATE</code>: ask Hibernate Search to either index
        or update the index for this entity - it is safe to ask for
        <code class="literal">UPDATE</code> even if the entity has never been
        indexed</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Be careful, not every combination makes sense: for example, asking
      to <code class="literal">UPDATE</code> the index upon
      <code class="methodname">onDelete</code>. Note that you could ask for
      <code class="literal">SKIP</code> in this situation if saving indexing time is
      critical for you. That's rarely the case though.</p></div><p>By default, no interceptor is applied on an entity. You have to
    explicitly define an interceptor via the <code class="classname">@Indexed</code>
    annotation (see <a href="#indexed-annotation" title="4.1.1.1. @Indexed">Section 4.1.1.1, “@Indexed”</a>) or programmatically
    (see <a href="#hsearch-mapping-programmaticapi" title="4.7. Programmatic API">Section 4.7, “Programmatic API”</a>). This class and
    all its subclasses will then be intercepted. You can stop or change the
    interceptor used in a subclass by overriding
    <code class="methodname">@Indexed.interceptor</code>. Hibernate Search provides
    <code class="classname">DontInterceptEntityInterceptor</code> which will
    explicitly not intercept any call. This is useful to reset interception
    within a class hierarchy.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Dirty checking optimization is disabled when interceptors are
      used. Dirty checking optimization does check what has changed in an
      entity and only triggers an index update if indexed properties are
      changed. The reason is simple, your interceptor might depend on a non
      indexed property which would be ignored by this optimization.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>An <code class="classname">EntityIndexingInterceptor</code> can never
      override an explicit indexing operation such as
      <code class="methodname">index(T)</code>, <code class="methodname">purge(T, id)</code>
      or <code class="methodname">purgeAll(class)</code>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="provided-id"/>4.6. Providing your own id</h2></div></div></div><p>You can provide your own id for Hibernate Search if you are
    extending the internals. You will have to generate a unique value so it
    can be given to Lucene to be indexed. This will have to be given to
    Hibernate Search when you create an org.hibernate.search.Work object - the
    document id is required in the constructor.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="ProvidedId"/>4.6.1. The ProvidedId annotation</h3></div></div></div><p>Unlike <code class="classname">@DocumentId</code>which is applied on field
      level, <code class="classname">@ProvidedId</code> is used on the class level.
      Optionally you can specify your own bridge implementation using the
      <code class="constant">bridge</code> property. Also, if you annotate a class with
      <code class="classname">@ProvidedId</code>, your subclasses will also get the
      annotation - but it is not done by using the
      java.lang.annotations.@Inherited. Be sure however, to
      <span class="emphasis"><em>not</em></span> use this annotation with @DocumentId as your
      system will break.</p><div class="example"><a id="d0e4844"/><p class="title"><b>Example 4.26. Providing your own id</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">ProvidedId</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">bridge&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">my</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">own</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">MyCustomBridge</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">MyClass</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;</span><span class="java_type">MyString</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="hsearch-mapping-programmaticapi"/>4.7. Programmatic API</h2></div></div></div><p>Although the recommended approach for mapping indexed entities is to
    use annotations, it is sometimes more convenient to use a different
    approach:</p><div class="itemizedlist"><ul><li><p>the same entity is mapped differently depending on deployment
        needs (customization for clients)</p></li><li><p>some automatization process requires the dynamic mapping of many
        entities sharing common traits</p></li></ul></div><p>While it has been a popular demand in the past, the Hibernate team
    never found the idea of an XML alternative to annotations appealing due to
    it's heavy duplication, lack of code refactoring safety, because it did
    not cover all the use case spectrum and because we are in the 21st century
    :)</p><p>The idea of a programmatic API was much more appealing and has now
    become a reality. You can programmatically define your mapping using a
    programmatic API: you define entities and fields as indexable by using
    mapping classes which effectively mirror the annotation concepts in
    Hibernate Search. Note that fan(s) of XML approach can design their own
    schema and use the programmatic API to create the mapping while parsing
    the XML stream.</p><p>In order to use the programmatic model you must first construct a
    <code class="classname">SearchMapping</code> object which you can do in two
    ways:</p><div class="itemizedlist"><ul><li><p>directly</p></li><li><p>via a factory</p></li></ul></div><p>You can pass the <code class="classname">SearchMapping</code> object
    directly via the property key
    <code class="literal">hibernate.search.model_mapping</code> or the constant
    <code class="classname">Environment.MODEL_MAPPING</code>. Use the
    <code class="classname">Configuration</code> API or the Map passed to the JPA
    <code class="classname">Persistence</code> bootstrap methods.</p><div class="example"><a id="d0e4894"/><p class="title"><b>Example 4.27. Programmatic mapping</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">[...]</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">configure&nbsp;mapping</span>
<!--  --><br/><span class="java_type">Configuration</span><span class="java_plain">&nbsp;config&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Configuration</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">config</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Environment</span><span class="java_separator">.</span><span class="java_plain">MODEL_MAPPING</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">SessionFactory</span><span class="java_plain">&nbsp;sf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;config</span><span class="java_separator">.</span><span class="java_plain">buildSessionFactory</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><div class="example"><a id="d0e4899"/><p class="title"><b>Example 4.28. Programmatic mapping with JPA</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">[...]</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">configure&nbsp;mapping</span>
<!--  --><br/><span class="java_type">Map</span><span class="java_plain">&nbsp;props&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">HashMap</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">props</span><span class="java_separator">.</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Environment</span><span class="java_separator">.</span><span class="java_plain">MODEL_MAPPING</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">EntityManagerFactory</span><span class="java_plain">&nbsp;emf&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Persistence</span><span class="java_separator">.</span><span class="java_plain">createEntityManagerFactory</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;userPU&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;props&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>Alternatively, you can create a factory class (ie. hosting a method
    annotated with <code class="classname">@Factory</code>) whose factory method
    returns the <code class="classname">SearchMapping</code> object. The factory class
    must have a no-arg constructor and its fully qualified class name is
    passed to the property key
    <code class="literal">hibernate.search.model_mapping</code> or its type-safe
    representation <code class="classname">Environment.MODEL_MAPPING</code>. This
    approach is useful when you do not necessarily control the bootstrap
    process like in a Java EE, CDI or Spring Framework container.</p><div class="example"><a id="d0e4918"/><p class="title"><b>Example 4.29. Use a mapping factory</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">MyAppSearchMappingFactory</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Factory</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">SearchMapping</span><span class="java_plain">&nbsp;getSearchMapping</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">SearchMapping</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SearchMapping</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzerDef</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;ngram&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">NGramFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">param</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;minGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">param</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;maxGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;mapping</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence</span><span class="xml_plain">&nbsp;...</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">persistence-unit</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;users&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;hibernate.search.model_mapping&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;com.acme.MyAppSearchMappingFactory&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">properties</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence-unit</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">persistence</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
</pre></div></div><br class="example-break"/><p>The <code class="classname">SearchMapping</code> is the root object which
    contains all the necessary indexable entities and fields. From there, the
    <code class="classname">SearchMapping</code> object exposes a fluent (and thus
    intuitive) API to express your mappings: it contextually exposes the
    relevant mapping options in a type-safe way. Just let your IDE
    autocompletion feature guide you through.</p><p>Today, the programmatic API cannot be used on a class annotated with
    Hibernate Search annotations, chose one approach or the other. Also note
    that the same default values apply in annotations and the programmatic
    API. For example, the <code class="methodname">@Field.name</code> is defaulted to
    the property name and does not have to be set.</p><p>Each core concept of the programmatic API has a corresponding
    example to depict how the same definition would look using annotation.
    Therefore seeing an annotation example of the programmatic approach should
    give you a clear picture of what Hibernate Search will build with the
    marked entities and associated properties.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4940"/>4.7.1. Mapping an entity as indexable</h3></div></div></div><p>The first concept of the programmatic API is to define an entity
      as indexable. Using the annotation approach a user would mark the entity
      as <code class="classname">@Indexed</code>, the following example demonstrates
      how to programmatically achieve this.</p><div class="example"><a id="d0e4948"/><p class="title"><b>Example 4.30. Marking an entity indexable</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexName</span><span class="java_separator">(</span><span class="java_literal">&quot;Address_Index&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">optional</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">interceptor</span><span class="java_separator">(</span><span class="java_type">IndexWhenPublishedInterceptor</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">optional</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>As you can see you must first create a
      <code class="classname">SearchMapping</code> object which is the root object
      that is then passed to the <code class="classname">Configuration</code> object
      as property. You must declare an entity and if you wish to make that
      entity as indexable then you must call the
      <code class="methodname">indexed()</code> method. The <code class="methodname">indexed()
      </code>method has an optional <code class="methodname">indexName(String
      indexName)</code> which can be used to change the default index
      name that is created by Hibernate Search. Likewise, an
      <code class="methodname">interceptor(Class&lt;? extends
      EntityIndexedInterceptor&gt;)</code> is available. Using the
      annotation model the above can be achieved as:</p><div class="example"><a id="d0e4973"/><p class="title"><b>Example 4.31. Annotation example of indexing entity</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_separator">(</span><span class="java_plain">index</span><span class="java_operator">=</span><span class="java_literal">&quot;Address_Index&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;interceptor</span><span class="java_operator">=</span><span class="java_type">IndexWhenPublishedInterceptor</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e4978"/>4.7.2. Adding DocumentId to indexed entity</h3></div></div></div><p>To set a property as a document id:</p><div class="example"><a id="d0e4983"/><p class="title"><b>Example 4.32. Enabling document id with programmatic model</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">field&nbsp;access</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The above is equivalent to annotating a property in the entity as
      <code class="classname">@DocumentId</code> as seen in the following
      example:</p><div class="example"><a id="d0e4993"/><p class="title"><b>Example 4.33. DocumentId annotation definition</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;addressId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>The next section demonstrates how to programmatically define
        analyzers.</p></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5000"/>4.7.3. Defining analyzers</h3></div></div></div><p>Analyzers can be programmatically defined using the
      <code class="methodname">analyzerDef(String analyzerDef, Class&lt;? extends
      TokenizerFactory&gt; tokenizerFactory) </code>method. This method
      also enables you to define filters for the analyzer definition. Each
      filter that you define can optionally take in parameters as seen in the
      following example :</p><div class="example"><a id="d0e5008"/><p class="title"><b>Example 4.34. Defining analyzers using programmatic model</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>.analyzerDef( "ngram", StandardTokenizerFactory.class )
        .filter( LowerCaseFilterFactory.class )
        .filter( NGramFilterFactory.class )
            .param( "minGramSize", "3" )
            .param( "maxGramSize", "3" )
    .analyzerDef( "en", StandardTokenizerFactory.class )
        .filter( LowerCaseFilterFactory.class )
        .filter( EnglishPorterFilterFactory.class )
    .analyzerDef( "de", StandardTokenizerFactory.class )
        .filter( LowerCaseFilterFactory.class )
        .filter( GermanStemFilterFactory.class )</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">getter&nbsp;access</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The analyzer mapping defined above is equivalent to the annotation
      model using <code class="classname">@AnalyzerDef</code> in conjunction with
      <code class="classname">@AnalyzerDefs</code>:</p><div class="example"><a id="d0e5024"/><p class="title"><b>Example 4.35. Analyzer definition using annotation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;ngram&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">NGramFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;minGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;maxGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}),</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;de&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">GermanStemFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">})</span>
</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5029"/>4.7.4. Defining full text filter definitions</h3></div></div></div><p>The programmatic API provides easy mechanism for defining full
      text filter definitions which is available via
      <code class="classname">@FullTextFilterDef</code> and
      <code class="classname">@FullTextFilterDefs</code> (see <a href="#query-filter" title="5.3. Filters">Section 5.3, “Filters”</a>). The next example depicts the creation of full
      text filter definition using the <code class="methodname">fullTextFilterDef
      </code>method.</p><div class="example"><a id="d0e5045"/><p class="title"><b>Example 4.36. Defining full text definition programmatically</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzerDef</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>.fullTextFilterDef("security", SecurityFilterFactory.class)
            .cache(FilterCacheModeType.INSTANCE_ONLY)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzer</span><span class="java_separator">(</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;address_data&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzer</span><span class="java_separator">(</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The previous example can effectively been seen as annotating your
      entity with <code class="classname">@FullTextFilterDef</code> like below:</p><div class="example"><a id="d0e5058"/><p class="title"><b>Example 4.37. Using annotation to define full text filter definition</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">FullTextFilterDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">FullTextFilterDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;security&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">SecurityFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;cache&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">FilterCacheModeType</span><span class="java_separator">.</span><span class="java_plain">INSTANCE_ONLY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;pubblic&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getAddressId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Fields</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">)),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;address_data&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getAddress1</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">......</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5063"/>4.7.5. Defining fields for indexing</h3></div></div></div><p>When defining fields for indexing using the programmatic API, call
      <code class="methodname">field()</code> on the <code class="methodname">property(String
      propertyName, ElementType elementType)</code> method. From
      <code class="methodname">field()</code> you can specify the <code class="methodname">name,
      index</code>, <code class="methodname">store</code>,
      <code class="methodname">bridge</code> and <code class="methodname">analyzer</code>
      definitions.</p><div class="example"><a id="d0e5089"/><p class="title"><b>Example 4.38. Indexing fields using programmatic API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">analyzerDef</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">filter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.field()
                .analyzer("en")
                .store(Store.YES)
            .field()
                .name("address_data")
                .analyzer("en");</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The above example of marking fields as indexable is equivalent to
      defining fields using <code class="classname">@Field</code> as seen
      below:</p><div class="example"><a id="d0e5102"/><p class="title"><b>Example 4.39. Indexing fields using annotation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">AnalyzerDefs</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">AnalyzerDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EnglishPorterFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getAddressId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...};</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Fields</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">store</span><span class="java_operator">=</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">)),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;address_data&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;en&quot;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getAddress1</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">......</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When using a programmatic mapping for a given type X, you can
        only refer to fields defined on X. Fields or methods inherited from a
        super type are not configurable. In case you need to configure a super
        class property, you need to either override the property in X or
        create a programmatic mapping for the super class. This mimics the
        usage of annotations where you cannot annotate a field or method of a
        super class either, unless it is redefined in the given type.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5110"/>4.7.6. Programmatically defining embedded entities</h3></div></div></div><p>In this section you will see how to programmatically define
      entities to be embedded into the indexed entity similar to using the
      <code class="classname">@IndexedEmbedded</code> model. In order to define this
      you must mark the property as
      <code class="methodname">indexEmbedded.</code>There is the option to add a
      prefix to the embedded entity definition which can be done by calling
      <code class="methodname">prefix</code> as seen in the example below:</p><div class="example"><a id="d0e5124"/><p class="title"><b>Example 4.40. Programmatically defining embedded entites</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">ProductCatalog</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;catalogId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">index</span><span class="java_separator">(</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">index</span><span class="java_separator">(</span><span class="java_type">Index</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;items&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.indexEmbedded()
                .prefix("catalog.items"); //optional</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The next example shows the same definition using annotation
      (<code class="classname">@IndexedEmbedded</code>):</p><div class="example"><a id="d0e5137"/><p class="title"><b>Example 4.41. Using @IndexedEmbedded</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ProductCatalog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getCatalogId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getTitle</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">fetch&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">FetchType</span><span class="java_separator">.</span><span class="java_plain">LAZY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">IndexColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;list_position&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Cascade</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">annotations</span><span class="java_separator">.</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">ALL</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">IndexedEmbedded</span><span class="java_separator">(</span><span class="java_plain">prefix</span><span class="java_operator">=</span><span class="java_literal">&quot;catalog.items&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Item</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getItems</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5142"/>4.7.7. Contained In definition</h3></div></div></div><p><code class="classname">@ContainedIn</code> can be define as seen in the
      example below:</p><div class="example"><a id="d0e5149"/><p class="title"><b>Example 4.42. Programmatically defining ContainedIn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">ProductCatalog</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;catalogId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;items&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexEmbedded</span><span class="java_separator">()</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;productCatalog&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">METHOD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.containedIn()<span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>This is equivalent to defining <code class="classname">@ContainedIn</code>
      in your entity:</p><div class="example"><a id="d0e5162"/><p class="title"><b>Example 4.43. Annotation approach for ContainedIn</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">ProductCatalog</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;getCatalogId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getTitle</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">OneToMany</span><span class="java_separator">(</span><span class="java_plain">fetch&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">FetchType</span><span class="java_separator">.</span><span class="java_plain">LAZY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">IndexColumn</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;list_position&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Cascade</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">annotations</span><span class="java_separator">.</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">ALL</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">IndexedEmbedded</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Item</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;getItems</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;itemId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getDescription</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">ManyToOne</span><span class="java_separator">(</span><span class="java_plain">&nbsp;cascade&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">PERSIST</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">CascadeType</span><span class="java_separator">.</span><span class="java_plain">REMOVE&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">ContainedIn</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">ProductCatalog</span><span class="java_plain">&nbsp;getProductCatalog</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{...}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5167"/>4.7.8. Date/Calendar Bridge</h3></div></div></div><p>In order to define a calendar or date bridge mapping, call the
      <code class="methodname">dateBridge(Resolution resolution) </code>or
      <code class="methodname">calendarBridge(Resolution resolution)</code> methods
      after you have defined a <code class="methodname">field()</code> in the
      <code class="classname">SearchMapping </code>hierarchy.</p><div class="example"><a id="d0e5184"/><p class="title"><b>Example 4.44. Programmatic model for defining calendar/date bridge</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;createdOn&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.dateBridge(Resolution.DAY)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;lastUpdated&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.calendarBridge(Resolution.DAY)<span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>See below for defining the above using
      <code class="classname">@CalendarBridge</code> and
      <code class="classname">@DateBridge</code>:</p><div class="example"><a id="d0e5203"/><p class="title"><b>Example 4.45. @CalendarBridge and @DateBridge definition</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;addressId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;address1</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution</span><span class="java_operator">=</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">DAY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;createdOn</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">CalendarBridge</span><span class="java_separator">(</span><span class="java_plain">resolution</span><span class="java_operator">=</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">DAY</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Calendar</span><span class="java_plain">&nbsp;lastUpdated</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5208"/>4.7.9. Defining bridges</h3></div></div></div><p>It is possible to associate bridges to programmatically defined
      fields. When you define a <code class="methodname">field()</code>
      programmatically you can use the <code class="methodname">bridge(Class&lt;?&gt;
      impl)</code> to associate a <code class="classname">FieldBridge
      </code>implementation class. The bridge method also provides
      optional methods to include any parameters required for the bridge
      class. The below shows an example of programmatically defining a
      bridge:</p><div class="example"><a id="d0e5222"/><p class="title"><b>Example 4.46. Defining field bridges programmatically</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Address</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;addressId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;street1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;street1_abridged&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.bridge( ConcatStringBridge.class )
                    .param( "size", "4" )<span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The above can equally be defined using annotations, as seen in the
      next example.</p><div class="example"><a id="d0e5232"/><p class="title"><b>Example 4.47. Defining field bridges using annotation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Address</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Long</span><span class="java_plain">&nbsp;addressId</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Fields</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;street1_abridged&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bridge&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">FieldBridge</span><span class="java_separator">(</span><span class="java_plain">&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">ConcatStringBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;size&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;4&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">))</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;address1</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5237"/>4.7.10. Mapping class bridge</h3></div></div></div><p>You can define class bridges on entities programmatically. This is
      shown in the next example:</p><div class="example"><a id="d0e5242"/><p class="title"><b>Example 4.48. Defining class briges using API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">Departments</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
       .classBridge(CatDeptsFieldsClassBridge.class)
         .name("branchnetwork")
         .index(Index.YES)
         .store(Store.YES)
         .param("sepChar", " ")
      .classBridge(EquipmentType.class)
         .name("equiptype")
         .index(Index.YES)
         .store(Store.YES)
         .param("C", "Cisco")
         .param("D", "D-Link")
         .param("K", "Kingston")
         .param("3", "3Com")</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span>
</pre></div></div><br class="example-break"/><p>The above is similar to using <code class="classname">@ClassBridge
      </code>as seen in the next example:</p><div class="example"><a id="d0e5255"/><p class="title"><b>Example 4.49. Using @ClassBridge</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">ClassBridges</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ClassBridge</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;branchnetwork&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;store</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CatDeptsFieldsClassBridge</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;sepChar&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">ClassBridge</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;equiptype&quot;</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;store</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">EquipmentType</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;C&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;Cisco&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;D&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;D-Link&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;K&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;Kingston&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;name</span><span class="java_operator">=</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value</span><span class="java_operator">=</span><span class="java_literal">&quot;3Com&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Departments</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_separator">....</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5260"/>4.7.11. Mapping dynamic boost</h3></div></div></div><p>You can apply a dynamic boost factor on either a field or a whole
      entity:</p><div class="example"><a id="d0e5265"/><p class="title"><b>Example 4.50. DynamicBoost mapping using programmatic model</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_plain">&nbsp;mapping&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">new</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SearchMapping</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">mapping</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">entity</span><span class="java_separator">(</span><span class="java_type">DynamicBoostedDescLibrary</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">indexed</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span>.dynamicBoost(CustomBoostStrategy.class)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;libraryId&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">documentId</span><span class="java_separator">().</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;id&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">property</span><span class="java_separator">(</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">ElementType</span><span class="java_separator">.</span><span class="java_plain">FIELD</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>.dynamicBoost(CustomFieldBoostStrategy.class)<span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">field</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">store</span><span class="java_separator">(</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_plain">cfg</span><span class="java_separator">.</span><span class="java_plain">getProperties</span><span class="java_separator">().</span><span class="java_plain">put</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;hibernate.search.model_mapping&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;mapping&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The next example shows the equivalent mapping using the
      <code class="classname">@DynamicBoost</code> annotation:</p><div class="example"><a id="d0e5281"/><p class="title"><b>Example 4.51. Using the @DynamicBoost</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">DynamicBoost</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomBoostStrategy</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">DynamicBoostedDescriptionLibrary</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DocumentId</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">float</span><span class="java_plain">&nbsp;dynScore</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">store&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;@</span><span class="java_type">DynamicBoost</span><span class="java_separator">(</span><span class="java_plain">impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomFieldBoostStrategy</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DynamicBoostedDescriptionLibrary</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;dynScore&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">1.0f</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.......</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-query"/>Chapter 5. Querying</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#section-building-lucene-queries">5.1. Building queries</a></span></dt><dd><dl><dt><span class="section"><a href="#search-query-lucene-api">5.1.1. Building a Lucene query using the Lucene API</a></span></dt><dt><span class="section"><a href="#search-query-querydsl">5.1.2. Building a Lucene query with the Hibernate Search query
      DSL</a></span></dt><dt><span class="section"><a href="#d0e5677">5.1.3. Building a Hibernate Search query</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6119">5.2. Retrieving the results</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6136">5.2.1. Performance considerations</a></span></dt><dt><span class="section"><a href="#d0e6182">5.2.2. Result size</a></span></dt><dt><span class="section"><a href="#d0e6213">5.2.3. ResultTransformer</a></span></dt><dt><span class="section"><a href="#d0e6239">5.2.4. Understanding results</a></span></dt></dl></dd><dt><span class="section"><a href="#query-filter">5.3. Filters</a></span></dt><dd><dl><dt><span class="section"><a href="#query-filter-shard">5.3.1. Using filters in a sharded environment</a></span></dt></dl></dd><dt><span class="section"><a href="#query-faceting">5.4. Faceting</a></span></dt><dd><dl><dt><span class="section"><a href="#section-creating-faceting-request">5.4.1. Creating a faceting request</a></span></dt><dt><span class="section"><a href="#section-sorting-faceting-request">5.4.2. Setting the facet sort order</a></span></dt><dt><span class="section"><a href="#section-applying-faceting-request">5.4.3. Applying a faceting request</a></span></dt><dt><span class="section"><a href="#section-interpreting-facet-result">5.4.4. Interpreting a <code class="classname">Facet</code> result</a></span></dt><dt><span class="section"><a href="#d0e6894">5.4.5. Restricting query results</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e6932">5.5. Optimizing the query process</a></span></dt><dd><dl><dt><span class="section"><a href="#query-fieldcaches">5.5.1. Caching index values: FieldCache</a></span></dt></dl></dd></dl></div><p>The second most important capability of Hibernate Search is the
  ability to execute Lucene queries and retrieve entities managed by a
  Hibernate session. The search provides the power of Lucene without leaving
  the Hibernate paradigm, giving another dimension to the Hibernate classic
  search mechanisms (HQL, Criteria query, native SQL query).</p><p>Preparing and executing a query consists of four simple steps:</p><div class="itemizedlist"><ul><li><p>Creating a <code class="classname">FullTextSession</code></p></li><li><p>Creating a Lucene query either via the Hibernate Search query DSL
      (recommended) or by utilizing the Lucene query API</p></li><li><p>Wrapping the Lucene query using an
      <code class="classname">org.hibernate.Query</code></p></li><li><p>Executing the search by calling for example
      <code class="methodname">list()</code> or
      <code class="methodname">scroll()</code></p></li></ul></div><p>To access the querying facilities, you have to use a
  <code class="classname">FullTextSession</code>. This Search specific session wraps a
  regular <code class="classname">org.hibernate.Session</code> in order to provide
  query and indexing capabilities.</p><div class="example"><a id="d0e5324"/><p class="title"><b>Example 5.1. Creating a FullTextSession</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Session</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;sessionFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">openSession</span><!-- <br/> --><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">FullTextSession</span><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextSession</span><span class="java_separator">(</span><span class="java_plain">session</span><span class="java_separator">);</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>Once you have a <code class="classname">FullTextSession</code> you have two
  options to build the full-text query: the Hibernate Search query DSL or the
  native Lucene query.</p><p>If you use the Hibernate Search query DSL, it will look like
  this:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;b&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_type">Myth</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;b</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">).</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;a&nbsp;list&nbsp;of&nbsp;managed&nbsp;objects</span>
</pre><p>You can alternatively write your Lucene query either using the Lucene
  query parser or Lucene programmatic API.</p><div class="example"><a id="d0e5340"/><p class="title"><b>Example 5.2. Creating a Lucene query via the
    <code class="classname">QueryParser</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_type">SearchFactory</span><span class="java_plain">&nbsp;searchFactory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">queryParser</span><span class="java_separator">.</span><span class="java_type">QueryParser</span><span class="java_plain">&nbsp;parser&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">QueryParser</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;searchFactory</span><span class="java_separator">.</span><span class="java_plain">getAnalyzer</span><span class="java_separator">(</span><span class="java_type">Myth</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;parser</span><span class="java_separator">.</span><span class="java_plain">parse</span><span class="java_separator">(</span><span class="java_literal">&quot;history:storm^3&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">ParseException</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">handle&nbsp;parsing&nbsp;failure</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;a&nbsp;list&nbsp;of&nbsp;managed&nbsp;objects&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The Hibernate query built on top of the Lucene query is a regular
    <code class="literal">org.hibernate.Query</code>, which means you are in the same
    paradigm as the other Hibernate query facilities (HQL, Native or
    Criteria). The regular <code class="literal">list()</code> ,
    <code class="literal">uniqueResult()</code>, <code class="literal">iterate()</code> and
    <code class="literal">scroll()</code> methods can be used.</p></div><p>In case you are using the Java Persistence APIs of Hibernate, the same
  extensions exist:</p><div class="example"><a id="d0e5367"/><p class="title"><b>Example 5.3. Creating a Search query using the JPA API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">EntityManager</span><!-- <br/> --><span class="java_plain">&nbsp;em&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;entityManagerFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createEntityManager</span><!-- <br/> --><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">FullTextEntityManager</span><span class="java_plain">&nbsp;fullTextEntityManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">jpa</span><span class="java_separator">.</span><span class="java_type">Search</span><span class="java_separator">.</span><span class="java_plain">getFullTextEntityManager</span><span class="java_separator">(</span><span class="java_plain">em</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">...</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;b&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextEntityManager</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Myth</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;b</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">).</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
javax.persistence.Query fullTextQuery = 
    fullTextEntityManager.createFullTextQuery( luceneQuery );</span>
</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;a&nbsp;list&nbsp;of&nbsp;managed&nbsp;objects&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The following examples we will use the Hibernate APIs but the same
    example can be easily rewritten with the Java Persistence API by just
    adjusting the way the <code class="classname">FullTextQuery</code> is
    retrieved.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="section-building-lucene-queries"/>5.1. Building queries</h2></div></div></div><p>Hibernate Search queries are built on top of Lucene queries which
    gives you total freedom on the type of Lucene query you want to execute.
    However, once built, Hibernate Search wraps further query processing using
    <code class="classname">org.hibernate.Query</code> as your primary query
    manipulation API.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-query-lucene-api"/>5.1.1. Building a Lucene query using the Lucene API</h3></div></div></div><p>Using the Lucene API, you have several options. You can use the
      query parser (fine for simple queries) or the Lucene programmatic API
      (for more complex use cases). It is out of the scope of this
      documentation on how to exactly build a Lucene query. Please refer to
      the online Lucene documentation or get hold of a copy of Lucene In
      Action or Hibernate Search in Action.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-query-querydsl"/>5.1.2. Building a Lucene query with the Hibernate Search query
      DSL</h3></div></div></div><p>Writing full-text queries with the Lucene programmatic API is
      quite complex. It's even more complex to understand the code once
      written. Besides the inherent API complexity, you have to remember to
      convert your parameters to their string equivalent as well as make sure
      to apply the correct analyzer to the right field (a ngram analyzer will
      for example use several ngrams as the tokens for a given word and should
      be searched as such).</p><p>The Hibernate Search query DSL makes use of a style of API called
      a fluent API. This API has a few key characteristics:</p><div class="itemizedlist"><ul><li><p>it has meaningful method names making a succession of
          operations reads almost like English</p></li><li><p>it limits the options offered to what makes sense in a given
          context (thanks to strong typing and IDE autocompletion).</p></li><li><p>It often uses the chaining method pattern</p></li><li><p>it's easy to use and even easier to read</p></li></ul></div><p>Let's see how to use the API. You first need to create a query
      builder that is attached to a given indexed entity type. This
      <code class="classname">QueryBuilder</code> will know what analyzer to use and
      what field bridge to apply. You can create several
      <code class="classname">QueryBuilder</code>s (one for each entity type involved
      in the root of your query). You get the
      <code class="classname">QueryBuilder</code> from the
      <code class="classname">SearchFactory</code>.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;searchFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildQueryBuilder</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">forEntity</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Myth</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">get</span><!-- <br/> --><span class="java_separator">();</span></pre><p>You can also override the analyzer used for a given field or
      fields. This is rarely needed and should be avoided unless you know what
      you are doing.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;searchFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">buildQueryBuilder</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Myth</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">overridesForField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">,</span><span class="java_literal">&quot;stem_analyzer_definition&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span></pre><p>Using the query builder, you can then build queries. It is
      important to realize that the end result of a
      <code class="classname">QueryBuilder</code> is a Lucene query. For this reason
      you can easily mix and match queries generated via Lucene's query parser
      or <code class="classname">Query</code> objects you have assembled with the
      Lucene programmatic API and use them with the Hibernate Search DSL. Just
      in case the DSL is missing some features.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5442"/>5.1.2.1. Keyword queries</h4></div></div></div><p>Let's start with the most basic use case - searching for a
        specific word:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">keyword</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">onField</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;history&quot;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">matching</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">&quot;storm&quot;</span><!-- <br/> --><span class="java_separator">).</span><!-- <br/> --><span class="java_plain">createQuery</span><!-- <br/> --><span class="java_separator">();</span></pre><p><code class="methodname">keyword()</code> means that you are trying to
        find a specific word. <code class="methodname">onField()</code> specifies in
        which Lucene field to look. <code class="methodname">matching()</code> tells
        what to look for. And finally <code class="methodname">createQuery()</code>
        creates the Lucene query object. A lot is going on with this line of
        code.</p><div class="itemizedlist"><ul><li><p>The value storm is passed through the
            <code class="literal">history</code> <code class="classname">FieldBridge</code>: it
            does not matter here but you will see that it's quite handy when
            dealing with numbers or dates.</p></li><li><p>The field bridge value is then passed to the analyzer used
            to index the field <code class="literal">history</code>. This ensures that
            the query uses the same term transformation than the indexing
            (lower case, n-gram, stemming and so on). If the analyzing process
            generates several terms for a given word, a boolean query is used
            with the <code class="literal">SHOULD</code> logic (roughly an
            <code class="literal">OR</code> logic).</p></li></ul></div><p>Let's see how you can search a property that is not of type
        string.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Myth</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">YEAR</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;getCreationDate</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;creationDate</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;setCreationDate</span><span class="java_separator">(</span><span class="java_type">Date</span><span class="java_plain">&nbsp;creationDate</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">creationDate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;creationDate</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;creationDate</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">Date</span><span class="java_plain">&nbsp;birthdate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQb</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;creationDate&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_plain">birthdate</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>In plain Lucene, you would have had to convert the
          <code class="classname">Date</code> object to its string representation (in
          this case the year).</p></div><p>This conversion works for any object, not just
        <code class="classname">Date</code>, provided that the
        <code class="classname">FieldBridge</code> has an
        <code class="methodname">objectToString</code> method (and all built-in
        <code class="classname">FieldBridge</code> implementations do).</p><p>We make the example a little more advanced now and have a look
        at how to search a field that uses ngram analyzers. ngram analyzers
        index succession of ngrams of your words which helps to recover from
        user typos. For example the 3-grams of the word hibernate are hib,
        ibe, ber, rna, nat, ate.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">AnalyzerDef</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">name&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">&quot;ngram&quot;</span><!-- <br/> --><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;tokenizer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;@</span><span class="java_type">TokenizerDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardTokenizerFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;filters&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">LowerCaseFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">StopFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">TokenFilterDef</span><span class="java_separator">(</span><span class="java_plain">factory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">NGramFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;minGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">),</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Parameter</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;maxGramSize&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;value&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;3&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Myth</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyzer</span><span class="java_operator">=</span><span class="java_plain">@</span><span class="java_type">Analyzer</span><span class="java_separator">(</span><span class="java_plain">definition</span><span class="java_operator">=</span><span class="java_literal">&quot;ngram&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">YEAR</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getName</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;setName</span><span class="java_separator">(</span><span class="java_type">Date</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">Date</span><span class="java_plain">&nbsp;birthdate&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQb</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;Sisiphus&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</pre><p>The matching word "Sisiphus" will be lower-cased and then split
        into 3-grams: sis, isi, sip, phu, hus. Each of these n-gram will be
        part of the query. We will then be able to find the Sysiphus myth
        (with a <code class="literal">y</code>). All that is transparently done for
        you.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>If for some reason you do not want a specific field to use the
          field bridge or the analyzer you can call the
          <code class="methodname">ignoreAnalyzer()</code> or
          <code class="methodname">ignoreFieldBridge()</code> functions</p></div><p>To search for multiple possible words in the same field, simply
        add them all in the matching clause.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">search&nbsp;document&nbsp;with&nbsp;storm&nbsp;or&nbsp;lightning&nbsp;in&nbsp;their&nbsp;history</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&nbsp;lightning&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p>To search the same word on multiple fields, use the
        <code class="methodname">onFields</code> method.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onFields</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">,</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">,</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p>Sometimes, one field should be treated differently from another
        field even if searching the same term, you can use the
        <code class="methodname">andField()</code> method for that.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">keyword</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">andField</span><span class="java_separator">(</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">5</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">andField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;storm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p>In the previous example, only field name is boosted to 5.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5546"/>5.1.2.2. Fuzzy queries</h4></div></div></div><p>To execute a fuzzy query (based on the Levenshtein distance
        algorithm), start like a <code class="literal">keyword</code> query and add the
        fuzzy flag.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">fuzzy</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">withThreshold</span><span class="java_separator">(</span><span class="java_literal">.8f</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">withPrefixLength</span><span class="java_separator">(</span><span class="java_literal">1</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;starm&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p><code class="literal">threshold</code> is the limit above which two terms
        are considering matching. It's a decimal between 0 and 1 and defaults
        to 0.5. <code class="literal">prefixLength</code> is the length of the prefix
        ignored by the "fuzzyness": while it defaults to 0, a non zero value
        is recommended for indexes containing a huge amount of distinct
        terms.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5563"/>5.1.2.3. Wildcard queries</h4></div></div></div><p>You can also execute wildcard queries (queries where some of
        parts of the word are unknown). <code class="literal">?</code> represents a
        single character and <code class="literal">*</code> represents any character
        sequence. Note that for performance purposes, it is recommended that
        the query does not start with either <code class="literal">?</code> or
        <code class="literal">*</code>.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">wildcard</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;sto*&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Wildcard queries do not apply the analyzer on the matching
          terms. Otherwise the risk of <code class="literal">*</code> or
          <code class="literal">?</code> being mangled is too high.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5591"/>5.1.2.4. Phrase queries</h4></div></div></div><p>So far we have been looking for words or sets of words, you can
        also search exact or approximate sentences. Use
        <code class="methodname">phrase()</code> to do so.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">phrase</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">sentence</span><span class="java_separator">(</span><span class="java_literal">&quot;Thou&nbsp;shalt&nbsp;not&nbsp;kill&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre><p>You can search approximate sentences by adding a slop factor.
        The slop factor represents the number of other words permitted in the
        sentence: this works like a within or near operator</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">phrase</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">withSlop</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;history&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">sentence</span><span class="java_separator">(</span><span class="java_literal">&quot;Thou&nbsp;kill&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5605"/>5.1.2.5. Range queries</h4></div></div></div><p>After looking at all these query examples for searching for to a
        given word, it is time to introduce range queries (on numbers, dates,
        strings etc). A range query searches for a value in between given
        boundaries (included or not) or for a value below or above a given
        boundary (included or not).</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">look&nbsp;</span><!-- <br/> --><span class="java_keyword">for</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">0</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;=</span><!-- <br/> --><span class="java_plain">&nbsp;starred&nbsp;</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">3</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;starred&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">).</span><span class="java_plain">to</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">).</span><span class="java_plain">excludeLimit</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">look&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;myths&nbsp;strictly&nbsp;BC</span>
<!--  --><br/><span class="java_type">Date</span><span class="java_plain">&nbsp;beforeChrist&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;creationDate&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">below</span><span class="java_separator">(</span><span class="java_plain">beforeChrist</span><span class="java_separator">).</span><span class="java_plain">excludeLimit</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5612"/>5.1.2.6. Combining queries</h4></div></div></div><p>Finally, you can aggregate (combine) queries to create more
        complex queries. The following aggregation operators are
        available:</p><div class="itemizedlist"><ul><li><p><code class="literal">SHOULD</code>: the query query should contain
            the matching elements of the subquery</p></li><li><p><code class="literal">MUST</code>: the query must contain the matching
            elements of the subquery</p></li><li><p><code class="literal">MUST NOT</code>: the query must not contain the
            matching elements of the subquery</p></li></ul></div><p>The subqueries can be any Lucene query including a boolean query
        itself. Let's look at a few examples:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">look&nbsp;</span><!-- <br/> --><span class="java_keyword">for</span><!-- <br/> --><span class="java_plain">&nbsp;popular&nbsp;modern&nbsp;myths&nbsp;that&nbsp;are&nbsp;not&nbsp;urban</span>
<!--  --><br/><span class="java_type">Date</span><span class="java_plain">&nbsp;twentiethCentury&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">bool</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;urban&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">not</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;starred&quot;</span><span class="java_separator">).</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_literal">4</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;creationDate&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_plain">twentiethCentury</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">look&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;popular&nbsp;myths&nbsp;that&nbsp;are&nbsp;preferably&nbsp;urban</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">bool</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">should</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;urban&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;starred&quot;</span><span class="java_separator">).</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_literal">4</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">look&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;all&nbsp;myths&nbsp;except&nbsp;religious&nbsp;ones</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">all</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">except</span><span class="java_separator">(</span><span class="java_plain">&nbsp;monthQb</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;description_stem&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;religion&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5637"/>5.1.2.7. Query options</h4></div></div></div><p>We already have seen several query options in the previous
        example, but lets summarize again the options for query types and
        fields:</p><div class="itemizedlist"><ul><li><p><code class="methodname">boostedTo</code> (on query type and on
            field): boost the whole query or the specific field to a given
            factor</p></li><li><p><code class="methodname">withConstantScore</code> (on query): all
            results matching the query have a constant score equals to the
            boost</p></li><li><p><code class="methodname">filteredBy(Filter)</code> (on query):
            filter query results using the <code class="classname">Filter</code>
            instance</p></li><li><p><code class="methodname">ignoreAnalyzer</code> (on field): ignore
            the analyzer when processing this field</p></li><li><p><code class="methodname">ignoreFieldBridge</code> (on field):
            ignore field bridge when processing this field</p></li></ul></div><p>Let's check out an example using some of these options</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">bool</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">should</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">().</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;description&quot;</span><span class="java_separator">).</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;urban&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">should</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">keyword</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;name&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">ignoreAnalyzer</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">matching</span><span class="java_separator">(</span><span class="java_literal">&quot;urban&quot;</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">must</span><span class="java_separator">(</span><span class="java_plain">&nbsp;mythQB</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">boostedTo</span><span class="java_separator">(</span><span class="java_literal">5</span><span class="java_separator">).</span><span class="java_plain">withConstantScore</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;starred&quot;</span><span class="java_separator">).</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_literal">4</span><span class="java_separator">).</span><span class="java_plain">createQuery</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</pre><p>As you can see, the Hibernate Search query DSL is an easy to use
        and easy to read query API and by accepting and producing Lucene
        queries, you can easily incorporate query types not (yet) supported by
        the DSL. Please give us feedback!</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e5677"/>5.1.3. Building a Hibernate Search query</h3></div></div></div><p>So far we only covered the process of how to create your Lucene
      query (see <a href="#section-building-lucene-queries" title="5.1. Building queries">Section 5.1, “Building queries”</a>). However,
      this is only the first step in the chain of actions. Let's now see how
      to build the Hibernate Search query from the Lucene query.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5684"/>5.1.3.1. Generality</h4></div></div></div><p>Once the Lucene query is built, it needs to be wrapped into an
        Hibernate Query. If not specified otherwise, the query will be
        executed against all indexed entities, potentially returning all types
        of indexed classes.</p><div class="example"><a id="d0e5689"/><p class="title"><b>Example 5.4. Wrapping a Lucene query into a Hibernate Query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;session&nbsp;</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>It is advised, from a performance point of view, to restrict the
        returned types:</p><div class="example"><a id="example-filtering-by-entity-type"/><p class="title"><b>Example 5.5. Filtering the search result by entity type</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or</span>
</span>
<!--  --><br/><span class="java_plain">fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Item</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Actor</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>In <a href="#example-filtering-by-entity-type" title="Example 5.5. Filtering the search result by entity type">Example 5.5, “Filtering the search result by entity type”</a> the first
        example returns only matching <code class="classname">Customer</code>s, the
        second returns matching <code class="classname">Actor</code>s and
        <code class="classname">Item</code>s. The type restriction is fully
        polymorphic which means that if there are two indexed subclasses
        <code class="classname">Salesman</code> and <code class="classname">Customer</code> of
        the baseclass <code class="classname">Person</code>, it is possible to just
        specify <code class="classname">Person.class</code> in order to filter on
        result types.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5726"/>5.1.3.2. Pagination</h4></div></div></div><p>Out of performance reasons it is recommended to restrict the
        number of returned objects per query. In fact is a very common use
        case anyway that the user navigates from one page to an other. The way
        to define pagination is exactly the way you would define pagination in
        a plain HQL or Criteria query.</p><div class="example"><a id="d0e5731"/><p class="title"><b>Example 5.6. Defining pagination for a search query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">setFirstResult</span><span class="java_separator">(</span><span class="java_literal">15</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">start&nbsp;from&nbsp;the&nbsp;</span><span class="java_literal">15</span><span class="java_plain">th&nbsp;element</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">setMaxResults</span><span class="java_separator">(</span><span class="java_literal">10</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_plain">&nbsp;elements</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>It is still possible to get the total number of matching
          elements regardless of the pagination via
          <code class="methodname">fulltextQuery.</code><code class="methodname">getResultSize()</code></p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5743"/>5.1.3.3. Sorting</h4></div></div></div><p>Apache Lucene provides a very flexible and powerful way to sort
        results. While the default sorting (by relevance) is appropriate most
        of the time, it can be interesting to sort by one or several other
        properties. In order to do so set the Lucene Sort object to apply a
        Lucene sorting strategy.</p><div class="example"><a id="d0e5748"/><p class="title"><b>Example 5.7. Specifying a Lucene <code class="classname">Sort</code> in order to
          sort the results</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Sort</span><span class="java_plain">&nbsp;sort&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Sort</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">SortField</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">SortField</span><span class="java_separator">.</span><span class="java_plain">STRING</span><span class="java_separator">));</span>
query.setSort(sort);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
</pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Be aware that fields used for sorting must not be tokenized
          (see <a href="#field-annotation" title="4.1.1.2. @Field">Section 4.1.1.2, “@Field”</a>).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5764"/>5.1.3.4. Fetching strategy</h4></div></div></div><p>When you restrict the return types to one class, Hibernate
        Search loads the objects using a single query. It also respects the
        static fetching strategy defined in your domain model.</p><p>It is often useful, however, to refine the fetching strategy for
        a specific use case.</p><div class="example"><a id="d0e5771"/><p class="title"><b>Example 5.8. Specifying <code class="classname">FetchMode</code> on a
          query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Criteria</span><!-- <br/> --><span class="java_plain">&nbsp;criteria&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createCriteria</span><span class="java_separator">(</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">setFetchMode</span><span class="java_separator">(</span><span class="java_literal">&quot;authors&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">FetchMode</span><span class="java_separator">.</span><span class="java_plain">JOIN</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">).</span><span class="java_plain">setCriteriaQuery</span><span class="java_separator">(</span><span class="java_plain">criteria</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>In this example, the query will return all Books matching the
        luceneQuery. The authors collection will be loaded from the same query
        using an SQL outer join.</p><p>When defining a criteria query, it is not necessary to restrict
        the returned entity types when creating the Hibernate Search query
        from the full text session: the type is guessed from the criteria
        query itself.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Only fetch mode can be adjusted, refrain from applying any
          other restriction. While it is known to work as of Hibernate Search
          4, using restriction (ie a where clause) on your
          <code class="classname">Criteria</code> query should be avoided when
          possible. <code class="methodname">getResultSize()</code> will throw a
          <code class="classname">SearchException</code> if used in conjunction with a
          <code class="classname">Criteria</code> with restriction.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>You cannot use <code class="methodname">setCriteriaQuery</code> if
          more than one entity type is expected to be returned.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="projections"/>5.1.3.5. Projection</h4></div></div></div><p>For some use cases, returning the domain object (including its
        associations) is overkill. Only a small subset of the properties is
        necessary. Hibernate Search allows you to return a subset of
        properties:</p><div class="example"><a id="d0e5809"/><p class="title"><b>Example 5.9. Using projection instead of returning the full domain
          object</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span>setProjection("id", "summary", "body", "mainAuthor.name")<span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;firstResult&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_separator">[])</span><span class="java_plain">&nbsp;results</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Integer</span><span class="java_plain">&nbsp;id&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">0</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;summary&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">1</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;body&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">2</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;authorName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">3</span><span class="java_separator">];</span></pre></div></div><br class="example-break"/><p>Hibernate Search extracts the properties from the Lucene index
        and convert them back to their object representation, returning a list
        of <code class="classname">Object[]</code>. Projections avoid a potential
        database round trip (useful if the query response time is critical).
        However, it also has several constraints:</p><div class="itemizedlist"><ul><li><p>the properties projected must be stored in the index
            (<code class="literal">@Field(store=Store.YES)</code>), which increases the
            index size</p></li><li><p>the properties projected must use a
            <code class="literal">FieldBridge</code> implementing
            <code class="classname">org.hibernate.search.bridge.TwoWayFieldBridge</code>
            or
            <code class="literal">org.hibernate.search.bridge.TwoWayStringBridge</code>,
            the latter being the simpler version.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>All Hibernate Search built-in types are two-way.</p></div></li><li><p>you can only project simple properties of the indexed entity
            or its embedded associations. This means you cannot project a
            whole embedded entity.</p></li><li><p>projection does not work on collections or maps which are
            indexed via <code class="classname">@IndexedEmbedded</code></p></li></ul></div><p>Projection is also useful for another kind of use case. Lucene
        can provide metadata information about the results. By using some
        special projection constants, the projection mechanism can retrieve
        this metadata:</p><div class="example"><a id="d0e5854"/><p class="title"><b>Example 5.10. Using projection in order to retrieve meta data</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span>setProjection( 
    FullTextQuery.SCORE, 
    FullTextQuery.THIS, 
    "mainAuthor.name" )<span class="java_separator">;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;firstResult&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_separator">[])</span><span class="java_plain">&nbsp;results</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">float</span><span class="java_plain">&nbsp;score&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">0</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">Book</span><span class="java_plain">&nbsp;book&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">1</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_type">String</span><span class="java_plain">&nbsp;authorName&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;firstResult</span><span class="java_separator">[</span><span class="java_literal">2</span><span class="java_separator">];</span></pre></div></div><br class="example-break"/><p>You can mix and match regular fields and projection constants.
        Here is the list of the available constants:</p><div class="itemizedlist"><ul><li><p><code class="classname">FullTextQuery.THIS</code>: returns the
            initialized and managed entity (as a non projected query would
            have done).</p></li><li><p><code class="classname">FullTextQuery.DOCUMENT</code>: returns the
            Lucene Document related to the object projected.</p></li><li><p><code class="classname">FullTextQuery.OBJECT_CLASS</code>: returns
            the class of the indexed entity.</p></li><li><p><code class="classname">FullTextQuery.SCORE</code>: returns the
            document score in the query. Scores are handy to compare one
            result against an other for a given query but are useless when
            comparing the result of different queries.</p></li><li><p><code class="classname">FullTextQuery.ID</code>: the id property
            value of the projected object.</p></li><li><p><code class="classname">FullTextQuery.DOCUMENT_ID</code>: the Lucene
            document id. Careful, Lucene document id can change overtime
            between two different IndexReader opening.</p></li><li><p><code class="classname">FullTextQuery.EXPLANATION</code>: returns
            the Lucene Explanation object for the matching object/document in
            the given query. Do not use if you retrieve a lot of data. Running
            explanation typically is as costly as running the whole Lucene
            query per matching element. Make sure you use projection!</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e5900"/>5.1.3.6. Customizing object initialization strategies</h4></div></div></div><p>By default, Hibernate Search uses the most appropriate strategy
        to initialize entities matching your full text query. It executes one
        (or several) queries to retrieve the required entities. This is the
        best approach to minimize database round trips in a scenario where
        none / few of the retrieved entities are present in the persistence
        context (ie the session) or the second level cache.</p><p>If most of your entities are present in the second level cache,
        you can force Hibernate Search to look into the cache before
        retrieving an object from the database.</p><div class="example"><a id="d0e5907"/><p class="title"><b>Example 5.11. Check the second-level cache before using a query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;session</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createFullTextQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">luceneQuery</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">User</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">initializeObjectWith</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">ObjectLookupMethod</span><span class="java_separator">.</span><span class="java_plain">SECOND_LEVEL_CACHE</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">DatabaseRetrievalMethod</span><span class="java_separator">.</span><span class="java_plain">QUERY</span>
<!--  --><br/><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p><code class="classname">ObjectLookupMethod</code> defines the strategy
        used to check if an object is easily accessible (without database
        round trip). Other options are:</p><div class="itemizedlist"><ul><li><p><code class="literal">ObjectLookupMethod.PERSISTENCE_CONTEXT</code>:
            useful if most of the matching entities are already in the
            persistence context (ie loaded in the
            <code class="classname">Session</code> or
            <code class="classname">EntityManager</code>)</p></li><li><p><code class="literal">ObjectLookupMethod.SECOND_LEVEL_CACHE</code>:
            check first the persistence context and then the second-level
            cache.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Note that to search in the second-level cache, several
          settings must be in place:</p><div class="itemizedlist"><ul><li><p>the second level cache must be properly configured and
              active</p></li><li><p>the entity must have enabled second-level cache (eg via
              <code class="classname">@Cacheable</code>)</p></li><li><p>the <code class="classname">Session</code>,
              <code class="classname">EntityManager</code> or
              <code class="classname">Query</code> must allow access to the
              second-level cache for read access (ie
              <code class="literal">CacheMode.NORMAL</code> in Hibernate native APIs or
              <code class="literal">CacheRetrieveMode.USE</code> in JPA 2 APIs).</p></li></ul></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Avoid using
          <code class="literal">ObjectLookupMethod.SECOND_LEVEL_CACHE</code> unless your
          second level cache implementation is either EHCache or Infinispan;
          other second level cache providers don't currently implement this
          operation efficiently.</p></div><p>You can also customize how objects are loaded from the database
        (if not found before). Use
        <code class="classname">DatabaseRetrievalMethod</code> for that:</p><div class="itemizedlist"><ul><li><p><code class="classname">QUERY</code> (default): use a (set of)
            queries to load several objects in batch. This is usually the best
            approach.</p></li><li><p><code class="classname">FIND_BY_ID</code>: load objects one by one
            using the
            <code class="classname">Session</code>.<code class="methodname">get</code> or
            <code class="classname">EntityManager</code>.<code class="methodname">find</code>
            semantic. This might be useful if batch-size is set on the entity
            (in which case, entities will be loaded in batch by Hibernate
            Core). <code class="classname">QUERY</code> should be preferred almost all
            the time.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e6001"/>5.1.3.7. Limiting the time of a query</h4></div></div></div><p>You can limit the time a query takes in Hibernate Search in two
        ways:</p><div class="itemizedlist"><ul><li><p>raise an exception when the limit is reached</p></li><li><p>limit to the number of results retrieved when the time limit
            is raised</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6013"/>5.1.3.7.1. Raise an exception on time limit</h5></div></div></div><p>You can decide to stop a query if when it takes more than a
          predefined amount of time. Note that this is a best effort basis but
          if Hibernate Search still has significant work to do and if we are
          beyond the time limit, a
          <code class="classname">QueryTimeoutException</code> will be raised
          (<code class="classname">org.hibernate.QueryTimeoutException</code> or
          <code class="classname">javax.persistence.QueryTimeoutException</code>
          depending on your programmatic API).</p><p>To define the limit when using the native Hibernate APIs, use
          one of the following approaches</p><div class="example"><a id="d0e6029"/><p class="title"><b>Example 5.12. Defining a timeout in query execution</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;seconds</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setTimeout</span><span class="java_separator">(</span><span class="java_literal">5</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">alternatively</span><span class="java_separator">,</span><span class="java_plain">&nbsp;define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;any&nbsp;given&nbsp;time&nbsp;unit</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setTimeout</span><span class="java_separator">(</span><span class="java_literal">450</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeUnit</span><span class="java_separator">.</span><span class="java_plain">MILLISECONDS</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">QueryTimeoutException</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;something</span><span class="java_separator">,</span><span class="java_plain">&nbsp;too&nbsp;slow</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Likewise <code class="literal">getResultSize()</code>,
          <code class="methodname">iterate()</code> and
          <code class="methodname">scroll()</code> honor the timeout but only until
          the end of the method call. That simply means that the methods of
          <code class="classname">Iterable</code> or the
          <code class="classname">ScrollableResults</code> ignore the timeout.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><code class="methodname">explain()</code> does not honor the
            timeout: this method is used for debug purposes and in particular
            to find out why a query is slow</p></div><p>When using JPA, simply use the standard way of limiting query
          execution time.</p><div class="example"><a id="d0e6058"/><p class="title"><b>Example 5.13. Defining a timeout in query execution</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextEM</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;milliseconds</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setHint</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;javax.persistence.query.timeout&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">450</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">javax</span><span class="java_separator">.</span><span class="java_plain">persistence</span><span class="java_separator">.</span><span class="java_type">QueryTimeoutException</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_keyword">do</span><span class="java_plain">&nbsp;something</span><span class="java_separator">,</span><span class="java_plain">&nbsp;too&nbsp;slow</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Remember, this is a best effort approach and does not
            guarantee to stop exactly on the specified timeout.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="d0e6066"/>5.1.3.7.2. Limit the number of results when the time limit is
          reached</h5></div></div></div><p>Alternatively, you can return the number of results which have
          already been fetched by the time the limit is reached. Note that
          only the Lucene part of the query is influenced by this limit. It is
          possible that, if you retrieve managed object, it takes longer to
          fetch these objects.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>This approach is not compatible with the
            <code class="classname">setTimeout</code> approach.</p></div><p>To define this soft limit, use the following approach</p><div class="example"><a id="d0e6079"/><p class="title"><b>Example 5.14. Defining a time limit in query execution</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;seconds</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">limitExecutionTimeTo</span><span class="java_separator">(</span><span class="java_literal">500</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeUnit</span><span class="java_separator">.</span><span class="java_plain">MILLISECONDS</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Likewise <code class="literal">getResultSize()</code>,
          <code class="methodname">iterate()</code> and
          <code class="methodname">scroll()</code> honor the time limit but only
          until the end of the method call. That simply means that the methods
          of <code class="classname">Iterable</code> or the
          <code class="classname">ScrollableResults</code> ignore the timeout.</p><p>You can determine if the results have been partially loaded by
          invoking the <code class="methodname">hasPartialResults</code>
          method.</p><div class="example"><a id="d0e6106"/><p class="title"><b>Example 5.15. Determines when a query returns partial results</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Query</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">...;</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">define&nbsp;the&nbsp;timeout&nbsp;in&nbsp;seconds</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">limitExecutionTimeTo</span><span class="java_separator">(</span><span class="java_literal">500</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">TimeUnit</span><span class="java_separator">.</span><span class="java_plain">MILLISECONDS</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">hasPartialResults</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;displayWarningToUser</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>If you use the JPA API,
          <code class="methodname">limitExecutionTimeTo</code> and
          <code class="methodname">hasPartialResults</code> are also available to
          you.</p></div></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6119"/>5.2. Retrieving the results</h2></div></div></div><p>Once the Hibernate Search query is built, executing it is in no way
    different than executing a HQL or Criteria query. The same paradigm and
    object semantic applies. All the common operations are available:
    <code class="methodname">list()</code>, <code class="methodname">uniqueResult()</code>,
    <code class="methodname">iterate()</code>,
    <code class="methodname">scroll()</code>.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6136"/>5.2.1. Performance considerations</h3></div></div></div><p>If you expect a reasonable number of results (for example using
      pagination) and expect to work on all of them,
      <code class="methodname">list()</code> or
      <code class="methodname">uniqueResult()</code> are recommended.
      <code class="methodname">list()</code> work best if the entity
      <code class="literal">batch-size</code> is set up properly. Note that Hibernate
      Search has to process all Lucene Hits elements (within the pagination)
      when using <code class="methodname">list()</code> ,
      <code class="methodname">uniqueResult()</code> and
      <code class="methodname">iterate()</code>.</p><p>If you wish to minimize Lucene document loading,
      <code class="methodname">scroll()</code> is more appropriate. Don't forget to
      close the <code class="classname">ScrollableResults</code> object when you're
      done, since it keeps Lucene resources. If you expect to use
      <code class="methodname">scroll,</code> but wish to load objects in batch, you
      can use <code class="methodname">query.setFetchSize()</code>. When an object is
      accessed, and if not already loaded, Hibernate Search will load the next
      <code class="literal">fetchSize</code> objects in one pass.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Pagination is preferred over scrolling.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6182"/>5.2.2. Result size</h3></div></div></div><p>It is sometimes useful to know the total number of matching
      documents:</p><div class="itemizedlist"><ul><li><p>for the Google-like feature "1-10 of about 888,000,000"</p></li><li><p>to implement a fast pagination navigation</p></li><li><p>to implement a multi step search engine (adding approximation
          if the restricted query return no or not enough results)</p></li></ul></div><p>Of course it would be too costly to retrieve all the matching
      documents. Hibernate Search allows you to retrieve the total number of
      matching documents regardless of the pagination parameters. Even more
      interesting, you can retrieve the number of matching elements without
      triggering a single object load.</p><div class="example"><a id="d0e6199"/><p class="title"><b>Example 5.16. Determining the result size of a query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;the&nbsp;number&nbsp;of&nbsp;matching&nbsp;books&nbsp;without&nbsp;loading&nbsp;a&nbsp;single&nbsp;one</span>
<!--  --><br/><span class="java_keyword">assert</span><span class="java_plain">&nbsp;</span><span class="java_literal">3245</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span>query.getResultSize()<span class="java_separator">;</span><span class="java_plain">&nbsp;</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setMaxResult</span><span class="java_separator">(</span><span class="java_literal">10</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;matching&nbsp;books&nbsp;regardless&nbsp;of&nbsp;pagination</span>
<!--  --><br/><span class="java_keyword">assert</span><span class="java_plain">&nbsp;</span><span class="java_literal">3245</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span>query.getResultSize()<span class="java_separator">;</span><span class="java_plain">&nbsp;</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Like Google, the number of results is an approximation if the
        index is not fully up-to-date with the database (asynchronous cluster
        for example).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6213"/>5.2.3. ResultTransformer</h3></div></div></div><p>As seen in <a href="#projections" title="5.1.3.5. Projection">Section 5.1.3.5, “Projection”</a> projection results are
      returns as <code class="classname">Object</code> arrays. This data structure is
      not always matching the application needs. In this cases It is possible
      to apply a <code class="classname">ResultTransformer</code> which post query
      execution can build the needed data structure:</p><div class="example"><a id="d0e6226"/><p class="title"><b>Example 5.17. Using ResultTransformer in conjunction with projections</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;query&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;s</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Book</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">query</span><span class="java_separator">.</span><span class="java_plain">setProjection</span><span class="java_separator">(</span><span class="java_literal">&quot;title&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;mainAuthor.name&quot;</span><span class="java_separator">);</span>
query.setResultTransformer( 
    new StaticAliasToBeanResultTransformer( 
        BookView.class, 
        "title", 
        "author" ) 
);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">BookView</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">BookView</span><span class="java_operator">&gt;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">BookView</span><span class="java_plain">&nbsp;view&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;results</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;log</span><span class="java_separator">.</span><span class="java_plain">info</span><span class="java_separator">(</span><span class="java_literal">&quot;Book:&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;view</span><span class="java_separator">.</span><span class="java_plain">getTitle</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;,&nbsp;&quot;</span><span class="java_plain">&nbsp;</span><span class="java_operator">+</span><span class="java_plain">&nbsp;view</span><span class="java_separator">.</span><span class="java_plain">getAuthor</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Examples of <code class="classname">ResultTransformer</code>
      implementations can be found in the Hibernate Core codebase.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6239"/>5.2.4. Understanding results</h3></div></div></div><p>You will find yourself sometimes puzzled by a result showing up in
      a query or a result not showing up in a query. Luke is a great tool to
      understand those mysteries. However, Hibernate Search also gives you
      access to the Lucene <code class="classname">Explanation</code> object for a
      given result (in a given query). This class is considered fairly
      advanced to Lucene users but can provide a good understanding of the
      scoring of an object. You have two ways to access the Explanation object
      for a given result:</p><div class="itemizedlist"><ul><li><p>Use the <code class="methodname">fullTextQuery.explain(int)</code>
          method</p></li><li><p>Use projection</p></li></ul></div><p>The first approach takes a document id as a parameter and return
      the Explanation object. The document id can be retrieved using
      projection and the <code class="literal">FullTextQuery.DOCUMENT_ID</code>
      constant.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>The Document id has nothing to do with the entity id. Do not
        mess up these two notions.</p></div><p>In the second approach you project the
      <code class="classname">Explanation</code> object using the
      <code class="literal">FullTextQuery.EXPLANATION</code> constant.</p><div class="example"><a id="d0e6273"/><p class="title"><b>Example 5.18. Retrieving the Lucene Explanation object using
        projection</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextQuery</span><!-- <br/> --><span class="java_plain">&nbsp;ftQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;s</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createFullTextQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">&nbsp;luceneQuery</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Dvd</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setProjection</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FullTextQuery</span><span class="java_separator">.</span><span class="java_plain">DOCUMENT_ID</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>FullTextQuery.EXPLANATION<span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FullTextQuery</span><span class="java_separator">.</span><span class="java_plain">THIS&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">SuppressWarnings</span><span class="java_separator">(</span><span class="java_literal">&quot;unchecked&quot;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Object</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;result&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;results</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Explanation</span><span class="java_plain">&nbsp;e&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Explanation</span><span class="java_separator">)</span><span class="java_plain">&nbsp;result</span><span class="java_separator">[</span><span class="java_literal">1</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;display</span><span class="java_separator">(</span><span class="java_plain">&nbsp;e</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Be careful, building the explanation object is quite expensive, it
      is roughly as expensive as running the Lucene query again. Don't do it
      if you don't need the object</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="query-filter"/>5.3. Filters</h2></div></div></div><p>Apache Lucene has a powerful feature that allows to filter query
    results according to a custom filtering process. This is a very powerful
    way to apply additional data restrictions, especially since filters can be
    cached and reused. Some interesting use cases are:</p><div class="itemizedlist"><ul><li><p>security</p></li><li><p>temporal data (eg. view only last month's data)</p></li><li><p>population filter (eg. search limited to a given
        category)</p></li><li><p>and many more</p></li></ul></div><p>Hibernate Search pushes the concept further by introducing the
    notion of parameterizable named filters which are transparently cached.
    For people familiar with the notion of Hibernate Core filters, the API is
    very similar:</p><div class="example"><a id="d0e6303"/><p class="title"><b>Example 5.19. Enabling fulltext filters for a given query</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;s</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createFullTextQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">query</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Driver</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">enableFullTextFilter</span><span class="java_separator">(</span><span class="java_literal">&quot;bestDriver&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">enableFullTextFilter</span><span class="java_separator">(</span><span class="java_literal">&quot;security&quot;</span><span class="java_separator">).</span><span class="java_plain">setParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;login&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;andre&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">returns&nbsp;only&nbsp;best&nbsp;drivers&nbsp;where&nbsp;andre&nbsp;has&nbsp;credentials</span></pre></div></div><br class="example-break"/><p>In this example we enabled two filters on top of the query. You can
    enable (or disable) as many filters as you like.</p><p>Declaring filters is done through the
    <code class="classname">@FullTextFilterDef</code> annotation. This annotation can
    be on any <code class="literal">@Indexed</code> entity regardless of the query the
    filter is later applied to. This implies that filter definitions are
    global and their names must be unique. A
    <code class="classname">SearchException</code> is thrown in case two different
    <code class="classname">@FullTextFilterDef</code> annotations with the same name
    are defined. Each named filter has to specify its actual filter
    implementation.</p><div class="example"><a id="d0e6324"/><p class="title"><b>Example 5.20. Defining and implementing a Filter</b></p><div class="example-contents"><pre class="programlisting">@Entity
@Indexed
@FullTextFilterDefs( {
    <span class="bold"><strong>@FullTextFilterDef(name = "bestDriver", impl = BestDriversFilter.class)</strong></span>, 
    <span class="bold"><strong>@FullTextFilterDef(name = "security", impl = SecurityFilterFactory.class)</strong></span> 
})
public class Driver { ... }</pre><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">BestDriversFilter</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">extends</span><!-- <br/> --><span class="java_plain">&nbsp;</span>org.apache.lucene.search.Filter<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">DocIdSet</span><span class="java_plain">&nbsp;getDocIdSet</span><span class="java_separator">(</span><span class="java_type">IndexReader</span><span class="java_plain">&nbsp;reader</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_keyword">throws</span><span class="java_plain">&nbsp;</span><span class="java_type">IOException</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">OpenBitSet</span><span class="java_plain">&nbsp;bitSet&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">OpenBitSet</span><span class="java_separator">(</span><span class="java_plain">&nbsp;reader</span><span class="java_separator">.</span><span class="java_plain">maxDoc</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">TermDocs</span><span class="java_plain">&nbsp;termDocs&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;reader</span><span class="java_separator">.</span><span class="java_plain">termDocs</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Term</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;score&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;5&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">while</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">&nbsp;termDocs</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bitSet</span><span class="java_separator">.</span><span class="java_plain">set</span><span class="java_separator">(</span><span class="java_plain">&nbsp;termDocs</span><span class="java_separator">.</span><span class="java_plain">doc</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;bitSet</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p><code class="classname">BestDriversFilter</code> is an example of a simple
    Lucene filter which reduces the result set to drivers whose score is 5. In
    this example the specified filter implements the
    <code class="literal">org.apache.lucene.search.Filter</code> directly and contains a
    no-arg constructor.</p><p>If your Filter creation requires additional steps or if the filter
    you want to use does not have a no-arg constructor, you can use the
    factory pattern:</p><div class="example"><a id="d0e6349"/><p class="title"><b>Example 5.21. Creating a filter using the factory pattern</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">FullTextFilterDef</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;bestDriver&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;impl&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">BestDriversFilterFactory</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Driver</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">BestDriversFilterFactory</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Factory</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Filter</span><span class="java_plain">&nbsp;getFilter</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">some&nbsp;additional&nbsp;steps&nbsp;to&nbsp;cache&nbsp;the&nbsp;filter&nbsp;results&nbsp;per&nbsp;</span><span class="java_type">IndexReader</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Filter</span><span class="java_plain">&nbsp;bestDriversFilter&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">BestDriversFilter</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CachingWrapperFilter</span><span class="java_separator">(</span><span class="java_plain">bestDriversFilter</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Hibernate Search will look for a <code class="literal">@Factory</code>
    annotated method and use it to build the filter instance. The factory must
    have a no-arg constructor.</p><p>Named filters come in handy where parameters have to be passed to
    the filter. For example a security filter might want to know which
    security level you want to apply:</p><div class="example"><a id="d0e6364"/><p class="title"><b>Example 5.22. Passing parameters to a defined filter</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextQuery&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;s</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createFullTextQuery</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">query</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Driver</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">enableFullTextFilter</span><span class="java_separator">(</span><span class="java_literal">&quot;security&quot;</span><span class="java_separator">)</span>.setParameter("level", 5)<span class="java_separator">;</span></pre></div></div><br class="example-break"/><p>Each parameter name should have an associated setter on either the
    filter or filter factory of the targeted named filter definition.</p><div class="example"><a id="d0e6374"/><p class="title"><b>Example 5.23. Using parameters in the actual filter implementation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SecurityFilterFactory</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;level</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;injected&nbsp;parameter</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>public void setLevel(Integer level)<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">level&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;level</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>@Key
    public FilterKey getKey()<span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">StandardFilterKey</span><span class="java_plain">&nbsp;key&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">StandardFilterKey</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key</span><span class="java_separator">.</span><span class="java_plain">addParameter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;level&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;key</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Factory</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Filter</span><span class="java_plain">&nbsp;getFilter</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">TermQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Term</span><span class="java_separator">(</span><span class="java_literal">&quot;level&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;level</span><span class="java_separator">.</span><span class="java_plain">toString</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CachingWrapperFilter</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">QueryWrapperFilter</span><span class="java_separator">(</span><span class="java_plain">query</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>Note the method annotated <code class="classname">@Key</code> returning a
    <code class="classname">FilterKey</code> object. The returned object has a special
    contract: the key object must implement <code class="methodname">equals()</code>
    / <code class="methodname">hashCode()</code> so that 2 keys are equal if and only
    if the given <code class="classname">Filter</code> types are the same and the set
    of parameters are the same. In other words, 2 filter keys are equal if and
    only if the filters from which the keys are generated can be interchanged.
    The key object is used as a key in the cache mechanism.</p><p><code class="classname">@Key</code> methods are needed only if:</p><div class="itemizedlist"><ul><li><p>you enabled the filter caching system (enabled by
        default)</p></li><li><p>your filter has parameters</p></li></ul></div><p>In most cases, using the <code class="literal">StandardFilterKey</code>
    implementation will be good enough. It delegates the
    <code class="methodname">equals()</code> / <code class="methodname">hashCode()</code>
    implementation to each of the parameters equals and hashcode
    methods.</p><p>As mentioned before the defined filters are per default cached and
    the cache uses a combination of hard and soft references to allow disposal
    of memory when needed. The hard reference cache keeps track of the most
    recently used filters and transforms the ones least used to
    <code class="classname">SoftReferences</code> when needed. Once the limit of the
    hard reference cache is reached additional filters are cached as
    <code class="classname">SoftReferences</code>. To adjust the size of the hard
    reference cache, use
    <code class="literal">hibernate.search.filter.cache_strategy.size</code> (defaults
    to 128). For advanced use of filter caching, you can implement your own
    <code class="classname">FilterCachingStrategy</code>. The classname is defined by
    <code class="literal">hibernate.search.filter.cache_strategy</code>.</p><p>This filter caching mechanism should not be confused with caching
    the actual filter results. In Lucene it is common practice to wrap filters
    using the <code class="classname">IndexReader</code> around a
    <code class="classname">CachingWrapperFilter.</code> The wrapper will cache the
    <code class="classname">DocIdSet</code> returned from the
    <code class="methodname">getDocIdSet(IndexReader reader)</code> method to avoid
    expensive recomputation. It is important to mention that the computed
    <code class="classname">DocIdSet</code> is only cachable for the same
    <code class="classname">IndexReader</code> instance, because the reader
    effectively represents the state of the index at the moment it was opened.
    The document list cannot change within an opened
    <code class="classname">IndexReader</code>. A different/new<code class="classname">
    IndexReader</code> instance, however, works potentially on a
    different set of <code class="classname">Document</code>s (either from a different
    index or simply because the index has changed), hence the cached
    <code class="classname">DocIdSet</code> has to be recomputed.</p><p>Hibernate Search also helps with this aspect of caching. Per default
    the <code class="literal">cache</code> flag of <code class="classname">@FullTextFilterDef
    </code>is set to
    <code class="literal">FilterCacheModeType.INSTANCE_AND_DOCIDSETRESULTS</code> which
    will automatically cache the filter instance as well as wrap the specified
    filter around a Hibernate specific implementation of
    <code class="classname">CachingWrapperFilter</code>. In contrast to Lucene's
    version of this class <code class="classname">SoftReference</code>s are used
    together with a hard reference count (see discussion about filter cache).
    The hard reference count can be adjusted using
    <code class="literal">hibernate.search.filter.cache_docidresults.size</code>
    (defaults to 5). The wrapping behaviour can be controlled using the
    <code class="literal">@FullTextFilterDef.cache</code> parameter. There are three
    different values for this parameter:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Value</th><th align="center">Definition</th></tr></thead><tbody><tr><td align="left">FilterCacheModeType.NONE</td><td align="left">No filter instance and no result is cached by Hibernate
              Search. For every filter call, a new filter instance is created.
              This setting might be useful for rapidly changing data sets or
              heavily memory constrained environments.</td></tr><tr><td align="left">FilterCacheModeType.INSTANCE_ONLY</td><td align="left">The filter instance is cached and reused across
              concurrent <code class="methodname">Filter.getDocIdSet()</code> calls.
              <code class="classname">DocIdSet</code> results are not cached. This
              setting is useful when a filter uses its own specific caching
              mechanism or the filter results change dynamically due to
              application specific events making
              <code class="classname">DocIdSet</code> caching in both cases
              unnecessary.</td></tr><tr><td align="left">FilterCacheModeType.INSTANCE_AND_DOCIDSETRESULTS</td><td align="left">Both the filter instance and the
              <code class="classname">DocIdSet</code> results are cached. This is the
              default value.</td></tr></tbody></table></div><p>Last but not least - why should filters be cached? There
    are two areas where filter caching shines:</p><div class="itemizedlist"><ul><li><p>the system does not update the targeted entity index often (in
        other words, the IndexReader is reused a lot)</p></li><li><p>the Filter's DocIdSet is expensive to compute (compared to the
        time spent to execute the query)</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="query-filter-shard"/>5.3.1. Using filters in a sharded environment</h3></div></div></div><p>It is possible, in a sharded environment to execute queries on a
      subset of the available shards. This can be done in two steps:</p><div class="itemizedlist"><ul><li><p>create a sharding strategy that does select a subset of
          <code class="classname">IndexManager</code>s depending on some filter
          configuration</p></li><li><p>activate the proper filter at query time</p></li></ul></div><p>Let's first look at an example of sharding strategy that query on
      a specific customer shard if the customer filter is activated.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CustomerShardingStrategy</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">IndexShardingStrategy</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;stored&nbsp;</span><span class="java_type">IndexManagers</span><span class="java_plain">&nbsp;in&nbsp;a&nbsp;array&nbsp;indexed&nbsp;by&nbsp;customerID</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexManager</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;indexManagers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span><span class="java_type">Properties</span><span class="java_plain">&nbsp;properties</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexManager</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;indexManagers</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">indexManagers&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;indexManagers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexManager</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;getIndexManagersForAllShards</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;indexManagers</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexManager</span><span class="java_plain">&nbsp;getIndexManagerForAddition</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;id</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;idInString</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Document</span><span class="java_plain">&nbsp;document</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;customerID&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Integer</span><span class="java_separator">.</span><span class="java_plain">parseInt</span><span class="java_separator">(</span><span class="java_plain">document</span><span class="java_separator">.</span><span class="java_plain">getFieldable</span><span class="java_separator">(</span><span class="java_literal">&quot;customerID&quot;</span><span class="java_separator">).</span><span class="java_plain">stringValue</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;indexManagers</span><span class="java_separator">[</span><span class="java_plain">customerID</span><span class="java_separator">];</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexManager</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;getIndexManagersForDeletion</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Class</span><span class="java_operator">&lt;?&gt;</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Serializable</span><span class="java_plain">&nbsp;id</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;idInString</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;getIndexManagersForAllShards</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;*&nbsp;Optimization;&nbsp;don't&nbsp;search&nbsp;ALL&nbsp;shards&nbsp;and&nbsp;union&nbsp;the&nbsp;results;&nbsp;in&nbsp;this&nbsp;case,&nbsp;we&nbsp;</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;*&nbsp;can&nbsp;be&nbsp;certain&nbsp;that&nbsp;all&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;particular&nbsp;customer&nbsp;Filter&nbsp;is&nbsp;in&nbsp;a&nbsp;single</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;*&nbsp;shard;&nbsp;simply&nbsp;return&nbsp;that&nbsp;shard&nbsp;by&nbsp;customerID.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexManager</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;getIndexManagersForQuery</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">FullTextFilterImplementor</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;filters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">FullTextFilter</span><span class="java_plain">&nbsp;filter&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;getCustomerFilter</span><span class="java_separator">(</span><span class="java_plain">filters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;customer&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">filter&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;getIndexManagersForAllShards</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">IndexManager</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;indexManagers</span><span class="java_separator">[</span><span class="java_type">Integer</span><span class="java_separator">.</span><span class="java_plain">parseInt</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter</span><span class="java_separator">.</span><span class="java_plain">getParameter</span><span class="java_separator">(</span><span class="java_literal">&quot;customerID&quot;</span><span class="java_separator">).</span><span class="java_plain">toString</span><span class="java_separator">())]</span><span class="java_plain">&nbsp;</span><span class="java_separator">};</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">FullTextFilter</span><span class="java_plain">&nbsp;getCustomerFilter</span><span class="java_separator">(</span><span class="java_type">FullTextFilterImplementor</span><span class="java_separator">[]</span><span class="java_plain">&nbsp;filters</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">FullTextFilterImplementor</span><span class="java_plain">&nbsp;filter</span><span class="java_operator">:</span><span class="java_plain">&nbsp;filters</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">filter</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">().</span><span class="java_plain">equals</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_separator">))</span><span class="java_plain">&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;filter</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre><p>In this example, if the filter named <code class="literal">customer</code>
      is present, we make sure to only use the shard dedicated to this
      customer. Otherwise, we return all shards. A given Sharding strategy can
      react to one or more filters and depends on their parameters.</p><p>The second step is simply to activate the filter at query time.
      While the filter can be a regular filter (as defined in <a href="#query-filter" title="5.3. Filters">Section 5.3, “Filters”</a>) which also filters Lucene results after the
      query, you can make use of a special filter that will only be passed to
      the sharding strategy and otherwise ignored for the rest of the query.
      Simply use the <code class="classname">ShardSensitiveOnlyFilter</code> class
      when declaring your filter.</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Indexed</span>
@FullTextFilterDef(name="customer", impl=ShardSensitiveOnlyFilter.class)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;ftEm</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
query.enableFulltextFilter("customer").setParameter("CustomerID", 5);</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">SuppressWarnings</span><span class="java_separator">(</span><span class="java_literal">&quot;unchecked&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Customer</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;query</span><span class="java_separator">.</span><span class="java_plain">getResultList</span><span class="java_separator">();</span></pre><p>Note that by using the
      <code class="classname">ShardSensitiveOnlyFilter</code>, you do not have to
      implement any Lucene filter. Using filters and sharding strategy
      reacting to these filters is recommended to speed up queries in a
      sharded environment.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="query-faceting"/>5.4. Faceting</h2></div></div></div><p><a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://en.wikipedia.org/wiki/Faceted_search">Faceted
    search</a> is a technique which allows to divide the results of a
    query into multiple categories. This categorization includes the
    calculation of hit counts for each category and the ability to further
    restrict search results based on these facets (categories). <a href="#example-amazon-facets" title="Example 5.24. Search for 'Hibernate Search' on Amazon">Example 5.24, “Search for <span class="emphasis"><em>'Hibernate Search'</em></span> on
      Amazon”</a> shows a faceting example. The search for
    'Hibernate Search' results in fifteen hits which are displayed on the main
    part of the page. The navigation bar on the left, however, shows the
    category<span class="emphasis"><em> Computers &amp; Internet</em></span> with its
    subcategories <span class="emphasis"><em>Programming</em></span>, <span class="emphasis"><em>Computer
    Science</em></span>, <span class="emphasis"><em>Databases</em></span>,
    <span class="emphasis"><em>Software</em></span>, <span class="emphasis"><em>Web Development,</em></span>
    <span class="emphasis"><em>Networking</em></span> and <span class="emphasis"><em>Home Computing</em></span>.
    For each of these subcategories the number of books is shown matching the
    main search criteria and belonging to the respective subcategory. This
    division of the category <span class="emphasis"><em>Computers &amp; Internet</em></span> is
    one facet of this search. Another one is for example the average customer
    review rating.</p><div class="example"><a id="example-amazon-facets"/><p class="title"><b>Example 5.24. Search for <span class="emphasis"><em>'Hibernate Search'</em></span> on
      Amazon</b></p><div class="example-contents"><div class="mediaobject" align="center"><img src="faceting.png" align="middle"/></div></div></div><br class="example-break"/><p>In Hibernate Search the classes <code class="classname">QueryBuilder</code>
    and <code class="classname">FullTextQuery</code> are the entry point to the
    faceting API. The former allows to create faceting requests whereas the
    latter gives access to the so called <code class="classname">FacetManager</code>.
    With the help of the <code class="classname">FacetManager</code> faceting requests
    can be applied on a query and selected facets can be added to an existing
    query in order to refine search results. The following sections will
    describe the faceting process in more detail. The examples will use the
    entity <code class="classname">Cd</code> as shown in <a href="#example-faceting-entity" title="Example 5.25. Example entity for faceting">Example 5.25, “Example entity for faceting”</a>:</p><div class="example"><a id="example-faceting-entity"/><p class="title"><b>Example 5.25. Example entity for faceting</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">GeneratedValue</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Fields</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">name&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;name_un_analyzed&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;analyze&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;price</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">DateBridge</span><span class="java_separator">(</span><span class="java_plain">resolution&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Resolution</span><span class="java_separator">.</span><span class="java_plain">YEAR</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Date</span><span class="java_plain">&nbsp;releaseYear</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">analyze&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Analyze</span><span class="java_separator">.</span><span class="java_plain">NO</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;label</span><span class="java_separator">;</span>
</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;setter</span><span class="java_operator">/</span><span class="java_plain">getter</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-creating-faceting-request"/>5.4.1. Creating a faceting request</h3></div></div></div><p>The first step towards a faceted search is to create the
      <code class="classname">FacetingRequest</code>. Currently two types of faceting
      requests are supported. The first type is called <span class="emphasis"><em>discrete
      faceting</em></span> and the second type <span class="emphasis"><em>range
      faceting</em></span> request.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="discrete-faceting-request"/>5.4.1.1. Discrete faceting request</h4></div></div></div><p>In the case of a discrete faceting request you start with giving
        the request a unique name. This name will later be used to retrieve
        the facet values (see <a href="#section-interpreting-facet-result" title="5.4.4. Interpreting a Facet result">Section 5.4.4, “Interpreting a <code class="classname">Facet</code> result”</a>). Then you need to
        specify on which index field you want to categorize on and which
        faceting options to apply. An example for a discrete faceting request
        can be seen in <a href="#example-discrete-faceting" title="Example 5.26. Creating a discrete faceting request">Example 5.26, “Creating a discrete faceting request”</a>:</p><div class="example"><a id="example-discrete-faceting"/><p class="title"><b>Example 5.26. Creating a discrete faceting request</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;builder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FacetingRequest</span><span class="java_plain">&nbsp;labelFacetingRequest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">facet</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;labelFacetRequest&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;label&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">discrete</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">orderedBy</span><span class="java_separator">(</span><span class="java_type">FacetSortOrder</span><span class="java_separator">.</span><span class="java_plain">COUNT_DESC</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">includeZeroCounts</span><span class="java_separator">(</span><span class="java_literal">false</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">maxFacetCount</span><span class="java_separator">(</span><span class="java_literal">3</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createFacetingRequest</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>When executing this faceting request a
        <code class="classname">Facet</code> instance will be created for each
        discrete value for the indexed field <code class="constant">label</code>. The
        <code class="classname">Facet</code> instance will record the actual field
        value including how often this particular field value occurs within
        the original query results. Parameters <code class="methodname">orderedBy</code>,
        <code class="methodname">includeZeroCounts</code> and
        <code class="methodname">maxFacetCount</code> are optional and can be applied
        on any faceting request.
        Parameter <code class="methodname">orderedBy</code> allows to specify in which
        order the created facets will be returned. The default is
        <code class="constant">FacetSortOrder.COUNT_DESC</code>, but you can also sort
        on the field value. Parameter <code class="methodname">includeZeroCount</code>
        determines whether facets with a count of 0 will be included in the
        result (by default they are) and <code class="methodname">maxFacetCount</code>
        allows to limit the maximum amount of facets returned.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>There are several preconditions an indexed field has to meet
          in order to categorize (facet) on it. The indexed
          property must be of type <code class="classname">String</code>,
          <code class="classname">Date</code> or a subtype of
          <code class="classname">Number</code>; also <code class="constant">null</code> values
          should be avoided. Finally the property has to be indexed with
          <code class="constant">Analyze.NO</code> and you can not use it in combination
          with <code class="classname">@NumericField</code>. When you need these other
          options we suggest to index the property twice and use the appropriate
          field depending on the use case: </p><pre class="programlisting">...
@Fields({
  @Field( name="price" ),
  @Field( name="price_facet", analyze=Analyze.NO )
})
@NumericFields({
  @NumericField( forField="price" )
})
private int price;
...</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="range-faceting-request"/>5.4.1.2. Creating a range faceting request</h4></div></div></div><p>The creation of a range faceting request is similar. We also
        start with a name for the request and the field to facet on. Then
        we have to specify ranges for the field values. A range faceting
        request can be seen in <a href="#example-range-faceting" title="Example 5.27. Creating a range faceting request">Example 5.27, “Creating a range faceting request”</a>.
        There, three different price ranges are specified.
        <code class="methodname">below</code> and <code class="methodname">above</code> can
        only be specified once, but you can specify as many
        <code class="methodname">from</code> - <code class="methodname">to</code> ranges as
        you want. For each range boundary you can also specify via
        <code class="methodname">excludeLimit</code> whether it is included into the
        range or not.</p><div class="example"><a id="example-range-faceting"/><p class="title"><b>Example 5.27. Creating a range faceting request</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;builder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">FacetingRequest</span><span class="java_plain">&nbsp;priceFacetingRequest&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">facet</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">name</span><span class="java_separator">(</span><span class="java_literal">&quot;priceFaceting&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onField</span><span class="java_separator">(</span><span class="java_literal">&quot;price_facet&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">range</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">below</span><span class="java_separator">(</span><span class="java_literal">1000</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">from</span><span class="java_separator">(</span><span class="java_literal">1001</span><span class="java_separator">).</span><span class="java_plain">to</span><span class="java_separator">(</span><span class="java_literal">1500</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">above</span><span class="java_separator">(</span><span class="java_literal">1500</span><span class="java_separator">).</span><span class="java_plain">excludeLimit</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createFacetingRequest</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-sorting-faceting-request"/>5.4.2. Setting the facet sort order</h3></div></div></div><p>The result of applying a faceting request is a list of
      <code class="classname">Facet</code> instances as seen in <a href="#example-applying-faceting" title="Example 5.28. Applying a faceting request">Example 5.28, “Applying a faceting request”</a>. The order within the list is
      given by the <code class="classname">FacetSortOrder</code> parameter specified
      via <code class="methodname">orderedBy</code> when creating the faceting
      request. The default value is
      <code class="constant">FacetSortOrder.COUNT_DESC</code>, meaning facets are
      ordered by their count in descending order (highest count first).
      Other values are <code class="constant">COUNT_ASC</code>,
      <code class="constant">FIELD_VALUE</code> and
      <code class="constant">RANGE_DEFINITION_ORDER</code>.
      <code class="constant">COUNT_ASC</code> returns the facets in ascending count
      order whereas <code class="constant">FIELD_VALUE</code> will return them in
      alphabetical order of the facet/category value (see <a href="#section-interpreting-facet-result" title="5.4.4. Interpreting a Facet result">Section 5.4.4, “Interpreting a <code class="classname">Facet</code> result”</a>).
      <code class="constant">RANGE_DEFINITION_ORDER</code> only applies for range
      faceting request and returns the facets in the same order in which the
      ranges are defined. For <a href="#example-range-faceting" title="Example 5.27. Creating a range faceting request">Example 5.27, “Creating a range faceting request”</a> this
      would mean the facet for the range of below 1000 would be returned
      first, followed by the facet for the range 1001 to 1500 and finally
      the facet for above 1500.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-applying-faceting-request"/>5.4.3. Applying a faceting request</h3></div></div></div><p>In <a href="#section-creating-faceting-request" title="5.4.1. Creating a faceting request">Section 5.4.1, “Creating a faceting request”</a> we have
      seen how to create a faceting request. Now it is time to apply it on a
      query. The key is the <code class="classname">FacetManager</code> which can be
      retrieved via the <code class="classname">FullTextQuery</code> (see <a href="#example-applying-faceting" title="Example 5.28. Applying a faceting request">Example 5.28, “Applying a faceting request”</a>).</p><div class="example"><a id="example-applying-faceting"/><p class="title"><b>Example 5.28. Applying a faceting request</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;create&nbsp;a&nbsp;fulltext&nbsp;query</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">all</span><span class="java_separator">().</span><span class="java_plain">createQuery</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;match&nbsp;all&nbsp;query</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Cd</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;retrieve&nbsp;facet&nbsp;manager&nbsp;and&nbsp;apply&nbsp;faceting&nbsp;request</span>
<!--  --><br/><span class="java_type">FacetManager</span><span class="java_plain">&nbsp;facetManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">getFacetManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">facetManager</span><span class="java_separator">.</span><span class="java_plain">enableFaceting</span><span class="java_separator">(</span><span class="java_plain">priceFacetingRequest</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;</span><span class="java_type">Cds</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Cd</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;retrieve&nbsp;the&nbsp;faceting&nbsp;results</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Facet</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;facets&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;facetManager</span><span class="java_separator">.</span><span class="java_plain">getFacets</span><span class="java_separator">(</span><span class="java_literal">&quot;priceFaceting&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">...</span></pre></div></div><br class="example-break"/><p>You need to enable the faceting request before you execute the
      query. You do that via
      <code class="methodname">facetManager.enableFaceting(&lt;facetName&gt;)</code>.
      You can enable as many faceting requests as you like, then you execute
      the query and retrieve the facet results for a given request via
      <code class="methodname">facetManager.getFacets(&lt;facetname&gt;)</code>. For
      each request you will get a list of <code class="classname">Facet</code>
      instances. Facet requests stay active and get applied to the fulltext
      query until they are either explicitly disabled via
      <code class="methodname">disableFaceting(&lt;facetName&gt;)</code> or the
      query is discarded.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="section-interpreting-facet-result"/>5.4.4. Interpreting a <code class="classname">Facet</code> result</h3></div></div></div><p>Each facet request results in a list of
      <code class="classname">Facet</code> instances. Each instance represents one
      facet/category value. In the CD example (<a href="#example-discrete-faceting" title="Example 5.26. Creating a discrete faceting request">Example 5.26, “Creating a discrete faceting request”</a>) where we want to categorize on
      the Cd labels, there would for example be a <code class="classname">Facet</code>
      for each of the record labels Universal, Sony and Warner. <a href="#example-facet-api" title="Example 5.29. Facet API">Example 5.29, “Facet API”</a> shows the API of
      <code class="classname">Facet</code>.</p><div class="example"><a id="example-facet-api"/><p class="title"><b>Example 5.29. Facet API</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">interface</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Facet</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;the&nbsp;faceting&nbsp;name&nbsp;this&nbsp;{</span><span class="java_javadoc_tag">@code</span><span class="java_javadoc_comment">&nbsp;Facet}&nbsp;belongs&nbsp;to.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@see</span><span class="java_javadoc_comment">&nbsp;org.hibernate.search.query.facet.FacetingRequest#getFacetingName()</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getFacetingName</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Return&nbsp;the&nbsp;{</span><span class="java_javadoc_tag">@code</span><span class="java_javadoc_comment">&nbsp;Document}&nbsp;field&nbsp;name&nbsp;this&nbsp;facet&nbsp;is&nbsp;targeting.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;The&nbsp;field&nbsp;needs&nbsp;to&nbsp;be&nbsp;indexed&nbsp;with&nbsp;{</span><span class="java_javadoc_tag">@code</span><span class="java_javadoc_comment">&nbsp;Analyze.NO}.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;the&nbsp;{</span><span class="java_javadoc_tag">@code</span><span class="java_javadoc_comment">&nbsp;Document}&nbsp;field&nbsp;name&nbsp;this&nbsp;facet&nbsp;is&nbsp;targeting.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getFieldName</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;the&nbsp;value&nbsp;of&nbsp;this&nbsp;facet.&nbsp;In&nbsp;case&nbsp;of&nbsp;a&nbsp;discrete&nbsp;facet&nbsp;it&nbsp;is&nbsp;the&nbsp;actual</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span><span class="java_javadoc_tag">@code</span><span class="java_javadoc_comment">&nbsp;Document}&nbsp;field&nbsp;value.&nbsp;In&nbsp;case&nbsp;of&nbsp;a&nbsp;range&nbsp;query&nbsp;the&nbsp;value&nbsp;is&nbsp;a</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;range.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getValue</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;the&nbsp;facet&nbsp;count.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;getCount</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_javadoc_comment">/**</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;</span><span class="java_javadoc_tag">@return</span><span class="java_javadoc_comment">&nbsp;a&nbsp;Lucene&nbsp;{</span><span class="java_javadoc_tag">@link</span><span class="java_javadoc_comment">&nbsp;Query}&nbsp;which&nbsp;can&nbsp;be&nbsp;executed&nbsp;to&nbsp;retrieve&nbsp;all</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;documents&nbsp;matching&nbsp;the&nbsp;value&nbsp;of&nbsp;this&nbsp;facet.</span>
<!--  --><br/><span class="java_javadoc_comment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;getFacetQuery</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_separator">}</span>
</pre></div></div><br class="example-break"/><p><code class="methodname">getFacetingName()</code> and
      <code class="methodname">getFieldName()</code> are returning the facet request
      name and the targeted document field name as specified by the underlying
      <code class="classname">FacetRequest</code>. For <a href="#example-discrete-faceting" title="Example 5.26. Creating a discrete faceting request">Example 5.26, “Creating a discrete faceting request”</a> that would be
      <code class="constant">labelFacetRequest</code> and <code class="constant">label</code>
      respectively. The interesting information is provided by
      <code class="methodname">getValue()</code> and
      <code class="methodname">getCount()</code>. The former is the actual
      facet/category value, for example a concrete record label like
      Universal. The latter returns the count for this value. To stick with
      the example again, the count value tells you how many Cds are released
      under the Universal label. Last but not least,
      <code class="classname">getFacetQuery()</code> returns a Lucene query which can
      be used to retrieve the entities counted in this facet.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e6894"/>5.4.5. Restricting query results</h3></div></div></div><p>A common use case for faceting is a "drill-down" functionality
      which allows you to narrow your original search by applying a given
      facet on it. To do this, you can apply any of the returned
      <code class="classname">Facet</code>s as additional criteria on your original
      query via <code class="classname">FacetSelection</code>.
      <code class="classname">FacetSelection</code>s are available via the
      <code class="classname">FacetManager</code> and allow you to select a facet as
      query criteria (<code class="methodname">selectFacets</code>), remove a facet
      restriction (<code class="methodname">deselectFacets</code>), remove all facet
      restrictions (<code class="methodname">clearSelectedFacets</code>) and retrieve
      all currently selected facets
      (<code class="methodname">getSelectedFacets</code>). <a href="#example-restricting-query-results" title="Example 5.30. Restricting query results via the application of a FacetSelection">Example 5.30, “Restricting query results via the application of a
        <code class="classname">FacetSelection</code>”</a> shows an example.</p><div class="example"><a id="example-restricting-query-results"/><p class="title"><b>Example 5.30. Restricting query results via the application of a
        <code class="classname">FacetSelection</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_operator">//</span><!-- <br/> --><span class="java_plain">&nbsp;create&nbsp;a&nbsp;fulltext&nbsp;query</span>
<!--  --><br/><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">all</span><span class="java_separator">().</span><span class="java_plain">createQuery</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;match&nbsp;all&nbsp;query</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;fullTextQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;clazz&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;retrieve&nbsp;facet&nbsp;manager&nbsp;and&nbsp;apply&nbsp;faceting&nbsp;request</span>
<!--  --><br/><span class="java_type">FacetManager</span><span class="java_plain">&nbsp;facetManager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">getFacetManager</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">facetManager</span><span class="java_separator">.</span><span class="java_plain">enableFaceting</span><span class="java_separator">(</span><span class="java_plain">&nbsp;priceFacetingRequest&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;get&nbsp;the&nbsp;list&nbsp;of&nbsp;</span><span class="java_type">Cd</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Cd</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;cds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">assertTrue</span><span class="java_separator">(</span><span class="java_plain">cds</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">10</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;retrieve&nbsp;the&nbsp;faceting&nbsp;results</span>
<!--  --><br/><span class="java_type">List</span><span class="java_operator">&lt;</span><span class="java_type">Facet</span><span class="java_operator">&gt;</span><span class="java_plain">&nbsp;facets&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;facetManager</span><span class="java_separator">.</span><span class="java_plain">getFacets</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;priceFaceting&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">assertTrue</span><span class="java_separator">(</span><span class="java_plain">facets</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">).</span><span class="java_plain">getCount</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">)</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;apply&nbsp;first&nbsp;facet&nbsp;as&nbsp;additional&nbsp;search&nbsp;criteria</span>
<!--  --><br/><span class="java_type">FacetSelection</span><span class="java_plain">&nbsp;facetSelection&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;facetManager</span><span class="java_separator">.</span><span class="java_plain">getFacetGroup</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;priceFaceting&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">facetSelection</span><span class="java_separator">.</span><span class="java_plain">selectFacets</span><span class="java_separator">(</span><span class="java_plain">&nbsp;facets</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;re</span><span class="java_operator">-</span><span class="java_plain">execute&nbsp;the&nbsp;query</span>
<!--  --><br/><span class="java_plain">cds&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">assertTrue</span><span class="java_separator">(</span><span class="java_plain">cds</span><span class="java_separator">.</span><span class="java_plain">size</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e6932"/>5.5. Optimizing the query process</h2></div></div></div><p>Query performance depends on several criteria:</p><div class="itemizedlist"><ul><li><p>the Lucene query itself: read the literature on this
        subject.</p></li><li><p>the number of loaded objects: use pagination and / or index
        projection (if needed).</p></li><li><p>the way Hibernate Search interacts with the Lucene readers:
        defines the appropriate <a href="#search-architecture-readerstrategy" title="2.3. Reader strategy">Reader strategy</a>.</p></li><li><p>caching frequently extracted values from the index: see <a href="#query-fieldcaches" title="5.5.1. Caching index values: FieldCache">Section 5.5.1, “Caching index values: FieldCache”</a>.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="query-fieldcaches"/>5.5.1. Caching index values: FieldCache</h3></div></div></div><p>The primary function of a Lucene index is to identify matches to
      your queries, still after the query is performed the results must be
      analyzed to extract useful information: typically Hibernate Search might
      need to extract the Class type and the primary key.</p><p>Extracting the needed values from the index has a performance
      cost, which in some cases might be very low and not noticeable, but in
      some other cases might be a good candidate for caching.</p><p>What is exactly needed depends on the kind of Projections being
      used (see <a href="#projections" title="5.1.3.5. Projection">Section 5.1.3.5, “Projection”</a>), and in some cases the Class
      type is not needed as it can be inferred from the query context or other
      means.</p><p>Using the @<code class="classname">CacheFromIndex</code> annotation you
      can experiment different kinds of caching of the main metadata fields
      required by Hibernate Search:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">annotations</span><span class="java_separator">.</span><span class="java_type">FieldCacheType</span><span class="java_separator">.</span><span class="java_plain">CLASS</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">annotations</span><span class="java_separator">.</span><span class="java_type">FieldCacheType</span><span class="java_separator">.</span><span class="java_plain">ID</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">CacheFromIndex</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span><span class="java_plain">&nbsp;CLASS</span><span class="java_separator">,</span><span class="java_plain">&nbsp;ID&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Essay</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>It is currently possible to cache Class types and IDs using this
      annotation:</p><div class="itemizedlist"><ul><li><p><code class="constant">CLASS</code>: Hibernate Search will use a Lucene
          FieldCache to improve peformance of the Class type extraction from
          the index.</p><p>This value is enabled by default, and is what Hibernate Search
          will apply if you don't specify the
          @<code class="classname">CacheFromIndex</code> annotation.</p></li><li><p><code class="constant">ID</code>: Extracting the primary identifier
          will use a cache. This is likely providing the best performing
          queries, but will consume much more memory which in turn might
          reduce performance.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Measure the performance and memory consumption impact after
        warmup (executing some queries): enabling Field Caches is likely to
        improve performance but this is not always the case.</p></div><p>Using a FieldCache has two downsides to consider:</p><div class="itemizedlist"><ul><li><p>Memory usage: these caches can be quite memory hungry.
          Typically the CLASS cache has lower requirements than the ID
          cache.</p></li><li><p>Index warmup: when using field caches, the first query on a
          new index or segment will be slower than when you don't have caching
          enabled.</p></li></ul></div><p>With some queries the classtype won't be needed at all, in that
      case even if you enabled the <code class="constant">CLASS</code> field cache,
      this might not be used; for example if you are targeting a single class,
      obviously all returned values will be of that type (this is evaluated at
      each Query execution).</p><p>For the ID FieldCache to be used, the ids of targeted entities
      must be using a <code class="classname">TwoWayFieldBridge</code> (as all
      builting bridges), and all types being loaded in a specific query must
      use the fieldname for the id, and have ids of the same type (this is
      evaluated at each Query execution).</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="manual-index-changes"/>Chapter 6. Manual index changes</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e7020">6.1. Adding instances to the index</a></span></dt><dt><span class="section"><a href="#d0e7061">6.2. Deleting instances from the index</a></span></dt><dt><span class="section"><a href="#search-batchindex">6.3. Rebuilding the whole index</a></span></dt><dd><dl><dt><span class="section"><a href="#search-batchindex-flushtoindexes">6.3.1. Using flushToIndexes()</a></span></dt><dt><span class="section"><a href="#search-batchindex-massindexer">6.3.2. Using a MassIndexer</a></span></dt><dt><span class="section"><a href="#d0e7343">6.3.3. Useful parameters for batch indexing</a></span></dt></dl></dd></dl></div><p>As Hibernate core applies changes to the Database, Hibernate Search
  detects these changes and will update the index automatically (unless the
  EventListeners are disabled). Sometimes changes are made to the database
  without using Hibernate, as when backup is restored or your data is
  otherwise affected; for these cases Hibernate Search exposes the Manual
  Index APIs to explicitly update or remove a single entity from the index, or
  rebuild the index for the whole database, or remove all references to a
  specific type.</p><p>All these methods affect the Lucene Index only, no changes are applied
  to the Database.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7020"/>6.1. Adding instances to the index</h2></div></div></div><p>Using <code class="classname">FullTextSession</code>.<code class="methodname">index(T
    entity)</code> you can directly add or update a specific object
    instance to the index. If this entity was already indexed, then the index
    will be updated. Changes to the index are only applied at transaction
    commit.</p><div class="example"><a id="d0e7031"/><p class="title"><b>Example 6.1. Indexing an entity via <code class="methodname">FullTextSession.index(T
      entity)</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">session</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_type">Object</span><span class="java_plain">&nbsp;customer&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">load</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">8</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
fullTextSession.index(customer);</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">index&nbsp;only&nbsp;updated&nbsp;at&nbsp;commit&nbsp;time</span></pre></div></div><br class="example-break"/><p>In case you want to add all instances for a type, or for all indexed
    types, the recommended approach is to use a
    <code class="classname">MassIndexer</code>: see <a href="#search-batchindex-massindexer" title="6.3.2. Using a MassIndexer">Section 6.3.2, “Using a MassIndexer”</a> for more details.</p><p>The method <code class="methodname">FullTextSession.index(T
    entity)</code> is considered an explicit indexing operation, so any
    registered <code class="classname">EntityIndexingInterceptor</code> won't be applied
    in this case. For more information on <code class="classname">EntityIndexingInterceptor</code>
    see <a href="#search-mapping-indexinginterceptor" title="4.5. Conditional indexing: to index or not based on entity state">Section 4.5, “Conditional indexing: to index or not based on entity state”</a>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7061"/>6.2. Deleting instances from the index</h2></div></div></div><p>It is equally possible to remove an entity or all entities of a
    given type from a Lucene index without the need to physically remove them
    from the database. This operation is named purging and is also done
    through the <code class="classname">FullTextSession</code>.</p><div class="example"><a id="d0e7069"/><p class="title"><b>Example 6.2. Purging a specific instance of an entity from the index</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">session</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_keyword">for</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Customer</span><span class="java_plain">&nbsp;customer&nbsp;</span><span class="java_operator">:</span><span class="java_plain">&nbsp;customers</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>fullTextSession.purge( Customer.class, customer.getId() );</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">index&nbsp;is&nbsp;updated&nbsp;at&nbsp;commit&nbsp;time</span></pre></div></div><br class="example-break"/><p>Purging will remove the entity with the given id from the Lucene
    index but will not touch the database.</p><p>If you need to remove all entities of a given type, you can use the
    <code class="methodname">purgeAll</code> method. This operation removes all
    entities of the type passed as a parameter as well as all its
    subtypes.</p><div class="example"><a id="d0e7084"/><p class="title"><b>Example 6.3. Purging all instances of an entity from the index</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">session</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Transaction</span><span class="java_plain">&nbsp;tx&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
fullTextSession.purgeAll( Customer.class );</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">optionally&nbsp;optimize&nbsp;the&nbsp;index</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">().</span><span class="java_plain">optimize</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">tx</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">index&nbsp;changes&nbsp;are&nbsp;applied&nbsp;at&nbsp;commit&nbsp;time&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>As in the previous example, it is suggested to optimize the index
    after many purge operation to actually free the used space.</p><p>As is the case with method <code class="methodname">FullTextSession.index(T
    entity)</code>, also <code class="methodname">purge</code> and
    <code class="methodname">purgeAll</code> are considered explicit indexinging
    operations: any registered <code class="classname">EntityIndexingInterceptor</code>
    won't be applied. For more information on <code class="classname">EntityIndexingInterceptor</code>
    see <a href="#search-mapping-indexinginterceptor" title="4.5. Conditional indexing: to index or not based on entity state">Section 4.5, “Conditional indexing: to index or not based on entity state”</a>.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Methods <code class="methodname">index</code>,
      <code class="methodname">purge</code> and <code class="methodname">purgeAll</code> are
      available on <code class="classname">FullTextEntityManager</code> as
      well.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>All manual indexing methods (<code class="methodname">index</code>,
      <code class="methodname">purge</code> and <code class="methodname">purgeAll</code>)
      only affect the index, not the database, nevertheless they are
      transactional and as such they won't be applied until the transaction is
      successfully committed, or you make use of
      <code class="methodname">flushToIndexes</code>.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-batchindex"/>6.3. Rebuilding the whole index</h2></div></div></div><p>If you change the entity mapping to the index, chances are that the
    whole Index needs to be updated; For example if you decide to index a an
    existing field using a different analyzer you'll need to rebuild the index
    for affected types. Also if the Database is replaced (like restored from a
    backup, imported from a legacy system) you'll want to be able to rebuild
    the index from existing data. Hibernate Search provides two main
    strategies to choose from:</p><div class="itemizedlist"><ul><li><p>Using
        <code class="classname">FullTextSession</code>.<code class="methodname">flushToIndexes()</code>
        periodically, while using
        <code class="classname">FullTextSession</code>.<code class="methodname">index()</code>
        on all entities.</p></li><li><p>Use a <code class="classname">MassIndexer</code>.</p></li></ul></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-batchindex-flushtoindexes"/>6.3.1. Using flushToIndexes()</h3></div></div></div><p>This strategy consists in removing the existing index and then
      adding all entities back to the index using
      <code class="classname">FullTextSession</code>.<code class="methodname">purgeAll()</code>
      and
      <code class="classname">FullTextSession</code>.<code class="methodname">index()</code>,
      however there are some memory and efficiency contraints. For maximum
      efficiency Hibernate Search batches index operations and executes them
      at commit time. If you expect to index a lot of data you need to be
      careful about memory consumption since all documents are kept in a queue
      until the transaction commit. You can potentially face an
      <code class="classname">OutOfMemoryException</code> if you don't empty the queue
      periodically: to do this you can use
      <code class="methodname">fullTextSession.flushToIndexes()</code>. Every time
      <code class="methodname">fullTextSession.flushToIndexes()</code> is called (or
      if the transaction is committed), the batch queue is processed applying
      all index changes. Be aware that, once flushed, the changes cannot be
      rolled back.</p><div class="example"><a id="d0e7196"/><p class="title"><b>Example 6.4. Index rebuilding using index() and flushToIndexes()</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">setFlushMode</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">FlushMode</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">MANUAL</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">fullTextSession</span><span class="java_separator">.</span><span class="java_plain">setCacheMode</span><span class="java_separator">(</span><span class="java_type">CacheMode</span><span class="java_separator">.</span><span class="java_plain">IGNORE</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">transaction&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">beginTransaction</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_type">Scrollable</span><span class="java_plain">&nbsp;results&nbsp;will&nbsp;avoid&nbsp;loading&nbsp;too&nbsp;many&nbsp;objects&nbsp;in&nbsp;memory</span>
<!--  --><br/><span class="java_type">ScrollableResults</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createCriteria</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Email</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">setFetchSize</span><span class="java_separator">(</span><span class="java_plain">BATCH_SIZE</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">scroll</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">ScrollMode</span><span class="java_separator">.</span><span class="java_plain">FORWARD_ONLY&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">int</span><span class="java_plain">&nbsp;index&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">while</span><span class="java_separator">(</span><span class="java_plain">&nbsp;results</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;index</span><span class="java_operator">++</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">index</span><span class="java_separator">(</span><span class="java_plain">&nbsp;results</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_literal">0</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">index&nbsp;each&nbsp;element</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">index&nbsp;</span><span class="java_operator">%</span><span class="java_plain">&nbsp;BATCH_SIZE&nbsp;</span><span class="java_operator">==</span><span class="java_plain">&nbsp;</span><span class="java_literal">0</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">flushToIndexes</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">apply&nbsp;changes&nbsp;to&nbsp;indexes</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">clear</span><span class="java_separator">();</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">free&nbsp;memory&nbsp;since&nbsp;the&nbsp;queue&nbsp;is&nbsp;processed</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">transaction</span><span class="java_separator">.</span><span class="java_plain">commit</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>Try to use a batch size that guarantees that your application will
      not run out of memory: with a bigger batch size objects are fetched
      faster from database but more memory is needed.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="search-batchindex-massindexer"/>6.3.2. Using a MassIndexer</h3></div></div></div><p>Hibernate Search's <code class="classname">MassIndexer</code> uses several
      parallel threads to rebuild the index; you can optionally select which
      entities need to be reloaded or have it reindex all entities. This
      approach is optimized for best performance but requires to set the
      application in maintenance mode: making queries to the index is not
      recommended when a MassIndexer is busy.</p><div class="example"><a id="d0e7211"/><p class="title"><b>Example 6.5. Index rebuilding using a MassIndexer</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">createIndexer</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">startAndWait</span><!-- <br/> --><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>This will rebuild the index, deleting it and then reloading all
      entities from the database. Although it's simple to use, some tweaking
      is recommended to speed up the process: there are several parameters
      configurable.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>During the progress of a MassIndexer the content of the index is
        undefined! If a query is performed while the MassIndexer is working
        most likely some results will be missing.</p></div><div class="example"><a id="d0e7221"/><p class="title"><b>Example 6.6. Using a tuned MassIndexer</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextSession</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createIndexer</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">batchSizeToLoadObjects</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">25</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">cacheMode</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CacheMode</span><span class="java_separator">.</span><span class="java_plain">NORMAL&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">threadsToLoadObjects</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">5</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">idFetchSize</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">150</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">threadsForSubsequentFetching</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">20</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">progressMonitor</span><span class="java_separator">(</span><span class="java_plain">&nbsp;monitor&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">a&nbsp;</span><span class="java_type">MassIndexerProgressMonitor</span><span class="java_plain">&nbsp;implementation</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">startAndWait</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>This will rebuild the index of all User instances (and subtypes),
      and will create 5 parallel threads to load the User instances using
      batches of 25 objects per query; these loaded User instances are then
      pipelined to 20 parallel threads to load the attached lazy collections
      of User containing some information needed for the index. The number of
      threads working on actual index writing is defined by the backend
      configuration of each index. See the option
      <code class="literal">worker.thread_pool.size</code> in <a href="#table-work-execution-configuration" title="Table 3.3. Execution configuration">Table 3.3, “Execution configuration”</a>.</p><p>As of Hibernate Search 4.4.0, instead of indexing all the types
      in parallel, the MassIndexer is configured by default to index only
      one type in parallel. It prevents resource exhaustion especially
      database connections and usually does not slow down the indexing.
      You can however configure this behavior using
      <code class="classname">MassIndexer</code>.<code class="methodname">typesToIndexInParallel(int threadsToIndexObjects)</code>:
      </p><div class="example"><a id="d0e7241"/><p class="title"><b>Example 6.7. Configuring the MassIndexer to index several types in parallel</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">fullTextSession</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createIndexer</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">User</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Customer</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">typesToIndexInParallel</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">2</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">batchSizeToLoadObjects</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">25</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">cacheMode</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">CacheMode</span><span class="java_separator">.</span><span class="java_plain">NORMAL&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">threadsToLoadObjects</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">5</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">idFetchSize</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">150</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">threadsForSubsequentFetching</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">20</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">progressMonitor</span><span class="java_separator">(</span><span class="java_plain">&nbsp;monitor&nbsp;</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_operator">//</span><span class="java_plain">a&nbsp;</span><span class="java_type">MassIndexerProgressMonitor</span><span class="java_plain">&nbsp;implementation</span>
<!--  --><br/><span class="java_plain">&nbsp;</span><span class="java_separator">.</span><span class="java_plain">startAndWait</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>It is recommended to leave cacheMode to
      <code class="literal">CacheMode.IGNORE</code> (the default), as in most reindexing
      situations the cache will be a useless additional overhead; it might be
      useful to enable some other <code class="literal">CacheMode</code> depending on
      your data: it might increase performance if the main entity is relating
      to enum-like data included in the index.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The MassIndexer was designed for speed and is unaware of
        transactions, so there is no need to begin one or committing. Also
        because it is not transactional it is not recommended to let users use
        the system during it's processing, as it is unlikely people will be
        able to find results and the system load might be too high
        anyway.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="search-batchindexing-threadsandconnections"/>6.3.2.1. MassIndexer using threads and JDBC connections</h4></div></div></div><p>The MassIndexer was designed to finish the reindexing task as
      quickly as possible, but this requires a bit of care in its configuration
      to behave fairly with your server resources.</p><p>There is a simple formula to understand how the different options
      applied to the MassIndexer affect the number of used worker threads
      and connections: each thread will require a JDBC connection.</p><pre class="programlisting">threads = typesToIndexInParallel * (threadsToLoadObjects + threadsForSubsequentFetching + 1);
required JDBC connections = threads;</pre><p>Let's see some suggestions for a roughly sane tuning starting point:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>Option <code class="literal">typesToIndexInParallel</code> should probably be a low value, like 1 or 2, depending on how
          much of your CPUs have spare cycles and how slow a database round trip will be.</p></li><li><p>Before tuning a parallel run, experiment with options to tune your primary indexed entities in isolation.</p></li><li><p>Making <code class="literal">threadsToLoadObjects</code> higher increases the preloading rate for the picked root entity
          from the database, but also increases memory usage and the pressure on the threads working on subsequent fetching.</p></li><li><p>Option <code class="literal">threadsForSubsequentFetching</code> should generally be higher than <code class="literal">threadsToLoadObjects</code>
          as it needs to perform more work in parallel: loading all the values for relations marked <code class="classname">@IndexedEmbedded</code>
          or other lazily loaded relations needed by your custom <code class="classname">FieldBridge</code>s.
          You could try a lower value if the root entity doesn't have any such relation.</p></li><li><p>Increasing parallelism usually helps as the bottleneck usually is the latency to the database connection,
          but make sure your database can handle all the multiple requests.</p></li><li><p>This advice might not apply to you: always measure the effects! We're providing this as a means to help you
          understand how these options are related.</p></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>Running the MassIndexer with many threads will require many
        connections to the database. If you don't have a sufficiently large
        connection pool, the MassIndexer itself could deadlock or your other
        applications (or your same application) could starve being unable to serve
        other requests: make sure you size your connection pool accordingly
        to the options as explained in the above paragraph.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>The "sweet spot" of number of threads to achieve best
        performance is highly dependent on your overall architecture, database
        design and even data values. To find out the best number of threads
        for your application it is recommended to use a profiler: all internal
        thread groups have meaningful names to be easily identified with most
        tools.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="search-batchindex-custommassindexer"/>6.3.2.2. Using a custom MassIndexer implementation</h4></div></div></div><p>The provided MassIndexer is quite general purpose, and while we believe
        it's a robust approach, you might be able to squeeze some better performance
        by writing a custom implementation. To run your own <code class="classname">MassIndexer</code>
        instead of using the one shipped with Hibernate Search you have to:</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><ol><li><p>create an implementation of the <code class="classname">org.hibernate.search.spi.MassIndexerFactory</code> interface;</p></li><li><p>set the property <code class="code">hibernate.search.massindexer.factoryclass</code> with the qualified class name of the factory implementation.</p></li></ol></div><div class="example"><a id="d0e7333"/><p class="title"><b>Example 6.8. Custom <code class="code">MassIndexerFactory</code> example</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">package</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">myproject</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">spi</span><span class="java_separator">.</span><span class="java_type">MassIndexerFactory</span>
<!--  --><br/><span class="java_separator">[...]</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomIndexerFactory</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">MassIndexerFactory</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span><span class="java_type">Properties</span><span class="java_plain">&nbsp;properties</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">MassIndexer</span><span class="java_plain">&nbsp;createMassIndexer</span><span class="java_separator">(...)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CustomIndexer</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><pre class="programlisting">hibernate.search.massindexer.factoryclass = org.myproject.CustomIndexerFactory</pre></div></div><br class="example-break"/></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7343"/>6.3.3. Useful parameters for batch indexing</h3></div></div></div><p>Other parameters which affect indexing time and memory consumption
      are:</p><div class="itemizedlist"><ul><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].exclusive_index_use</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_buffered_docs</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_merge_docs</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_factor</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_min_size</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_max_size</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_max_optimize_size</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_calibrate_by_deletes</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.ram_buffer_size</code></p></li><li><p><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.term_index_interval</code></p></li></ul></div><p>Previous versions also had a <code class="literal">max_field_length</code> but
      this was removed from Lucene, it's possible to obtain a similar effect by
      using a <code class="classname">LimitTokenCountAnalyzer</code>.</p><p>All <code class="literal">.indexwriter</code> parameters are Lucene specific
      and Hibernate Search is just passing these parameters through - see <a href="#lucene-indexing-performance" title="3.7.1. Tuning indexing performance">Section 3.7.1, “Tuning indexing performance”</a> for more details.</p><p>The <code class="classname">MassIndexer</code> uses a forward only
      scrollable result to iterate on the primary keys to be loaded, but MySQL's
      JDBC driver will load all values in memory; to avoid this "optimisation"
      set <code class="literal">idFetchSize</code> to
      <code class="literal">Integer.MIN_VALUE</code>.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-optimize"/>Chapter 7. Index Optimization</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e7465">7.1. Automatic optimization</a></span></dt><dt><span class="section"><a href="#d0e7528">7.2. Manual optimization</a></span></dt><dt><span class="section"><a href="#d0e7551">7.3. Adjusting optimization</a></span></dt></dl></div><p>This section explains some low level tricks to keep your indexes at
  peak performance. We cover some Lucene details which in most cases you don't
  have to know about: Hibernate Search will handle these operations optimally
  and transparently in most cases without the need for further configuration.
  Still, it is good to know that there are ways to configure the behaviour,
  if the need arises.</p><p>The index is physically stored in several smaller segments. Each
  segment is immutable and represents a generation of index writes. Index
  segments are periodically compacted, both to merge smaller segments and to
  remove stale entries; this merging process happens constantly in the
  background and can be tuned with the options specified in <a href="#lucene-indexing-performance" title="3.7.1. Tuning indexing performance">Section 3.7.1, “Tuning indexing performance”</a>, but you can also define policies to
  fully run index optimizations when it is most suited for your specific
  workload.</p><p>With older versions of Lucene it was important to frequently optimize
  the index to maintain good performance, but with current Lucene versions
  this doesn't apply anymore. The benefit of explicit optimization is very low,
  and in certain cases even counter-productive. During an explicit optimization the
  whole index is processed and rewritten inflicting a significant performance
  cost. Optimization is for this reason a double-edged sword.</p><p>Another reason to avoid optimizing the index too often is that an
  optimization will, as a side effect, invalidate cached filters and field caches
  and internal buffers need to be refreshed. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>Optimizing the index is often not needed, does not benefit write
      (update) performance at all, and is a slow operation: make sure you need
      it before activating it.</p></div><p>Of course optimizing the index does not only present drawbacks: after
  the optimization process is completed and new
  <code class="classname">IndexReader</code> instances have loaded their buffers,
  queries will perform at peak performance and you will have reclaimed all
  disk space potentially used by stale entries.</p><p>It is recommended to not schedule any optimization, but if you wish to
  perform it periodically you should run it:</p><div class="itemizedlist"><ul><li><p>on an idle system or when the searches are less frequent</p></li><li><p>after a lot of index modifications</p></li></ul></div><p>When using a <code class="classname">MassIndexer</code> (see <a href="#search-batchindex-massindexer" title="6.3.2. Using a MassIndexer">Section 6.3.2, “Using a MassIndexer”</a>) it will optimize involved indexes
  by default at the start and at the end of processing; you can change this
  behavior by using
  <code class="classname">MassIndexer</code>.<code class="methodname">optimizeAfterPurge</code>
  and
  <code class="classname">MassIndexer</code>.<code class="methodname">optimizeOnFinish</code>
  respectively. The initial optimization is actually very cheap as it is
  performed on an emtpy index: its purpose is to release the storage space
  occupied by the old index.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7465"/>7.1. Automatic optimization</h2></div></div></div><p>While in most cases this is not needed, Hibernate Search can
    automatically optimize an index after:</p><div class="itemizedlist"><ul><li><p>a certain amount of write operations</p></li><li><p>or after a certain amount of transactions</p></li></ul></div><p>The configuration for automatic index optimization can be defined on
    a global level or per index:</p><div class="example"><a id="d0e7479"/><p class="title"><b>Example 7.1. Defining automatic optimization parameters</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.optimizer.operation_limit.max = 1000
hibernate.search.default.optimizer.transaction_limit.max = 100
hibernate.search.Animal.optimizer.transaction_limit.max = 50</pre></div></div><br class="example-break"/><p>With the above example an optimization will be triggered to the
    <code class="literal">Animal</code> index as soon as either:</p><div class="itemizedlist"><ul><li><p>the number of additions and deletions reaches 1000</p></li><li><p>the number of transactions reaches 50
        (<code class="constant">hibernate.search.Animal.optimizer.transaction_limit.max</code>
        having priority over
        <code class="constant">hibernate.search.default.optimizer.transaction_limit.max</code>)</p></li></ul></div><p>If none of these parameters are defined, no optimization is
    processed automatically.</p><p>The default implementation of OptimizerStrategy can be overriden by
    implementing
    <code class="literal">org.hibernate.search.store.optimization.OptimizerStrategy</code>
    and setting the <code class="literal">optimizer.implementation</code> property to
    the fully qualified name of your implementation. This implementation must
    implement the interface, be a public class and have a public constructor
    taking no arguments.</p><div class="example"><a id="d0e7512"/><p class="title"><b>Example 7.2. Loading a custom OptimizerStrategy</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.default.optimizer.implementation = com.acme.worlddomination.SmartOptimizer
hibernate.search.default.optimizer.SomeOption = CustomConfigurationValue
hibernate.search.humans.optimizer.implementation = default</pre></div></div><br class="example-break"/><p>The keyword <code class="literal">default</code> can be used to select the
    Hibernate Search default implementation; all properties after the
    <code class="literal">.optimizer</code> key separator will be passed to the
    implementation's <code class="methodname">initialize</code> method at
    start.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7528"/>7.2. Manual optimization</h2></div></div></div><p>You can programmatically optimize (defragment) a Lucene index from
    Hibernate Search through the <code class="classname">SearchFactory</code>:</p><div class="example"><a id="d0e7536"/><p class="title"><b>Example 7.3. Programmatic index optimization</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">regularSession</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">SearchFactory</span><span class="java_plain">&nbsp;searchFactory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">searchFactory</span><span class="java_separator">.</span><span class="java_plain">optimize</span><span class="java_separator">(</span><span class="java_type">Order</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;or</span>
<!--  --><br/><span class="java_plain">searchFactory</span><span class="java_separator">.</span><span class="java_plain">optimize</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>The first example optimizes the Lucene index holding
    <code class="classname">Order</code>s; the second, optimizes all indexes.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p><code class="literal">searchFactory.optimize()</code> has no effect on a JMS
      or JGroups backend: you must apply the optimize operation on the Master
      node.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7551"/>7.3. Adjusting optimization</h2></div></div></div><p>The Lucene index is constantly being merged in the background to
    keep a good balance between write and read performance; in a sense this is a
    form of background optimization which is always applied.</p><p>The following match attributes of Lucene's <code class="classname">IndexWriter</code>
    and are commonly used to tune how often merging occurs and how aggressive it is
    applied. They are exposed by Hibernate Search via: </p><div class="itemizedlist"><ul><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_buffered_docs</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.max_merge_docs</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.merge_factor</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.ram_buffer_size</code></li><li><code class="literal">hibernate.search.[default|&lt;indexname&gt;].indexwriter.term_index_interval</code></li></ul></div><p> See <a href="#lucene-indexing-performance" title="3.7.1. Tuning indexing performance">Section 3.7.1, “Tuning indexing performance”</a> for
    a description of these properties.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-monitoring"/>Chapter 8. Monitoring</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e7595">8.1. JMX</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7624">8.1.1. StatisticsInfoMBean</a></span></dt><dt><span class="section"><a href="#d0e7632">8.1.2. IndexControlMBean</a></span></dt><dt><span class="section"><a href="#d0e7648">8.1.3. IndexingProgressMonitorMBean</a></span></dt></dl></dd></dl></div><p>Hibernate Search offers access to a <code class="classname">Statistics</code>
  object via <code class="methodname">SearchFactory.getStatistics()</code>. It allows
  you for example to determine which classes are indexed and how many entities
  are in the index. This information is always available. However, by
  specifying the <code class="literal">hibernate.search.generate_statistics</code>
  property in your configuration you can also collect total and average Lucene
  query and object loading timings.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e7595"/>8.1. JMX</h2></div></div></div><p>You can also enable access to the statistics via JMX. Setting the
    property <code class="literal">hibernate.search.jmx_enabled</code> will
    automatically register the <code class="classname">StatisticsInfoMBean</code>.
    Depending on your the configuration the
    <code class="classname">IndexControlMBean</code> and
    <code class="classname">IndexingProgressMonitorMBean</code> will also be
    registered. In case you are having more than one JMX enabled Hibernate
    Search instance running within a single JVM, you should also set
    <span class="property">hibernate.search.jmx_bean_suffix</span> to a different value
    for each of the instances. The specified suffix will be used to
    distinguish between the different MBean instances. Let's have a closer
    look at the mentioned MBeans. </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>If you want to access your JMX beans remotely via JConsole make
        sure to set the system property
        <code class="varname">com.sun.management.jmxremote</code> to
        <code class="constant">true</code>.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7624"/>8.1.1. StatisticsInfoMBean</h3></div></div></div><p>This MBean gives you access to <code class="classname">Statistics</code>
      object as desribed in the previous section.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7632"/>8.1.2. IndexControlMBean</h3></div></div></div><p>This MBean allows to build, optimize and purge the index for a
      given entity. Indexing occurs via the mass indexing API (see<a href="#search-batchindex-massindexer" title="6.3.2. Using a MassIndexer">Section 6.3.2, “Using a MassIndexer”</a>). A requirement for this bean
      to be registered in JMX is, that the Hibernate
      <code class="classname">SessionFactory</code> is bound to JNDI via the
      <code class="literal">hibernate.session_factory_name</code> property. Refer to the
      Hibernate Core manual for more information on how to configure JNDI. The
      <code class="classname">IndexControlMBean</code> and its API are for now
      experimental.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e7648"/>8.1.3. IndexingProgressMonitorMBean</h3></div></div></div><p>This MBean is an implementation
      <code class="classname">MassIndexerProgressMonitor</code> interface. If
      <code class="literal">hibernate.search.jmx_enabled</code> is enabled and the mass
      indexer API is used the indexing progress can be followed via this bean.
      The bean will only be bound to JMX while indexing is in progress. Once
      indexing is completed the MBean is not longer available.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial"/>Chapter 9. Spatial</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#spatial-indexing">9.1. Enable indexing of Spatial Coordinates</a></span></dt><dd><dl><dt><span class="section"><a href="#spatial-indexing-range">9.1.1. Indexing coordinates for Double Range Queries</a></span></dt><dt><span class="section"><a href="#spatial-indexing-quadtree">9.1.2. Indexing coordinates in a Grid with Quad Trees</a></span></dt><dt><span class="section"><a href="#spatial-coordinatesinterface">9.1.3. Implementing the Coordinates interface</a></span></dt></dl></dd><dt><span class="section"><a href="#spatial-queries">9.2. Performing Spatial Queries</a></span></dt><dd><dl><dt><span class="section"><a href="#spatial-queries-distance">9.2.1. Returning distance to query point in the search results</a></span></dt></dl></dd><dt><span class="section"><a href="#spatial-multiplecoordinates">9.3. Multiple Coordinate pairs</a></span></dt><dt><span class="section"><a href="#spatial-behind-curtain">9.4. Insight: implementation details of Quad Tree indexing</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8105">9.4.1. At indexing level</a></span></dt><dt><span class="section"><a href="#d0e8150">9.4.2. At search level</a></span></dt></dl></dd></dl></div><p>With the Spatial extensions you can combine fulltext queries
  with restrictions based on distance from a point in space, filter
  results based on distances from coordinates or sort results
  on such a distance criteria.</p><p>The spatial support of Hibernate Search has a few goals:</p><div class="itemizedlist"><ul><li><p>Enable spatial search on entities: find entities within x km
      from a location (latitude, longitude) on Earth</p></li><li><p>Provide an easy way to enable spatial indexing via expressive
      annotations</p></li><li><p>Provide a simple way for querying</p></li><li><p>Hide geographical complexity</p></li></ul></div><p>For example, you might search for that Italian place named
  approximately "Il Ciociaro" and is somewhere in the 2 km area around
  your office.</p><p>To be able to filter an <code class="classname">@Indexed</code> <code class="classname">@Entity</code>
  on a distance criteria you need to add the <code class="classname">@Spatial</code>
  annotation (<code class="classname">org.hibernate.search.annotations.Spatial</code>)
  and specify one or more sets of coordinates.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial-indexing"/>9.1. Enable indexing of Spatial Coordinates</h2></div></div></div><p>There are different techniques to index point coordinates,
    in particular Hibernate Search Spatial offers a choice between
    two strategies:</p><div class="itemizedlist"><ul><li><p>as numbers formatted for range queries</p></li><li><p>in Quad-Tree labels for two stage spatial queries</p></li></ul></div><p>We will now describe both methods so you can make a suitable choice; of
    course you can pick different strategies for each set of coordinates.
    These strategies are selected by specifying <code class="literal">spatialMode</code>,
    an attribute of the <code class="classname">@Spatial</code> annotation.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial-indexing-range"/>9.1.1. Indexing coordinates for Double Range Queries</h3></div></div></div><p>When setting the <code class="classname">@Spatial</code>.<code class="methodname">spatialMode</code>
    attribute to <code class="classname">SpatialMode</code>.<code class="methodname">RANGE</code>
    (which is the default) coordinates are indexed as numeric fields,
    so that range queries can be performed to narrow down the initial area
    of interest.</p><p>Pros:</p><div class="itemizedlist"><ul><li><p>Is quick on small data sets (&lt; 100k entities)</p></li><li><p>Is very simple: straightforward to debug/analyze</p></li><li><p>Impact on index size is moderate</p></li></ul></div><p>Cons:</p><div class="itemizedlist"><ul><li><p>Poor performance on large data sets</p></li><li><p>Poor performance if your data set is distributed across the whole
          world (for example when indexing points of interest in the United States,
          in Europe and in Asia, large areas collide because they share the same latitude.
          The latitude range query returns large amounts of data that need to be cross
          checked with those returned by the longitude range).</p></li></ul></div><p>To index your entities for range querying you have to:</p><div class="itemizedlist"><ul><li><p>add the <code class="classname">@Spatial</code> annotation on your entity</p></li><li><p>add the <code class="classname">@Latitude</code> and
        <code class="classname">@Longitude</code> annotations on your properties representing
        the coordinates; these must be of type <code class="classname">Double</code></p></li></ul></div><div class="example"><a id="d0e7774"/><p class="title"><b>Example 9.1. Sample Spatial indexing: Hotel class</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">annotations</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_operator">*</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Spatial</span><span class="java_plain">&nbsp;@</span><span class="java_type">Indexed</span><span class="java_plain">&nbsp;@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Hotel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Latitude</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;latitude</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Longitude</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;longitude</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">[..]</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial-indexing-quadtree"/>9.1.2. Indexing coordinates in a Grid with Quad Trees</h3></div></div></div><p>When setting <code class="classname">@Spatial</code>.<code class="methodname">spatialMode</code>
    to <code class="classname">SpatialMode</code>.<code class="methodname">GRID</code>
    the coordinates are encoded in several fields representing different
    zoom levels. Each box for each level is labelled so coordinates are assigned
    matching labels for each zoom level. This results in a tree encoding of
    labels called <code class="literal">quad tree</code>.</p><p>Pros :</p><div class="itemizedlist"><ul><li><p>Good performance even with large data sets</p></li><li><p>World wide data distribution independent</p></li></ul></div><p>Cons :</p><div class="itemizedlist"><ul><li><p>Index size is larger: need to encode multiple labels per
          pair of coordinates</p></li></ul></div><p>To index your entities you have to:</p><div class="itemizedlist"><ul><li><p>add the <code class="classname">@Spatial</code> annotation on the
        entity with the <code class="classname">SpatialMode</code> set to GRID :
        <code class="code">@Spatial(spatialMode = SpatialMode.GRID)</code></p></li><li><p>add the <code class="classname">@Latitude</code> and
        <code class="classname">@Longitude</code> annotations on the properties
        representing your coordinates; these must be of type
        <code class="classname">Double</code></p></li></ul></div><div class="example"><a id="d0e7839"/><p class="title"><b>Example 9.2. Indexing coordinates in a Grid using Quad Trees</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Spatial</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">spatialMode&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">SpatialMode</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">GRID</span><!-- <br/> --><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Hotel</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Latitude</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;latitude</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Longitude</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;longitude</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial-coordinatesinterface"/>9.1.3. Implementing the Coordinates interface</h3></div></div></div><p>Instead of using the <code class="literal">@</code><code class="classname">Latitude</code>
    and <code class="literal">@</code><code class="classname">Longitue</code> annotations
    you can choose to implement the <code class="classname">org.hibernate.search.spatial.Coordinates</code>
    interface.</p><div class="example"><a id="d0e7862"/><p class="title"><b>Example 9.3. Implementing the Coordinates interface</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">annotations</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_operator">*</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_plain">spatial</span><span class="java_separator">.</span><span class="java_type">Coordinates</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Spatial</span><span class="java_plain">&nbsp;@</span><span class="java_type">Indexed</span><span class="java_plain">&nbsp;@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Song</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">Coordinates</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span><span class="java_plain">&nbsp;</span><span class="java_type">long</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;latitude</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;longitude</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;getLatitude</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;latitude</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;getLongitude</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;longitude</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
</pre></div></div><br class="example-break"/><p>As we will see in the section <a href="#spatial-multiplecoordinates" title="9.3. Multiple Coordinate pairs">Section 9.3, “Multiple Coordinate pairs”</a>,
   a <code class="literal">@</code><code class="classname">Spatial</code>
   <code class="literal">@</code><code class="classname">Indexed</code> <code class="literal">@</code><code class="classname">Entity</code>
   can have multiple <code class="literal">@</code><code class="classname">Spatial</code> annotations;
   when having the entity implement <code class="classname">Coordinates</code>, the implemented
   methods refer to the default Spatial name: the default pair of coordinates.</p><p>An alternative is to use properties implementing the <code class="classname">Coordinates</code>
  interface; this way you can have multiple Spatial instances:</p><div class="example"><a id="d0e7899"/><p class="title"><b>Example 9.4. Using attributes of type Coordinates</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_plain">@</span><!-- <br/> --><span class="java_type">Indexed</span><!-- <br/> --><span class="java_plain">&nbsp;@</span><!-- <br/> --><span class="java_type">Entity</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">Event</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Field</span><span class="java_separator">(</span><span class="java_plain">store&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">Store</span><span class="java_separator">.</span><span class="java_plain">YES</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;name</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;latitude</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">double</span><span class="java_plain">&nbsp;longitude</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Spatial</span><span class="java_separator">(</span><span class="java_plain">spatialMode&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">SpatialMode</span><span class="java_separator">.</span><span class="java_plain">GRID</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Coordinates</span><span class="java_plain">&nbsp;getLocation</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Coordinates</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;getLatitude</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;latitude</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;getLongitude</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;longitude</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">};</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">[...]</span>
</pre></div></div><br class="example-break"/><p>When using this form the <code class="literal">@</code><code class="classname">Spatial</code>
    <code class="literal">.name</code> automatically defaults to the propery name.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial-queries"/>9.2. Performing Spatial Queries</h2></div></div></div><p>The Hibernate Search DSL has been extended to support the spatial
  feature. You can build a query to search around a pair of coordinates
  (latitude,longitude) or around a bean implementing the <code class="classname">Coordinates</code>
  interface.</p><p>As with any fulltext queries, also for Spatial queries you:</p><div class="itemizedlist"><ul><li><p>retrieve a <code class="classname">QueryBuilder</code> from the
        <code class="classname">SearchFactory</code> as a starting point</p></li><li><p>use the DSL to build a spatial query with your search center and
        radius</p></li><li><p>optionally combine the resulting Query with other filters</p></li><li><p>call the <code class="methodname">createFullTextQuery()</code> and use
        run it as any standard Hibernate or JPA <code class="classname">Query</code></p></li></ul></div><div class="example"><a id="spatial-example-firstquery"/><p class="title"><b>Example 9.5. Search for an Hotel by distance</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;builder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">Hotel</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">spatial</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onDefaultCoordinates</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">within</span><span class="java_separator">(</span><span class="java_plain">&nbsp;radius</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Unit</span><span class="java_separator">.</span><span class="java_plain">KM&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">ofLatitude</span><span class="java_separator">(</span><span class="java_plain">&nbsp;centerLatitude&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">andLongitude</span><span class="java_separator">(</span><span class="java_plain">&nbsp;centerLongitude&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;hibQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">Hotel</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;hibQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><p>A fully working example can be found in the source code, in the
    testsuite. See
    <code class="methodname">SpatialIndexingTest.testSpatialAnnotationOnClassLevel()</code>
    and in the <code class="classname">Hotel</code> class.</p><p>As an alternative to passing separate values for latitude and longitude
    values, you can also pass an object implementing the <code class="classname">Coordinates</code>
    interface:</p><div class="example"><a id="d0e7966"/><p class="title"><b>Example 9.6. DSL example with Coordinates</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">Coordinates</span><!-- <br/> --><span class="java_plain">&nbsp;coordinates&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Point</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">fromDegrees</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_literal">24d</span><!-- <br/> --><span class="java_separator">,</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">31.5d</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">Query</span><span class="java_plain">&nbsp;query&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">spatial</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onCoordinates</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;location&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">within</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">51</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Unit</span><span class="java_separator">.</span><span class="java_plain">KM&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">ofCoordinates</span><span class="java_separator">(</span><span class="java_plain">&nbsp;coordinates&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;query</span><span class="java_separator">,</span><span class="java_plain">&nbsp;POI</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="spatial-queries-distance"/>9.2.1. Returning distance to query point in the search results</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="spatial-distance-projection"/>9.2.1.1. Returning distance to the center in the results</h4></div></div></div><p>To get the distance to the center of the search returned with the
      results you just need to project it:</p><div class="example"><a id="d0e7979"/><p class="title"><b>Example 9.7. Distance projection example</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">double</span><!-- <br/> --><span class="java_plain">&nbsp;centerLatitude&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">24.0d</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">double</span><span class="java_plain">&nbsp;centerLongitude</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">32.0d</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;builder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">POI</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">spatial</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onCoordinates</span><span class="java_separator">(</span><span class="java_literal">&quot;location&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">within</span><span class="java_separator">(</span><span class="java_literal">100</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Unit</span><span class="java_separator">.</span><span class="java_plain">KM</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">ofLatitude</span><span class="java_separator">(</span><span class="java_plain">centerLatitude</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">andLongitude</span><span class="java_separator">(</span><span class="java_plain">centerLongitude</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;hibQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;POI</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">hibQuery</span><span class="java_separator">.</span><span class="java_plain">setProjection</span><span class="java_separator">(</span><span class="java_type">FullTextQuery</span><span class="java_separator">.</span><span class="java_plain">SPATIAL_DISTANCE</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">FullTextQuery</span><span class="java_separator">.</span><span class="java_plain">THIS</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">hibQuery</span><span class="java_separator">.</span><span class="java_plain">setSpatialParameters</span><span class="java_separator">(</span><span class="java_plain">centerLatitude</span><span class="java_separator">,</span><span class="java_plain">&nbsp;centerLongitude</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;location&quot;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;hibQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/><div class="itemizedlist"><ul><li><p>Use
          <code class="classname">FullTextQuery</code>.<code class="literal">setProjection</code>
          with FullTextQuery.SPATIAL_DISTANCE as one of the projected
          fields.</p></li><li><p>Call
          <code class="classname">FullTextQuery</code>.<code class="literal">setSpatialParameters</code>
          with the latitude, longitude and the name of the spatial field used
          to build the spatial query. Note that using coordinates different thans
          the center used for the query will have unexpected results.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Distance projection and null values</h2><p>Using distance projection on non @Spatial enabled entities and/or
      with a non spatial Query will have unexpected results as entities not
      spatially indexed and/or having null values for latitude or longitude
      will be considered to be at (0,0)/(lat,0)/(0,long).</p><p>Using distance projection with a spatial query on spatially
      indexed entities having, eventually, <code class="literal">null</code> values for
      latitude and/or longitude is safe as they will not be found by the
      spatial query and won't have distance calculated.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="spatial-distance-sort"/>9.2.1.2. Sorting by distance</h4></div></div></div><p>To sort the results by distance to the center of the search you
      will have to build a Sort object using a
      <code class="classname">DistanceSortField</code>:</p><div class="example"><a id="d0e8021"/><p class="title"><b>Example 9.8. Distance sort example</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">double</span><!-- <br/> --><span class="java_plain">&nbsp;centerLatitude&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_literal">24.0d</span><!-- <br/> --><span class="java_separator">;</span>
<!--  --><br/><span class="java_type">double</span><span class="java_plain">&nbsp;centerLongitude&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">32.0d</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_type">QueryBuilder</span><span class="java_plain">&nbsp;builder&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;POI</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">spatial</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onCoordinates</span><span class="java_separator">(</span><span class="java_literal">&quot;location&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">within</span><span class="java_separator">(</span><span class="java_literal">100</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Unit</span><span class="java_separator">.</span><span class="java_plain">KM</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">ofLatitude</span><span class="java_separator">(</span><span class="java_plain">centerLatitude</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">andLongitude</span><span class="java_separator">(</span><span class="java_plain">centerLongitude</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_type">FullTextQuery</span><span class="java_plain">&nbsp;hibQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">luceneQuery</span><span class="java_separator">,</span><span class="java_plain">&nbsp;POI</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">Sort</span><span class="java_plain">&nbsp;distanceSort&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">Sort</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">DistanceSortField</span><span class="java_separator">(</span><span class="java_plain">centerLatitude</span><span class="java_separator">,</span><span class="java_plain">&nbsp;centerLongitude</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;location&quot;</span><span class="java_separator">));</span>
<!--  --><br/><span class="java_plain">hibQuery</span><span class="java_separator">.</span><span class="java_plain">setSort</span><span class="java_separator">(</span><span class="java_plain">distanceSort</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/><p>The <code class="classname">DistanceSortField</code> must be constructed
      using the same coordinates on the same spatial field used to build the
      spatial query otherwise the sorting will occur with another center than
      the query. This repetition is needed to allow you to define Queries with
      any tool.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Sorting and null values</h2><p>Using distance sort on non @Spatial enabled entities and/or with a
      non spatial Query will have also unexpected results as entities non
      spatially indexed and/or with null values for latitude or longitude will
      be considered to be at (0,0)/(lat,0)/(0,long)</p><p>Using distance sort with a spatial query on spatially indexed
      entities having, potentially, <code class="literal">null</code> values for latitude
      and/or longitude is safe as they will not be found by the spatial query
      and so won't be sorted</p></div></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial-multiplecoordinates"/>9.3. Multiple Coordinate pairs</h2></div></div></div><p>You can associate multiple pairs of coordinates to the same entity,
    as long as each pair is uniquelly identified by using a different name. This is achieved
    by stacking multiple <code class="literal">@</code><code class="classname">Spatial</code>
    annotations in a <code class="literal">@</code><code class="classname">Spatials</code> annotation,
    and specifying the <code class="literal">name</code> attribute on the
    <code class="literal">@</code><code class="classname">Spatial</code> annotation.</p><div class="example"><a id="d0e8064"/><p class="title"><b>Example 9.9. Multiple sets of coordinates</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">import</span><!-- <br/> --><span class="java_plain">&nbsp;org</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">hibernate</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">annotations</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_operator">*</span><!-- <br/> --><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Spatials</span><span class="java_separator">({</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Spatial</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Spatial</span><span class="java_separator">(</span><span class="java_plain">name</span><span class="java_operator">=</span><span class="java_literal">&quot;work&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;&nbsp;spatialMode&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_type">SpatialMode</span><span class="java_separator">.</span><span class="java_plain">GRID</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_separator">})</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Entity</span>
<!--  --><br/><span class="java_plain">@</span><span class="java_type">Indexed</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">UserEx</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Id</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Integer</span><span class="java_plain">&nbsp;id</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Latitude</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;homeLatitude</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Longitude</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;homeLongitude</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Latitude</span><span class="java_separator">(</span><span class="java_plain">of</span><span class="java_operator">=</span><span class="java_literal">&quot;work&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;workLatitude</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;@</span><span class="java_type">Longitude</span><span class="java_separator">(</span><span class="java_plain">of</span><span class="java_operator">=</span><span class="java_literal">&quot;work&quot;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_type">Double</span><span class="java_plain">&nbsp;workLongitude</span><span class="java_separator">;</span>
</pre></div></div><br class="example-break"/><p>In the example <a href="#spatial-example-firstquery" title="Example 9.5. Search for an Hotel by distance">Example 9.5, “Search for an Hotel by distance”</a> we used
  <code class="literal">onDefaultCoordinates()</code> which points to the coordinates
  defined by a <code class="literal">@</code><code class="classname">Spatial</code> annotation
  whose <code class="literal">name</code> attribute was not specified.</p><p>To target an alternative pair of coordinates at query time, we need
  to specify the pair by name using <code class="methodname">onCoordinates</code>
  <code class="literal">(String)</code> instead of
  <code class="methodname">onDefaultCoordinates()</code>:</p><div class="example"><a id="d0e8095"/><p class="title"><b>Example 9.10. Querying on non-default coordinate set</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">QueryBuilder</span><!-- <br/> --><span class="java_plain">&nbsp;builder&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getSearchFactory</span><!-- <br/> --><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">buildQueryBuilder</span><span class="java_separator">().</span><span class="java_plain">forEntity</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_type">UserEx</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">).</span><span class="java_plain">get</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">apache</span><span class="java_separator">.</span><span class="java_plain">lucene</span><span class="java_separator">.</span><span class="java_plain">search</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;luceneQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;builder</span><span class="java_separator">.</span><span class="java_plain">spatial</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">onCoordinates</span><span class="java_separator">(</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;work&quot;</span><span class="java_plain">&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">within</span><span class="java_separator">(</span><span class="java_plain">&nbsp;radius</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Unit</span><span class="java_separator">.</span><span class="java_plain">KM&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">ofLatitude</span><span class="java_separator">(</span><span class="java_plain">&nbsp;centerLatitude&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">andLongitude</span><span class="java_separator">(</span><span class="java_plain">&nbsp;centerLongitude&nbsp;</span><span class="java_separator">)</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">createQuery</span><span class="java_separator">();</span>
</span>
<!--  --><br/><span class="java_plain">org</span><span class="java_separator">.</span><span class="java_plain">hibernate</span><span class="java_separator">.</span><span class="java_type">Query</span><span class="java_plain">&nbsp;hibQuery&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">createFullTextQuery</span><span class="java_separator">(</span><span class="java_plain">&nbsp;luceneQuery</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_type">Hotel</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">List</span><span class="java_plain">&nbsp;results&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;hibQuery</span><span class="java_separator">.</span><span class="java_plain">list</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spatial-behind-curtain"/>9.4. Insight: implementation details of Quad Tree indexing</h2></div></div></div><p>The present chapter is meant to provide a technical insight in
    quad-tree (grid) indexing: how coordinates are mapped to the index and
    how queries are implemented.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8105"/>9.4.1. At indexing level</h3></div></div></div><p>When Hibernate Search indexes the entity annotated with @Spatial,
      it instantiates a SpatialFieldBridge to transform the latitude and
      longitude fields accessed via the Coordinates interface to the multiple
      index fields stored in the Lucene index.</p><p>Principle of the spatial index: the spatial index used in
      Hibernate Search is a QuadTree (<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://en.wikipedia.org/wiki/Quadtree">http://en.wikipedia.org/wiki/Quadtree</a>).</p><p>To make computation in a flat coordinates system the latitude and
      longitude field values will be projected with a sinusoidal projection
      (<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://en.wikipedia.org/wiki/Sinusoidal_projection">
      http://en.wikipedia.org/wiki/Sinusoidal_projection</a>). Origin
      values space is :</p><p>[-90 -&gt; +90],]-180 -&gt; 180]</p><p>for latitude,longitude coordinates and projected space is:</p><p>]-pi -&gt; +pi],[-pi/2 -&gt; +pi/2]</p><p>for cartesian x,y coordinates (beware of fields order inversion: x
      is longitude and y is latitude).</p><p>The index is divided into n levels labeled from 0 to n-1.</p><p>At the level 0 the projected space is the whole Earth. At the
      level 1 the projected space is devided into 4 rectangles (called boxes
      as in bounding box):</p><p>[-pi,-pi/2]-&gt;[0,0], [-pi,0]-&gt;[0,+pi/2],
      [0,-pi/2]-&gt;[+pi,0] and [0,0]-&gt;[+pi,+pi/2]</p><p>At level n+1 each box of level n is divided into 4 new boxes and
      so on. The numbers of boxes at a given level is 4^n.</p><p>Each box is given an id, in this format: [Box index on the X
      axis]|[Box index on the Y axis] To calculate the index of a box on an
      axis we divide the axis range in 2^n slots and find the slot the box
      belongs to. At the n level the indexes on an axis are from -(2^n)/2 to
      (2^n)/2. For instance, the 5th level has 4^5 = 1024 boxes with 32
      indexes on each axis (32x32 is 1024) and the box of Id "0|8" is covering
      the [0,8/32*pi/2]-&gt;[1/32*pi,9/32*pi/2] rectangle is projected
      space.</p><p>Beware! The boxes are rectangles in projected space but the
      related area on Earth is not a rectangle!</p><p>Now that we have all these boxes at all these levels will be
      indexing points "into" them.</p><p>For a point (lat,long) we calculate its projection (x,y) and then
      we calculate for each level of the spatial index, the ids of the boxes
      it belongs to.</p><p>At each level the point is in one and only one box. For points on
      the edges the box are considered exclusive n the left side and inclusive
      on the right i-e ]start,end] (the points are normalized before
      projection to [-90,+90],]-180,+180]).</p><p>We store in the Lucene document corresponding to the entity to
      index one field for each level of the quad tree. The field is named: [spatial
      index fields name]_HSSI_[n]. [spatial index fields name] is given either
      by the parameter at class level annotation or derived from the name of
      the spatial annoted method of he entitiy, HSSI stands for Hibernate
      Search Spatial Index and n is the level of the quad tree.</p><p>We also store the latitude and longitude as a Numeric field under
      [spatial index fields name]_HSSI_Latitude and [spatial index fields
      name]_HSSI_Longitude fields. They will be used to filter precisely
      results by distance in the second stage of the search.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8150"/>9.4.2. At search level</h3></div></div></div><p>Now that we have all these fields, what are they used for?</p><p>When you ask for a spatial search by providing a search discus
      (center+radius) we will calculate the boxes ids that do cover the search
      discus in the projected space, fetch all the documents that belong to
      these boxes (thus narrowing the number of documents for which we will
      have to calculate distance to the center) and then filter this subset
      with a real distance calculation. This is called two level spatial
      filtering.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8157"/>9.4.2.1. Step 1: compute the best quad tree level for the search
        discus</h4></div></div></div><p>For a given search radius there is an optimal quad tree level where
        the number of boxes to retrieve hall be minimal without bringing back
        to many documents (level 0 has only 1 box but retrieve all documents).
        The optimal quad tree level is the maximum level where the width of each box
        is larger than the search area. Near the equator line where
        projection deformation is minimal, this will lead to the retrieval of
        at most 4 boxes. Towards the poles where the deformation is more
        significant, it might need to examine more boxes but as the sinusoidal projection
        has a simple Tissot's indicatrix (see
        http://en.wikipedia.org/wiki/Sinusoidal_projection) in populated areas,
        the overhead is minimal.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8162"/>9.4.2.2. Step 2: compute ids of the corresponding covering boxes at that
        level</h4></div></div></div><p>Now that we have chosen the optimal level, we can compute the
        ids of the boxes covering the search discus (which is not a discus in
        projected space anymore).</p><p>This is done by
        org.hibernate.search.spatial.impl.SpatialHelper.getQuadTreeCellsIds(Point
        center, double radius, int quadTreeLevel)</p><p>It will calculate the bounding box of the search discus and then
        call
        org.hibernate.search.spatial.impl.SpatialHelper.getQuadTreeCellsIds(Point
        lowerLeft, Point upperRight, int quadTreeLevel) that will do the actual
        computation. If the bounding box crosses the meridian line it will cut
        the search in two and make two calls to <code class="literal">getQuadTreeCellsIds(Point
        lowerLeft, Point upperRight, int quadTreeLevel)</code> with left and
        right parts of the box.</p><p>There are some geo related hacks (search radius too large,
        search radius crossing the poles) that are handled in bounding box
        computations done by Rectangle.fromBoundingCircle(Coordinates center, double
        radius) (see
        http://janmatuschek.de/LatitudeLongitudeBoundingCoordinates for
        reference on those subjects).</p><p>The SpatialHelper.getQuadTreeCellsIds(Point lowerLeft, Point
        upperRight, int quadTreeLevel) project the defining points of the bounding
        box and compute the boxes they belong to. It returns all the box Ids
        between the lower left to the upper right corners, thus covering the
        area.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8178"/>9.4.2.3. Step 3: Lucene index lookup</h4></div></div></div><p>The Query is build with theses Ids to lookup for documents
        having a [spatial index fields name]_HSSI_[n] (n the level found at
        Step 1) field valued with one of the ids of Step 2.</p><p>See also the implementation of <code class="classname">org.hibernate.search.spatial.impl.QuadTreeFilter
        </code>.</p><p>This Query will return all documents in the boxes covering the
        projected bounding box of the search discus. So it is too large and
        needs refining. But we have narrowed the distance calculation problems
        to a subet of our datas.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8190"/>9.4.2.4. Step 4: refine</h4></div></div></div><p>A distance calculation filter is set after the Lucene index
        lookup query of Step 3 to exclude false candidates from the result
        list.</p><p>See SpatialQueryBuilderFromCoordinates.buildSpatialQuery(Coordinates center,
        double radius, String fieldName)</p></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="search-lucene-native"/>Chapter 10. Advanced features</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#d0e8203">10.1. Accessing the SearchFactory</a></span></dt><dt><span class="section"><a href="#IndexReaders">10.2. Using an IndexReader</a></span></dt><dt><span class="section"><a href="#d0e8294">10.3. Accessing a Lucene Directory</a></span></dt><dt><span class="section"><a href="#advanced-features-sharding">10.4. Sharding indexes</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8351">10.4.1. Static sharding</a></span></dt><dt><span class="section"><a href="#advanced-features-dynamic-sharding">10.4.2. Dynamic sharding</a></span></dt></dl></dd><dt><span class="section"><a href="#section-sharing-indexes">10.5. Sharing indexes</a></span></dt><dt><span class="section"><a href="#section-services">10.6. Using external services</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8572">10.6.1. Exposing a service</a></span></dt><dt><span class="section"><a href="#d0e8660">10.6.2. Using a service</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8681">10.7. Customizing Lucene's scoring formula</a></span></dt></dl></div><p>In this final chapter we are offering a smorgasbord of tips and tricks
  which might become useful as you dive deeper and deeper into Hibernate
  Search.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8203"/>10.1. Accessing the SearchFactory</h2></div></div></div><p>The <code class="classname">SearchFactory</code> object keeps track of the
    underlying Lucene resources for Hibernate Search. It is a convenient way
    to access Lucene natively. The <code class="literal">SearchFactory</code> can be
    accessed from a <code class="classname">FullTextSession</code>:</p><div class="example"><a id="d0e8217"/><p class="title"><b>Example 10.1. Accessing the <code class="classname">SearchFactory</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">FullTextSession</span><!-- <br/> --><span class="java_plain">&nbsp;fullTextSession&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">Search</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getFullTextSession</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_plain">regularSession</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_type">SearchFactory</span><span class="java_plain">&nbsp;searchFactory&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;fullTextSession</span><span class="java_separator">.</span><span class="java_plain">getSearchFactory</span><span class="java_separator">();</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="IndexReaders"/>10.2. Using an IndexReader</h2></div></div></div><p>Queries in Lucene are executed on an
    <code class="classname">IndexReader</code>. Hibernate Search caches index readers
    to maximize performance and implements other strategies to retrieve
    updated <code class="classname">IndexReader</code>s in order to minimize IO
    operations. Your code can access these cached resources, but you have to
    follow some "good citizen" rules.</p><div class="example"><a id="d0e8235"/><p class="title"><b>Example 10.2. Accessing an <code class="classname">IndexReader</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">IndexReader</span><!-- <br/> --><span class="java_plain">&nbsp;reader&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;searchFactory</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_plain">getIndexReaderAccessor</span><!-- <br/> --><span class="java_separator">().</span><!-- <br/> --><span class="java_plain">open</span><!-- <br/> --><span class="java_separator">(</span><!-- <br/> --><span class="java_type">Order</span><!-- <br/> --><span class="java_separator">.</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_separator">);</span>
<!--  --><br/><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">perform&nbsp;read</span><span class="java_operator">-</span><span class="java_plain">only&nbsp;operations&nbsp;on&nbsp;the&nbsp;reader</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_keyword">finally</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;searchFactory</span><span class="java_separator">.</span><span class="java_plain">getIndexReaderAccessor</span><span class="java_separator">().</span><span class="java_plain">close</span><span class="java_separator">(</span><span class="java_plain">reader</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_separator">}</span><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div><br class="example-break"/><p>In this example the <code class="classname">SearchFactory</code> figures out
    which indexes are needed to query this entity. Using the configured
    <code class="classname">ReaderProvider</code> (described in <a href="#search-architecture-readerstrategy" title="2.3. Reader strategy">Reader strategy</a>) on each index, it returns
    a compound <code class="literal">IndexReader</code> on top of all involved indexes.
    Because this <code class="classname">IndexReader</code> is shared amongst several
    clients, you must adhere to the following rules:</p><div class="itemizedlist"><ul><li><p>Never call indexReader.close(), but always call
        readerProvider.closeReader(reader), using a finally block.</p></li><li><p>Don't use this <code class="classname">IndexReader</code> for
        modification operations: it's a readonly
        <code class="classname">IndexReader</code>, you would get an
        exception).</p></li></ul></div><p>Aside from those rules, you can use the
    <code class="classname">IndexReader</code> freely, especially to do native Lucene
    queries. Using this shared <code class="classname">IndexReader</code>s will be
    more efficient than by opening one directly from - for example - the
    filesystem.</p><p>As an alternative to the method <code class="methodname">open(Class...
    types)</code> you can use <code class="methodname">open(String...
    indexNames)</code>; in this case you pass in one or more index
    names; using this strategy you can also select a subset of the indexes for
    any indexed type if sharding is used.</p><div class="example"><a id="d0e8287"/><p class="title"><b>Example 10.3. Accessing an <code class="classname">IndexReader by index
      names</code></b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_type">IndexReader</span><!-- <br/> --><span class="java_plain">&nbsp;reader&nbsp;</span><!-- <br/> --><span class="java_operator">=</span><!-- <br/> --><span class="java_plain">&nbsp;searchFactory</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">getIndexReaderAccessor</span><span class="java_separator">()</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">.</span><span class="java_plain">open</span><span class="java_separator">(</span><span class="java_literal">&quot;Products.1&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;Products.3&quot;</span><span class="java_separator">);</span></pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8294"/>10.3. Accessing a Lucene Directory</h2></div></div></div><p>A <code class="classname">Directory</code> is the most common abstraction
    used by Lucene to represent the index storage; Hibernate Search doesn't
    interact directly with a Lucene <code class="classname">Directory</code> but
    abstracts these interactions via an <code class="classname">IndexManager</code>:
    an index does not necessarily need to be implemented by a
    <code class="classname">Directory</code>.</p><p>If you are certain that your index is represented as a
    <code class="classname">Directory</code> and need to access it, you can get a
    reference to the <code class="classname">Directory</code> via the
    <code class="classname">IndexManager</code>. You will have to cast the
    <code class="classname">IndexManager</code> instance to a
    <code class="classname">DirectoryBasedIndexManager</code> and then use
    <code class="literal">getDirectoryProvider().getDirectory()</code> to get a
    reference to the underlying <code class="classname">Directory</code>. This is not
    recommended, if you need low level access to the index using Lucene APIs
    we suggest to see <a href="#IndexReaders" title="10.2. Using an IndexReader">Section 10.2, “Using an IndexReader”</a> instead.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="advanced-features-sharding"/>10.4. Sharding indexes</h2></div></div></div><p>In some cases it can be useful to split (shard) the data into
    several Lucene indexes. There are two main use use cases:</p><div class="itemizedlist"><ul><li><p>A single index is so big that index update times are slowing the
        application down. In this case static sharding can be used to split
        the data into a pre-defined number of shards.</p></li><li><p>Data is naturally segmented by customer, region, language or
        other application parameter and the index should be split according to
        these segments. This is a use case for dynamic sharding.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="tip"><h2>Tip</h2><p>By default sharding is not enabled.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8351"/>10.4.1. Static sharding</h3></div></div></div><p>To enable static sharding set the
      <code class="constant">hibernate.search.&lt;indexName&gt;.sharding_strategy.nbr_of_shards</code>
      property as seen in <a href="#example-index-sharding" title="Example 10.4. Enabling index sharding">Example 10.4, “Enabling index sharding”</a>.</p><div class="example"><a id="example-index-sharding"/><p class="title"><b>Example 10.4. Enabling index sharding</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.[default|&lt;indexName&gt;].sharding_strategy.nbr_of_shards = 5</pre></div></div><br class="example-break"/><p>The default sharding strategy which gets enabled by setting this
      property, splits the data according to the hash value of the document id
      (generated by the <code class="classname">FieldBridge</code>). This ensures a
      fairly balanced sharding. You can replace the default strategy by
      implementing a custom <code class="classname">IndexShardingStrategy</code>. To
      use your custom strategy you have to set the
      <code class="constant">hibernate.search.[default|&lt;indexName&gt;].sharding_strategy</code>
      property to the fully qualified class name of your custom
      <code class="classname">IndexShardingStrategy</code>.</p><div class="example"><a id="example-index-sharding-strategy"/><p class="title"><b>Example 10.5. Registering a custom IndexShardingStrategy</b></p><div class="example-contents"><pre class="programlisting">hibernate.search.[default|&lt;indexName&gt;].sharding_strategy = my.custom.RandomShardingStrategy</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="advanced-features-dynamic-sharding"/>10.4.2. Dynamic sharding</h3></div></div></div><p>Dynamic sharding allows you to manage the shards yourself and even
      create new shards on the fly. To do so you need to implement the
      interface <code class="classname">ShardIdentifierProvider</code> and set the
      <code class="constant">hibernate.search.[default|&lt;indexName&gt;].sharding_strategy</code>
      property to the fully qualified name of this class. Note that instead of
      implementing the interface directly, you should rather derive your
      implementation from
      <code class="classname">org.hibernate.search.store.ShardIdentifierProviderTemplate</code>
      which provides a basic implementation. Let's look at <a href="#example-custom-shard-identifier-provider" title="Example 10.6. Custom ShardidentiferProvider">Example 10.6, “Custom <code class="classname">ShardidentiferProvider</code>”</a> for an
      example.</p><div class="example"><a id="example-custom-shard-identifier-provider"/><p class="title"><b>Example 10.6. Custom <code class="classname">ShardidentiferProvider</code></b></p><div class="example-contents"><pre class="programlisting">public static class AnimalShardIdentifierProvider extends ShardIdentifierProviderTemplate {

 @Override
 public String getShardIdentifier(Class&lt;?&gt; entityType, Serializable id,
         String idAsString, Document document) {
    if ( entityType.equals(Animal.class) ) {
       String type = document.getFieldable("type").stringValue();
       addShard(type);
       return type;
    }
    throw new RuntimeException("Animal expected but found " + entityType);
 }

 @Override
 protected Set&lt;String&gt; loadInitialShardNames(Properties properties, BuildContext buildContext) {
    ServiceManager serviceManager = buildContext.getServiceManager();
    SessionFactory sessionFactory = serviceManager.requestService(
        HibernateSessionFactoryServiceProvider.class, buildContext);
    Session session = sessionFactory.openSession();
    try {
       Criteria initialShardsCriteria = session.createCriteria(Animal.class);
       initialShardsCriteria.setProjection( Projections.distinct(Property.forName("type")));

       @SuppressWarnings("unchecked")
       List&lt;String&gt; initialTypes = initialShardsCriteria.list();
       return new HashSet&lt;String&gt;(initialTypes);
    }
    finally {
       session.close();
    }
 }
}</pre></div></div><p><br class="example-break"/>The are several things happening in
      <code class="classname">AnimalShardIdentifierProvider</code>. First off its
      purpose is to create one shard per animal type (e.g. mammal, insect,
      etc.). It does so by inspecting the class type and the Lucene document
      passed to the <code class="methodname">getShardIdentifier()</code> method. It
      extracts the <code class="constant">type</code> field from the document and uses
      it as shard name. <code class="methodname">getShardIdentifier()</code> is
      called for every addition to the index and a new shard will be created
      with every new animal type encountered. The base class
      <code class="classname">ShardIdentifierProviderTemplate</code> maintains a set
      with all known shards to which any identifier must be added by calling
      <code class="methodname">addShard()</code>.</p><p>It is important to understand that Hibernate Search cannot know which
      shards already exist when the application starts. When using
      <code class="classname">ShardIdentifierProviderTemplate</code> as base class of
      a <code class="classname">ShardIdentifierProvider</code> implementation, the
      initial set of shard identifiers must be returned by the
      <code class="methodname">loadInitialShardNames()</code> method. How this is
      done will depend on the use case. However, a common case in combination
      with Hibernate ORM is that the initial shard set is defined by the the
      distinct values of a given database column. <a href="#example-custom-shard-identifier-provider" title="Example 10.6. Custom ShardidentiferProvider">Example 10.6, “Custom <code class="classname">ShardidentiferProvider</code>”</a> shows how to handle
      such a case. <code class="classname">AnimalShardIdentifierProvider</code> makes
      in its <code class="methodname">loadInitialShardNames()</code> implementation
      use of a service called
      <code class="classname">HibernateSessionFactoryServiceProvider</code> (see also
      <a href="#section-services" title="10.6. Using external services">Section 10.6, “Using external services”</a>) which is available within an ORM
      environment. It allows to request a Hibernate
      <code class="classname">SessionFactory</code> instance which can be used to run
      a <code class="classname">Criteria</code> query in order to determine the
      initial set of shard identifers.</p><p>Last but not least, the
      <code class="classname">ShardIdentifierProvider</code> also allows for
      optimizing searches by selecting which shard to run a query against. By
      activating a filter (see <a href="#query-filter-shard" title="5.3.1. Using filters in a sharded environment">Section 5.3.1, “Using filters in a sharded environment”</a>), a
      sharding strategy can select a subset of the shards used to answer a
      query (<code class="classname">getShardIdentifiersForQuery()</code>, not shown
      in the example) and thus speed up the query execution.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>This <code class="classname">ShardIdentifierProvider</code> is considered
        experimental. We might need to apply some changes to the defined method
        signatures to accomodate for unforeseen use cases. Please provide
        feedback if you have ideas, or just to let us know how you're using
        this API.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="section-sharing-indexes"/>10.5. Sharing indexes</h2></div></div></div><p>It is technically possible to store the information of more than one
    entity into a single Lucene index. There are two ways to accomplish
    this:</p><div class="itemizedlist"><ul><li><p>Configuring the underlying directory providers to point to the
        same physical index directory. In practice, you set the property
        <code class="literal">hibernate.search.[fully qualified entity
        name].indexName</code> to the same value. As an example let’s use
        the same index (directory) for the <code class="classname">Furniture</code>
        and <code class="classname">Animal</code> entity. We just set
        <code class="literal">indexName</code> for both entities to for example
        “Animal”. Both entities will then be stored in the Animal
        directory.</p><pre class="programlisting">hibernate.search.org.hibernate.search.test.shards.Furniture.indexName = Animal
hibernate.search.org.hibernate.search.test.shards.Animal.indexName = Animal</pre></li><li><p>Setting the <code class="code">@Indexed</code> annotation’s
        <code class="methodname">index</code> attribute of the entities you want to
        merge to the same value. If we again wanted all
        <code class="classname">Furniture</code> instances to be indexed in the
        <code class="classname">Animal</code> index along with all instances of
        <code class="classname">Animal</code> we would specify
        <code class="code">@Indexed(index="Animal")</code> on both
        <code class="classname">Animal</code> and <code class="classname">Furniture</code>
        classes.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>This is only presented here so that you know the option is
            available. There is really not much benefit in sharing
            indexes.</p></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="section-services"/>10.6. Using external services</h2></div></div></div><p>Any of the pluggable contracts we have seen so far allows for the
    injection of a service. The most notable example being the
    <code class="classname">DirectoryProvider</code>. The full list is:</p><div class="itemizedlist"><ul><li><p><code class="classname">DirectoryProvider</code></p></li><li><p><code class="classname">ReaderProvider</code></p></li><li><p><code class="classname">OptimizerStrategy</code></p></li><li><p><code class="classname">BackendQueueProcessor</code></p></li><li><p><code class="classname">Worker</code></p></li><li><p><code class="classname">ErrorHandler</code></p></li><li><p><code class="classname">MassIndexerProgressMonitor</code></p></li></ul></div><p>Some of these components need to access a service which is either
    available in the environment or whose lifecycle is bound to the
    <code class="classname">SearchFactory</code>. Sometimes, you even want the same
    service to be shared amongst several instances of these contract. One
    example is the ability the share an Infinispan cache instance between
    several directory providers running in different <code class="literal">JVM</code>s
    to store the various indexes using the same underlying infrastructure;
    this provides real-time replication of indexes across nodes.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8572"/>10.6.1. Exposing a service</h3></div></div></div><p>To expose a service, you need to implement
      <code class="classname">org.hibernate.search.spi.ServiceProvider&lt;T&gt;</code>.
      <code class="classname">T</code> is the type of the service you want to use.
      Services are retrieved by components via their
      <code class="classname">ServiceProvider</code> class implementation.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8586"/>10.6.1.1. Managed services</h4></div></div></div><p>If your service ought to be started when Hibernate Search starts
        and stopped when Hibernate Search stops, you can use a managed
        service. Make sure to properly implement the
        <code class="methodname">start</code> and <code class="methodname">stop</code>
        methods of <code class="classname">ServiceProvider</code>. When the service is
        requested, the <code class="methodname">getService</code> method is
        called.</p><div class="example"><a id="d0e8603"/><p class="title"><b>Example 10.7. Example of ServiceProvider implementation</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">class</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CacheServiceProvider</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">ServiceProvider</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">Cache</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">CacheManager</span><span class="java_plain">&nbsp;manager</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;start</span><span class="java_separator">(</span><span class="java_type">Properties</span><span class="java_plain">&nbsp;properties</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">read&nbsp;configuration</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manager&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">CacheManager</span><span class="java_separator">(</span><span class="java_plain">properties</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Cache</span><span class="java_plain">&nbsp;getService</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;manager</span><span class="java_separator">.</span><span class="java_plain">getCache</span><span class="java_separator">(</span><span class="java_plain">DEFAULT</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;stop</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manager</span><span class="java_separator">.</span><span class="java_plain">close</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The <code class="classname">ServiceProvider</code> implementation must
          have a no-arg constructor.</p></div><p>To be transparently discoverable, such service should have an
        accompanying
        <code class="filename">META-INF/services/org.hibernate.search.spi.ServiceProvider</code>
        whose content list the (various) service provider
        implementation(s).</p><div class="example"><a id="d0e8619"/><p class="title"><b>Example 10.8. Content of
          META-INF/services/org.hibernate.search.spi.ServiceProvider</b></p><div class="example-contents"><pre class="programlisting">com.acme.infra.hibernate.CacheServiceProvider</pre></div></div><br class="example-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e8624"/>10.6.1.2. Provided services</h4></div></div></div><p>Alternatively, the service can be provided by the environment
        bootstrapping Hibernate Search. For example, Infinispan which uses
        Hibernate Search as its internal search engine can pass the
        <code class="classname">CacheContainer</code> to Hibernate Search. In this
        case, the <code class="classname">CacheContainer</code> instance is not
        managed by Hibernate Search and the
        <code class="methodname">start</code>/<code class="methodname">stop</code> methods
        of its corresponding service provider will not be used.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Provided services have priority over managed services. If a
          provider service is registered with the same
          <code class="classname">ServiceProvider</code> class as a managed service,
          the provided service will be used.</p></div><p>The provided services are passed to Hibernate Search via the
        <code class="classname">SearchConfiguration</code> interface
        (<code class="methodname">getProvidedServices</code>).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Provided services are used by frameworks controlling the
          lifecycle of Hibernate Search and not by traditional users.</p></div><p>If, as a user, you want to retrieve a service instance from the
        environment, use registry services like JNDI and look the service up
        in the provider.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e8660"/>10.6.2. Using a service</h3></div></div></div><p>Many of of the pluggable contracts of Hibernate Search can use
      services. Services are accessible via the
      <code class="classname">BuildContext</code> interface.</p><div class="example"><a id="d0e8668"/><p class="title"><b>Example 10.9. Example of a directory provider using a cache service</b></p><div class="example-contents"><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"><!-- <br/> --><span class="java_keyword">public</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">CustomDirectoryProvider</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_keyword">implements</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_type">DirectoryProvider</span><!-- <br/> --><span class="java_operator">&lt;</span><!-- <br/> --><span class="java_type">RAMDirectory</span><!-- <br/> --><span class="java_operator">&gt;</span><!-- <br/> --><span class="java_plain">&nbsp;</span><!-- <br/> --><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">BuildContext</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;initialize</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;directoryProviderName</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Properties</span><span class="java_plain">&nbsp;properties</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">BuildContext</span><span class="java_plain">&nbsp;context</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">initialize</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">context&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;context</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;start</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Cache</span><span class="java_plain">&nbsp;cache&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;context</span><span class="java_separator">.</span><span class="java_plain">requestService</span><span class="java_separator">(</span><span class="java_type">CacheServiceProvider</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">use&nbsp;cache</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">RAMDirectory</span><span class="java_plain">&nbsp;getDirectory</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;use&nbsp;cache</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;stop</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">stop&nbsp;services</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context</span><span class="java_separator">.</span><span class="java_plain">releaseService</span><span class="java_separator">(</span><span class="java_type">CacheServiceProvider</span><span class="java_separator">.</span><span class="java_keyword">class</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span></pre></div></div><br class="example-break"/><p>When you request a service, an instance of the service is served
      to you. Make sure to then release the service. This is fundamental. Note
      that the service can be released in the
      <code class="methodname">DirectoryProvider.stop</code> method if the
      <code class="classname">DirectoryProvider</code> uses the service during its
      lifetime or could be released right away of the service is simply used
      at initialization time.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8681"/>10.7. Customizing Lucene's scoring formula</h2></div></div></div><p>Lucene allows the user to customize its scoring formula by extending
    <code class="classname">org.apache.lucene.search.Similarity</code>. The abstract
    methods defined in this class match the factors of the following formula
    calculating the score of query q for document d:</p><p><span class="bold"><strong>score(q,d) = coord(q,d) · queryNorm(q) · ∑
    <sub>t in q</sub> ( tf(t in d) · idf(t)
    <sup>2</sup> · t.getBoost() · norm(t,d) )
    </strong></span></p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th align="center">Factor</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">tf(t ind)</td><td align="left">Term frequency factor for the term (t) in the document
              (d).</td></tr><tr><td align="left">idf(t)</td><td align="left">Inverse document frequency of the term.</td></tr><tr><td align="left">coord(q,d)</td><td align="left">Score factor based on how many of the query terms are
              found in the specified document.</td></tr><tr><td align="left">queryNorm(q)</td><td align="left">Normalizing factor used to make scores between queries
              comparable.</td></tr><tr><td align="left">t.getBoost()</td><td align="left">Field boost.</td></tr><tr><td align="left">norm(t,d)</td><td align="left">Encapsulates a few (indexing time) boost and length
              factors.</td></tr></tbody></table></div><p>It is beyond the scope of this manual to explain this
    formula in more detail. Please refer to
    <code class="classname">Similarity</code>'s Javadocs for more information.</p><p>Hibernate Search provides two ways to modify Lucene's similarity
    calculation.</p><p>First you can set the default similarity by specifying the fully
    specified classname of your <code class="classname">Similarity</code>
    implementation using the property
    <code class="constant">hibernate.search.similarity</code>. The default value is
    <code class="classname">org.apache.lucene.search.DefaultSimilarity</code>.</p><p>Secondly, you can override the similarity used for a specific index
    by setting the <code class="literal">similarity</code> property for this index (see
    <a href="#search-configuration-directory" title="3.3. Directory configuration">Section 3.3, “Directory configuration”</a> for more information
    about index configuration):</p><pre class="programlisting">hibernate.search.[default|&lt;indexname&gt;].similarity = my.custom.Similarity</pre><p>As an example, let's assume it is not important how often a term
    appears in a document. Documents with a single occurrence of the term
    should be scored the same as documents with multiple occurrences. In this
    case your custom implementation of the method <code class="methodname">tf(float freq)
    </code> should return 1.0.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>When two entities share the same index they must declare the same
      <code class="classname">Similarity</code> implementation.</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The use of <code class="classname">@Similarity</code> which was used to
      configure the similarity on a class level is deprecated since Hibernate
      Search 4.4. Instead of using the annotation use the configuration
      property.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e8782"/>Chapter 11. Further reading</h2></div></div></div><p>Last but not least, a few pointers to further information. We highly
  recommend you to get a copy <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.manning.com/bernard/">Hibernate Search in Action</a>.
  This excellent book covers Hibernate Search in much more depth than this
  online documentation can and has a great range of additional examples. If
  you want to increase your knowledge of Lucene we recommend <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.manning.com/hatcher3/">Lucene in Action (Second
  Edition)</a>. Because Hibernate Search's functionality is tightly
  coupled to Hibernate Core it is a good idea to understand Hibernate.
  Start with the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.hibernate.org/docs">online
  documentation</a> or get hold of a copy of <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.manning.com/bauer2/">Java Persistence with
  Hibernate</a>.</p><p>If you have any further questions regarding Hibernate Search or want
  to share some of your use cases have a look at the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://community.jboss.org/en/hibernate/search">Hibernate Search
  Wiki</a> and the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://forum.hibernate.org/viewforum.php?f=9">Hibernate Search
  Forum</a>. We are looking forward hearing from you.</p><p>In case you would like to report a bug use the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://hibernate.atlassian.net/browse/HSEARCH">Hibernate
  Search JIRA</a> instance. Feedback is always welcome!</p></div></div><HR xmlns=""/><a xmlns="" href=""/></body></html>